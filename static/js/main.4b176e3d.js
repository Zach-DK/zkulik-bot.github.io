/*! For license information please see main.4b176e3d.js.LICENSE.txt */
(()=>{var e={21:(e,t,n)=>{"use strict";const r=n(5059);e.exports=(e,t)=>{const n=r(e,null,!0),a=r(t,null,!0),s=n.compare(a);if(0===s)return null;const i=s>0,o=i?n:a,l=i?a:n,c=!!o.prerelease.length;if(!!l.prerelease.length&&!c){if(!l.patch&&!l.minor)return"major";if(0===l.compareMain(o))return l.minor&&!l.patch?"minor":"patch"}const u=c?"pre":"";return n.major!==a.major?u+"major":n.minor!==a.minor?u+"minor":n.patch!==a.patch?u+"patch":"prerelease"}},76:(e,t,n)=>{"use strict";const r=n(1595);e.exports=(e,t,n)=>0!==r(e,t,n)},209:(e,t,n)=>{"use strict";const r=n(1595);e.exports=(e,t,n)=>r(e,t,n)>0},422:(e,t,n)=>{"use strict";const r=n(6357),a=n(9325),{ANY:s}=a,i=n(5252),o=n(8125),l=n(209),c=n(4238),u=n(4695),d=n(3042);e.exports=(e,t,n,h)=>{let f,p,m,g,y;switch(e=new r(e,h),t=new i(t,h),n){case">":f=l,p=u,m=c,g=">",y=">=";break;case"<":f=c,p=d,m=l,g="<",y="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(o(e,t,h))return!1;for(let r=0;r<t.set.length;++r){const n=t.set[r];let i=null,o=null;if(n.forEach(e=>{e.semver===s&&(e=new a(">=0.0.0")),i=i||e,o=o||e,f(e.semver,i.semver,h)?i=e:m(e.semver,o.semver,h)&&(o=e)}),i.operator===g||i.operator===y)return!1;if((!o.operator||o.operator===g)&&p(e,o.semver))return!1;if(o.operator===y&&m(e,o.semver))return!1}return!0}},579:(e,t,n)=>{"use strict";e.exports=n(2799)},705:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){let r=0,a=e.length;for(;a>0;){const s=a/2|0;let i=r+s;n(e[i],t)<=0?(r=++i,a-=s+1):a=s}return r}},1491:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(705);t.default=class{constructor(){this._queue=[]}enqueue(e,t){const n={priority:(t=Object.assign({priority:0},t)).priority,run:e};if(this.size&&this._queue[this.size-1].priority>=t.priority)return void this._queue.push(n);const a=r.default(this._queue,n,(e,t)=>t.priority-e.priority);this._queue.splice(a,0,n)}dequeue(){const e=this._queue.shift();return null===e||void 0===e?void 0:e.run}filter(e){return this._queue.filter(t=>t.priority===e.priority).map(e=>e.run)}get size(){return this._queue.length}}},1492:(e,t,n)=>{"use strict";const r=n(6357);e.exports=(e,t,n,a,s)=>{"string"===typeof n&&(s=a,a=n,n=void 0);try{return new r(e instanceof r?e.version:e,n).inc(t,a,s).version}catch(i){return null}}},1595:(e,t,n)=>{"use strict";const r=n(6357);e.exports=(e,t,n)=>new r(e,n).compare(new r(t,n))},1634:(e,t,n)=>{"use strict";const r=n(4570);e.exports=(e,t)=>e.sort((e,n)=>r(n,e,t))},1824:(e,t,n)=>{"use strict";const r=n(1595);e.exports=(e,t,n)=>0===r(e,t,n)},2027:(e,t,n)=>{"use strict";const r=n(5252);e.exports=(e,t)=>{try{return new r(e,t).range||"*"}catch(n){return null}}},2233:e=>{"use strict";var t=Object.prototype.hasOwnProperty,n="~";function r(){}function a(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function s(e,t,r,s,i){if("function"!==typeof r)throw new TypeError("The listener must be a function");var o=new a(r,s||e,i),l=n?n+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function i(e,t){0===--e._eventsCount?e._events=new r:delete e._events[t]}function o(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),o.prototype.eventNames=function(){var e,r,a=[];if(0===this._eventsCount)return a;for(r in e=this._events)t.call(e,r)&&a.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?a.concat(Object.getOwnPropertySymbols(e)):a},o.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var a=0,s=r.length,i=new Array(s);a<s;a++)i[a]=r[a].fn;return i},o.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},o.prototype.emit=function(e,t,r,a,s,i){var o=n?n+e:e;if(!this._events[o])return!1;var l,c,u=this._events[o],d=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),d){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,r),!0;case 4:return u.fn.call(u.context,t,r,a),!0;case 5:return u.fn.call(u.context,t,r,a,s),!0;case 6:return u.fn.call(u.context,t,r,a,s,i),!0}for(c=1,l=new Array(d-1);c<d;c++)l[c-1]=arguments[c];u.fn.apply(u.context,l)}else{var h,f=u.length;for(c=0;c<f;c++)switch(u[c].once&&this.removeListener(e,u[c].fn,void 0,!0),d){case 1:u[c].fn.call(u[c].context);break;case 2:u[c].fn.call(u[c].context,t);break;case 3:u[c].fn.call(u[c].context,t,r);break;case 4:u[c].fn.call(u[c].context,t,r,a);break;default:if(!l)for(h=1,l=new Array(d-1);h<d;h++)l[h-1]=arguments[h];u[c].fn.apply(u[c].context,l)}}return!0},o.prototype.on=function(e,t,n){return s(this,e,t,n,!1)},o.prototype.once=function(e,t,n){return s(this,e,t,n,!0)},o.prototype.removeListener=function(e,t,r,a){var s=n?n+e:e;if(!this._events[s])return this;if(!t)return i(this,s),this;var o=this._events[s];if(o.fn)o.fn!==t||a&&!o.once||r&&o.context!==r||i(this,s);else{for(var l=0,c=[],u=o.length;l<u;l++)(o[l].fn!==t||a&&!o[l].once||r&&o[l].context!==r)&&c.push(o[l]);c.length?this._events[s]=1===c.length?c[0]:c:i(this,s)}return this},o.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&i(this,t)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=n,o.EventEmitter=o,e.exports=o},2527:(e,t,n)=>{"use strict";const r=n(5252);e.exports=(e,t,n)=>(e=new r(e,n),t=new r(t,n),e.intersects(t,n))},2569:(e,t,n)=>{"use strict";const r=n(9764),a=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class s extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,({message:e}=e)):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}const i=(e,t)=>new Promise((n,i)=>{t={onFailedAttempt:()=>{},retries:10,...t};const o=r.operation(t);o.attempt(async r=>{try{n(await e(r))}catch(c){if(!(c instanceof Error))return void i(new TypeError(`Non-error was thrown: "${c}". You should only throw errors.`));if(c instanceof s)o.stop(),i(c.originalError);else if(c instanceof TypeError&&(l=c.message,!a.includes(l)))o.stop(),i(c);else{((e,t,n)=>{const r=n.retries-(t-1);e.attemptNumber=t,e.retriesLeft=r})(c,r,t);try{await t.onFailedAttempt(c)}catch(c){return void i(c)}o.retry(c)||i(o.mainError())}}var l})});e.exports=i,e.exports.default=i,e.exports.AbortError=s},2600:e=>{"use strict";const t=/[\p{Lu}]/u,n=/[\p{Ll}]/u,r=/^[\p{Lu}](?![\p{Lu}])/gu,a=/([\p{Alpha}\p{N}_]|$)/u,s=/[_.\- ]+/,i=new RegExp("^"+s.source),o=new RegExp(s.source+a.source,"gu"),l=new RegExp("\\d+"+a.source,"gu"),c=(e,a)=>{if("string"!==typeof e&&!Array.isArray(e))throw new TypeError("Expected the input to be `string | string[]`");if(a={pascalCase:!1,preserveConsecutiveUppercase:!1,...a},0===(e=Array.isArray(e)?e.map(e=>e.trim()).filter(e=>e.length).join("-"):e.trim()).length)return"";const s=!1===a.locale?e=>e.toLowerCase():e=>e.toLocaleLowerCase(a.locale),c=!1===a.locale?e=>e.toUpperCase():e=>e.toLocaleUpperCase(a.locale);if(1===e.length)return a.pascalCase?c(e):s(e);return e!==s(e)&&(e=((e,r,a)=>{let s=!1,i=!1,o=!1;for(let l=0;l<e.length;l++){const c=e[l];s&&t.test(c)?(e=e.slice(0,l)+"-"+e.slice(l),s=!1,o=i,i=!0,l++):i&&o&&n.test(c)?(e=e.slice(0,l-1)+"-"+e.slice(l-1),o=i,i=!1,s=!0):(s=r(c)===c&&a(c)!==c,o=i,i=a(c)===c&&r(c)!==c)}return e})(e,s,c)),e=e.replace(i,""),e=a.preserveConsecutiveUppercase?((e,t)=>(r.lastIndex=0,e.replace(r,e=>t(e))))(e,s):s(e),a.pascalCase&&(e=c(e.charAt(0))+e.slice(1)),((e,t)=>(o.lastIndex=0,l.lastIndex=0,e.replace(o,(e,n)=>t(n)).replace(l,e=>t(e))))(e,c)};e.exports=c,e.exports.default=c},2697:e=>{"use strict";e.exports=class{constructor(){this.max=1e3,this.map=new Map}get(e){const t=this.map.get(e);return void 0===t?void 0:(this.map.delete(e),this.map.set(e,t),t)}delete(e){return this.map.delete(e)}set(e,t){if(!this.delete(e)&&void 0!==t){if(this.map.size>=this.max){const e=this.map.keys().next().value;this.delete(e)}this.map.set(e,t)}return this}}},2700:e=>{function t(e,t){"boolean"===typeof t&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}e.exports=t,t.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},t.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},t.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=(new Date).getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var n=this._timeouts.shift();if(void 0===n){if(!this._cachedTimeouts)return!1;this._errors.splice(0,this._errors.length-1),n=this._cachedTimeouts.slice(-1)}var r=this;return this._timer=setTimeout(function(){r._attempts++,r._operationTimeoutCb&&(r._timeout=setTimeout(function(){r._operationTimeoutCb(r._attempts)},r._operationTimeout),r._options.unref&&r._timeout.unref()),r._fn(r._attempts)},n),this._options.unref&&this._timer.unref(),!0},t.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var n=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){n._operationTimeoutCb()},n._operationTimeout)),this._operationStart=(new Date).getTime(),this._fn(this._attempts)},t.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},t.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},t.prototype.start=t.prototype.try,t.prototype.errors=function(){return this._errors},t.prototype.attempts=function(){return this._attempts},t.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},t=null,n=0,r=0;r<this._errors.length;r++){var a=this._errors[r],s=a.message,i=(e[s]||0)+1;e[s]=i,i>=n&&(t=a,n=i)}return t}},2799:(e,t)=>{"use strict";var n=Symbol.for("react.transitional.element");function r(e,t,r){var a=null;if(void 0!==r&&(a=""+r),void 0!==t.key&&(a=""+t.key),"key"in t)for(var s in r={},t)"key"!==s&&(r[s]=t[s]);else r=t;return t=r.ref,{$$typeof:n,type:e,key:a,ref:void 0!==t?t:null,props:r}}Symbol.for("react.fragment"),t.jsx=r,t.jsxs=r},2941:(e,t,n)=>{"use strict";const r=n(6357),a=n(5252);e.exports=(e,t,n)=>{let s=null,i=null,o=null;try{o=new a(t,n)}catch(l){return null}return e.forEach(e=>{o.test(e)&&(s&&1!==i.compare(e)||(s=e,i=new r(s,n)))}),s}},2990:e=>{"use strict";const t=/^[0-9]+$/,n=(e,n)=>{const r=t.test(e),a=t.test(n);return r&&a&&(e=+e,n=+n),e===n?0:r&&!a?-1:a&&!r?1:e<n?-1:1};e.exports={compareIdentifiers:n,rcompareIdentifiers:(e,t)=>n(t,e)}},3011:(e,t,n)=>{"use strict";const r=n(1595);e.exports=(e,t,n)=>r(t,e,n)},3042:(e,t,n)=>{"use strict";const r=n(1595);e.exports=(e,t,n)=>r(e,t,n)>=0},3737:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(2233),a=n(6072),s=n(1491),i=()=>{},o=new a.TimeoutError;t.default=class extends r{constructor(e){var t,n,r,a;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=i,this._resolveIdle=i,!("number"===typeof(e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:s.default},e)).intervalCap&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${null!==(n=null===(t=e.intervalCap)||void 0===t?void 0:t.toString())&&void 0!==n?n:""}\` (${typeof e.intervalCap})`);if(void 0===e.interval||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${null!==(a=null===(r=e.interval)||void 0===r?void 0:r.toString())&&void 0!==a?a:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||0===e.interval,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=!0===e.throwOnTimeout,this._isPaused=!1===e.autoStart}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=i,0===this._pendingCount&&(this._resolveIdle(),this._resolveIdle=i,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){const e=Date.now();if(void 0===this._intervalId){const t=this._intervalEnd-e;if(!(t<0))return void 0===this._timeoutId&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},t)),!0;this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0}return!1}_tryToStartAnother(){if(0===this._queue.size)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){const e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){const t=this._queue.dequeue();return!!t&&(this.emit("active"),t(),e&&this._initializeIntervalIfNeeded(),!0)}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||void 0!==this._intervalId||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){0===this._intervalCount&&0===this._pendingCount&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!("number"===typeof e&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise((n,r)=>{this._queue.enqueue(async()=>{this._pendingCount++,this._intervalCount++;try{const s=void 0===this._timeout&&void 0===t.timeout?e():a.default(Promise.resolve(e()),void 0===t.timeout?this._timeout:t.timeout,()=>{(void 0===t.throwOnTimeout?this._throwOnTimeout:t.throwOnTimeout)&&r(o)});n(await s)}catch(s){r(s)}this._next()},t),this._tryToStartAnother(),this.emit("add")})}async addAll(e,t){return Promise.all(e.map(async e=>this.add(e,t)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(0!==this._queue.size)return new Promise(e=>{const t=this._resolveEmpty;this._resolveEmpty=()=>{t(),e()}})}async onIdle(){if(0!==this._pendingCount||0!==this._queue.size)return new Promise(e=>{const t=this._resolveIdle;this._resolveIdle=()=>{t(),e()}})}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}}},3868:(e,t,n)=>{"use strict";const r=n(5252);e.exports=(e,t)=>new r(e,t).set.map(e=>e.map(e=>e.value).join(" ").trim().split(" "))},3914:(e,t,n)=>{var r=n(2700);t.operation=function(e){var n=t.timeouts(e);return new r(n,{forever:e&&(e.forever||e.retries===1/0),unref:e&&e.unref,maxRetryTime:e&&e.maxRetryTime})},t.timeouts=function(e){if(e instanceof Array)return[].concat(e);var t={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var n in e)t[n]=e[n];if(t.minTimeout>t.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var r=[],a=0;a<t.retries;a++)r.push(this.createTimeout(a,t));return e&&e.forever&&!r.length&&r.push(this.createTimeout(a,t)),r.sort(function(e,t){return e-t}),r},t.createTimeout=function(e,t){var n=t.randomize?Math.random()+1:1,r=Math.round(n*Math.max(t.minTimeout,1)*Math.pow(t.factor,e));return r=Math.min(r,t.maxTimeout)},t.wrap=function(e,n,r){if(n instanceof Array&&(r=n,n=null),!r)for(var a in r=[],e)"function"===typeof e[a]&&r.push(a);for(var s=0;s<r.length;s++){var i=r[s],o=e[i];e[i]=function(r){var a=t.operation(n),s=Array.prototype.slice.call(arguments,1),i=s.pop();s.push(function(e){a.retry(e)||(e&&(arguments[0]=a.mainError()),i.apply(this,arguments))}),a.attempt(function(){r.apply(e,s)})}.bind(e,o),e[i].options=n}}},4073:(e,t,n)=>{"use strict";const r=n(5059);e.exports=(e,t)=>{const n=r(e.trim().replace(/^[=v]+/,""),t);return n?n.version:null}},4152:e=>{"use strict";e.exports=(e,t)=>(t=t||(()=>{}),e.then(e=>new Promise(e=>{e(t())}).then(()=>e),e=>new Promise(e=>{e(t())}).then(()=>{throw e})))},4192:(e,t,n)=>{"use strict";const r=n(6357),a=n(5252),s=n(209);e.exports=(e,t)=>{e=new a(e,t);let n=new r("0.0.0");if(e.test(n))return n;if(n=new r("0.0.0-0"),e.test(n))return n;n=null;for(let a=0;a<e.set.length;++a){const t=e.set[a];let i=null;t.forEach(e=>{const t=new r(e.semver.version);switch(e.operator){case">":0===t.prerelease.length?t.patch++:t.prerelease.push(0),t.raw=t.format();case"":case">=":i&&!s(t,i)||(i=t);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${e.operator}`)}}),!i||n&&!s(n,i)||(n=i)}return n&&e.test(n)?n:null}},4238:(e,t,n)=>{"use strict";const r=n(1595);e.exports=(e,t,n)=>r(e,t,n)<0},4288:(e,t)=>{"use strict";var n=Symbol.for("react.transitional.element"),r=Symbol.for("react.portal"),a=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),o=Symbol.for("react.consumer"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),f=Symbol.iterator;var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,g={};function y(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||p}function b(){}function v(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||p}y.prototype.isReactComponent={},y.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},y.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},b.prototype=y.prototype;var w=v.prototype=new b;w.constructor=v,m(w,y.prototype),w.isPureReactComponent=!0;var _=Array.isArray,S={H:null,A:null,T:null,S:null,V:null},k=Object.prototype.hasOwnProperty;function E(e,t,r,a,s,i){return r=i.ref,{$$typeof:n,type:e,key:t,ref:void 0!==r?r:null,props:i}}function x(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var O=/\/+/g;function A(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function I(){}function $(e,t,a,s,i){var o=typeof e;"undefined"!==o&&"boolean"!==o||(e=null);var l,c,u=!1;if(null===e)u=!0;else switch(o){case"bigint":case"string":case"number":u=!0;break;case"object":switch(e.$$typeof){case n:case r:u=!0;break;case h:return $((u=e._init)(e._payload),t,a,s,i)}}if(u)return i=i(e),u=""===s?"."+A(e,0):s,_(i)?(a="",null!=u&&(a=u.replace(O,"$&/")+"/"),$(i,t,a,"",function(e){return e})):null!=i&&(x(i)&&(l=i,c=a+(null==i.key||e&&e.key===i.key?"":(""+i.key).replace(O,"$&/")+"/")+u,i=E(l.type,c,void 0,0,0,l.props)),t.push(i)),1;u=0;var d,p=""===s?".":s+":";if(_(e))for(var m=0;m<e.length;m++)u+=$(s=e[m],t,a,o=p+A(s,m),i);else if("function"===typeof(m=null===(d=e)||"object"!==typeof d?null:"function"===typeof(d=f&&d[f]||d["@@iterator"])?d:null))for(e=m.call(e),m=0;!(s=e.next()).done;)u+=$(s=s.value,t,a,o=p+A(s,m++),i);else if("object"===o){if("function"===typeof e.then)return $(function(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:switch("string"===typeof e.status?e.then(I,I):(e.status="pending",e.then(function(t){"pending"===e.status&&(e.status="fulfilled",e.value=t)},function(t){"pending"===e.status&&(e.status="rejected",e.reason=t)})),e.status){case"fulfilled":return e.value;case"rejected":throw e.reason}}throw e}(e),t,a,s,i);throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.")}return u}function T(e,t,n){if(null==e)return e;var r=[],a=0;return $(e,r,"","",function(e){return t.call(n,e,a++)}),r}function P(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var R="function"===typeof reportError?reportError:function(e){if("object"===typeof window&&"function"===typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"===typeof e&&null!==e&&"string"===typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"===typeof process&&"function"===typeof process.emit)return void process.emit("uncaughtException",e);console.error(e)};function C(){}t.Children={map:T,forEach:function(e,t,n){T(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return T(e,function(){t++}),t},toArray:function(e){return T(e,function(e){return e})||[]},only:function(e){if(!x(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=y,t.Fragment=a,t.Profiler=i,t.PureComponent=v,t.StrictMode=s,t.Suspense=u,t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=S,t.__COMPILER_RUNTIME={__proto__:null,c:function(e){return S.H.useMemoCache(e)}},t.cache=function(e){return function(){return e.apply(null,arguments)}},t.cloneElement=function(e,t,n){if(null===e||void 0===e)throw Error("The argument must be a React element, but you passed "+e+".");var r=m({},e.props),a=e.key;if(null!=t)for(s in void 0!==t.ref&&void 0,void 0!==t.key&&(a=""+t.key),t)!k.call(t,s)||"key"===s||"__self"===s||"__source"===s||"ref"===s&&void 0===t.ref||(r[s]=t[s]);var s=arguments.length-2;if(1===s)r.children=n;else if(1<s){for(var i=Array(s),o=0;o<s;o++)i[o]=arguments[o+2];r.children=i}return E(e.type,a,void 0,0,0,r)},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider=e,e.Consumer={$$typeof:o,_context:e},e},t.createElement=function(e,t,n){var r,a={},s=null;if(null!=t)for(r in void 0!==t.key&&(s=""+t.key),t)k.call(t,r)&&"key"!==r&&"__self"!==r&&"__source"!==r&&(a[r]=t[r]);var i=arguments.length-2;if(1===i)a.children=n;else if(1<i){for(var o=Array(i),l=0;l<i;l++)o[l]=arguments[l+2];a.children=o}if(e&&e.defaultProps)for(r in i=e.defaultProps)void 0===a[r]&&(a[r]=i[r]);return E(e,s,void 0,0,0,a)},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=x,t.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:P}},t.memo=function(e,t){return{$$typeof:d,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=S.T,n={};S.T=n;try{var r=e(),a=S.S;null!==a&&a(n,r),"object"===typeof r&&null!==r&&"function"===typeof r.then&&r.then(C,R)}catch(s){R(s)}finally{S.T=t}},t.unstable_useCacheRefresh=function(){return S.H.useCacheRefresh()},t.use=function(e){return S.H.use(e)},t.useActionState=function(e,t,n){return S.H.useActionState(e,t,n)},t.useCallback=function(e,t){return S.H.useCallback(e,t)},t.useContext=function(e){return S.H.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e,t){return S.H.useDeferredValue(e,t)},t.useEffect=function(e,t,n){var r=S.H;if("function"===typeof n)throw Error("useEffect CRUD overload is not enabled in this build of React.");return r.useEffect(e,t)},t.useId=function(){return S.H.useId()},t.useImperativeHandle=function(e,t,n){return S.H.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return S.H.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return S.H.useLayoutEffect(e,t)},t.useMemo=function(e,t){return S.H.useMemo(e,t)},t.useOptimistic=function(e,t){return S.H.useOptimistic(e,t)},t.useReducer=function(e,t,n){return S.H.useReducer(e,t,n)},t.useRef=function(e){return S.H.useRef(e)},t.useState=function(e){return S.H.useState(e)},t.useSyncExternalStore=function(e,t,n){return S.H.useSyncExternalStore(e,t,n)},t.useTransition=function(){return S.H.useTransition()},t.version="19.1.0"},4375:(e,t)=>{"use strict";t.byteLength=function(e){var t=o(e),n=t[0],r=t[1];return 3*(n+r)/4-r},t.toByteArray=function(e){var t,n,s=o(e),i=s[0],l=s[1],c=new a(function(e,t,n){return 3*(t+n)/4-n}(0,i,l)),u=0,d=l>0?i-4:i;for(n=0;n<d;n+=4)t=r[e.charCodeAt(n)]<<18|r[e.charCodeAt(n+1)]<<12|r[e.charCodeAt(n+2)]<<6|r[e.charCodeAt(n+3)],c[u++]=t>>16&255,c[u++]=t>>8&255,c[u++]=255&t;2===l&&(t=r[e.charCodeAt(n)]<<2|r[e.charCodeAt(n+1)]>>4,c[u++]=255&t);1===l&&(t=r[e.charCodeAt(n)]<<10|r[e.charCodeAt(n+1)]<<4|r[e.charCodeAt(n+2)]>>2,c[u++]=t>>8&255,c[u++]=255&t);return c},t.fromByteArray=function(e){for(var t,r=e.length,a=r%3,s=[],i=16383,o=0,l=r-a;o<l;o+=i)s.push(c(e,o,o+i>l?l:o+i));1===a?(t=e[r-1],s.push(n[t>>2]+n[t<<4&63]+"==")):2===a&&(t=(e[r-2]<<8)+e[r-1],s.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"="));return s.join("")};for(var n=[],r=[],a="undefined"!==typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0;i<64;++i)n[i]=s[i],r[s.charCodeAt(i)]=i;function o(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function l(e){return n[e>>18&63]+n[e>>12&63]+n[e>>6&63]+n[63&e]}function c(e,t,n){for(var r,a=[],s=t;s<n;s+=3)r=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),a.push(l(r));return a.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},4391:(e,t,n)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(7004)},4570:(e,t,n)=>{"use strict";const r=n(6357);e.exports=(e,t,n)=>{const a=new r(e,n),s=new r(t,n);return a.compare(s)||a.compareBuild(s)}},4695:(e,t,n)=>{"use strict";const r=n(1595);e.exports=(e,t,n)=>r(e,t,n)<=0},4806:e=>{"use strict";const t=Object.freeze({loose:!0}),n=Object.freeze({});e.exports=e=>e?"object"!==typeof e?t:e:n},5043:(e,t,n)=>{"use strict";e.exports=n(4288)},5059:(e,t,n)=>{"use strict";const r=n(6357);e.exports=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e instanceof r)return e;try{return new r(e,t)}catch(a){if(!n)return null;throw a}}},5210:(e,t,n)=>{"use strict";const r=n(4570);e.exports=(e,t)=>e.sort((e,n)=>r(e,n,t))},5252:(e,t,n)=>{"use strict";const r=/\s+/g;class a{constructor(e,t){if(t=i(t),e instanceof a)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new a(e.raw,t);if(e instanceof o)return this.raw=e.value,this.set=[[e]],this.formatted=void 0,this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e.trim().replace(r," "),this.set=this.raw.split("||").map(e=>this.parseRange(e.trim())).filter(e=>e.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const e=this.set[0];if(this.set=this.set.filter(e=>!y(e[0])),0===this.set.length)this.set=[e];else if(this.set.length>1)for(const t of this.set)if(1===t.length&&b(t[0])){this.set=[t];break}}this.formatted=void 0}get range(){if(void 0===this.formatted){this.formatted="";for(let e=0;e<this.set.length;e++){e>0&&(this.formatted+="||");const t=this.set[e];for(let e=0;e<t.length;e++)e>0&&(this.formatted+=" "),this.formatted+=t[e].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(e){const t=((this.options.includePrerelease&&m)|(this.options.loose&&g))+":"+e,n=s.get(t);if(n)return n;const r=this.options.loose,a=r?u[d.HYPHENRANGELOOSE]:u[d.HYPHENRANGE];e=e.replace(a,T(this.options.includePrerelease)),l("hyphen replace",e),e=e.replace(u[d.COMPARATORTRIM],h),l("comparator trim",e),e=e.replace(u[d.TILDETRIM],f),l("tilde trim",e),e=e.replace(u[d.CARETTRIM],p),l("caret trim",e);let i=e.split(" ").map(e=>w(e,this.options)).join(" ").split(/\s+/).map(e=>$(e,this.options));r&&(i=i.filter(e=>(l("loose invalid filter",e,this.options),!!e.match(u[d.COMPARATORLOOSE])))),l("range list",i);const c=new Map,b=i.map(e=>new o(e,this.options));for(const s of b){if(y(s))return[s];c.set(s.value,s)}c.size>1&&c.has("")&&c.delete("");const v=[...c.values()];return s.set(t,v),v}intersects(e,t){if(!(e instanceof a))throw new TypeError("a Range is required");return this.set.some(n=>v(n,t)&&e.set.some(e=>v(e,t)&&n.every(n=>e.every(e=>n.intersects(e,t)))))}test(e){if(!e)return!1;if("string"===typeof e)try{e=new c(e,this.options)}catch(t){return!1}for(let n=0;n<this.set.length;n++)if(P(this.set[n],e,this.options))return!0;return!1}}e.exports=a;const s=new(n(2697)),i=n(4806),o=n(9325),l=n(7921),c=n(6357),{safeRe:u,t:d,comparatorTrimReplace:h,tildeTrimReplace:f,caretTrimReplace:p}=n(8969),{FLAG_INCLUDE_PRERELEASE:m,FLAG_LOOSE:g}=n(6615),y=e=>"<0.0.0-0"===e.value,b=e=>""===e.value,v=(e,t)=>{let n=!0;const r=e.slice();let a=r.pop();for(;n&&r.length;)n=r.every(e=>a.intersects(e,t)),a=r.pop();return n},w=(e,t)=>(l("comp",e,t),e=E(e,t),l("caret",e),e=S(e,t),l("tildes",e),e=O(e,t),l("xrange",e),e=I(e,t),l("stars",e),e),_=e=>!e||"x"===e.toLowerCase()||"*"===e,S=(e,t)=>e.trim().split(/\s+/).map(e=>k(e,t)).join(" "),k=(e,t)=>{const n=t.loose?u[d.TILDELOOSE]:u[d.TILDE];return e.replace(n,(t,n,r,a,s)=>{let i;return l("tilde",e,t,n,r,a,s),_(n)?i="":_(r)?i=`>=${n}.0.0 <${+n+1}.0.0-0`:_(a)?i=`>=${n}.${r}.0 <${n}.${+r+1}.0-0`:s?(l("replaceTilde pr",s),i=`>=${n}.${r}.${a}-${s} <${n}.${+r+1}.0-0`):i=`>=${n}.${r}.${a} <${n}.${+r+1}.0-0`,l("tilde return",i),i})},E=(e,t)=>e.trim().split(/\s+/).map(e=>x(e,t)).join(" "),x=(e,t)=>{l("caret",e,t);const n=t.loose?u[d.CARETLOOSE]:u[d.CARET],r=t.includePrerelease?"-0":"";return e.replace(n,(t,n,a,s,i)=>{let o;return l("caret",e,t,n,a,s,i),_(n)?o="":_(a)?o=`>=${n}.0.0${r} <${+n+1}.0.0-0`:_(s)?o="0"===n?`>=${n}.${a}.0${r} <${n}.${+a+1}.0-0`:`>=${n}.${a}.0${r} <${+n+1}.0.0-0`:i?(l("replaceCaret pr",i),o="0"===n?"0"===a?`>=${n}.${a}.${s}-${i} <${n}.${a}.${+s+1}-0`:`>=${n}.${a}.${s}-${i} <${n}.${+a+1}.0-0`:`>=${n}.${a}.${s}-${i} <${+n+1}.0.0-0`):(l("no pr"),o="0"===n?"0"===a?`>=${n}.${a}.${s}${r} <${n}.${a}.${+s+1}-0`:`>=${n}.${a}.${s}${r} <${n}.${+a+1}.0-0`:`>=${n}.${a}.${s} <${+n+1}.0.0-0`),l("caret return",o),o})},O=(e,t)=>(l("replaceXRanges",e,t),e.split(/\s+/).map(e=>A(e,t)).join(" ")),A=(e,t)=>{e=e.trim();const n=t.loose?u[d.XRANGELOOSE]:u[d.XRANGE];return e.replace(n,(n,r,a,s,i,o)=>{l("xRange",e,n,r,a,s,i,o);const c=_(a),u=c||_(s),d=u||_(i),h=d;return"="===r&&h&&(r=""),o=t.includePrerelease?"-0":"",c?n=">"===r||"<"===r?"<0.0.0-0":"*":r&&h?(u&&(s=0),i=0,">"===r?(r=">=",u?(a=+a+1,s=0,i=0):(s=+s+1,i=0)):"<="===r&&(r="<",u?a=+a+1:s=+s+1),"<"===r&&(o="-0"),n=`${r+a}.${s}.${i}${o}`):u?n=`>=${a}.0.0${o} <${+a+1}.0.0-0`:d&&(n=`>=${a}.${s}.0${o} <${a}.${+s+1}.0-0`),l("xRange return",n),n})},I=(e,t)=>(l("replaceStars",e,t),e.trim().replace(u[d.STAR],"")),$=(e,t)=>(l("replaceGTE0",e,t),e.trim().replace(u[t.includePrerelease?d.GTE0PRE:d.GTE0],"")),T=e=>(t,n,r,a,s,i,o,l,c,u,d,h)=>`${n=_(r)?"":_(a)?`>=${r}.0.0${e?"-0":""}`:_(s)?`>=${r}.${a}.0${e?"-0":""}`:i?`>=${n}`:`>=${n}${e?"-0":""}`} ${l=_(c)?"":_(u)?`<${+c+1}.0.0-0`:_(d)?`<${c}.${+u+1}.0-0`:h?`<=${c}.${u}.${d}-${h}`:e?`<${c}.${u}.${+d+1}-0`:`<=${l}`}`.trim(),P=(e,t,n)=>{for(let r=0;r<e.length;r++)if(!e[r].test(t))return!1;if(t.prerelease.length&&!n.includePrerelease){for(let n=0;n<e.length;n++)if(l(e[n].semver),e[n].semver!==o.ANY&&e[n].semver.prerelease.length>0){const r=e[n].semver;if(r.major===t.major&&r.minor===t.minor&&r.patch===t.patch)return!0}return!1}return!0}},5343:(e,t,n)=>{"use strict";const r=n(6357),a=n(5059),{safeRe:s,t:i}=n(8969);e.exports=(e,t)=>{if(e instanceof r)return e;if("number"===typeof e&&(e=String(e)),"string"!==typeof e)return null;let n=null;if((t=t||{}).rtl){const r=t.includePrerelease?s[i.COERCERTLFULL]:s[i.COERCERTL];let a;for(;(a=r.exec(e))&&(!n||n.index+n[0].length!==e.length);)n&&a.index+a[0].length===n.index+n[0].length||(n=a),r.lastIndex=a.index+a[1].length+a[2].length;r.lastIndex=-1}else n=e.match(t.includePrerelease?s[i.COERCEFULL]:s[i.COERCE]);if(null===n)return null;const o=n[2],l=n[3]||"0",c=n[4]||"0",u=t.includePrerelease&&n[5]?`-${n[5]}`:"",d=t.includePrerelease&&n[6]?`+${n[6]}`:"";return a(`${o}.${l}.${c}${u}${d}`,t)}},5415:(e,t,n)=>{"use strict";const r=n(5252),a=n(9325),{ANY:s}=a,i=n(8125),o=n(1595),l=[new a(">=0.0.0-0")],c=[new a(">=0.0.0")],u=(e,t,n)=>{if(e===t)return!0;if(1===e.length&&e[0].semver===s){if(1===t.length&&t[0].semver===s)return!0;e=n.includePrerelease?l:c}if(1===t.length&&t[0].semver===s){if(n.includePrerelease)return!0;t=c}const r=new Set;let a,u,f,p,m,g,y;for(const s of e)">"===s.operator||">="===s.operator?a=d(a,s,n):"<"===s.operator||"<="===s.operator?u=h(u,s,n):r.add(s.semver);if(r.size>1)return null;if(a&&u){if(f=o(a.semver,u.semver,n),f>0)return null;if(0===f&&(">="!==a.operator||"<="!==u.operator))return null}for(const s of r){if(a&&!i(s,String(a),n))return null;if(u&&!i(s,String(u),n))return null;for(const e of t)if(!i(s,String(e),n))return!1;return!0}let b=!(!u||n.includePrerelease||!u.semver.prerelease.length)&&u.semver,v=!(!a||n.includePrerelease||!a.semver.prerelease.length)&&a.semver;b&&1===b.prerelease.length&&"<"===u.operator&&0===b.prerelease[0]&&(b=!1);for(const s of t){if(y=y||">"===s.operator||">="===s.operator,g=g||"<"===s.operator||"<="===s.operator,a)if(v&&s.semver.prerelease&&s.semver.prerelease.length&&s.semver.major===v.major&&s.semver.minor===v.minor&&s.semver.patch===v.patch&&(v=!1),">"===s.operator||">="===s.operator){if(p=d(a,s,n),p===s&&p!==a)return!1}else if(">="===a.operator&&!i(a.semver,String(s),n))return!1;if(u)if(b&&s.semver.prerelease&&s.semver.prerelease.length&&s.semver.major===b.major&&s.semver.minor===b.minor&&s.semver.patch===b.patch&&(b=!1),"<"===s.operator||"<="===s.operator){if(m=h(u,s,n),m===s&&m!==u)return!1}else if("<="===u.operator&&!i(u.semver,String(s),n))return!1;if(!s.operator&&(u||a)&&0!==f)return!1}return!(a&&g&&!u&&0!==f)&&(!(u&&y&&!a&&0!==f)&&(!v&&!b))},d=(e,t,n)=>{if(!e)return t;const r=o(e.semver,t.semver,n);return r>0?e:r<0||">"===t.operator&&">="===e.operator?t:e},h=(e,t,n)=>{if(!e)return t;const r=o(e.semver,t.semver,n);return r<0?e:r>0||"<"===t.operator&&"<="===e.operator?t:e};e.exports=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(e===t)return!0;e=new r(e,n),t=new r(t,n);let a=!1;e:for(const r of e.set){for(const e of t.set){const t=u(r,e,n);if(a=a||null!==t,t)continue e}if(a)return!1}return!0}},5609:e=>{"use strict";e.exports=function(e,t){if("string"!==typeof e)throw new TypeError("Expected a string");return t="undefined"===typeof t?"_":t,e.replace(/([a-z\d])([A-Z])/g,"$1"+t+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+t+"$2").toLowerCase()}},5646:(e,t,n)=>{"use strict";e=n.nmd(e);const r=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return t=>`\x1b[${38+e};5;${t}m`},a=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(t,n,r)=>`\x1b[${38+e};2;${t};${n};${r}m`};Object.defineProperty(e,"exports",{enumerable:!0,get:function(){const e=new Map,t={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};t.color.gray=t.color.blackBright,t.bgColor.bgGray=t.bgColor.bgBlackBright,t.color.grey=t.color.blackBright,t.bgColor.bgGrey=t.bgColor.bgBlackBright;for(const[n,r]of Object.entries(t)){for(const[n,a]of Object.entries(r))t[n]={open:`\x1b[${a[0]}m`,close:`\x1b[${a[1]}m`},r[n]=t[n],e.set(a[0],a[1]);Object.defineProperty(t,n,{value:r,enumerable:!1})}return Object.defineProperty(t,"codes",{value:e,enumerable:!1}),t.color.close="\x1b[39m",t.bgColor.close="\x1b[49m",t.color.ansi256=r(),t.color.ansi16m=a(),t.bgColor.ansi256=r(10),t.bgColor.ansi16m=a(10),Object.defineProperties(t,{rgbToAnsi256:{value:(e,t,n)=>e===t&&t===n?e<8?16:e>248?231:Math.round((e-8)/247*24)+232:16+36*Math.round(e/255*5)+6*Math.round(t/255*5)+Math.round(n/255*5),enumerable:!1},hexToRgb:{value:e=>{const t=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(e.toString(16));if(!t)return[0,0,0];let{colorString:n}=t.groups;3===n.length&&(n=n.split("").map(e=>e+e).join(""));const r=Number.parseInt(n,16);return[r>>16&255,r>>8&255,255&r]},enumerable:!1},hexToAnsi256:{value:e=>t.rgbToAnsi256(...t.hexToRgb(e)),enumerable:!1}}),t}})},5896:(e,t)=>{"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,a=e[r];if(!(0<s(a,t)))break e;e[r]=t,e[n]=a,n=r}}function r(e){return 0===e.length?null:e[0]}function a(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,a=e.length,i=a>>>1;r<i;){var o=2*(r+1)-1,l=e[o],c=o+1,u=e[c];if(0>s(l,n))c<a&&0>s(u,l)?(e[r]=u,e[c]=n,r=c):(e[r]=l,e[o]=n,r=o);else{if(!(c<a&&0>s(u,n)))break e;e[r]=u,e[c]=n,r=c}}}return t}function s(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if(t.unstable_now=void 0,"object"===typeof performance&&"function"===typeof performance.now){var i=performance;t.unstable_now=function(){return i.now()}}else{var o=Date,l=o.now();t.unstable_now=function(){return o.now()-l}}var c=[],u=[],d=1,h=null,f=3,p=!1,m=!1,g=!1,y=!1,b="function"===typeof setTimeout?setTimeout:null,v="function"===typeof clearTimeout?clearTimeout:null,w="undefined"!==typeof setImmediate?setImmediate:null;function _(e){for(var t=r(u);null!==t;){if(null===t.callback)a(u);else{if(!(t.startTime<=e))break;a(u),t.sortIndex=t.expirationTime,n(c,t)}t=r(u)}}function S(e){if(g=!1,_(e),!m)if(null!==r(c))m=!0,E||(E=!0,k());else{var t=r(u);null!==t&&R(S,t.startTime-e)}}var k,E=!1,x=-1,O=5,A=-1;function I(){return!!y||!(t.unstable_now()-A<O)}function $(){if(y=!1,E){var e=t.unstable_now();A=e;var n=!0;try{e:{m=!1,g&&(g=!1,v(x),x=-1),p=!0;var s=f;try{t:{for(_(e),h=r(c);null!==h&&!(h.expirationTime>e&&I());){var i=h.callback;if("function"===typeof i){h.callback=null,f=h.priorityLevel;var o=i(h.expirationTime<=e);if(e=t.unstable_now(),"function"===typeof o){h.callback=o,_(e),n=!0;break t}h===r(c)&&a(c),_(e)}else a(c);h=r(c)}if(null!==h)n=!0;else{var l=r(u);null!==l&&R(S,l.startTime-e),n=!1}}break e}finally{h=null,f=s,p=!1}n=void 0}}finally{n?k():E=!1}}}if("function"===typeof w)k=function(){w($)};else if("undefined"!==typeof MessageChannel){var T=new MessageChannel,P=T.port2;T.port1.onmessage=$,k=function(){P.postMessage(null)}}else k=function(){b($,0)};function R(e,n){x=b(function(){e(t.unstable_now())},n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):O=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_next=function(e){switch(f){case 1:case 2:case 3:var t=3;break;default:t=f}var n=f;f=t;try{return e()}finally{f=n}},t.unstable_requestPaint=function(){y=!0},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=f;f=e;try{return t()}finally{f=n}},t.unstable_scheduleCallback=function(e,a,s){var i=t.unstable_now();switch("object"===typeof s&&null!==s?s="number"===typeof(s=s.delay)&&0<s?i+s:i:s=i,e){case 1:var o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}return e={id:d++,callback:a,priorityLevel:e,startTime:s,expirationTime:o=s+o,sortIndex:-1},s>i?(e.sortIndex=s,n(u,e),null===r(c)&&e===r(u)&&(g?(v(x),x=-1):g=!0,R(S,s-i))):(e.sortIndex=o,n(c,e),m||p||(m=!0,E||(E=!0,k()))),e},t.unstable_shouldYield=I,t.unstable_wrapCallback=function(e){var t=f;return function(){var n=f;f=t;try{return e.apply(this,arguments)}finally{f=n}}}},5919:(e,t,n)=>{"use strict";const r=n(422);e.exports=(e,t,n)=>r(e,t,"<",n)},5962:(e,t,n)=>{"use strict";const r=n(422);e.exports=(e,t,n)=>r(e,t,">",n)},5986:(e,t,n)=>{"use strict";const r=n(6357);e.exports=(e,t)=>new r(e,t).patch},6072:(e,t,n)=>{"use strict";const r=n(4152);class a extends Error{constructor(e){super(e),this.name="TimeoutError"}}const s=(e,t,n)=>new Promise((s,i)=>{if("number"!==typeof t||t<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(t===1/0)return void s(e);const o=setTimeout(()=>{if("function"===typeof n){try{s(n())}catch(o){i(o)}return}const r=n instanceof Error?n:new a("string"===typeof n?n:`Promise timed out after ${t} milliseconds`);"function"===typeof e.cancel&&e.cancel(),i(r)},t);r(e.then(s,i),()=>{clearTimeout(o)})});e.exports=s,e.exports.default=s,e.exports.TimeoutError=a},6357:(e,t,n)=>{"use strict";const r=n(7921),{MAX_LENGTH:a,MAX_SAFE_INTEGER:s}=n(6615),{safeRe:i,t:o}=n(8969),l=n(4806),{compareIdentifiers:c}=n(2990);class u{constructor(e,t){if(t=l(t),e instanceof u){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if("string"!==typeof e)throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>a)throw new TypeError(`version is longer than ${a} characters`);r("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const n=e.trim().match(t.loose?i[o.LOOSE]:i[o.FULL]);if(!n)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>s||this.major<0)throw new TypeError("Invalid major version");if(this.minor>s||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>s||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map(e=>{if(/^[0-9]+$/.test(e)){const t=+e;if(t>=0&&t<s)return t}return e}):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(r("SemVer.compare",this.version,this.options,e),!(e instanceof u)){if("string"===typeof e&&e===this.version)return 0;e=new u(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof u||(e=new u(e,this.options)),c(this.major,e.major)||c(this.minor,e.minor)||c(this.patch,e.patch)}comparePre(e){if(e instanceof u||(e=new u(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{const n=this.prerelease[t],a=e.prerelease[t];if(r("prerelease compare",t,n,a),void 0===n&&void 0===a)return 0;if(void 0===a)return 1;if(void 0===n)return-1;if(n!==a)return c(n,a)}while(++t)}compareBuild(e){e instanceof u||(e=new u(e,this.options));let t=0;do{const n=this.build[t],a=e.build[t];if(r("build compare",t,n,a),void 0===n&&void 0===a)return 0;if(void 0===a)return 1;if(void 0===n)return-1;if(n!==a)return c(n,a)}while(++t)}inc(e,t,n){if(e.startsWith("pre")){if(!t&&!1===n)throw new Error("invalid increment argument: identifier is empty");if(t){const e=`-${t}`.match(this.options.loose?i[o.PRERELEASELOOSE]:i[o.PRERELEASE]);if(!e||e[1]!==t)throw new Error(`invalid identifier: ${t}`)}}switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,n);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,n);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,n),this.inc("pre",t,n);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t,n),this.inc("pre",t,n);break;case"release":if(0===this.prerelease.length)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":{const e=Number(n)?1:0;if(0===this.prerelease.length)this.prerelease=[e];else{let r=this.prerelease.length;for(;--r>=0;)"number"===typeof this.prerelease[r]&&(this.prerelease[r]++,r=-2);if(-1===r){if(t===this.prerelease.join(".")&&!1===n)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(e)}}if(t){let r=[t,e];!1===n&&(r=[t]),0===c(this.prerelease[0],t)?isNaN(this.prerelease[1])&&(this.prerelease=r):this.prerelease=r}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}e.exports=u},6457:(e,t,n)=>{"use strict";const r=n(6357);e.exports=(e,t)=>new r(e,t).minor},6612:(e,t,n)=>{"use strict";const r=n(1824),a=n(76),s=n(209),i=n(3042),o=n(4238),l=n(4695);e.exports=(e,t,n,c)=>{switch(t){case"===":return"object"===typeof e&&(e=e.version),"object"===typeof n&&(n=n.version),e===n;case"!==":return"object"===typeof e&&(e=e.version),"object"===typeof n&&(n=n.version),e!==n;case"":case"=":case"==":return r(e,n,c);case"!=":return a(e,n,c);case">":return s(e,n,c);case">=":return i(e,n,c);case"<":return o(e,n,c);case"<=":return l(e,n,c);default:throw new TypeError(`Invalid operator: ${t}`)}}},6615:e=>{"use strict";const t=Number.MAX_SAFE_INTEGER||9007199254740991;e.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:16,MAX_SAFE_BUILD_LENGTH:250,MAX_SAFE_INTEGER:t,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:"2.0.0",FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}},6672:(e,t,n)=>{"use strict";var r=n(5043);function a(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(){}var i={d:{f:s,r:function(){throw Error(a(522))},D:s,C:s,L:s,m:s,X:s,S:s,M:s},p:0,findDOMNode:null},o=Symbol.for("react.portal");var l=r.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function c(e,t){return"font"===e?"":"string"===typeof t?"use-credentials"===t?t:"":void 0}t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=i,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!t||1!==t.nodeType&&9!==t.nodeType&&11!==t.nodeType)throw Error(a(299));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:o,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.flushSync=function(e){var t=l.T,n=i.p;try{if(l.T=null,i.p=2,e)return e()}finally{l.T=t,i.p=n,i.d.f()}},t.preconnect=function(e,t){"string"===typeof e&&(t?t="string"===typeof(t=t.crossOrigin)?"use-credentials"===t?t:"":void 0:t=null,i.d.C(e,t))},t.prefetchDNS=function(e){"string"===typeof e&&i.d.D(e)},t.preinit=function(e,t){if("string"===typeof e&&t&&"string"===typeof t.as){var n=t.as,r=c(n,t.crossOrigin),a="string"===typeof t.integrity?t.integrity:void 0,s="string"===typeof t.fetchPriority?t.fetchPriority:void 0;"style"===n?i.d.S(e,"string"===typeof t.precedence?t.precedence:void 0,{crossOrigin:r,integrity:a,fetchPriority:s}):"script"===n&&i.d.X(e,{crossOrigin:r,integrity:a,fetchPriority:s,nonce:"string"===typeof t.nonce?t.nonce:void 0})}},t.preinitModule=function(e,t){if("string"===typeof e)if("object"===typeof t&&null!==t){if(null==t.as||"script"===t.as){var n=c(t.as,t.crossOrigin);i.d.M(e,{crossOrigin:n,integrity:"string"===typeof t.integrity?t.integrity:void 0,nonce:"string"===typeof t.nonce?t.nonce:void 0})}}else null==t&&i.d.M(e)},t.preload=function(e,t){if("string"===typeof e&&"object"===typeof t&&null!==t&&"string"===typeof t.as){var n=t.as,r=c(n,t.crossOrigin);i.d.L(e,n,{crossOrigin:r,integrity:"string"===typeof t.integrity?t.integrity:void 0,nonce:"string"===typeof t.nonce?t.nonce:void 0,type:"string"===typeof t.type?t.type:void 0,fetchPriority:"string"===typeof t.fetchPriority?t.fetchPriority:void 0,referrerPolicy:"string"===typeof t.referrerPolicy?t.referrerPolicy:void 0,imageSrcSet:"string"===typeof t.imageSrcSet?t.imageSrcSet:void 0,imageSizes:"string"===typeof t.imageSizes?t.imageSizes:void 0,media:"string"===typeof t.media?t.media:void 0})}},t.preloadModule=function(e,t){if("string"===typeof e)if(t){var n=c(t.as,t.crossOrigin);i.d.m(e,{as:"string"===typeof t.as&&"script"!==t.as?t.as:void 0,crossOrigin:n,integrity:"string"===typeof t.integrity?t.integrity:void 0})}else i.d.m(e)},t.requestFormReset=function(e){i.d.r(e)},t.unstable_batchedUpdates=function(e,t){return e(t)},t.useFormState=function(e,t,n){return l.H.useFormState(e,t,n)},t.useFormStatus=function(){return l.H.useHostTransitionStatus()},t.version="19.1.0"},7004:(e,t,n)=>{"use strict";var r=n(8853),a=n(5043),s=n(7950);function i(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function o(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function l(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function c(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function u(e){if(l(e)!==e)throw Error(i(188))}function d(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e;for(e=e.child;null!==e;){if(null!==(t=d(e)))return t;e=e.sibling}return null}var h=Object.assign,f=Symbol.for("react.element"),p=Symbol.for("react.transitional.element"),m=Symbol.for("react.portal"),g=Symbol.for("react.fragment"),y=Symbol.for("react.strict_mode"),b=Symbol.for("react.profiler"),v=Symbol.for("react.provider"),w=Symbol.for("react.consumer"),_=Symbol.for("react.context"),S=Symbol.for("react.forward_ref"),k=Symbol.for("react.suspense"),E=Symbol.for("react.suspense_list"),x=Symbol.for("react.memo"),O=Symbol.for("react.lazy");Symbol.for("react.scope");var A=Symbol.for("react.activity");Symbol.for("react.legacy_hidden"),Symbol.for("react.tracing_marker");var I=Symbol.for("react.memo_cache_sentinel");Symbol.for("react.view_transition");var $=Symbol.iterator;function T(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=$&&e[$]||e["@@iterator"])?e:null}var P=Symbol.for("react.client.reference");function R(e){if(null==e)return null;if("function"===typeof e)return e.$$typeof===P?null:e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case g:return"Fragment";case b:return"Profiler";case y:return"StrictMode";case k:return"Suspense";case E:return"SuspenseList";case A:return"Activity"}if("object"===typeof e)switch(e.$$typeof){case m:return"Portal";case _:return(e.displayName||"Context")+".Provider";case w:return(e._context.displayName||"Context")+".Consumer";case S:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case x:return null!==(t=e.displayName||null)?t:R(e.type)||"Memo";case O:t=e._payload,e=e._init;try{return R(e(t))}catch(n){}}return null}var C=Array.isArray,N=a.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,j=s.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,L={pending:!1,data:null,method:null,action:null},M=[],D=-1;function z(e){return{current:e}}function U(e){0>D||(e.current=M[D],M[D]=null,D--)}function F(e,t){D++,M[D]=e.current,e.current=t}var B=z(null),q=z(null),H=z(null),W=z(null);function V(e,t){switch(F(H,t),F(q,e),F(B,null),t.nodeType){case 9:case 11:e=(e=t.documentElement)&&(e=e.namespaceURI)?ad(e):0;break;default:if(e=t.tagName,t=t.namespaceURI)e=sd(t=ad(t),e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}U(B),F(B,e)}function Z(){U(B),U(q),U(H)}function G(e){null!==e.memoizedState&&F(W,e);var t=B.current,n=sd(t,e.type);t!==n&&(F(q,e),F(B,n))}function J(e){q.current===e&&(U(B),U(q)),W.current===e&&(U(W),Gd._currentValue=L)}var K=Object.prototype.hasOwnProperty,X=r.unstable_scheduleCallback,Q=r.unstable_cancelCallback,Y=r.unstable_shouldYield,ee=r.unstable_requestPaint,te=r.unstable_now,ne=r.unstable_getCurrentPriorityLevel,re=r.unstable_ImmediatePriority,ae=r.unstable_UserBlockingPriority,se=r.unstable_NormalPriority,ie=r.unstable_LowPriority,oe=r.unstable_IdlePriority,le=r.log,ce=r.unstable_setDisableYieldValue,ue=null,de=null;function he(e){if("function"===typeof le&&ce(e),de&&"function"===typeof de.setStrictMode)try{de.setStrictMode(ue,e)}catch(t){}}var fe=Math.clz32?Math.clz32:function(e){return 0===(e>>>=0)?32:31-(pe(e)/me|0)|0},pe=Math.log,me=Math.LN2;var ge=256,ye=4194304;function be(e){var t=42&e;if(0!==t)return t;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194048&e;case 4194304:case 8388608:case 16777216:case 33554432:return 62914560&e;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function ve(e,t,n){var r=e.pendingLanes;if(0===r)return 0;var a=0,s=e.suspendedLanes,i=e.pingedLanes;e=e.warmLanes;var o=134217727&r;return 0!==o?0!==(r=o&~s)?a=be(r):0!==(i&=o)?a=be(i):n||0!==(n=o&~e)&&(a=be(n)):0!==(o=r&~s)?a=be(o):0!==i?a=be(i):n||0!==(n=r&~e)&&(a=be(n)),0===a?0:0!==t&&t!==a&&0===(t&s)&&((s=a&-a)>=(n=t&-t)||32===s&&0!==(4194048&n))?t:a}function we(e,t){return 0===(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&t)}function _e(e,t){switch(e){case 1:case 2:case 4:case 8:case 64:return t+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function Se(){var e=ge;return 0===(4194048&(ge<<=1))&&(ge=256),e}function ke(){var e=ye;return 0===(62914560&(ye<<=1))&&(ye=4194304),e}function Ee(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function xe(e,t){e.pendingLanes|=t,268435456!==t&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function Oe(e,t,n){e.pendingLanes|=t,e.suspendedLanes&=~t;var r=31-fe(t);e.entangledLanes|=t,e.entanglements[r]=1073741824|e.entanglements[r]|4194090&n}function Ae(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-fe(n),a=1<<r;a&t|e[r]&t&&(e[r]|=t),n&=~a}}function Ie(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function $e(e){return 2<(e&=-e)?8<e?0!==(134217727&e)?32:268435456:8:2}function Te(){var e=j.p;return 0!==e?e:void 0===(e=window.event)?32:ch(e.type)}var Pe=Math.random().toString(36).slice(2),Re="__reactFiber$"+Pe,Ce="__reactProps$"+Pe,Ne="__reactContainer$"+Pe,je="__reactEvents$"+Pe,Le="__reactListeners$"+Pe,Me="__reactHandles$"+Pe,De="__reactResources$"+Pe,ze="__reactMarker$"+Pe;function Ue(e){delete e[Re],delete e[Ce],delete e[je],delete e[Le],delete e[Me]}function Fe(e){var t=e[Re];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Ne]||n[Re]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=vd(e);null!==e;){if(n=e[Re])return n;e=vd(e)}return t}n=(e=n).parentNode}return null}function Be(e){if(e=e[Re]||e[Ne]){var t=e.tag;if(5===t||6===t||13===t||26===t||27===t||3===t)return e}return null}function qe(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e.stateNode;throw Error(i(33))}function He(e){var t=e[De];return t||(t=e[De]={hoistableStyles:new Map,hoistableScripts:new Map}),t}function We(e){e[ze]=!0}var Ve=new Set,Ze={};function Ge(e,t){Je(e,t),Je(e+"Capture",t)}function Je(e,t){for(Ze[e]=t,e=0;e<t.length;e++)Ve.add(t[e])}var Ke,Xe,Qe=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Ye={},et={};function tt(e,t,n){if(a=t,K.call(et,a)||!K.call(Ye,a)&&(Qe.test(a)?et[a]=!0:(Ye[a]=!0,0)))if(null===n)e.removeAttribute(t);else{switch(typeof n){case"undefined":case"function":case"symbol":return void e.removeAttribute(t);case"boolean":var r=t.toLowerCase().slice(0,5);if("data-"!==r&&"aria-"!==r)return void e.removeAttribute(t)}e.setAttribute(t,""+n)}var a}function nt(e,t,n){if(null===n)e.removeAttribute(t);else{switch(typeof n){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(t)}e.setAttribute(t,""+n)}}function rt(e,t,n,r){if(null===r)e.removeAttribute(n);else{switch(typeof r){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(n)}e.setAttributeNS(t,n,""+r)}}function at(e){if(void 0===Ke)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);Ke=t&&t[1]||"",Xe=-1<n.stack.indexOf("\n    at")?" (<anonymous>)":-1<n.stack.indexOf("@")?"@unknown:0:0":""}return"\n"+Ke+e+Xe}var st=!1;function it(e,t){if(!e||st)return"";st=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var r={DetermineComponentFrameRoot:function(){try{if(t){var n=function(){throw Error()};if(Object.defineProperty(n.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(n,[])}catch(a){var r=a}Reflect.construct(e,[],n)}else{try{n.call()}catch(s){r=s}e.call(n.prototype)}}else{try{throw Error()}catch(i){r=i}(n=e())&&"function"===typeof n.catch&&n.catch(function(){})}}catch(o){if(o&&r&&"string"===typeof o.stack)return[o.stack,r.stack]}return[null,null]}};r.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var a=Object.getOwnPropertyDescriptor(r.DetermineComponentFrameRoot,"name");a&&a.configurable&&Object.defineProperty(r.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var s=r.DetermineComponentFrameRoot(),i=s[0],o=s[1];if(i&&o){var l=i.split("\n"),c=o.split("\n");for(a=r=0;r<l.length&&!l[r].includes("DetermineComponentFrameRoot");)r++;for(;a<c.length&&!c[a].includes("DetermineComponentFrameRoot");)a++;if(r===l.length||a===c.length)for(r=l.length-1,a=c.length-1;1<=r&&0<=a&&l[r]!==c[a];)a--;for(;1<=r&&0<=a;r--,a--)if(l[r]!==c[a]){if(1!==r||1!==a)do{if(r--,0>--a||l[r]!==c[a]){var u="\n"+l[r].replace(" at new "," at ");return e.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",e.displayName)),u}}while(1<=r&&0<=a);break}}}finally{st=!1,Error.prepareStackTrace=n}return(n=e?e.displayName||e.name:"")?at(n):""}function ot(e){switch(e.tag){case 26:case 27:case 5:return at(e.type);case 16:return at("Lazy");case 13:return at("Suspense");case 19:return at("SuspenseList");case 0:case 15:return it(e.type,!1);case 11:return it(e.type.render,!1);case 1:return it(e.type,!0);case 31:return at("Activity");default:return""}}function lt(e){try{var t="";do{t+=ot(e),e=e.return}while(e);return t}catch(n){return"\nError generating stack: "+n.message+"\n"+n.stack}}function ct(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function ut(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function dt(e){e._valueTracker||(e._valueTracker=function(e){var t=ut(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var a=n.get,s=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return a.call(this)},set:function(e){r=""+e,s.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function ht(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=ut(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function ft(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}var pt=/[\n"\\]/g;function mt(e){return e.replace(pt,function(e){return"\\"+e.charCodeAt(0).toString(16)+" "})}function gt(e,t,n,r,a,s,i,o){e.name="",null!=i&&"function"!==typeof i&&"symbol"!==typeof i&&"boolean"!==typeof i?e.type=i:e.removeAttribute("type"),null!=t?"number"===i?(0===t&&""===e.value||e.value!=t)&&(e.value=""+ct(t)):e.value!==""+ct(t)&&(e.value=""+ct(t)):"submit"!==i&&"reset"!==i||e.removeAttribute("value"),null!=t?bt(e,i,ct(t)):null!=n?bt(e,i,ct(n)):null!=r&&e.removeAttribute("value"),null==a&&null!=s&&(e.defaultChecked=!!s),null!=a&&(e.checked=a&&"function"!==typeof a&&"symbol"!==typeof a),null!=o&&"function"!==typeof o&&"symbol"!==typeof o&&"boolean"!==typeof o?e.name=""+ct(o):e.removeAttribute("name")}function yt(e,t,n,r,a,s,i,o){if(null!=s&&"function"!==typeof s&&"symbol"!==typeof s&&"boolean"!==typeof s&&(e.type=s),null!=t||null!=n){if(!("submit"!==s&&"reset"!==s||void 0!==t&&null!==t))return;n=null!=n?""+ct(n):"",t=null!=t?""+ct(t):n,o||t===e.value||(e.value=t),e.defaultValue=t}r="function"!==typeof(r=null!=r?r:a)&&"symbol"!==typeof r&&!!r,e.checked=o?e.checked:!!r,e.defaultChecked=!!r,null!=i&&"function"!==typeof i&&"symbol"!==typeof i&&"boolean"!==typeof i&&(e.name=i)}function bt(e,t,n){"number"===t&&ft(e.ownerDocument)===e||e.defaultValue===""+n||(e.defaultValue=""+n)}function vt(e,t,n,r){if(e=e.options,t){t={};for(var a=0;a<n.length;a++)t["$"+n[a]]=!0;for(n=0;n<e.length;n++)a=t.hasOwnProperty("$"+e[n].value),e[n].selected!==a&&(e[n].selected=a),a&&r&&(e[n].defaultSelected=!0)}else{for(n=""+ct(n),t=null,a=0;a<e.length;a++){if(e[a].value===n)return e[a].selected=!0,void(r&&(e[a].defaultSelected=!0));null!==t||e[a].disabled||(t=e[a])}null!==t&&(t.selected=!0)}}function wt(e,t,n){null==t||((t=""+ct(t))!==e.value&&(e.value=t),null!=n)?e.defaultValue=null!=n?""+ct(n):"":e.defaultValue!==t&&(e.defaultValue=t)}function _t(e,t,n,r){if(null==t){if(null!=r){if(null!=n)throw Error(i(92));if(C(r)){if(1<r.length)throw Error(i(93));r=r[0]}n=r}null==n&&(n=""),t=n}n=ct(t),e.defaultValue=n,(r=e.textContent)===n&&""!==r&&null!==r&&(e.value=r)}function St(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var kt=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Et(e,t,n){var r=0===t.indexOf("--");null==n||"boolean"===typeof n||""===n?r?e.setProperty(t,""):"float"===t?e.cssFloat="":e[t]="":r?e.setProperty(t,n):"number"!==typeof n||0===n||kt.has(t)?"float"===t?e.cssFloat=n:e[t]=(""+n).trim():e[t]=n+"px"}function xt(e,t,n){if(null!=t&&"object"!==typeof t)throw Error(i(62));if(e=e.style,null!=n){for(var r in n)!n.hasOwnProperty(r)||null!=t&&t.hasOwnProperty(r)||(0===r.indexOf("--")?e.setProperty(r,""):"float"===r?e.cssFloat="":e[r]="");for(var a in t)r=t[a],t.hasOwnProperty(a)&&n[a]!==r&&Et(e,a,r)}else for(var s in t)t.hasOwnProperty(s)&&Et(e,s,t[s])}function Ot(e){if(-1===e.indexOf("-"))return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var At=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),It=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function $t(e){return It.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}var Tt=null;function Pt(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Rt=null,Ct=null;function Nt(e){var t=Be(e);if(t&&(e=t.stateNode)){var n=e[Ce]||null;e:switch(e=t.stateNode,t.type){case"input":if(gt(e,n.value,n.defaultValue,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll('input[name="'+mt(""+t)+'"][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var a=r[Ce]||null;if(!a)throw Error(i(90));gt(r,a.value,a.defaultValue,a.defaultValue,a.checked,a.defaultChecked,a.type,a.name)}}for(t=0;t<n.length;t++)(r=n[t]).form===e.form&&ht(r)}break e;case"textarea":wt(e,n.value,n.defaultValue);break e;case"select":null!=(t=n.value)&&vt(e,!!n.multiple,t,!1)}}}var jt=!1;function Lt(e,t,n){if(jt)return e(t,n);jt=!0;try{return e(t)}finally{if(jt=!1,(null!==Rt||null!==Ct)&&(Fc(),Rt&&(t=Rt,e=Ct,Ct=Rt=null,Nt(t),e)))for(t=0;t<e.length;t++)Nt(e[t])}}function Mt(e,t){var n=e.stateNode;if(null===n)return null;var r=n[Ce]||null;if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(i(231,t,typeof n));return n}var Dt=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),zt=!1;if(Dt)try{var Ut={};Object.defineProperty(Ut,"passive",{get:function(){zt=!0}}),window.addEventListener("test",Ut,Ut),window.removeEventListener("test",Ut,Ut)}catch(Ch){zt=!1}var Ft=null,Bt=null,qt=null;function Ht(){if(qt)return qt;var e,t,n=Bt,r=n.length,a="value"in Ft?Ft.value:Ft.textContent,s=a.length;for(e=0;e<r&&n[e]===a[e];e++);var i=r-e;for(t=1;t<=i&&n[r-t]===a[s-t];t++);return qt=a.slice(e,1<t?1-t:void 0)}function Wt(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function Vt(){return!0}function Zt(){return!1}function Gt(e){function t(t,n,r,a,s){for(var i in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=a,this.target=s,this.currentTarget=null,e)e.hasOwnProperty(i)&&(t=e[i],this[i]=t?t(a):a[i]);return this.isDefaultPrevented=(null!=a.defaultPrevented?a.defaultPrevented:!1===a.returnValue)?Vt:Zt,this.isPropagationStopped=Zt,this}return h(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=Vt)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=Vt)},persist:function(){},isPersistent:Vt}),t}var Jt,Kt,Xt,Qt={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Yt=Gt(Qt),en=h({},Qt,{view:0,detail:0}),tn=Gt(en),nn=h({},en,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:pn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Xt&&(Xt&&"mousemove"===e.type?(Jt=e.screenX-Xt.screenX,Kt=e.screenY-Xt.screenY):Kt=Jt=0,Xt=e),Jt)},movementY:function(e){return"movementY"in e?e.movementY:Kt}}),rn=Gt(nn),an=Gt(h({},nn,{dataTransfer:0})),sn=Gt(h({},en,{relatedTarget:0})),on=Gt(h({},Qt,{animationName:0,elapsedTime:0,pseudoElement:0})),ln=Gt(h({},Qt,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}})),cn=Gt(h({},Qt,{data:0})),un={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},dn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},hn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function fn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=hn[e])&&!!t[e]}function pn(){return fn}var mn=Gt(h({},en,{key:function(e){if(e.key){var t=un[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=Wt(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?dn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:pn,charCode:function(e){return"keypress"===e.type?Wt(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?Wt(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}})),gn=Gt(h({},nn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),yn=Gt(h({},en,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:pn})),bn=Gt(h({},Qt,{propertyName:0,elapsedTime:0,pseudoElement:0})),vn=Gt(h({},nn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0})),wn=Gt(h({},Qt,{newState:0,oldState:0})),_n=[9,13,27,32],Sn=Dt&&"CompositionEvent"in window,kn=null;Dt&&"documentMode"in document&&(kn=document.documentMode);var En=Dt&&"TextEvent"in window&&!kn,xn=Dt&&(!Sn||kn&&8<kn&&11>=kn),On=String.fromCharCode(32),An=!1;function In(e,t){switch(e){case"keyup":return-1!==_n.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function $n(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Tn=!1;var Pn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Rn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Pn[e.type]:"textarea"===t}function Cn(e,t,n,r){Rt?Ct?Ct.push(r):Ct=[r]:Rt=r,0<(t=Hu(t,"onChange")).length&&(n=new Yt("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Nn=null,jn=null;function Ln(e){Lu(e,0)}function Mn(e){if(ht(qe(e)))return e}function Dn(e,t){if("change"===e)return t}var zn=!1;if(Dt){var Un;if(Dt){var Fn="oninput"in document;if(!Fn){var Bn=document.createElement("div");Bn.setAttribute("oninput","return;"),Fn="function"===typeof Bn.oninput}Un=Fn}else Un=!1;zn=Un&&(!document.documentMode||9<document.documentMode)}function qn(){Nn&&(Nn.detachEvent("onpropertychange",Hn),jn=Nn=null)}function Hn(e){if("value"===e.propertyName&&Mn(jn)){var t=[];Cn(t,jn,e,Pt(e)),Lt(Ln,t)}}function Wn(e,t,n){"focusin"===e?(qn(),jn=n,(Nn=t).attachEvent("onpropertychange",Hn)):"focusout"===e&&qn()}function Vn(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Mn(jn)}function Zn(e,t){if("click"===e)return Mn(t)}function Gn(e,t){if("input"===e||"change"===e)return Mn(t)}var Jn="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function Kn(e,t){if(Jn(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var a=n[r];if(!K.call(t,a)||!Jn(e[a],t[a]))return!1}return!0}function Xn(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Qn(e,t){var n,r=Xn(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=Xn(r)}}function Yn(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?Yn(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function er(e){for(var t=ft((e=null!=e&&null!=e.ownerDocument&&null!=e.ownerDocument.defaultView?e.ownerDocument.defaultView:window).document);t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=ft((e=t.contentWindow).document)}return t}function tr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var nr=Dt&&"documentMode"in document&&11>=document.documentMode,rr=null,ar=null,sr=null,ir=!1;function or(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;ir||null==rr||rr!==ft(r)||("selectionStart"in(r=rr)&&tr(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},sr&&Kn(sr,r)||(sr=r,0<(r=Hu(ar,"onSelect")).length&&(t=new Yt("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=rr)))}function lr(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var cr={animationend:lr("Animation","AnimationEnd"),animationiteration:lr("Animation","AnimationIteration"),animationstart:lr("Animation","AnimationStart"),transitionrun:lr("Transition","TransitionRun"),transitionstart:lr("Transition","TransitionStart"),transitioncancel:lr("Transition","TransitionCancel"),transitionend:lr("Transition","TransitionEnd")},ur={},dr={};function hr(e){if(ur[e])return ur[e];if(!cr[e])return e;var t,n=cr[e];for(t in n)if(n.hasOwnProperty(t)&&t in dr)return ur[e]=n[t];return e}Dt&&(dr=document.createElement("div").style,"AnimationEvent"in window||(delete cr.animationend.animation,delete cr.animationiteration.animation,delete cr.animationstart.animation),"TransitionEvent"in window||delete cr.transitionend.transition);var fr=hr("animationend"),pr=hr("animationiteration"),mr=hr("animationstart"),gr=hr("transitionrun"),yr=hr("transitionstart"),br=hr("transitioncancel"),vr=hr("transitionend"),wr=new Map,_r="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Sr(e,t){wr.set(e,t),Ge(t,[e])}_r.push("scrollEnd");var kr=new WeakMap;function Er(e,t){if("object"===typeof e&&null!==e){var n=kr.get(e);return void 0!==n?n:(t={value:e,source:t,stack:lt(t)},kr.set(e,t),t)}return{value:e,source:t,stack:lt(t)}}var xr=[],Or=0,Ar=0;function Ir(){for(var e=Or,t=Ar=Or=0;t<e;){var n=xr[t];xr[t++]=null;var r=xr[t];xr[t++]=null;var a=xr[t];xr[t++]=null;var s=xr[t];if(xr[t++]=null,null!==r&&null!==a){var i=r.pending;null===i?a.next=a:(a.next=i.next,i.next=a),r.pending=a}0!==s&&Rr(n,a,s)}}function $r(e,t,n,r){xr[Or++]=e,xr[Or++]=t,xr[Or++]=n,xr[Or++]=r,Ar|=r,e.lanes|=r,null!==(e=e.alternate)&&(e.lanes|=r)}function Tr(e,t,n,r){return $r(e,t,n,r),Cr(e)}function Pr(e,t){return $r(e,null,null,t),Cr(e)}function Rr(e,t,n){e.lanes|=n;var r=e.alternate;null!==r&&(r.lanes|=n);for(var a=!1,s=e.return;null!==s;)s.childLanes|=n,null!==(r=s.alternate)&&(r.childLanes|=n),22===s.tag&&(null===(e=s.stateNode)||1&e._visibility||(a=!0)),e=s,s=s.return;return 3===e.tag?(s=e.stateNode,a&&null!==t&&(a=31-fe(n),null===(r=(e=s.hiddenUpdates)[a])?e[a]=[t]:r.push(t),t.lane=536870912|n),s):null}function Cr(e){if(50<Rc)throw Rc=0,Cc=null,Error(i(185));for(var t=e.return;null!==t;)t=(e=t).return;return 3===e.tag?e.stateNode:null}var Nr={};function jr(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Lr(e,t,n,r){return new jr(e,t,n,r)}function Mr(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Dr(e,t){var n=e.alternate;return null===n?((n=Lr(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=65011712&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n.refCleanup=e.refCleanup,n}function zr(e,t){e.flags&=65011714;var n=e.alternate;return null===n?(e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=n.childLanes,e.lanes=n.lanes,e.child=n.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=n.memoizedProps,e.memoizedState=n.memoizedState,e.updateQueue=n.updateQueue,e.type=n.type,t=n.dependencies,e.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext}),e}function Ur(e,t,n,r,a,s){var o=0;if(r=e,"function"===typeof e)Mr(e)&&(o=1);else if("string"===typeof e)o=function(e,t,n){if(1===n||null!=t.itemProp)return!1;switch(e){case"meta":case"title":return!0;case"style":if("string"!==typeof t.precedence||"string"!==typeof t.href||""===t.href)break;return!0;case"link":if("string"!==typeof t.rel||"string"!==typeof t.href||""===t.href||t.onLoad||t.onError)break;return"stylesheet"!==t.rel||(e=t.disabled,"string"===typeof t.precedence&&null==e);case"script":if(t.async&&"function"!==typeof t.async&&"symbol"!==typeof t.async&&!t.onLoad&&!t.onError&&t.src&&"string"===typeof t.src)return!0}return!1}(e,n,B.current)?26:"html"===e||"head"===e||"body"===e?27:5;else e:switch(e){case A:return(e=Lr(31,n,t,a)).elementType=A,e.lanes=s,e;case g:return Fr(n.children,a,s,t);case y:o=8,a|=24;break;case b:return(e=Lr(12,n,t,2|a)).elementType=b,e.lanes=s,e;case k:return(e=Lr(13,n,t,a)).elementType=k,e.lanes=s,e;case E:return(e=Lr(19,n,t,a)).elementType=E,e.lanes=s,e;default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case v:case _:o=10;break e;case w:o=9;break e;case S:o=11;break e;case x:o=14;break e;case O:o=16,r=null;break e}o=29,n=Error(i(130,null===e?"null":typeof e,"")),r=null}return(t=Lr(o,n,t,a)).elementType=e,t.type=r,t.lanes=s,t}function Fr(e,t,n,r){return(e=Lr(7,e,r,t)).lanes=n,e}function Br(e,t,n){return(e=Lr(6,e,null,t)).lanes=n,e}function qr(e,t,n){return(t=Lr(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}var Hr=[],Wr=0,Vr=null,Zr=0,Gr=[],Jr=0,Kr=null,Xr=1,Qr="";function Yr(e,t){Hr[Wr++]=Zr,Hr[Wr++]=Vr,Vr=e,Zr=t}function ea(e,t,n){Gr[Jr++]=Xr,Gr[Jr++]=Qr,Gr[Jr++]=Kr,Kr=e;var r=Xr;e=Qr;var a=32-fe(r)-1;r&=~(1<<a),n+=1;var s=32-fe(t)+a;if(30<s){var i=a-a%5;s=(r&(1<<i)-1).toString(32),r>>=i,a-=i,Xr=1<<32-fe(t)+a|n<<a|r,Qr=s+e}else Xr=1<<s|n<<a|r,Qr=e}function ta(e){null!==e.return&&(Yr(e,1),ea(e,1,0))}function na(e){for(;e===Vr;)Vr=Hr[--Wr],Hr[Wr]=null,Zr=Hr[--Wr],Hr[Wr]=null;for(;e===Kr;)Kr=Gr[--Jr],Gr[Jr]=null,Qr=Gr[--Jr],Gr[Jr]=null,Xr=Gr[--Jr],Gr[Jr]=null}var ra=null,aa=null,sa=!1,ia=null,oa=!1,la=Error(i(519));function ca(e){throw ma(Er(Error(i(418,"")),e)),la}function ua(e){var t=e.stateNode,n=e.type,r=e.memoizedProps;switch(t[Re]=e,t[Ce]=r,n){case"dialog":Mu("cancel",t),Mu("close",t);break;case"iframe":case"object":case"embed":Mu("load",t);break;case"video":case"audio":for(n=0;n<Nu.length;n++)Mu(Nu[n],t);break;case"source":Mu("error",t);break;case"img":case"image":case"link":Mu("error",t),Mu("load",t);break;case"details":Mu("toggle",t);break;case"input":Mu("invalid",t),yt(t,r.value,r.defaultValue,r.checked,r.defaultChecked,r.type,r.name,!0),dt(t);break;case"select":Mu("invalid",t);break;case"textarea":Mu("invalid",t),_t(t,r.value,r.defaultValue,r.children),dt(t)}"string"!==typeof(n=r.children)&&"number"!==typeof n&&"bigint"!==typeof n||t.textContent===""+n||!0===r.suppressHydrationWarning||Ku(t.textContent,n)?(null!=r.popover&&(Mu("beforetoggle",t),Mu("toggle",t)),null!=r.onScroll&&Mu("scroll",t),null!=r.onScrollEnd&&Mu("scrollend",t),null!=r.onClick&&(t.onclick=Xu),t=!0):t=!1,t||ca(e)}function da(e){for(ra=e.return;ra;)switch(ra.tag){case 5:case 13:return void(oa=!1);case 27:case 3:return void(oa=!0);default:ra=ra.return}}function ha(e){if(e!==ra)return!1;if(!sa)return da(e),sa=!0,!1;var t,n=e.tag;if((t=3!==n&&27!==n)&&((t=5===n)&&(t=!("form"!==(t=e.type)&&"button"!==t)||id(e.type,e.memoizedProps)),t=!t),t&&aa&&ca(e),da(e),13===n){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(i(317));e:{for(e=e.nextSibling,n=0;e;){if(8===e.nodeType)if("/$"===(t=e.data)){if(0===n){aa=yd(e.nextSibling);break e}n--}else"$"!==t&&"$!"!==t&&"$?"!==t||n++;e=e.nextSibling}aa=null}}else 27===n?(n=aa,fd(e.type)?(e=bd,bd=null,aa=e):aa=n):aa=ra?yd(e.stateNode.nextSibling):null;return!0}function fa(){aa=ra=null,sa=!1}function pa(){var e=ia;return null!==e&&(null===vc?vc=e:vc.push.apply(vc,e),ia=null),e}function ma(e){null===ia?ia=[e]:ia.push(e)}var ga=z(null),ya=null,ba=null;function va(e,t,n){F(ga,t._currentValue),t._currentValue=n}function wa(e){e._currentValue=ga.current,U(ga)}function _a(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function Sa(e,t,n,r){var a=e.child;for(null!==a&&(a.return=e);null!==a;){var s=a.dependencies;if(null!==s){var o=a.child;s=s.firstContext;e:for(;null!==s;){var l=s;s=a;for(var c=0;c<t.length;c++)if(l.context===t[c]){s.lanes|=n,null!==(l=s.alternate)&&(l.lanes|=n),_a(s.return,n,e),r||(o=null);break e}s=l.next}}else if(18===a.tag){if(null===(o=a.return))throw Error(i(341));o.lanes|=n,null!==(s=o.alternate)&&(s.lanes|=n),_a(o,n,e),o=null}else o=a.child;if(null!==o)o.return=a;else for(o=a;null!==o;){if(o===e){o=null;break}if(null!==(a=o.sibling)){a.return=o.return,o=a;break}o=o.return}a=o}}function ka(e,t,n,r){e=null;for(var a=t,s=!1;null!==a;){if(!s)if(0!==(524288&a.flags))s=!0;else if(0!==(262144&a.flags))break;if(10===a.tag){var o=a.alternate;if(null===o)throw Error(i(387));if(null!==(o=o.memoizedProps)){var l=a.type;Jn(a.pendingProps.value,o.value)||(null!==e?e.push(l):e=[l])}}else if(a===W.current){if(null===(o=a.alternate))throw Error(i(387));o.memoizedState.memoizedState!==a.memoizedState.memoizedState&&(null!==e?e.push(Gd):e=[Gd])}a=a.return}null!==e&&Sa(t,e,n,r),t.flags|=262144}function Ea(e){for(e=e.firstContext;null!==e;){if(!Jn(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function xa(e){ya=e,ba=null,null!==(e=e.dependencies)&&(e.firstContext=null)}function Oa(e){return Ia(ya,e)}function Aa(e,t){return null===ya&&xa(e),Ia(e,t)}function Ia(e,t){var n=t._currentValue;if(t={context:t,memoizedValue:n,next:null},null===ba){if(null===e)throw Error(i(308));ba=t,e.dependencies={lanes:0,firstContext:t},e.flags|=524288}else ba=ba.next=t;return n}var $a="undefined"!==typeof AbortController?AbortController:function(){var e=[],t=this.signal={aborted:!1,addEventListener:function(t,n){e.push(n)}};this.abort=function(){t.aborted=!0,e.forEach(function(e){return e()})}},Ta=r.unstable_scheduleCallback,Pa=r.unstable_NormalPriority,Ra={$$typeof:_,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Ca(){return{controller:new $a,data:new Map,refCount:0}}function Na(e){e.refCount--,0===e.refCount&&Ta(Pa,function(){e.controller.abort()})}var ja=null,La=0,Ma=0,Da=null;function za(){if(0===--La&&null!==ja){null!==Da&&(Da.status="fulfilled");var e=ja;ja=null,Ma=0,Da=null;for(var t=0;t<e.length;t++)(0,e[t])()}}var Ua=N.S;N.S=function(e,t){"object"===typeof t&&null!==t&&"function"===typeof t.then&&function(e,t){if(null===ja){var n=ja=[];La=0,Ma=$u(),Da={status:"pending",value:void 0,then:function(e){n.push(e)}}}La++,t.then(za,za)}(0,t),null!==Ua&&Ua(e,t)};var Fa=z(null);function Ba(){var e=Fa.current;return null!==e?e:rc.pooledCache}function qa(e,t){F(Fa,null===t?Fa.current:t.pool)}function Ha(){var e=Ba();return null===e?null:{parent:Ra._currentValue,pool:e}}var Wa=Error(i(460)),Va=Error(i(474)),Za=Error(i(542)),Ga={then:function(){}};function Ja(e){return"fulfilled"===(e=e.status)||"rejected"===e}function Ka(){}function Xa(e,t,n){switch(void 0===(n=e[n])?e.push(t):n!==t&&(t.then(Ka,Ka),t=n),t.status){case"fulfilled":return t.value;case"rejected":throw es(e=t.reason),e;default:if("string"===typeof t.status)t.then(Ka,Ka);else{if(null!==(e=rc)&&100<e.shellSuspendCounter)throw Error(i(482));(e=t).status="pending",e.then(function(e){if("pending"===t.status){var n=t;n.status="fulfilled",n.value=e}},function(e){if("pending"===t.status){var n=t;n.status="rejected",n.reason=e}})}switch(t.status){case"fulfilled":return t.value;case"rejected":throw es(e=t.reason),e}throw Qa=t,Wa}}var Qa=null;function Ya(){if(null===Qa)throw Error(i(459));var e=Qa;return Qa=null,e}function es(e){if(e===Wa||e===Za)throw Error(i(483))}var ts=!1;function ns(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function rs(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function as(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function ss(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,0!==(2&nc)){var a=r.pending;return null===a?t.next=t:(t.next=a.next,a.next=t),r.pending=t,t=Cr(e),Rr(e,null,n),t}return $r(e,r,t,n),Cr(e)}function is(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194048&n))){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,Ae(e,n)}}function os(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var a=null,s=null;if(null!==(n=n.firstBaseUpdate)){do{var i={lane:n.lane,tag:n.tag,payload:n.payload,callback:null,next:null};null===s?a=s=i:s=s.next=i,n=n.next}while(null!==n);null===s?a=s=t:s=s.next=t}else a=s=t;return n={baseState:r.baseState,firstBaseUpdate:a,lastBaseUpdate:s,shared:r.shared,callbacks:r.callbacks},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}var ls=!1;function cs(){if(ls){if(null!==Da)throw Da}}function us(e,t,n,r){ls=!1;var a=e.updateQueue;ts=!1;var s=a.firstBaseUpdate,i=a.lastBaseUpdate,o=a.shared.pending;if(null!==o){a.shared.pending=null;var l=o,c=l.next;l.next=null,null===i?s=c:i.next=c,i=l;var u=e.alternate;null!==u&&((o=(u=u.updateQueue).lastBaseUpdate)!==i&&(null===o?u.firstBaseUpdate=c:o.next=c,u.lastBaseUpdate=l))}if(null!==s){var d=a.baseState;for(i=0,u=c=l=null,o=s;;){var f=-536870913&o.lane,p=f!==o.lane;if(p?(sc&f)===f:(r&f)===f){0!==f&&f===Ma&&(ls=!0),null!==u&&(u=u.next={lane:0,tag:o.tag,payload:o.payload,callback:null,next:null});e:{var m=e,g=o;f=t;var y=n;switch(g.tag){case 1:if("function"===typeof(m=g.payload)){d=m.call(y,d,f);break e}d=m;break e;case 3:m.flags=-65537&m.flags|128;case 0:if(null===(f="function"===typeof(m=g.payload)?m.call(y,d,f):m)||void 0===f)break e;d=h({},d,f);break e;case 2:ts=!0}}null!==(f=o.callback)&&(e.flags|=64,p&&(e.flags|=8192),null===(p=a.callbacks)?a.callbacks=[f]:p.push(f))}else p={lane:f,tag:o.tag,payload:o.payload,callback:o.callback,next:null},null===u?(c=u=p,l=d):u=u.next=p,i|=f;if(null===(o=o.next)){if(null===(o=a.shared.pending))break;o=(p=o).next,p.next=null,a.lastBaseUpdate=p,a.shared.pending=null}}null===u&&(l=d),a.baseState=l,a.firstBaseUpdate=c,a.lastBaseUpdate=u,null===s&&(a.shared.lanes=0),fc|=i,e.lanes=i,e.memoizedState=d}}function ds(e,t){if("function"!==typeof e)throw Error(i(191,e));e.call(t)}function hs(e,t){var n=e.callbacks;if(null!==n)for(e.callbacks=null,e=0;e<n.length;e++)ds(n[e],t)}var fs=z(null),ps=z(0);function ms(e,t){F(ps,e=dc),F(fs,t),dc=e|t.baseLanes}function gs(){F(ps,dc),F(fs,fs.current)}function ys(){dc=ps.current,U(fs),U(ps)}var bs=0,vs=null,ws=null,_s=null,Ss=!1,ks=!1,Es=!1,xs=0,Os=0,As=null,Is=0;function $s(){throw Error(i(321))}function Ts(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!Jn(e[n],t[n]))return!1;return!0}function Ps(e,t,n,r,a,s){return bs=s,vs=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,N.H=null===e||null===e.memoizedState?Wi:Vi,Es=!1,s=n(r,a),Es=!1,ks&&(s=Cs(t,n,r,a)),Rs(e),s}function Rs(e){N.H=Hi;var t=null!==ws&&null!==ws.next;if(bs=0,_s=ws=vs=null,Ss=!1,Os=0,As=null,t)throw Error(i(300));null===e||Ao||null!==(e=e.dependencies)&&Ea(e)&&(Ao=!0)}function Cs(e,t,n,r){vs=e;var a=0;do{if(ks&&(As=null),Os=0,ks=!1,25<=a)throw Error(i(301));if(a+=1,_s=ws=null,null!=e.updateQueue){var s=e.updateQueue;s.lastEffect=null,s.events=null,s.stores=null,null!=s.memoCache&&(s.memoCache.index=0)}N.H=Zi,s=t(n,r)}while(ks);return s}function Ns(){var e=N.H,t=e.useState()[0];return t="function"===typeof t.then?Us(t):t,e=e.useState()[0],(null!==ws?ws.memoizedState:null)!==e&&(vs.flags|=1024),t}function js(){var e=0!==xs;return xs=0,e}function Ls(e,t,n){t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n}function Ms(e){if(Ss){for(e=e.memoizedState;null!==e;){var t=e.queue;null!==t&&(t.pending=null),e=e.next}Ss=!1}bs=0,_s=ws=vs=null,ks=!1,Os=xs=0,As=null}function Ds(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===_s?vs.memoizedState=_s=e:_s=_s.next=e,_s}function zs(){if(null===ws){var e=vs.alternate;e=null!==e?e.memoizedState:null}else e=ws.next;var t=null===_s?vs.memoizedState:_s.next;if(null!==t)_s=t,ws=e;else{if(null===e){if(null===vs.alternate)throw Error(i(467));throw Error(i(310))}e={memoizedState:(ws=e).memoizedState,baseState:ws.baseState,baseQueue:ws.baseQueue,queue:ws.queue,next:null},null===_s?vs.memoizedState=_s=e:_s=_s.next=e}return _s}function Us(e){var t=Os;return Os+=1,null===As&&(As=[]),e=Xa(As,e,t),t=vs,null===(null===_s?t.memoizedState:_s.next)&&(t=t.alternate,N.H=null===t||null===t.memoizedState?Wi:Vi),e}function Fs(e){if(null!==e&&"object"===typeof e){if("function"===typeof e.then)return Us(e);if(e.$$typeof===_)return Oa(e)}throw Error(i(438,String(e)))}function Bs(e){var t=null,n=vs.updateQueue;if(null!==n&&(t=n.memoCache),null==t){var r=vs.alternate;null!==r&&(null!==(r=r.updateQueue)&&(null!=(r=r.memoCache)&&(t={data:r.data.map(function(e){return e.slice()}),index:0})))}if(null==t&&(t={data:[],index:0}),null===n&&(n={lastEffect:null,events:null,stores:null,memoCache:null},vs.updateQueue=n),n.memoCache=t,void 0===(n=t.data[t.index]))for(n=t.data[t.index]=Array(e),r=0;r<e;r++)n[r]=I;return t.index++,n}function qs(e,t){return"function"===typeof t?t(e):t}function Hs(e){return Ws(zs(),ws,e)}function Ws(e,t,n){var r=e.queue;if(null===r)throw Error(i(311));r.lastRenderedReducer=n;var a=e.baseQueue,s=r.pending;if(null!==s){if(null!==a){var o=a.next;a.next=s.next,s.next=o}t.baseQueue=a=s,r.pending=null}if(s=e.baseState,null===a)e.memoizedState=s;else{var l=o=null,c=null,u=t=a.next,d=!1;do{var h=-536870913&u.lane;if(h!==u.lane?(sc&h)===h:(bs&h)===h){var f=u.revertLane;if(0===f)null!==c&&(c=c.next={lane:0,revertLane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),h===Ma&&(d=!0);else{if((bs&f)===f){u=u.next,f===Ma&&(d=!0);continue}h={lane:0,revertLane:u.revertLane,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null},null===c?(l=c=h,o=s):c=c.next=h,vs.lanes|=f,fc|=f}h=u.action,Es&&n(s,h),s=u.hasEagerState?u.eagerState:n(s,h)}else f={lane:h,revertLane:u.revertLane,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null},null===c?(l=c=f,o=s):c=c.next=f,vs.lanes|=h,fc|=h;u=u.next}while(null!==u&&u!==t);if(null===c?o=s:c.next=l,!Jn(s,e.memoizedState)&&(Ao=!0,d&&null!==(n=Da)))throw n;e.memoizedState=s,e.baseState=o,e.baseQueue=c,r.lastRenderedState=s}return null===a&&(r.lanes=0),[e.memoizedState,r.dispatch]}function Vs(e){var t=zs(),n=t.queue;if(null===n)throw Error(i(311));n.lastRenderedReducer=e;var r=n.dispatch,a=n.pending,s=t.memoizedState;if(null!==a){n.pending=null;var o=a=a.next;do{s=e(s,o.action),o=o.next}while(o!==a);Jn(s,t.memoizedState)||(Ao=!0),t.memoizedState=s,null===t.baseQueue&&(t.baseState=s),n.lastRenderedState=s}return[s,r]}function Zs(e,t,n){var r=vs,a=zs(),s=sa;if(s){if(void 0===n)throw Error(i(407));n=n()}else n=t();var o=!Jn((ws||a).memoizedState,n);if(o&&(a.memoizedState=n,Ao=!0),a=a.queue,gi(2048,8,Ks.bind(null,r,a,e),[e]),a.getSnapshot!==t||o||null!==_s&&1&_s.memoizedState.tag){if(r.flags|=2048,fi(9,{destroy:void 0,resource:void 0},Js.bind(null,r,a,n,t),null),null===rc)throw Error(i(349));s||0!==(124&bs)||Gs(r,t,n)}return n}function Gs(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=vs.updateQueue)?(t={lastEffect:null,events:null,stores:null,memoCache:null},vs.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Js(e,t,n,r){t.value=n,t.getSnapshot=r,Xs(t)&&Qs(e)}function Ks(e,t,n){return n(function(){Xs(t)&&Qs(e)})}function Xs(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!Jn(e,n)}catch(r){return!0}}function Qs(e){var t=Pr(e,2);null!==t&&Lc(t,e,2)}function Ys(e){var t=Ds();if("function"===typeof e){var n=e;if(e=n(),Es){he(!0);try{n()}finally{he(!1)}}}return t.memoizedState=t.baseState=e,t.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:qs,lastRenderedState:e},t}function ei(e,t,n,r){return e.baseState=n,Ws(e,ws,"function"===typeof r?r:qs)}function ti(e,t,n,r,a){if(Fi(e))throw Error(i(485));if(null!==(e=t.action)){var s={payload:a,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(e){s.listeners.push(e)}};null!==N.T?n(!0):s.isTransition=!1,r(s),null===(n=t.pending)?(s.next=t.pending=s,ni(t,s)):(s.next=n.next,t.pending=n.next=s)}}function ni(e,t){var n=t.action,r=t.payload,a=e.state;if(t.isTransition){var s=N.T,i={};N.T=i;try{var o=n(a,r),l=N.S;null!==l&&l(i,o),ri(e,t,o)}catch(c){si(e,t,c)}finally{N.T=s}}else try{ri(e,t,s=n(a,r))}catch(u){si(e,t,u)}}function ri(e,t,n){null!==n&&"object"===typeof n&&"function"===typeof n.then?n.then(function(n){ai(e,t,n)},function(n){return si(e,t,n)}):ai(e,t,n)}function ai(e,t,n){t.status="fulfilled",t.value=n,ii(t),e.state=n,null!==(t=e.pending)&&((n=t.next)===t?e.pending=null:(n=n.next,t.next=n,ni(e,n)))}function si(e,t,n){var r=e.pending;if(e.pending=null,null!==r){r=r.next;do{t.status="rejected",t.reason=n,ii(t),t=t.next}while(t!==r)}e.action=null}function ii(e){e=e.listeners;for(var t=0;t<e.length;t++)(0,e[t])()}function oi(e,t){return t}function li(e,t){if(sa){var n=rc.formState;if(null!==n){e:{var r=vs;if(sa){if(aa){t:{for(var a=aa,s=oa;8!==a.nodeType;){if(!s){a=null;break t}if(null===(a=yd(a.nextSibling))){a=null;break t}}a="F!"===(s=a.data)||"F"===s?a:null}if(a){aa=yd(a.nextSibling),r="F!"===a.data;break e}}ca(r)}r=!1}r&&(t=n[0])}}return(n=Ds()).memoizedState=n.baseState=t,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:oi,lastRenderedState:t},n.queue=r,n=Di.bind(null,vs,r),r.dispatch=n,r=Ys(!1),s=Ui.bind(null,vs,!1,r.queue),a={state:t,dispatch:null,action:e,pending:null},(r=Ds()).queue=a,n=ti.bind(null,vs,a,s,n),a.dispatch=n,r.memoizedState=e,[t,n,!1]}function ci(e){return ui(zs(),ws,e)}function ui(e,t,n){if(t=Ws(e,t,oi)[0],e=Hs(qs)[0],"object"===typeof t&&null!==t&&"function"===typeof t.then)try{var r=Us(t)}catch(i){if(i===Wa)throw Za;throw i}else r=t;var a=(t=zs()).queue,s=a.dispatch;return n!==t.memoizedState&&(vs.flags|=2048,fi(9,{destroy:void 0,resource:void 0},di.bind(null,a,n),null)),[r,s,e]}function di(e,t){e.action=t}function hi(e){var t=zs(),n=ws;if(null!==n)return ui(t,n,e);zs(),t=t.memoizedState;var r=(n=zs()).queue.dispatch;return n.memoizedState=e,[t,r,!1]}function fi(e,t,n,r){return e={tag:e,create:n,deps:r,inst:t,next:null},null===(t=vs.updateQueue)&&(t={lastEffect:null,events:null,stores:null,memoCache:null},vs.updateQueue=t),null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function pi(){return zs().memoizedState}function mi(e,t,n,r){var a=Ds();r=void 0===r?null:r,vs.flags|=e,a.memoizedState=fi(1|t,{destroy:void 0,resource:void 0},n,r)}function gi(e,t,n,r){var a=zs();r=void 0===r?null:r;var s=a.memoizedState.inst;null!==ws&&null!==r&&Ts(r,ws.memoizedState.deps)?a.memoizedState=fi(t,s,n,r):(vs.flags|=e,a.memoizedState=fi(1|t,s,n,r))}function yi(e,t){mi(8390656,8,e,t)}function bi(e,t){gi(2048,8,e,t)}function vi(e,t){return gi(4,2,e,t)}function wi(e,t){return gi(4,4,e,t)}function _i(e,t){if("function"===typeof t){e=e();var n=t(e);return function(){"function"===typeof n?n():t(null)}}if(null!==t&&void 0!==t)return e=e(),t.current=e,function(){t.current=null}}function Si(e,t,n){n=null!==n&&void 0!==n?n.concat([e]):null,gi(4,4,_i.bind(null,t,e),n)}function ki(){}function Ei(e,t){var n=zs();t=void 0===t?null:t;var r=n.memoizedState;return null!==t&&Ts(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function xi(e,t){var n=zs();t=void 0===t?null:t;var r=n.memoizedState;if(null!==t&&Ts(t,r[1]))return r[0];if(r=e(),Es){he(!0);try{e()}finally{he(!1)}}return n.memoizedState=[r,t],r}function Oi(e,t,n){return void 0===n||0!==(1073741824&bs)?e.memoizedState=t:(e.memoizedState=n,e=jc(),vs.lanes|=e,fc|=e,n)}function Ai(e,t,n,r){return Jn(n,t)?n:null!==fs.current?(e=Oi(e,n,r),Jn(e,t)||(Ao=!0),e):0===(42&bs)?(Ao=!0,e.memoizedState=n):(e=jc(),vs.lanes|=e,fc|=e,t)}function Ii(e,t,n,r,a){var s=j.p;j.p=0!==s&&8>s?s:8;var i=N.T,o={};N.T=o,Ui(e,!1,t,n);try{var l=a(),c=N.S;if(null!==c&&c(o,l),null!==l&&"object"===typeof l&&"function"===typeof l.then)zi(e,t,function(e,t){var n=[],r={status:"pending",value:null,reason:null,then:function(e){n.push(e)}};return e.then(function(){r.status="fulfilled",r.value=t;for(var e=0;e<n.length;e++)(0,n[e])(t)},function(e){for(r.status="rejected",r.reason=e,e=0;e<n.length;e++)(0,n[e])(void 0)}),r}(l,r),Nc());else zi(e,t,r,Nc())}catch(u){zi(e,t,{then:function(){},status:"rejected",reason:u},Nc())}finally{j.p=s,N.T=i}}function $i(){}function Ti(e,t,n,r){if(5!==e.tag)throw Error(i(476));var a=Pi(e).queue;Ii(e,a,t,L,null===n?$i:function(){return Ri(e),n(r)})}function Pi(e){var t=e.memoizedState;if(null!==t)return t;var n={};return(t={memoizedState:L,baseState:L,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:qs,lastRenderedState:L},next:null}).next={memoizedState:n,baseState:n,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:qs,lastRenderedState:n},next:null},e.memoizedState=t,null!==(e=e.alternate)&&(e.memoizedState=t),t}function Ri(e){zi(e,Pi(e).next.queue,{},Nc())}function Ci(){return Oa(Gd)}function Ni(){return zs().memoizedState}function ji(){return zs().memoizedState}function Li(e){for(var t=e.return;null!==t;){switch(t.tag){case 24:case 3:var n=Nc(),r=ss(t,e=as(n),n);return null!==r&&(Lc(r,t,n),is(r,t,n)),t={cache:Ca()},void(e.payload=t)}t=t.return}}function Mi(e,t,n){var r=Nc();n={lane:r,revertLane:0,action:n,hasEagerState:!1,eagerState:null,next:null},Fi(e)?Bi(t,n):null!==(n=Tr(e,t,n,r))&&(Lc(n,e,r),qi(n,t,r))}function Di(e,t,n){zi(e,t,n,Nc())}function zi(e,t,n,r){var a={lane:r,revertLane:0,action:n,hasEagerState:!1,eagerState:null,next:null};if(Fi(e))Bi(t,a);else{var s=e.alternate;if(0===e.lanes&&(null===s||0===s.lanes)&&null!==(s=t.lastRenderedReducer))try{var i=t.lastRenderedState,o=s(i,n);if(a.hasEagerState=!0,a.eagerState=o,Jn(o,i))return $r(e,t,a,0),null===rc&&Ir(),!1}catch(l){}if(null!==(n=Tr(e,t,a,r)))return Lc(n,e,r),qi(n,t,r),!0}return!1}function Ui(e,t,n,r){if(r={lane:2,revertLane:$u(),action:r,hasEagerState:!1,eagerState:null,next:null},Fi(e)){if(t)throw Error(i(479))}else null!==(t=Tr(e,n,r,2))&&Lc(t,e,2)}function Fi(e){var t=e.alternate;return e===vs||null!==t&&t===vs}function Bi(e,t){ks=Ss=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function qi(e,t,n){if(0!==(4194048&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,Ae(e,n)}}var Hi={readContext:Oa,use:Fs,useCallback:$s,useContext:$s,useEffect:$s,useImperativeHandle:$s,useLayoutEffect:$s,useInsertionEffect:$s,useMemo:$s,useReducer:$s,useRef:$s,useState:$s,useDebugValue:$s,useDeferredValue:$s,useTransition:$s,useSyncExternalStore:$s,useId:$s,useHostTransitionStatus:$s,useFormState:$s,useActionState:$s,useOptimistic:$s,useMemoCache:$s,useCacheRefresh:$s},Wi={readContext:Oa,use:Fs,useCallback:function(e,t){return Ds().memoizedState=[e,void 0===t?null:t],e},useContext:Oa,useEffect:yi,useImperativeHandle:function(e,t,n){n=null!==n&&void 0!==n?n.concat([e]):null,mi(4194308,4,_i.bind(null,t,e),n)},useLayoutEffect:function(e,t){return mi(4194308,4,e,t)},useInsertionEffect:function(e,t){mi(4,2,e,t)},useMemo:function(e,t){var n=Ds();t=void 0===t?null:t;var r=e();if(Es){he(!0);try{e()}finally{he(!1)}}return n.memoizedState=[r,t],r},useReducer:function(e,t,n){var r=Ds();if(void 0!==n){var a=n(t);if(Es){he(!0);try{n(t)}finally{he(!1)}}}else a=t;return r.memoizedState=r.baseState=a,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:a},r.queue=e,e=e.dispatch=Mi.bind(null,vs,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},Ds().memoizedState=e},useState:function(e){var t=(e=Ys(e)).queue,n=Di.bind(null,vs,t);return t.dispatch=n,[e.memoizedState,n]},useDebugValue:ki,useDeferredValue:function(e,t){return Oi(Ds(),e,t)},useTransition:function(){var e=Ys(!1);return e=Ii.bind(null,vs,e.queue,!0,!1),Ds().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,t,n){var r=vs,a=Ds();if(sa){if(void 0===n)throw Error(i(407));n=n()}else{if(n=t(),null===rc)throw Error(i(349));0!==(124&sc)||Gs(r,t,n)}a.memoizedState=n;var s={value:n,getSnapshot:t};return a.queue=s,yi(Ks.bind(null,r,s,e),[e]),r.flags|=2048,fi(9,{destroy:void 0,resource:void 0},Js.bind(null,r,s,n,t),null),n},useId:function(){var e=Ds(),t=rc.identifierPrefix;if(sa){var n=Qr;t="\xab"+t+"R"+(n=(Xr&~(1<<32-fe(Xr)-1)).toString(32)+n),0<(n=xs++)&&(t+="H"+n.toString(32)),t+="\xbb"}else t="\xab"+t+"r"+(n=Is++).toString(32)+"\xbb";return e.memoizedState=t},useHostTransitionStatus:Ci,useFormState:li,useActionState:li,useOptimistic:function(e){var t=Ds();t.memoizedState=t.baseState=e;var n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return t.queue=n,t=Ui.bind(null,vs,!0,n),n.dispatch=t,[e,t]},useMemoCache:Bs,useCacheRefresh:function(){return Ds().memoizedState=Li.bind(null,vs)}},Vi={readContext:Oa,use:Fs,useCallback:Ei,useContext:Oa,useEffect:bi,useImperativeHandle:Si,useInsertionEffect:vi,useLayoutEffect:wi,useMemo:xi,useReducer:Hs,useRef:pi,useState:function(){return Hs(qs)},useDebugValue:ki,useDeferredValue:function(e,t){return Ai(zs(),ws.memoizedState,e,t)},useTransition:function(){var e=Hs(qs)[0],t=zs().memoizedState;return["boolean"===typeof e?e:Us(e),t]},useSyncExternalStore:Zs,useId:Ni,useHostTransitionStatus:Ci,useFormState:ci,useActionState:ci,useOptimistic:function(e,t){return ei(zs(),0,e,t)},useMemoCache:Bs,useCacheRefresh:ji},Zi={readContext:Oa,use:Fs,useCallback:Ei,useContext:Oa,useEffect:bi,useImperativeHandle:Si,useInsertionEffect:vi,useLayoutEffect:wi,useMemo:xi,useReducer:Vs,useRef:pi,useState:function(){return Vs(qs)},useDebugValue:ki,useDeferredValue:function(e,t){var n=zs();return null===ws?Oi(n,e,t):Ai(n,ws.memoizedState,e,t)},useTransition:function(){var e=Vs(qs)[0],t=zs().memoizedState;return["boolean"===typeof e?e:Us(e),t]},useSyncExternalStore:Zs,useId:Ni,useHostTransitionStatus:Ci,useFormState:hi,useActionState:hi,useOptimistic:function(e,t){var n=zs();return null!==ws?ei(n,0,e,t):(n.baseState=e,[e,n.queue.dispatch])},useMemoCache:Bs,useCacheRefresh:ji},Gi=null,Ji=0;function Ki(e){var t=Ji;return Ji+=1,null===Gi&&(Gi=[]),Xa(Gi,e,t)}function Xi(e,t){t=t.props.ref,e.ref=void 0!==t?t:null}function Qi(e,t){if(t.$$typeof===f)throw Error(i(525));throw e=Object.prototype.toString.call(t),Error(i(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Yi(e){return(0,e._init)(e._payload)}function eo(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e){for(var t=new Map;null!==e;)null!==e.key?t.set(e.key,e):t.set(e.index,e),e=e.sibling;return t}function a(e,t){return(e=Dr(e,t)).index=0,e.sibling=null,e}function s(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=67108866,n):r:(t.flags|=67108866,n):(t.flags|=1048576,n)}function o(t){return e&&null===t.alternate&&(t.flags|=67108866),t}function l(e,t,n,r){return null===t||6!==t.tag?((t=Br(n,e.mode,r)).return=e,t):((t=a(t,n)).return=e,t)}function c(e,t,n,r){var s=n.type;return s===g?d(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===s||"object"===typeof s&&null!==s&&s.$$typeof===O&&Yi(s)===t.type)?(Xi(t=a(t,n.props),n),t.return=e,t):(Xi(t=Ur(n.type,n.key,n.props,null,e.mode,r),n),t.return=e,t)}function u(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=qr(n,e.mode,r)).return=e,t):((t=a(t,n.children||[])).return=e,t)}function d(e,t,n,r,s){return null===t||7!==t.tag?((t=Fr(n,e.mode,r,s)).return=e,t):((t=a(t,n)).return=e,t)}function h(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t||"bigint"===typeof t)return(t=Br(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case p:return Xi(n=Ur(t.type,t.key,t.props,null,e.mode,n),t),n.return=e,n;case m:return(t=qr(t,e.mode,n)).return=e,t;case O:return h(e,t=(0,t._init)(t._payload),n)}if(C(t)||T(t))return(t=Fr(t,e.mode,n,null)).return=e,t;if("function"===typeof t.then)return h(e,Ki(t),n);if(t.$$typeof===_)return h(e,Aa(e,t),n);Qi(e,t)}return null}function f(e,t,n,r){var a=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n||"bigint"===typeof n)return null!==a?null:l(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case p:return n.key===a?c(e,t,n,r):null;case m:return n.key===a?u(e,t,n,r):null;case O:return f(e,t,n=(a=n._init)(n._payload),r)}if(C(n)||T(n))return null!==a?null:d(e,t,n,r,null);if("function"===typeof n.then)return f(e,t,Ki(n),r);if(n.$$typeof===_)return f(e,t,Aa(e,n),r);Qi(e,n)}return null}function y(e,t,n,r,a){if("string"===typeof r&&""!==r||"number"===typeof r||"bigint"===typeof r)return l(t,e=e.get(n)||null,""+r,a);if("object"===typeof r&&null!==r){switch(r.$$typeof){case p:return c(t,e=e.get(null===r.key?n:r.key)||null,r,a);case m:return u(t,e=e.get(null===r.key?n:r.key)||null,r,a);case O:return y(e,t,n,r=(0,r._init)(r._payload),a)}if(C(r)||T(r))return d(t,e=e.get(n)||null,r,a,null);if("function"===typeof r.then)return y(e,t,n,Ki(r),a);if(r.$$typeof===_)return y(e,t,n,Aa(t,r),a);Qi(t,r)}return null}function b(l,c,u,d){if("object"===typeof u&&null!==u&&u.type===g&&null===u.key&&(u=u.props.children),"object"===typeof u&&null!==u){switch(u.$$typeof){case p:e:{for(var v=u.key;null!==c;){if(c.key===v){if((v=u.type)===g){if(7===c.tag){n(l,c.sibling),(d=a(c,u.props.children)).return=l,l=d;break e}}else if(c.elementType===v||"object"===typeof v&&null!==v&&v.$$typeof===O&&Yi(v)===c.type){n(l,c.sibling),Xi(d=a(c,u.props),u),d.return=l,l=d;break e}n(l,c);break}t(l,c),c=c.sibling}u.type===g?((d=Fr(u.props.children,l.mode,d,u.key)).return=l,l=d):(Xi(d=Ur(u.type,u.key,u.props,null,l.mode,d),u),d.return=l,l=d)}return o(l);case m:e:{for(v=u.key;null!==c;){if(c.key===v){if(4===c.tag&&c.stateNode.containerInfo===u.containerInfo&&c.stateNode.implementation===u.implementation){n(l,c.sibling),(d=a(c,u.children||[])).return=l,l=d;break e}n(l,c);break}t(l,c),c=c.sibling}(d=qr(u,l.mode,d)).return=l,l=d}return o(l);case O:return b(l,c,u=(v=u._init)(u._payload),d)}if(C(u))return function(a,i,o,l){for(var c=null,u=null,d=i,p=i=0,m=null;null!==d&&p<o.length;p++){d.index>p?(m=d,d=null):m=d.sibling;var g=f(a,d,o[p],l);if(null===g){null===d&&(d=m);break}e&&d&&null===g.alternate&&t(a,d),i=s(g,i,p),null===u?c=g:u.sibling=g,u=g,d=m}if(p===o.length)return n(a,d),sa&&Yr(a,p),c;if(null===d){for(;p<o.length;p++)null!==(d=h(a,o[p],l))&&(i=s(d,i,p),null===u?c=d:u.sibling=d,u=d);return sa&&Yr(a,p),c}for(d=r(d);p<o.length;p++)null!==(m=y(d,a,p,o[p],l))&&(e&&null!==m.alternate&&d.delete(null===m.key?p:m.key),i=s(m,i,p),null===u?c=m:u.sibling=m,u=m);return e&&d.forEach(function(e){return t(a,e)}),sa&&Yr(a,p),c}(l,c,u,d);if(T(u)){if("function"!==typeof(v=T(u)))throw Error(i(150));return function(a,o,l,c){if(null==l)throw Error(i(151));for(var u=null,d=null,p=o,m=o=0,g=null,b=l.next();null!==p&&!b.done;m++,b=l.next()){p.index>m?(g=p,p=null):g=p.sibling;var v=f(a,p,b.value,c);if(null===v){null===p&&(p=g);break}e&&p&&null===v.alternate&&t(a,p),o=s(v,o,m),null===d?u=v:d.sibling=v,d=v,p=g}if(b.done)return n(a,p),sa&&Yr(a,m),u;if(null===p){for(;!b.done;m++,b=l.next())null!==(b=h(a,b.value,c))&&(o=s(b,o,m),null===d?u=b:d.sibling=b,d=b);return sa&&Yr(a,m),u}for(p=r(p);!b.done;m++,b=l.next())null!==(b=y(p,a,m,b.value,c))&&(e&&null!==b.alternate&&p.delete(null===b.key?m:b.key),o=s(b,o,m),null===d?u=b:d.sibling=b,d=b);return e&&p.forEach(function(e){return t(a,e)}),sa&&Yr(a,m),u}(l,c,u=v.call(u),d)}if("function"===typeof u.then)return b(l,c,Ki(u),d);if(u.$$typeof===_)return b(l,c,Aa(l,u),d);Qi(l,u)}return"string"===typeof u&&""!==u||"number"===typeof u||"bigint"===typeof u?(u=""+u,null!==c&&6===c.tag?(n(l,c.sibling),(d=a(c,u)).return=l,l=d):(n(l,c),(d=Br(u,l.mode,d)).return=l,l=d),o(l)):n(l,c)}return function(e,t,n,r){try{Ji=0;var a=b(e,t,n,r);return Gi=null,a}catch(i){if(i===Wa||i===Za)throw i;var s=Lr(29,i,null,e.mode);return s.lanes=r,s.return=e,s}}}var to=eo(!0),no=eo(!1),ro=z(null),ao=null;function so(e){var t=e.alternate;F(co,1&co.current),F(ro,e),null===ao&&(null===t||null!==fs.current||null!==t.memoizedState)&&(ao=e)}function io(e){if(22===e.tag){if(F(co,co.current),F(ro,e),null===ao){var t=e.alternate;null!==t&&null!==t.memoizedState&&(ao=e)}}else oo()}function oo(){F(co,co.current),F(ro,ro.current)}function lo(e){U(ro),ao===e&&(ao=null),U(co)}var co=z(0);function uo(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||gd(n)))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}function ho(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:h({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var fo={enqueueSetState:function(e,t,n){e=e._reactInternals;var r=Nc(),a=as(r);a.payload=t,void 0!==n&&null!==n&&(a.callback=n),null!==(t=ss(e,a,r))&&(Lc(t,e,r),is(t,e,r))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=Nc(),a=as(r);a.tag=1,a.payload=t,void 0!==n&&null!==n&&(a.callback=n),null!==(t=ss(e,a,r))&&(Lc(t,e,r),is(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Nc(),r=as(n);r.tag=2,void 0!==t&&null!==t&&(r.callback=t),null!==(t=ss(e,r,n))&&(Lc(t,e,n),is(t,e,n))}};function po(e,t,n,r,a,s,i){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,s,i):!t.prototype||!t.prototype.isPureReactComponent||(!Kn(n,r)||!Kn(a,s))}function mo(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&fo.enqueueReplaceState(t,t.state,null)}function go(e,t){var n=t;if("ref"in t)for(var r in n={},t)"ref"!==r&&(n[r]=t[r]);if(e=e.defaultProps)for(var a in n===t&&(n=h({},n)),e)void 0===n[a]&&(n[a]=e[a]);return n}var yo="function"===typeof reportError?reportError:function(e){if("object"===typeof window&&"function"===typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"===typeof e&&null!==e&&"string"===typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"===typeof process&&"function"===typeof process.emit)return void process.emit("uncaughtException",e);console.error(e)};function bo(e){yo(e)}function vo(e){console.error(e)}function wo(e){yo(e)}function _o(e,t){try{(0,e.onUncaughtError)(t.value,{componentStack:t.stack})}catch(n){setTimeout(function(){throw n})}}function So(e,t,n){try{(0,e.onCaughtError)(n.value,{componentStack:n.stack,errorBoundary:1===t.tag?t.stateNode:null})}catch(r){setTimeout(function(){throw r})}}function ko(e,t,n){return(n=as(n)).tag=3,n.payload={element:null},n.callback=function(){_o(e,t)},n}function Eo(e){return(e=as(e)).tag=3,e}function xo(e,t,n,r){var a=n.type.getDerivedStateFromError;if("function"===typeof a){var s=r.value;e.payload=function(){return a(s)},e.callback=function(){So(t,n,r)}}var i=n.stateNode;null!==i&&"function"===typeof i.componentDidCatch&&(e.callback=function(){So(t,n,r),"function"!==typeof a&&(null===Ec?Ec=new Set([this]):Ec.add(this));var e=r.stack;this.componentDidCatch(r.value,{componentStack:null!==e?e:""})})}var Oo=Error(i(461)),Ao=!1;function Io(e,t,n,r){t.child=null===e?no(t,null,n,r):to(t,e.child,n,r)}function $o(e,t,n,r,a){n=n.render;var s=t.ref;if("ref"in r){var i={};for(var o in r)"ref"!==o&&(i[o]=r[o])}else i=r;return xa(t),r=Ps(e,t,n,i,s,a),o=js(),null===e||Ao?(sa&&o&&ta(t),t.flags|=1,Io(e,t,r,a),t.child):(Ls(e,t,a),Jo(e,t,a))}function To(e,t,n,r,a){if(null===e){var s=n.type;return"function"!==typeof s||Mr(s)||void 0!==s.defaultProps||null!==n.compare?((e=Ur(n.type,null,r,t,t.mode,a)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=s,Po(e,t,s,r,a))}if(s=e.child,!Ko(e,a)){var i=s.memoizedProps;if((n=null!==(n=n.compare)?n:Kn)(i,r)&&e.ref===t.ref)return Jo(e,t,a)}return t.flags|=1,(e=Dr(s,r)).ref=t.ref,e.return=t,t.child=e}function Po(e,t,n,r,a){if(null!==e){var s=e.memoizedProps;if(Kn(s,r)&&e.ref===t.ref){if(Ao=!1,t.pendingProps=r=s,!Ko(e,a))return t.lanes=e.lanes,Jo(e,t,a);0!==(131072&e.flags)&&(Ao=!0)}}return jo(e,t,n,r,a)}function Ro(e,t,n){var r=t.pendingProps,a=r.children,s=null!==e?e.memoizedState:null;if("hidden"===r.mode){if(0!==(128&t.flags)){if(r=null!==s?s.baseLanes|n:n,null!==e){for(a=t.child=e.child,s=0;null!==a;)s=s|a.lanes|a.childLanes,a=a.sibling;t.childLanes=s&~r}else t.childLanes=0,t.child=null;return Co(e,t,r,n)}if(0===(536870912&n))return t.lanes=t.childLanes=536870912,Co(e,t,null!==s?s.baseLanes|n:n,n);t.memoizedState={baseLanes:0,cachePool:null},null!==e&&qa(0,null!==s?s.cachePool:null),null!==s?ms(t,s):gs(),io(t)}else null!==s?(qa(0,s.cachePool),ms(t,s),oo(),t.memoizedState=null):(null!==e&&qa(0,null),gs(),oo());return Io(e,t,a,n),t.child}function Co(e,t,n,r){var a=Ba();return a=null===a?null:{parent:Ra._currentValue,pool:a},t.memoizedState={baseLanes:n,cachePool:a},null!==e&&qa(0,null),gs(),io(t),null!==e&&ka(e,t,r,!0),null}function No(e,t){var n=t.ref;if(null===n)null!==e&&null!==e.ref&&(t.flags|=4194816);else{if("function"!==typeof n&&"object"!==typeof n)throw Error(i(284));null!==e&&e.ref===n||(t.flags|=4194816)}}function jo(e,t,n,r,a){return xa(t),n=Ps(e,t,n,r,void 0,a),r=js(),null===e||Ao?(sa&&r&&ta(t),t.flags|=1,Io(e,t,n,a),t.child):(Ls(e,t,a),Jo(e,t,a))}function Lo(e,t,n,r,a,s){return xa(t),t.updateQueue=null,n=Cs(t,r,n,a),Rs(e),r=js(),null===e||Ao?(sa&&r&&ta(t),t.flags|=1,Io(e,t,n,s),t.child):(Ls(e,t,s),Jo(e,t,s))}function Mo(e,t,n,r,a){if(xa(t),null===t.stateNode){var s=Nr,i=n.contextType;"object"===typeof i&&null!==i&&(s=Oa(i)),s=new n(r,s),t.memoizedState=null!==s.state&&void 0!==s.state?s.state:null,s.updater=fo,t.stateNode=s,s._reactInternals=t,(s=t.stateNode).props=r,s.state=t.memoizedState,s.refs={},ns(t),i=n.contextType,s.context="object"===typeof i&&null!==i?Oa(i):Nr,s.state=t.memoizedState,"function"===typeof(i=n.getDerivedStateFromProps)&&(ho(t,n,i,r),s.state=t.memoizedState),"function"===typeof n.getDerivedStateFromProps||"function"===typeof s.getSnapshotBeforeUpdate||"function"!==typeof s.UNSAFE_componentWillMount&&"function"!==typeof s.componentWillMount||(i=s.state,"function"===typeof s.componentWillMount&&s.componentWillMount(),"function"===typeof s.UNSAFE_componentWillMount&&s.UNSAFE_componentWillMount(),i!==s.state&&fo.enqueueReplaceState(s,s.state,null),us(t,r,s,a),cs(),s.state=t.memoizedState),"function"===typeof s.componentDidMount&&(t.flags|=4194308),r=!0}else if(null===e){s=t.stateNode;var o=t.memoizedProps,l=go(n,o);s.props=l;var c=s.context,u=n.contextType;i=Nr,"object"===typeof u&&null!==u&&(i=Oa(u));var d=n.getDerivedStateFromProps;u="function"===typeof d||"function"===typeof s.getSnapshotBeforeUpdate,o=t.pendingProps!==o,u||"function"!==typeof s.UNSAFE_componentWillReceiveProps&&"function"!==typeof s.componentWillReceiveProps||(o||c!==i)&&mo(t,s,r,i),ts=!1;var h=t.memoizedState;s.state=h,us(t,r,s,a),cs(),c=t.memoizedState,o||h!==c||ts?("function"===typeof d&&(ho(t,n,d,r),c=t.memoizedState),(l=ts||po(t,n,l,r,h,c,i))?(u||"function"!==typeof s.UNSAFE_componentWillMount&&"function"!==typeof s.componentWillMount||("function"===typeof s.componentWillMount&&s.componentWillMount(),"function"===typeof s.UNSAFE_componentWillMount&&s.UNSAFE_componentWillMount()),"function"===typeof s.componentDidMount&&(t.flags|=4194308)):("function"===typeof s.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=c),s.props=r,s.state=c,s.context=i,r=l):("function"===typeof s.componentDidMount&&(t.flags|=4194308),r=!1)}else{s=t.stateNode,rs(e,t),u=go(n,i=t.memoizedProps),s.props=u,d=t.pendingProps,h=s.context,c=n.contextType,l=Nr,"object"===typeof c&&null!==c&&(l=Oa(c)),(c="function"===typeof(o=n.getDerivedStateFromProps)||"function"===typeof s.getSnapshotBeforeUpdate)||"function"!==typeof s.UNSAFE_componentWillReceiveProps&&"function"!==typeof s.componentWillReceiveProps||(i!==d||h!==l)&&mo(t,s,r,l),ts=!1,h=t.memoizedState,s.state=h,us(t,r,s,a),cs();var f=t.memoizedState;i!==d||h!==f||ts||null!==e&&null!==e.dependencies&&Ea(e.dependencies)?("function"===typeof o&&(ho(t,n,o,r),f=t.memoizedState),(u=ts||po(t,n,u,r,h,f,l)||null!==e&&null!==e.dependencies&&Ea(e.dependencies))?(c||"function"!==typeof s.UNSAFE_componentWillUpdate&&"function"!==typeof s.componentWillUpdate||("function"===typeof s.componentWillUpdate&&s.componentWillUpdate(r,f,l),"function"===typeof s.UNSAFE_componentWillUpdate&&s.UNSAFE_componentWillUpdate(r,f,l)),"function"===typeof s.componentDidUpdate&&(t.flags|=4),"function"===typeof s.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof s.componentDidUpdate||i===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof s.getSnapshotBeforeUpdate||i===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=f),s.props=r,s.state=f,s.context=l,r=u):("function"!==typeof s.componentDidUpdate||i===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof s.getSnapshotBeforeUpdate||i===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),r=!1)}return s=r,No(e,t),r=0!==(128&t.flags),s||r?(s=t.stateNode,n=r&&"function"!==typeof n.getDerivedStateFromError?null:s.render(),t.flags|=1,null!==e&&r?(t.child=to(t,e.child,null,a),t.child=to(t,null,n,a)):Io(e,t,n,a),t.memoizedState=s.state,e=t.child):e=Jo(e,t,a),e}function Do(e,t,n,r){return fa(),t.flags|=256,Io(e,t,n,r),t.child}var zo={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Uo(e){return{baseLanes:e,cachePool:Ha()}}function Fo(e,t,n){return e=null!==e?e.childLanes&~n:0,t&&(e|=gc),e}function Bo(e,t,n){var r,a=t.pendingProps,s=!1,o=0!==(128&t.flags);if((r=o)||(r=(null===e||null!==e.memoizedState)&&0!==(2&co.current)),r&&(s=!0,t.flags&=-129),r=0!==(32&t.flags),t.flags&=-33,null===e){if(sa){if(s?so(t):oo(),sa){var l,c=aa;if(l=c){e:{for(l=c,c=oa;8!==l.nodeType;){if(!c){c=null;break e}if(null===(l=yd(l.nextSibling))){c=null;break e}}c=l}null!==c?(t.memoizedState={dehydrated:c,treeContext:null!==Kr?{id:Xr,overflow:Qr}:null,retryLane:536870912,hydrationErrors:null},(l=Lr(18,null,null,0)).stateNode=c,l.return=t,t.child=l,ra=t,aa=null,l=!0):l=!1}l||ca(t)}if(null!==(c=t.memoizedState)&&null!==(c=c.dehydrated))return gd(c)?t.lanes=32:t.lanes=536870912,null;lo(t)}return c=a.children,a=a.fallback,s?(oo(),c=Ho({mode:"hidden",children:c},s=t.mode),a=Fr(a,s,n,null),c.return=t,a.return=t,c.sibling=a,t.child=c,(s=t.child).memoizedState=Uo(n),s.childLanes=Fo(e,r,n),t.memoizedState=zo,a):(so(t),qo(t,c))}if(null!==(l=e.memoizedState)&&null!==(c=l.dehydrated)){if(o)256&t.flags?(so(t),t.flags&=-257,t=Wo(e,t,n)):null!==t.memoizedState?(oo(),t.child=e.child,t.flags|=128,t=null):(oo(),s=a.fallback,c=t.mode,a=Ho({mode:"visible",children:a.children},c),(s=Fr(s,c,n,null)).flags|=2,a.return=t,s.return=t,a.sibling=s,t.child=a,to(t,e.child,null,n),(a=t.child).memoizedState=Uo(n),a.childLanes=Fo(e,r,n),t.memoizedState=zo,t=s);else if(so(t),gd(c)){if(r=c.nextSibling&&c.nextSibling.dataset)var u=r.dgst;r=u,(a=Error(i(419))).stack="",a.digest=r,ma({value:a,source:null,stack:null}),t=Wo(e,t,n)}else if(Ao||ka(e,t,n,!1),r=0!==(n&e.childLanes),Ao||r){if(null!==(r=rc)&&(0!==(a=0!==((a=0!==(42&(a=n&-n))?1:Ie(a))&(r.suspendedLanes|n))?0:a)&&a!==l.retryLane))throw l.retryLane=a,Pr(e,a),Lc(r,e,a),Oo;"$?"===c.data||Zc(),t=Wo(e,t,n)}else"$?"===c.data?(t.flags|=192,t.child=e.child,t=null):(e=l.treeContext,aa=yd(c.nextSibling),ra=t,sa=!0,ia=null,oa=!1,null!==e&&(Gr[Jr++]=Xr,Gr[Jr++]=Qr,Gr[Jr++]=Kr,Xr=e.id,Qr=e.overflow,Kr=t),(t=qo(t,a.children)).flags|=4096);return t}return s?(oo(),s=a.fallback,c=t.mode,u=(l=e.child).sibling,(a=Dr(l,{mode:"hidden",children:a.children})).subtreeFlags=65011712&l.subtreeFlags,null!==u?s=Dr(u,s):(s=Fr(s,c,n,null)).flags|=2,s.return=t,a.return=t,a.sibling=s,t.child=a,a=s,s=t.child,null===(c=e.child.memoizedState)?c=Uo(n):(null!==(l=c.cachePool)?(u=Ra._currentValue,l=l.parent!==u?{parent:u,pool:u}:l):l=Ha(),c={baseLanes:c.baseLanes|n,cachePool:l}),s.memoizedState=c,s.childLanes=Fo(e,r,n),t.memoizedState=zo,a):(so(t),e=(n=e.child).sibling,(n=Dr(n,{mode:"visible",children:a.children})).return=t,n.sibling=null,null!==e&&(null===(r=t.deletions)?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=n,t.memoizedState=null,n)}function qo(e,t){return(t=Ho({mode:"visible",children:t},e.mode)).return=e,e.child=t}function Ho(e,t){return(e=Lr(22,e,null,t)).lanes=0,e.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},e}function Wo(e,t,n){return to(t,e.child,null,n),(e=qo(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Vo(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),_a(e.return,t,n)}function Zo(e,t,n,r,a){var s=e.memoizedState;null===s?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:a}:(s.isBackwards=t,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=n,s.tailMode=a)}function Go(e,t,n){var r=t.pendingProps,a=r.revealOrder,s=r.tail;if(Io(e,t,r.children,n),0!==(2&(r=co.current)))r=1&r|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Vo(e,n,t);else if(19===e.tag)Vo(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}switch(F(co,r),a){case"forwards":for(n=t.child,a=null;null!==n;)null!==(e=n.alternate)&&null===uo(e)&&(a=n),n=n.sibling;null===(n=a)?(a=t.child,t.child=null):(a=n.sibling,n.sibling=null),Zo(t,!1,a,n,s);break;case"backwards":for(n=null,a=t.child,t.child=null;null!==a;){if(null!==(e=a.alternate)&&null===uo(e)){t.child=a;break}e=a.sibling,a.sibling=n,n=a,a=e}Zo(t,!0,n,null,s);break;case"together":Zo(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Jo(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),fc|=t.lanes,0===(n&t.childLanes)){if(null===e)return null;if(ka(e,t,n,!1),0===(n&t.childLanes))return null}if(null!==e&&t.child!==e.child)throw Error(i(153));if(null!==t.child){for(n=Dr(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Dr(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Ko(e,t){return 0!==(e.lanes&t)||!(null===(e=e.dependencies)||!Ea(e))}function Xo(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps)Ao=!0;else{if(!Ko(e,n)&&0===(128&t.flags))return Ao=!1,function(e,t,n){switch(t.tag){case 3:V(t,t.stateNode.containerInfo),va(0,Ra,e.memoizedState.cache),fa();break;case 27:case 5:G(t);break;case 4:V(t,t.stateNode.containerInfo);break;case 10:va(0,t.type,t.memoizedProps.value);break;case 13:var r=t.memoizedState;if(null!==r)return null!==r.dehydrated?(so(t),t.flags|=128,null):0!==(n&t.child.childLanes)?Bo(e,t,n):(so(t),null!==(e=Jo(e,t,n))?e.sibling:null);so(t);break;case 19:var a=0!==(128&e.flags);if((r=0!==(n&t.childLanes))||(ka(e,t,n,!1),r=0!==(n&t.childLanes)),a){if(r)return Go(e,t,n);t.flags|=128}if(null!==(a=t.memoizedState)&&(a.rendering=null,a.tail=null,a.lastEffect=null),F(co,co.current),r)break;return null;case 22:case 23:return t.lanes=0,Ro(e,t,n);case 24:va(0,Ra,e.memoizedState.cache)}return Jo(e,t,n)}(e,t,n);Ao=0!==(131072&e.flags)}else Ao=!1,sa&&0!==(1048576&t.flags)&&ea(t,Zr,t.index);switch(t.lanes=0,t.tag){case 16:e:{e=t.pendingProps;var r=t.elementType,a=r._init;if(r=a(r._payload),t.type=r,"function"!==typeof r){if(void 0!==r&&null!==r){if((a=r.$$typeof)===S){t.tag=11,t=$o(null,t,r,e,n);break e}if(a===x){t.tag=14,t=To(null,t,r,e,n);break e}}throw t=R(r)||r,Error(i(306,t,""))}Mr(r)?(e=go(r,e),t.tag=1,t=Mo(null,t,r,e,n)):(t.tag=0,t=jo(null,t,r,e,n))}return t;case 0:return jo(e,t,t.type,t.pendingProps,n);case 1:return Mo(e,t,r=t.type,a=go(r,t.pendingProps),n);case 3:e:{if(V(t,t.stateNode.containerInfo),null===e)throw Error(i(387));r=t.pendingProps;var s=t.memoizedState;a=s.element,rs(e,t),us(t,r,null,n);var o=t.memoizedState;if(r=o.cache,va(0,Ra,r),r!==s.cache&&Sa(t,[Ra],n,!0),cs(),r=o.element,s.isDehydrated){if(s={element:r,isDehydrated:!1,cache:o.cache},t.updateQueue.baseState=s,t.memoizedState=s,256&t.flags){t=Do(e,t,r,n);break e}if(r!==a){ma(a=Er(Error(i(424)),t)),t=Do(e,t,r,n);break e}if(9===(e=t.stateNode.containerInfo).nodeType)e=e.body;else e="HTML"===e.nodeName?e.ownerDocument.body:e;for(aa=yd(e.firstChild),ra=t,sa=!0,ia=null,oa=!0,n=no(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(fa(),r===a){t=Jo(e,t,n);break e}Io(e,t,r,n)}t=t.child}return t;case 26:return No(e,t),null===e?(n=Id(t.type,null,t.pendingProps,null))?t.memoizedState=n:sa||(n=t.type,e=t.pendingProps,(r=rd(H.current).createElement(n))[Re]=t,r[Ce]=e,ed(r,n,e),We(r),t.stateNode=r):t.memoizedState=Id(t.type,e.memoizedProps,t.pendingProps,e.memoizedState),null;case 27:return G(t),null===e&&sa&&(r=t.stateNode=wd(t.type,t.pendingProps,H.current),ra=t,oa=!0,a=aa,fd(t.type)?(bd=a,aa=yd(r.firstChild)):aa=a),Io(e,t,t.pendingProps.children,n),No(e,t),null===e&&(t.flags|=4194304),t.child;case 5:return null===e&&sa&&((a=r=aa)&&(null!==(r=function(e,t,n,r){for(;1===e.nodeType;){var a=n;if(e.nodeName.toLowerCase()!==t.toLowerCase()){if(!r&&("INPUT"!==e.nodeName||"hidden"!==e.type))break}else if(r){if(!e[ze])switch(t){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if("stylesheet"===(s=e.getAttribute("rel"))&&e.hasAttribute("data-precedence"))break;if(s!==a.rel||e.getAttribute("href")!==(null==a.href||""===a.href?null:a.href)||e.getAttribute("crossorigin")!==(null==a.crossOrigin?null:a.crossOrigin)||e.getAttribute("title")!==(null==a.title?null:a.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(((s=e.getAttribute("src"))!==(null==a.src?null:a.src)||e.getAttribute("type")!==(null==a.type?null:a.type)||e.getAttribute("crossorigin")!==(null==a.crossOrigin?null:a.crossOrigin))&&s&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else{if("input"!==t||"hidden"!==e.type)return e;var s=null==a.name?null:""+a.name;if("hidden"===a.type&&e.getAttribute("name")===s)return e}if(null===(e=yd(e.nextSibling)))break}return null}(r,t.type,t.pendingProps,oa))?(t.stateNode=r,ra=t,aa=yd(r.firstChild),oa=!1,a=!0):a=!1),a||ca(t)),G(t),a=t.type,s=t.pendingProps,o=null!==e?e.memoizedProps:null,r=s.children,id(a,s)?r=null:null!==o&&id(a,o)&&(t.flags|=32),null!==t.memoizedState&&(a=Ps(e,t,Ns,null,null,n),Gd._currentValue=a),No(e,t),Io(e,t,r,n),t.child;case 6:return null===e&&sa&&((e=n=aa)&&(null!==(n=function(e,t,n){if(""===t)return null;for(;3!==e.nodeType;){if((1!==e.nodeType||"INPUT"!==e.nodeName||"hidden"!==e.type)&&!n)return null;if(null===(e=yd(e.nextSibling)))return null}return e}(n,t.pendingProps,oa))?(t.stateNode=n,ra=t,aa=null,e=!0):e=!1),e||ca(t)),null;case 13:return Bo(e,t,n);case 4:return V(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=to(t,null,r,n):Io(e,t,r,n),t.child;case 11:return $o(e,t,t.type,t.pendingProps,n);case 7:return Io(e,t,t.pendingProps,n),t.child;case 8:case 12:return Io(e,t,t.pendingProps.children,n),t.child;case 10:return r=t.pendingProps,va(0,t.type,r.value),Io(e,t,r.children,n),t.child;case 9:return a=t.type._context,r=t.pendingProps.children,xa(t),r=r(a=Oa(a)),t.flags|=1,Io(e,t,r,n),t.child;case 14:return To(e,t,t.type,t.pendingProps,n);case 15:return Po(e,t,t.type,t.pendingProps,n);case 19:return Go(e,t,n);case 31:return r=t.pendingProps,n=t.mode,r={mode:r.mode,children:r.children},null===e?((n=Ho(r,n)).ref=t.ref,t.child=n,n.return=t,t=n):((n=Dr(e.child,r)).ref=t.ref,t.child=n,n.return=t,t=n),t;case 22:return Ro(e,t,n);case 24:return xa(t),r=Oa(Ra),null===e?(null===(a=Ba())&&(a=rc,s=Ca(),a.pooledCache=s,s.refCount++,null!==s&&(a.pooledCacheLanes|=n),a=s),t.memoizedState={parent:r,cache:a},ns(t),va(0,Ra,a)):(0!==(e.lanes&n)&&(rs(e,t),us(t,null,null,n),cs()),a=e.memoizedState,s=t.memoizedState,a.parent!==r?(a={parent:r,cache:r},t.memoizedState=a,0===t.lanes&&(t.memoizedState=t.updateQueue.baseState=a),va(0,Ra,r)):(r=s.cache,va(0,Ra,r),r!==a.cache&&Sa(t,[Ra],n,!0))),Io(e,t,t.pendingProps.children,n),t.child;case 29:throw t.pendingProps}throw Error(i(156,t.tag))}function Qo(e){e.flags|=4}function Yo(e,t){if("stylesheet"!==t.type||0!==(4&t.state.loading))e.flags&=-16777217;else if(e.flags|=16777216,!Fd(t)){if(null!==(t=ro.current)&&((4194048&sc)===sc?null!==ao:(62914560&sc)!==sc&&0===(536870912&sc)||t!==ao))throw Qa=Ga,Va;e.flags|=8192}}function el(e,t){null!==t&&(e.flags|=4),16384&e.flags&&(t=22!==e.tag?ke():536870912,e.lanes|=t,yc|=t)}function tl(e,t){if(!sa)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function nl(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var a=e.child;null!==a;)n|=a.lanes|a.childLanes,r|=65011712&a.subtreeFlags,r|=65011712&a.flags,a.return=e,a=a.sibling;else for(a=e.child;null!==a;)n|=a.lanes|a.childLanes,r|=a.subtreeFlags,r|=a.flags,a.return=e,a=a.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function rl(e,t,n){var r=t.pendingProps;switch(na(t),t.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:case 1:return nl(t),null;case 3:return n=t.stateNode,r=null,null!==e&&(r=e.memoizedState.cache),t.memoizedState.cache!==r&&(t.flags|=2048),wa(Ra),Z(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),null!==e&&null!==e.child||(ha(t)?Qo(t):null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,pa())),nl(t),null;case 26:return n=t.memoizedState,null===e?(Qo(t),null!==n?(nl(t),Yo(t,n)):(nl(t),t.flags&=-16777217)):n?n!==e.memoizedState?(Qo(t),nl(t),Yo(t,n)):(nl(t),t.flags&=-16777217):(e.memoizedProps!==r&&Qo(t),nl(t),t.flags&=-16777217),null;case 27:J(t),n=H.current;var a=t.type;if(null!==e&&null!=t.stateNode)e.memoizedProps!==r&&Qo(t);else{if(!r){if(null===t.stateNode)throw Error(i(166));return nl(t),null}e=B.current,ha(t)?ua(t):(e=wd(a,r,n),t.stateNode=e,Qo(t))}return nl(t),null;case 5:if(J(t),n=t.type,null!==e&&null!=t.stateNode)e.memoizedProps!==r&&Qo(t);else{if(!r){if(null===t.stateNode)throw Error(i(166));return nl(t),null}if(e=B.current,ha(t))ua(t);else{switch(a=rd(H.current),e){case 1:e=a.createElementNS("http://www.w3.org/2000/svg",n);break;case 2:e=a.createElementNS("http://www.w3.org/1998/Math/MathML",n);break;default:switch(n){case"svg":e=a.createElementNS("http://www.w3.org/2000/svg",n);break;case"math":e=a.createElementNS("http://www.w3.org/1998/Math/MathML",n);break;case"script":(e=a.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild);break;case"select":e="string"===typeof r.is?a.createElement("select",{is:r.is}):a.createElement("select"),r.multiple?e.multiple=!0:r.size&&(e.size=r.size);break;default:e="string"===typeof r.is?a.createElement(n,{is:r.is}):a.createElement(n)}}e[Re]=t,e[Ce]=r;e:for(a=t.child;null!==a;){if(5===a.tag||6===a.tag)e.appendChild(a.stateNode);else if(4!==a.tag&&27!==a.tag&&null!==a.child){a.child.return=a,a=a.child;continue}if(a===t)break e;for(;null===a.sibling;){if(null===a.return||a.return===t)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}t.stateNode=e;e:switch(ed(e,n,r),n){case"button":case"input":case"select":case"textarea":e=!!r.autoFocus;break e;case"img":e=!0;break e;default:e=!1}e&&Qo(t)}}return nl(t),t.flags&=-16777217,null;case 6:if(e&&null!=t.stateNode)e.memoizedProps!==r&&Qo(t);else{if("string"!==typeof r&&null===t.stateNode)throw Error(i(166));if(e=H.current,ha(t)){if(e=t.stateNode,n=t.memoizedProps,r=null,null!==(a=ra))switch(a.tag){case 27:case 5:r=a.memoizedProps}e[Re]=t,(e=!!(e.nodeValue===n||null!==r&&!0===r.suppressHydrationWarning||Ku(e.nodeValue,n)))||ca(t)}else(e=rd(e).createTextNode(r))[Re]=t,t.stateNode=e}return nl(t),null;case 13:if(r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(a=ha(t),null!==r&&null!==r.dehydrated){if(null===e){if(!a)throw Error(i(318));if(!(a=null!==(a=t.memoizedState)?a.dehydrated:null))throw Error(i(317));a[Re]=t}else fa(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;nl(t),a=!1}else a=pa(),null!==e&&null!==e.memoizedState&&(e.memoizedState.hydrationErrors=a),a=!0;if(!a)return 256&t.flags?(lo(t),t):(lo(t),null)}if(lo(t),0!==(128&t.flags))return t.lanes=n,t;if(n=null!==r,e=null!==e&&null!==e.memoizedState,n){a=null,null!==(r=t.child).alternate&&null!==r.alternate.memoizedState&&null!==r.alternate.memoizedState.cachePool&&(a=r.alternate.memoizedState.cachePool.pool);var s=null;null!==r.memoizedState&&null!==r.memoizedState.cachePool&&(s=r.memoizedState.cachePool.pool),s!==a&&(r.flags|=2048)}return n!==e&&n&&(t.child.flags|=8192),el(t,t.updateQueue),nl(t),null;case 4:return Z(),null===e&&Uu(t.stateNode.containerInfo),nl(t),null;case 10:return wa(t.type),nl(t),null;case 19:if(U(co),null===(a=t.memoizedState))return nl(t),null;if(r=0!==(128&t.flags),null===(s=a.rendering))if(r)tl(a,!1);else{if(0!==hc||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(s=uo(e))){for(t.flags|=128,tl(a,!1),e=s.updateQueue,t.updateQueue=e,el(t,e),t.subtreeFlags=0,e=n,n=t.child;null!==n;)zr(n,e),n=n.sibling;return F(co,1&co.current|2),t.child}e=e.sibling}null!==a.tail&&te()>Sc&&(t.flags|=128,r=!0,tl(a,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=uo(s))){if(t.flags|=128,r=!0,e=e.updateQueue,t.updateQueue=e,el(t,e),tl(a,!0),null===a.tail&&"hidden"===a.tailMode&&!s.alternate&&!sa)return nl(t),null}else 2*te()-a.renderingStartTime>Sc&&536870912!==n&&(t.flags|=128,r=!0,tl(a,!1),t.lanes=4194304);a.isBackwards?(s.sibling=t.child,t.child=s):(null!==(e=a.last)?e.sibling=s:t.child=s,a.last=s)}return null!==a.tail?(t=a.tail,a.rendering=t,a.tail=t.sibling,a.renderingStartTime=te(),t.sibling=null,e=co.current,F(co,r?1&e|2:1&e),t):(nl(t),null);case 22:case 23:return lo(t),ys(),r=null!==t.memoizedState,null!==e?null!==e.memoizedState!==r&&(t.flags|=8192):r&&(t.flags|=8192),r?0!==(536870912&n)&&0===(128&t.flags)&&(nl(t),6&t.subtreeFlags&&(t.flags|=8192)):nl(t),null!==(n=t.updateQueue)&&el(t,n.retryQueue),n=null,null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),r=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(r=t.memoizedState.cachePool.pool),r!==n&&(t.flags|=2048),null!==e&&U(Fa),null;case 24:return n=null,null!==e&&(n=e.memoizedState.cache),t.memoizedState.cache!==n&&(t.flags|=2048),wa(Ra),nl(t),null;case 25:case 30:return null}throw Error(i(156,t.tag))}function al(e,t){switch(na(t),t.tag){case 1:return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return wa(Ra),Z(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 26:case 27:case 5:return J(t),null;case 13:if(lo(t),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(i(340));fa()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return U(co),null;case 4:return Z(),null;case 10:return wa(t.type),null;case 22:case 23:return lo(t),ys(),null!==e&&U(Fa),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 24:return wa(Ra),null;default:return null}}function sl(e,t){switch(na(t),t.tag){case 3:wa(Ra),Z();break;case 26:case 27:case 5:J(t);break;case 4:Z();break;case 13:lo(t);break;case 19:U(co);break;case 10:wa(t.type);break;case 22:case 23:lo(t),ys(),null!==e&&U(Fa);break;case 24:wa(Ra)}}function il(e,t){try{var n=t.updateQueue,r=null!==n?n.lastEffect:null;if(null!==r){var a=r.next;n=a;do{if((n.tag&e)===e){r=void 0;var s=n.create,i=n.inst;r=s(),i.destroy=r}n=n.next}while(n!==a)}}catch(o){uu(t,t.return,o)}}function ol(e,t,n){try{var r=t.updateQueue,a=null!==r?r.lastEffect:null;if(null!==a){var s=a.next;r=s;do{if((r.tag&e)===e){var i=r.inst,o=i.destroy;if(void 0!==o){i.destroy=void 0,a=t;var l=n,c=o;try{c()}catch(u){uu(a,l,u)}}}r=r.next}while(r!==s)}}catch(u){uu(t,t.return,u)}}function ll(e){var t=e.updateQueue;if(null!==t){var n=e.stateNode;try{hs(t,n)}catch(r){uu(e,e.return,r)}}}function cl(e,t,n){n.props=go(e.type,e.memoizedProps),n.state=e.memoizedState;try{n.componentWillUnmount()}catch(r){uu(e,t,r)}}function ul(e,t){try{var n=e.ref;if(null!==n){switch(e.tag){case 26:case 27:case 5:var r=e.stateNode;break;default:r=e.stateNode}"function"===typeof n?e.refCleanup=n(r):n.current=r}}catch(a){uu(e,t,a)}}function dl(e,t){var n=e.ref,r=e.refCleanup;if(null!==n)if("function"===typeof r)try{r()}catch(a){uu(e,t,a)}finally{e.refCleanup=null,null!=(e=e.alternate)&&(e.refCleanup=null)}else if("function"===typeof n)try{n(null)}catch(s){uu(e,t,s)}else n.current=null}function hl(e){var t=e.type,n=e.memoizedProps,r=e.stateNode;try{e:switch(t){case"button":case"input":case"select":case"textarea":n.autoFocus&&r.focus();break e;case"img":n.src?r.src=n.src:n.srcSet&&(r.srcset=n.srcSet)}}catch(a){uu(e,e.return,a)}}function fl(e,t,n){try{var r=e.stateNode;!function(e,t,n,r){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var a=null,s=null,o=null,l=null,c=null,u=null,d=null;for(p in n){var h=n[p];if(n.hasOwnProperty(p)&&null!=h)switch(p){case"checked":case"value":break;case"defaultValue":c=h;default:r.hasOwnProperty(p)||Qu(e,t,p,null,r,h)}}for(var f in r){var p=r[f];if(h=n[f],r.hasOwnProperty(f)&&(null!=p||null!=h))switch(f){case"type":s=p;break;case"name":a=p;break;case"checked":u=p;break;case"defaultChecked":d=p;break;case"value":o=p;break;case"defaultValue":l=p;break;case"children":case"dangerouslySetInnerHTML":if(null!=p)throw Error(i(137,t));break;default:p!==h&&Qu(e,t,f,p,r,h)}}return void gt(e,o,l,c,u,d,s,a);case"select":for(s in p=o=l=f=null,n)if(c=n[s],n.hasOwnProperty(s)&&null!=c)switch(s){case"value":break;case"multiple":p=c;default:r.hasOwnProperty(s)||Qu(e,t,s,null,r,c)}for(a in r)if(s=r[a],c=n[a],r.hasOwnProperty(a)&&(null!=s||null!=c))switch(a){case"value":f=s;break;case"defaultValue":l=s;break;case"multiple":o=s;default:s!==c&&Qu(e,t,a,s,r,c)}return t=l,n=o,r=p,void(null!=f?vt(e,!!n,f,!1):!!r!==!!n&&(null!=t?vt(e,!!n,t,!0):vt(e,!!n,n?[]:"",!1)));case"textarea":for(l in p=f=null,n)if(a=n[l],n.hasOwnProperty(l)&&null!=a&&!r.hasOwnProperty(l))switch(l){case"value":case"children":break;default:Qu(e,t,l,null,r,a)}for(o in r)if(a=r[o],s=n[o],r.hasOwnProperty(o)&&(null!=a||null!=s))switch(o){case"value":f=a;break;case"defaultValue":p=a;break;case"children":break;case"dangerouslySetInnerHTML":if(null!=a)throw Error(i(91));break;default:a!==s&&Qu(e,t,o,a,r,s)}return void wt(e,f,p);case"option":for(var m in n)if(f=n[m],n.hasOwnProperty(m)&&null!=f&&!r.hasOwnProperty(m))if("selected"===m)e.selected=!1;else Qu(e,t,m,null,r,f);for(c in r)if(f=r[c],p=n[c],r.hasOwnProperty(c)&&f!==p&&(null!=f||null!=p))if("selected"===c)e.selected=f&&"function"!==typeof f&&"symbol"!==typeof f;else Qu(e,t,c,f,r,p);return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var g in n)f=n[g],n.hasOwnProperty(g)&&null!=f&&!r.hasOwnProperty(g)&&Qu(e,t,g,null,r,f);for(u in r)if(f=r[u],p=n[u],r.hasOwnProperty(u)&&f!==p&&(null!=f||null!=p))switch(u){case"children":case"dangerouslySetInnerHTML":if(null!=f)throw Error(i(137,t));break;default:Qu(e,t,u,f,r,p)}return;default:if(Ot(t)){for(var y in n)f=n[y],n.hasOwnProperty(y)&&void 0!==f&&!r.hasOwnProperty(y)&&Yu(e,t,y,void 0,r,f);for(d in r)f=r[d],p=n[d],!r.hasOwnProperty(d)||f===p||void 0===f&&void 0===p||Yu(e,t,d,f,r,p);return}}for(var b in n)f=n[b],n.hasOwnProperty(b)&&null!=f&&!r.hasOwnProperty(b)&&Qu(e,t,b,null,r,f);for(h in r)f=r[h],p=n[h],!r.hasOwnProperty(h)||f===p||null==f&&null==p||Qu(e,t,h,f,r,p)}(r,e.type,n,t),r[Ce]=t}catch(a){uu(e,e.return,a)}}function pl(e){return 5===e.tag||3===e.tag||26===e.tag||27===e.tag&&fd(e.type)||4===e.tag}function ml(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||pl(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(27===e.tag&&fd(e.type))continue e;if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function gl(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?(9===n.nodeType?n.body:"HTML"===n.nodeName?n.ownerDocument.body:n).insertBefore(e,t):((t=9===n.nodeType?n.body:"HTML"===n.nodeName?n.ownerDocument.body:n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=Xu));else if(4!==r&&(27===r&&fd(e.type)&&(n=e.stateNode,t=null),null!==(e=e.child)))for(gl(e,t,n),e=e.sibling;null!==e;)gl(e,t,n),e=e.sibling}function yl(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&(27===r&&fd(e.type)&&(n=e.stateNode),null!==(e=e.child)))for(yl(e,t,n),e=e.sibling;null!==e;)yl(e,t,n),e=e.sibling}function bl(e){var t=e.stateNode,n=e.memoizedProps;try{for(var r=e.type,a=t.attributes;a.length;)t.removeAttributeNode(a[0]);ed(t,r,n),t[Re]=e,t[Ce]=n}catch(s){uu(e,e.return,s)}}var vl=!1,wl=!1,_l=!1,Sl="function"===typeof WeakSet?WeakSet:Set,kl=null;function El(e,t,n){var r=n.flags;switch(n.tag){case 0:case 11:case 15:Ml(e,n),4&r&&il(5,n);break;case 1:if(Ml(e,n),4&r)if(e=n.stateNode,null===t)try{e.componentDidMount()}catch(i){uu(n,n.return,i)}else{var a=go(n.type,t.memoizedProps);t=t.memoizedState;try{e.componentDidUpdate(a,t,e.__reactInternalSnapshotBeforeUpdate)}catch(o){uu(n,n.return,o)}}64&r&&ll(n),512&r&&ul(n,n.return);break;case 3:if(Ml(e,n),64&r&&null!==(e=n.updateQueue)){if(t=null,null!==n.child)switch(n.child.tag){case 27:case 5:case 1:t=n.child.stateNode}try{hs(e,t)}catch(i){uu(n,n.return,i)}}break;case 27:null===t&&4&r&&bl(n);case 26:case 5:Ml(e,n),null===t&&4&r&&hl(n),512&r&&ul(n,n.return);break;case 12:Ml(e,n);break;case 13:Ml(e,n),4&r&&Tl(e,n),64&r&&(null!==(e=n.memoizedState)&&(null!==(e=e.dehydrated)&&function(e,t){var n=e.ownerDocument;if("$?"!==e.data||"complete"===n.readyState)t();else{var r=function(){t(),n.removeEventListener("DOMContentLoaded",r)};n.addEventListener("DOMContentLoaded",r),e._reactRetry=r}}(e,n=pu.bind(null,n))));break;case 22:if(!(r=null!==n.memoizedState||vl)){t=null!==t&&null!==t.memoizedState||wl,a=vl;var s=wl;vl=r,(wl=t)&&!s?zl(e,n,0!==(8772&n.subtreeFlags)):Ml(e,n),vl=a,wl=s}break;case 30:break;default:Ml(e,n)}}function xl(e){var t=e.alternate;null!==t&&(e.alternate=null,xl(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&Ue(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var Ol=null,Al=!1;function Il(e,t,n){for(n=n.child;null!==n;)$l(e,t,n),n=n.sibling}function $l(e,t,n){if(de&&"function"===typeof de.onCommitFiberUnmount)try{de.onCommitFiberUnmount(ue,n)}catch(s){}switch(n.tag){case 26:wl||dl(n,t),Il(e,t,n),n.memoizedState?n.memoizedState.count--:n.stateNode&&(n=n.stateNode).parentNode.removeChild(n);break;case 27:wl||dl(n,t);var r=Ol,a=Al;fd(n.type)&&(Ol=n.stateNode,Al=!1),Il(e,t,n),_d(n.stateNode),Ol=r,Al=a;break;case 5:wl||dl(n,t);case 6:if(r=Ol,a=Al,Ol=null,Il(e,t,n),Al=a,null!==(Ol=r))if(Al)try{(9===Ol.nodeType?Ol.body:"HTML"===Ol.nodeName?Ol.ownerDocument.body:Ol).removeChild(n.stateNode)}catch(i){uu(n,t,i)}else try{Ol.removeChild(n.stateNode)}catch(i){uu(n,t,i)}break;case 18:null!==Ol&&(Al?(pd(9===(e=Ol).nodeType?e.body:"HTML"===e.nodeName?e.ownerDocument.body:e,n.stateNode),Ah(e)):pd(Ol,n.stateNode));break;case 4:r=Ol,a=Al,Ol=n.stateNode.containerInfo,Al=!0,Il(e,t,n),Ol=r,Al=a;break;case 0:case 11:case 14:case 15:wl||ol(2,n,t),wl||ol(4,n,t),Il(e,t,n);break;case 1:wl||(dl(n,t),"function"===typeof(r=n.stateNode).componentWillUnmount&&cl(n,t,r)),Il(e,t,n);break;case 21:Il(e,t,n);break;case 22:wl=(r=wl)||null!==n.memoizedState,Il(e,t,n),wl=r;break;default:Il(e,t,n)}}function Tl(e,t){if(null===t.memoizedState&&(null!==(e=t.alternate)&&(null!==(e=e.memoizedState)&&null!==(e=e.dehydrated))))try{Ah(e)}catch(n){uu(t,t.return,n)}}function Pl(e,t){var n=function(e){switch(e.tag){case 13:case 19:var t=e.stateNode;return null===t&&(t=e.stateNode=new Sl),t;case 22:return null===(t=(e=e.stateNode)._retryCache)&&(t=e._retryCache=new Sl),t;default:throw Error(i(435,e.tag))}}(e);t.forEach(function(t){var r=mu.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))})}function Rl(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var a=n[r],s=e,o=t,l=o;e:for(;null!==l;){switch(l.tag){case 27:if(fd(l.type)){Ol=l.stateNode,Al=!1;break e}break;case 5:Ol=l.stateNode,Al=!1;break e;case 3:case 4:Ol=l.stateNode.containerInfo,Al=!0;break e}l=l.return}if(null===Ol)throw Error(i(160));$l(s,o,a),Ol=null,Al=!1,null!==(s=a.alternate)&&(s.return=null),a.return=null}if(13878&t.subtreeFlags)for(t=t.child;null!==t;)Nl(t,e),t=t.sibling}var Cl=null;function Nl(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:Rl(t,e),jl(e),4&r&&(ol(3,e,e.return),il(3,e),ol(5,e,e.return));break;case 1:Rl(t,e),jl(e),512&r&&(wl||null===n||dl(n,n.return)),64&r&&vl&&(null!==(e=e.updateQueue)&&(null!==(r=e.callbacks)&&(n=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=null===n?r:n.concat(r))));break;case 26:var a=Cl;if(Rl(t,e),jl(e),512&r&&(wl||null===n||dl(n,n.return)),4&r){var s=null!==n?n.memoizedState:null;if(r=e.memoizedState,null===n)if(null===r)if(null===e.stateNode){e:{r=e.type,n=e.memoizedProps,a=a.ownerDocument||a;t:switch(r){case"title":(!(s=a.getElementsByTagName("title")[0])||s[ze]||s[Re]||"http://www.w3.org/2000/svg"===s.namespaceURI||s.hasAttribute("itemprop"))&&(s=a.createElement(r),a.head.insertBefore(s,a.querySelector("head > title"))),ed(s,r,n),s[Re]=e,We(s),r=s;break e;case"link":var o=zd("link","href",a).get(r+(n.href||""));if(o)for(var l=0;l<o.length;l++)if((s=o[l]).getAttribute("href")===(null==n.href||""===n.href?null:n.href)&&s.getAttribute("rel")===(null==n.rel?null:n.rel)&&s.getAttribute("title")===(null==n.title?null:n.title)&&s.getAttribute("crossorigin")===(null==n.crossOrigin?null:n.crossOrigin)){o.splice(l,1);break t}ed(s=a.createElement(r),r,n),a.head.appendChild(s);break;case"meta":if(o=zd("meta","content",a).get(r+(n.content||"")))for(l=0;l<o.length;l++)if((s=o[l]).getAttribute("content")===(null==n.content?null:""+n.content)&&s.getAttribute("name")===(null==n.name?null:n.name)&&s.getAttribute("property")===(null==n.property?null:n.property)&&s.getAttribute("http-equiv")===(null==n.httpEquiv?null:n.httpEquiv)&&s.getAttribute("charset")===(null==n.charSet?null:n.charSet)){o.splice(l,1);break t}ed(s=a.createElement(r),r,n),a.head.appendChild(s);break;default:throw Error(i(468,r))}s[Re]=e,We(s),r=s}e.stateNode=r}else Ud(a,e.type,e.stateNode);else e.stateNode=Nd(a,r,e.memoizedProps);else s!==r?(null===s?null!==n.stateNode&&(n=n.stateNode).parentNode.removeChild(n):s.count--,null===r?Ud(a,e.type,e.stateNode):Nd(a,r,e.memoizedProps)):null===r&&null!==e.stateNode&&fl(e,e.memoizedProps,n.memoizedProps)}break;case 27:Rl(t,e),jl(e),512&r&&(wl||null===n||dl(n,n.return)),null!==n&&4&r&&fl(e,e.memoizedProps,n.memoizedProps);break;case 5:if(Rl(t,e),jl(e),512&r&&(wl||null===n||dl(n,n.return)),32&e.flags){a=e.stateNode;try{St(a,"")}catch(p){uu(e,e.return,p)}}4&r&&null!=e.stateNode&&fl(e,a=e.memoizedProps,null!==n?n.memoizedProps:a),1024&r&&(_l=!0);break;case 6:if(Rl(t,e),jl(e),4&r){if(null===e.stateNode)throw Error(i(162));r=e.memoizedProps,n=e.stateNode;try{n.nodeValue=r}catch(p){uu(e,e.return,p)}}break;case 3:if(Dd=null,a=Cl,Cl=Ed(t.containerInfo),Rl(t,e),Cl=a,jl(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{Ah(t.containerInfo)}catch(p){uu(e,e.return,p)}_l&&(_l=!1,Ll(e));break;case 4:r=Cl,Cl=Ed(e.stateNode.containerInfo),Rl(t,e),jl(e),Cl=r;break;case 12:default:Rl(t,e),jl(e);break;case 13:Rl(t,e),jl(e),8192&e.child.flags&&null!==e.memoizedState!==(null!==n&&null!==n.memoizedState)&&(_c=te()),4&r&&(null!==(r=e.updateQueue)&&(e.updateQueue=null,Pl(e,r)));break;case 22:a=null!==e.memoizedState;var c=null!==n&&null!==n.memoizedState,u=vl,d=wl;if(vl=u||a,wl=d||c,Rl(t,e),wl=d,vl=u,jl(e),8192&r)e:for(t=e.stateNode,t._visibility=a?-2&t._visibility:1|t._visibility,a&&(null===n||c||vl||wl||Dl(e)),n=null,t=e;;){if(5===t.tag||26===t.tag){if(null===n){c=n=t;try{if(s=c.stateNode,a)"function"===typeof(o=s.style).setProperty?o.setProperty("display","none","important"):o.display="none";else{l=c.stateNode;var h=c.memoizedProps.style,f=void 0!==h&&null!==h&&h.hasOwnProperty("display")?h.display:null;l.style.display=null==f||"boolean"===typeof f?"":(""+f).trim()}}catch(p){uu(c,c.return,p)}}}else if(6===t.tag){if(null===n){c=t;try{c.stateNode.nodeValue=a?"":c.memoizedProps}catch(p){uu(c,c.return,p)}}}else if((22!==t.tag&&23!==t.tag||null===t.memoizedState||t===e)&&null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;null===t.sibling;){if(null===t.return||t.return===e)break e;n===t&&(n=null),t=t.return}n===t&&(n=null),t.sibling.return=t.return,t=t.sibling}4&r&&(null!==(r=e.updateQueue)&&(null!==(n=r.retryQueue)&&(r.retryQueue=null,Pl(e,n))));break;case 19:Rl(t,e),jl(e),4&r&&(null!==(r=e.updateQueue)&&(e.updateQueue=null,Pl(e,r)));case 30:case 21:}}function jl(e){var t=e.flags;if(2&t){try{for(var n,r=e.return;null!==r;){if(pl(r)){n=r;break}r=r.return}if(null==n)throw Error(i(160));switch(n.tag){case 27:var a=n.stateNode;yl(e,ml(e),a);break;case 5:var s=n.stateNode;32&n.flags&&(St(s,""),n.flags&=-33),yl(e,ml(e),s);break;case 3:case 4:var o=n.stateNode.containerInfo;gl(e,ml(e),o);break;default:throw Error(i(161))}}catch(l){uu(e,e.return,l)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function Ll(e){if(1024&e.subtreeFlags)for(e=e.child;null!==e;){var t=e;Ll(t),5===t.tag&&1024&t.flags&&t.stateNode.reset(),e=e.sibling}}function Ml(e,t){if(8772&t.subtreeFlags)for(t=t.child;null!==t;)El(e,t.alternate,t),t=t.sibling}function Dl(e){for(e=e.child;null!==e;){var t=e;switch(t.tag){case 0:case 11:case 14:case 15:ol(4,t,t.return),Dl(t);break;case 1:dl(t,t.return);var n=t.stateNode;"function"===typeof n.componentWillUnmount&&cl(t,t.return,n),Dl(t);break;case 27:_d(t.stateNode);case 26:case 5:dl(t,t.return),Dl(t);break;case 22:null===t.memoizedState&&Dl(t);break;default:Dl(t)}e=e.sibling}}function zl(e,t,n){for(n=n&&0!==(8772&t.subtreeFlags),t=t.child;null!==t;){var r=t.alternate,a=e,s=t,i=s.flags;switch(s.tag){case 0:case 11:case 15:zl(a,s,n),il(4,s);break;case 1:if(zl(a,s,n),"function"===typeof(a=(r=s).stateNode).componentDidMount)try{a.componentDidMount()}catch(c){uu(r,r.return,c)}if(null!==(a=(r=s).updateQueue)){var o=r.stateNode;try{var l=a.shared.hiddenCallbacks;if(null!==l)for(a.shared.hiddenCallbacks=null,a=0;a<l.length;a++)ds(l[a],o)}catch(c){uu(r,r.return,c)}}n&&64&i&&ll(s),ul(s,s.return);break;case 27:bl(s);case 26:case 5:zl(a,s,n),n&&null===r&&4&i&&hl(s),ul(s,s.return);break;case 12:zl(a,s,n);break;case 13:zl(a,s,n),n&&4&i&&Tl(a,s);break;case 22:null===s.memoizedState&&zl(a,s,n),ul(s,s.return);break;case 30:break;default:zl(a,s,n)}t=t.sibling}}function Ul(e,t){var n=null;null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),e=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(e=t.memoizedState.cachePool.pool),e!==n&&(null!=e&&e.refCount++,null!=n&&Na(n))}function Fl(e,t){e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&Na(e))}function Bl(e,t,n,r){if(10256&t.subtreeFlags)for(t=t.child;null!==t;)ql(e,t,n,r),t=t.sibling}function ql(e,t,n,r){var a=t.flags;switch(t.tag){case 0:case 11:case 15:Bl(e,t,n,r),2048&a&&il(9,t);break;case 1:case 13:default:Bl(e,t,n,r);break;case 3:Bl(e,t,n,r),2048&a&&(e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&Na(e)));break;case 12:if(2048&a){Bl(e,t,n,r),e=t.stateNode;try{var s=t.memoizedProps,i=s.id,o=s.onPostCommit;"function"===typeof o&&o(i,null===t.alternate?"mount":"update",e.passiveEffectDuration,-0)}catch(l){uu(t,t.return,l)}}else Bl(e,t,n,r);break;case 23:break;case 22:s=t.stateNode,i=t.alternate,null!==t.memoizedState?2&s._visibility?Bl(e,t,n,r):Wl(e,t):2&s._visibility?Bl(e,t,n,r):(s._visibility|=2,Hl(e,t,n,r,0!==(10256&t.subtreeFlags))),2048&a&&Ul(i,t);break;case 24:Bl(e,t,n,r),2048&a&&Fl(t.alternate,t)}}function Hl(e,t,n,r,a){for(a=a&&0!==(10256&t.subtreeFlags),t=t.child;null!==t;){var s=e,i=t,o=n,l=r,c=i.flags;switch(i.tag){case 0:case 11:case 15:Hl(s,i,o,l,a),il(8,i);break;case 23:break;case 22:var u=i.stateNode;null!==i.memoizedState?2&u._visibility?Hl(s,i,o,l,a):Wl(s,i):(u._visibility|=2,Hl(s,i,o,l,a)),a&&2048&c&&Ul(i.alternate,i);break;case 24:Hl(s,i,o,l,a),a&&2048&c&&Fl(i.alternate,i);break;default:Hl(s,i,o,l,a)}t=t.sibling}}function Wl(e,t){if(10256&t.subtreeFlags)for(t=t.child;null!==t;){var n=e,r=t,a=r.flags;switch(r.tag){case 22:Wl(n,r),2048&a&&Ul(r.alternate,r);break;case 24:Wl(n,r),2048&a&&Fl(r.alternate,r);break;default:Wl(n,r)}t=t.sibling}}var Vl=8192;function Zl(e){if(e.subtreeFlags&Vl)for(e=e.child;null!==e;)Gl(e),e=e.sibling}function Gl(e){switch(e.tag){case 26:Zl(e),e.flags&Vl&&null!==e.memoizedState&&function(e,t,n){if(null===Bd)throw Error(i(475));var r=Bd;if("stylesheet"===t.type&&("string"!==typeof n.media||!1!==matchMedia(n.media).matches)&&0===(4&t.state.loading)){if(null===t.instance){var a=$d(n.href),s=e.querySelector(Td(a));if(s)return null!==(e=s._p)&&"object"===typeof e&&"function"===typeof e.then&&(r.count++,r=Hd.bind(r),e.then(r,r)),t.state.loading|=4,t.instance=s,void We(s);s=e.ownerDocument||e,n=Pd(n),(a=Sd.get(a))&&Ld(n,a),We(s=s.createElement("link"));var o=s;o._p=new Promise(function(e,t){o.onload=e,o.onerror=t}),ed(s,"link",n),t.instance=s}null===r.stylesheets&&(r.stylesheets=new Map),r.stylesheets.set(t,e),(e=t.state.preload)&&0===(3&t.state.loading)&&(r.count++,t=Hd.bind(r),e.addEventListener("load",t),e.addEventListener("error",t))}}(Cl,e.memoizedState,e.memoizedProps);break;case 5:default:Zl(e);break;case 3:case 4:var t=Cl;Cl=Ed(e.stateNode.containerInfo),Zl(e),Cl=t;break;case 22:null===e.memoizedState&&(null!==(t=e.alternate)&&null!==t.memoizedState?(t=Vl,Vl=16777216,Zl(e),Vl=t):Zl(e))}}function Jl(e){var t=e.alternate;if(null!==t&&null!==(e=t.child)){t.child=null;do{t=e.sibling,e.sibling=null,e=t}while(null!==e)}}function Kl(e){var t=e.deletions;if(0!==(16&e.flags)){if(null!==t)for(var n=0;n<t.length;n++){var r=t[n];kl=r,Yl(r,e)}Jl(e)}if(10256&e.subtreeFlags)for(e=e.child;null!==e;)Xl(e),e=e.sibling}function Xl(e){switch(e.tag){case 0:case 11:case 15:Kl(e),2048&e.flags&&ol(9,e,e.return);break;case 3:case 12:default:Kl(e);break;case 22:var t=e.stateNode;null!==e.memoizedState&&2&t._visibility&&(null===e.return||13!==e.return.tag)?(t._visibility&=-3,Ql(e)):Kl(e)}}function Ql(e){var t=e.deletions;if(0!==(16&e.flags)){if(null!==t)for(var n=0;n<t.length;n++){var r=t[n];kl=r,Yl(r,e)}Jl(e)}for(e=e.child;null!==e;){switch((t=e).tag){case 0:case 11:case 15:ol(8,t,t.return),Ql(t);break;case 22:2&(n=t.stateNode)._visibility&&(n._visibility&=-3,Ql(t));break;default:Ql(t)}e=e.sibling}}function Yl(e,t){for(;null!==kl;){var n=kl;switch(n.tag){case 0:case 11:case 15:ol(8,n,t);break;case 23:case 22:if(null!==n.memoizedState&&null!==n.memoizedState.cachePool){var r=n.memoizedState.cachePool.pool;null!=r&&r.refCount++}break;case 24:Na(n.memoizedState.cache)}if(null!==(r=n.child))r.return=n,kl=r;else e:for(n=e;null!==kl;){var a=(r=kl).sibling,s=r.return;if(xl(r),r===n){kl=null;break e}if(null!==a){a.return=s,kl=a;break e}kl=s}}}var ec={getCacheForType:function(e){var t=Oa(Ra),n=t.data.get(e);return void 0===n&&(n=e(),t.data.set(e,n)),n}},tc="function"===typeof WeakMap?WeakMap:Map,nc=0,rc=null,ac=null,sc=0,ic=0,oc=null,lc=!1,cc=!1,uc=!1,dc=0,hc=0,fc=0,pc=0,mc=0,gc=0,yc=0,bc=null,vc=null,wc=!1,_c=0,Sc=1/0,kc=null,Ec=null,xc=0,Oc=null,Ac=null,Ic=0,$c=0,Tc=null,Pc=null,Rc=0,Cc=null;function Nc(){if(0!==(2&nc)&&0!==sc)return sc&-sc;if(null!==N.T){return 0!==Ma?Ma:$u()}return Te()}function jc(){0===gc&&(gc=0===(536870912&sc)||sa?Se():536870912);var e=ro.current;return null!==e&&(e.flags|=32),gc}function Lc(e,t,n){(e!==rc||2!==ic&&9!==ic)&&null===e.cancelPendingCommit||(qc(e,0),Uc(e,sc,gc,!1)),xe(e,n),0!==(2&nc)&&e===rc||(e===rc&&(0===(2&nc)&&(pc|=n),4===hc&&Uc(e,sc,gc,!1)),Su(e))}function Mc(e,t,n){if(0!==(6&nc))throw Error(i(327));for(var r=!n&&0===(124&t)&&0===(t&e.expiredLanes)||we(e,t),a=r?function(e,t){var n=nc;nc|=2;var r=Wc(),a=Vc();rc!==e||sc!==t?(kc=null,Sc=te()+500,qc(e,t)):cc=we(e,t);e:for(;;)try{if(0!==ic&&null!==ac){t=ac;var s=oc;t:switch(ic){case 1:ic=0,oc=null,Yc(e,t,s,1);break;case 2:case 9:if(Ja(s)){ic=0,oc=null,Qc(t);break}t=function(){2!==ic&&9!==ic||rc!==e||(ic=7),Su(e)},s.then(t,t);break e;case 3:ic=7;break e;case 4:ic=5;break e;case 7:Ja(s)?(ic=0,oc=null,Qc(t)):(ic=0,oc=null,Yc(e,t,s,7));break;case 5:var o=null;switch(ac.tag){case 26:o=ac.memoizedState;case 5:case 27:var l=ac;if(!o||Fd(o)){ic=0,oc=null;var c=l.sibling;if(null!==c)ac=c;else{var u=l.return;null!==u?(ac=u,eu(u)):ac=null}break t}}ic=0,oc=null,Yc(e,t,s,5);break;case 6:ic=0,oc=null,Yc(e,t,s,6);break;case 8:Bc(),hc=6;break e;default:throw Error(i(462))}}Kc();break}catch(d){Hc(e,d)}return ba=ya=null,N.H=r,N.A=a,nc=n,null!==ac?0:(rc=null,sc=0,Ir(),hc)}(e,t):Gc(e,t,!0),s=r;;){if(0===a){cc&&!r&&Uc(e,t,0,!1);break}if(n=e.current.alternate,!s||zc(n)){if(2===a){if(s=t,e.errorRecoveryDisabledLanes&s)var o=0;else o=0!==(o=-536870913&e.pendingLanes)?o:536870912&o?536870912:0;if(0!==o){t=o;e:{var l=e;a=bc;var c=l.current.memoizedState.isDehydrated;if(c&&(qc(l,o).flags|=256),2!==(o=Gc(l,o,!1))){if(uc&&!c){l.errorRecoveryDisabledLanes|=s,pc|=s,a=4;break e}s=vc,vc=a,null!==s&&(null===vc?vc=s:vc.push.apply(vc,s))}a=o}if(s=!1,2!==a)continue}}if(1===a){qc(e,0),Uc(e,t,0,!0);break}e:{switch(r=e,s=a){case 0:case 1:throw Error(i(345));case 4:if((4194048&t)!==t)break;case 6:Uc(r,t,gc,!lc);break e;case 2:vc=null;break;case 3:case 5:break;default:throw Error(i(329))}if((62914560&t)===t&&10<(a=_c+300-te())){if(Uc(r,t,gc,!lc),0!==ve(r,0,!0))break e;r.timeoutHandle=ld(Dc.bind(null,r,n,vc,kc,wc,t,gc,pc,yc,lc,s,2,-0,0),a)}else Dc(r,n,vc,kc,wc,t,gc,pc,yc,lc,s,0,-0,0)}break}a=Gc(e,t,!1),s=!1}Su(e)}function Dc(e,t,n,r,a,s,o,l,c,u,d,h,f,p){if(e.timeoutHandle=-1,(8192&(h=t.subtreeFlags)||16785408===(16785408&h))&&(Bd={stylesheets:null,count:0,unsuspend:qd},Gl(t),null!==(h=function(){if(null===Bd)throw Error(i(475));var e=Bd;return e.stylesheets&&0===e.count&&Vd(e,e.stylesheets),0<e.count?function(t){var n=setTimeout(function(){if(e.stylesheets&&Vd(e,e.stylesheets),e.unsuspend){var t=e.unsuspend;e.unsuspend=null,t()}},6e4);return e.unsuspend=t,function(){e.unsuspend=null,clearTimeout(n)}}:null}())))return e.cancelPendingCommit=h(nu.bind(null,e,t,s,n,r,a,o,l,c,d,1,f,p)),void Uc(e,s,o,!u);nu(e,t,s,n,r,a,o,l,c)}function zc(e){for(var t=e;;){var n=t.tag;if((0===n||11===n||15===n)&&16384&t.flags&&(null!==(n=t.updateQueue)&&null!==(n=n.stores)))for(var r=0;r<n.length;r++){var a=n[r],s=a.getSnapshot;a=a.value;try{if(!Jn(s(),a))return!1}catch(i){return!1}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Uc(e,t,n,r){t&=~mc,t&=~pc,e.suspendedLanes|=t,e.pingedLanes&=~t,r&&(e.warmLanes|=t),r=e.expirationTimes;for(var a=t;0<a;){var s=31-fe(a),i=1<<s;r[s]=-1,a&=~i}0!==n&&Oe(e,n,t)}function Fc(){return 0!==(6&nc)||(ku(0,!1),!1)}function Bc(){if(null!==ac){if(0===ic)var e=ac.return;else ba=ya=null,Ms(e=ac),Gi=null,Ji=0,e=ac;for(;null!==e;)sl(e.alternate,e),e=e.return;ac=null}}function qc(e,t){var n=e.timeoutHandle;-1!==n&&(e.timeoutHandle=-1,cd(n)),null!==(n=e.cancelPendingCommit)&&(e.cancelPendingCommit=null,n()),Bc(),rc=e,ac=n=Dr(e.current,null),sc=t,ic=0,oc=null,lc=!1,cc=we(e,t),uc=!1,yc=gc=mc=pc=fc=hc=0,vc=bc=null,wc=!1,0!==(8&t)&&(t|=32&t);var r=e.entangledLanes;if(0!==r)for(e=e.entanglements,r&=t;0<r;){var a=31-fe(r),s=1<<a;t|=e[a],r&=~s}return dc=t,Ir(),n}function Hc(e,t){vs=null,N.H=Hi,t===Wa||t===Za?(t=Ya(),ic=3):t===Va?(t=Ya(),ic=4):ic=t===Oo?8:null!==t&&"object"===typeof t&&"function"===typeof t.then?6:1,oc=t,null===ac&&(hc=1,_o(e,Er(t,e.current)))}function Wc(){var e=N.H;return N.H=Hi,null===e?Hi:e}function Vc(){var e=N.A;return N.A=ec,e}function Zc(){hc=4,lc||(4194048&sc)!==sc&&null!==ro.current||(cc=!0),0===(134217727&fc)&&0===(134217727&pc)||null===rc||Uc(rc,sc,gc,!1)}function Gc(e,t,n){var r=nc;nc|=2;var a=Wc(),s=Vc();rc===e&&sc===t||(kc=null,qc(e,t)),t=!1;var i=hc;e:for(;;)try{if(0!==ic&&null!==ac){var o=ac,l=oc;switch(ic){case 8:Bc(),i=6;break e;case 3:case 2:case 9:case 6:null===ro.current&&(t=!0);var c=ic;if(ic=0,oc=null,Yc(e,o,l,c),n&&cc){i=0;break e}break;default:c=ic,ic=0,oc=null,Yc(e,o,l,c)}}Jc(),i=hc;break}catch(u){Hc(e,u)}return t&&e.shellSuspendCounter++,ba=ya=null,nc=r,N.H=a,N.A=s,null===ac&&(rc=null,sc=0,Ir()),i}function Jc(){for(;null!==ac;)Xc(ac)}function Kc(){for(;null!==ac&&!Y();)Xc(ac)}function Xc(e){var t=Xo(e.alternate,e,dc);e.memoizedProps=e.pendingProps,null===t?eu(e):ac=t}function Qc(e){var t=e,n=t.alternate;switch(t.tag){case 15:case 0:t=Lo(n,t,t.pendingProps,t.type,void 0,sc);break;case 11:t=Lo(n,t,t.pendingProps,t.type.render,t.ref,sc);break;case 5:Ms(t);default:sl(n,t),t=Xo(n,t=ac=zr(t,dc),dc)}e.memoizedProps=e.pendingProps,null===t?eu(e):ac=t}function Yc(e,t,n,r){ba=ya=null,Ms(t),Gi=null,Ji=0;var a=t.return;try{if(function(e,t,n,r,a){if(n.flags|=32768,null!==r&&"object"===typeof r&&"function"===typeof r.then){if(null!==(t=n.alternate)&&ka(t,n,a,!0),null!==(n=ro.current)){switch(n.tag){case 13:return null===ao?Zc():null===n.alternate&&0===hc&&(hc=3),n.flags&=-257,n.flags|=65536,n.lanes=a,r===Ga?n.flags|=16384:(null===(t=n.updateQueue)?n.updateQueue=new Set([r]):t.add(r),du(e,r,a)),!1;case 22:return n.flags|=65536,r===Ga?n.flags|=16384:(null===(t=n.updateQueue)?(t={transitions:null,markerInstances:null,retryQueue:new Set([r])},n.updateQueue=t):null===(n=t.retryQueue)?t.retryQueue=new Set([r]):n.add(r),du(e,r,a)),!1}throw Error(i(435,n.tag))}return du(e,r,a),Zc(),!1}if(sa)return null!==(t=ro.current)?(0===(65536&t.flags)&&(t.flags|=256),t.flags|=65536,t.lanes=a,r!==la&&ma(Er(e=Error(i(422),{cause:r}),n))):(r!==la&&ma(Er(t=Error(i(423),{cause:r}),n)),(e=e.current.alternate).flags|=65536,a&=-a,e.lanes|=a,r=Er(r,n),os(e,a=ko(e.stateNode,r,a)),4!==hc&&(hc=2)),!1;var s=Error(i(520),{cause:r});if(s=Er(s,n),null===bc?bc=[s]:bc.push(s),4!==hc&&(hc=2),null===t)return!0;r=Er(r,n),n=t;do{switch(n.tag){case 3:return n.flags|=65536,e=a&-a,n.lanes|=e,os(n,e=ko(n.stateNode,r,e)),!1;case 1:if(t=n.type,s=n.stateNode,0===(128&n.flags)&&("function"===typeof t.getDerivedStateFromError||null!==s&&"function"===typeof s.componentDidCatch&&(null===Ec||!Ec.has(s))))return n.flags|=65536,a&=-a,n.lanes|=a,xo(a=Eo(a),e,n,r),os(n,a),!1}n=n.return}while(null!==n);return!1}(e,a,t,n,sc))return hc=1,_o(e,Er(n,e.current)),void(ac=null)}catch(s){if(null!==a)throw ac=a,s;return hc=1,_o(e,Er(n,e.current)),void(ac=null)}32768&t.flags?(sa||1===r?e=!0:cc||0!==(536870912&sc)?e=!1:(lc=e=!0,(2===r||9===r||3===r||6===r)&&(null!==(r=ro.current)&&13===r.tag&&(r.flags|=16384))),tu(t,e)):eu(t)}function eu(e){var t=e;do{if(0!==(32768&t.flags))return void tu(t,lc);e=t.return;var n=rl(t.alternate,t,dc);if(null!==n)return void(ac=n);if(null!==(t=t.sibling))return void(ac=t);ac=t=e}while(null!==t);0===hc&&(hc=5)}function tu(e,t){do{var n=al(e.alternate,e);if(null!==n)return n.flags&=32767,void(ac=n);if(null!==(n=e.return)&&(n.flags|=32768,n.subtreeFlags=0,n.deletions=null),!t&&null!==(e=e.sibling))return void(ac=e);ac=e=n}while(null!==e);hc=6,ac=null}function nu(e,t,n,r,a,s,o,l,c){e.cancelPendingCommit=null;do{ou()}while(0!==xc);if(0!==(6&nc))throw Error(i(327));if(null!==t){if(t===e.current)throw Error(i(177));if(s=t.lanes|t.childLanes,function(e,t,n,r,a,s){var i=e.pendingLanes;e.pendingLanes=n,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=n,e.entangledLanes&=n,e.errorRecoveryDisabledLanes&=n,e.shellSuspendCounter=0;var o=e.entanglements,l=e.expirationTimes,c=e.hiddenUpdates;for(n=i&~n;0<n;){var u=31-fe(n),d=1<<u;o[u]=0,l[u]=-1;var h=c[u];if(null!==h)for(c[u]=null,u=0;u<h.length;u++){var f=h[u];null!==f&&(f.lane&=-536870913)}n&=~d}0!==r&&Oe(e,r,0),0!==s&&0===a&&0!==e.tag&&(e.suspendedLanes|=s&~(i&~t))}(e,n,s|=Ar,o,l,c),e===rc&&(ac=rc=null,sc=0),Ac=t,Oc=e,Ic=n,$c=s,Tc=a,Pc=r,0!==(10256&t.subtreeFlags)||0!==(10256&t.flags)?(e.callbackNode=null,e.callbackPriority=0,X(se,function(){return lu(),null})):(e.callbackNode=null,e.callbackPriority=0),r=0!==(13878&t.flags),0!==(13878&t.subtreeFlags)||r){r=N.T,N.T=null,a=j.p,j.p=2,o=nc,nc|=4;try{!function(e,t){if(e=e.containerInfo,td=nh,tr(e=er(e))){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var a=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{n.nodeType,s.nodeType}catch(g){n=null;break e}var o=0,l=-1,c=-1,u=0,d=0,h=e,f=null;t:for(;;){for(var p;h!==n||0!==a&&3!==h.nodeType||(l=o+a),h!==s||0!==r&&3!==h.nodeType||(c=o+r),3===h.nodeType&&(o+=h.nodeValue.length),null!==(p=h.firstChild);)f=h,h=p;for(;;){if(h===e)break t;if(f===n&&++u===a&&(l=o),f===s&&++d===r&&(c=o),null!==(p=h.nextSibling))break;f=(h=f).parentNode}h=p}n=-1===l||-1===c?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(nd={focusedElem:e,selectionRange:n},nh=!1,kl=t;null!==kl;)if(e=(t=kl).child,0!==(1024&t.subtreeFlags)&&null!==e)e.return=t,kl=e;else for(;null!==kl;){switch(s=(t=kl).alternate,e=t.flags,t.tag){case 0:case 11:case 15:case 5:case 26:case 27:case 6:case 4:case 17:break;case 1:if(0!==(1024&e)&&null!==s){e=void 0,n=t,a=s.memoizedProps,s=s.memoizedState,r=n.stateNode;try{var m=go(n.type,a,(n.elementType,n.type));e=r.getSnapshotBeforeUpdate(m,s),r.__reactInternalSnapshotBeforeUpdate=e}catch(y){uu(n,n.return,y)}}break;case 3:if(0!==(1024&e))if(9===(n=(e=t.stateNode.containerInfo).nodeType))md(e);else if(1===n)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":md(e);break;default:e.textContent=""}break;default:if(0!==(1024&e))throw Error(i(163))}if(null!==(e=t.sibling)){e.return=t.return,kl=e;break}kl=t.return}}(e,t)}finally{nc=o,j.p=a,N.T=r}}xc=1,ru(),au(),su()}}function ru(){if(1===xc){xc=0;var e=Oc,t=Ac,n=0!==(13878&t.flags);if(0!==(13878&t.subtreeFlags)||n){n=N.T,N.T=null;var r=j.p;j.p=2;var a=nc;nc|=4;try{Nl(t,e);var s=nd,i=er(e.containerInfo),o=s.focusedElem,l=s.selectionRange;if(i!==o&&o&&o.ownerDocument&&Yn(o.ownerDocument.documentElement,o)){if(null!==l&&tr(o)){var c=l.start,u=l.end;if(void 0===u&&(u=c),"selectionStart"in o)o.selectionStart=c,o.selectionEnd=Math.min(u,o.value.length);else{var d=o.ownerDocument||document,h=d&&d.defaultView||window;if(h.getSelection){var f=h.getSelection(),p=o.textContent.length,m=Math.min(l.start,p),g=void 0===l.end?m:Math.min(l.end,p);!f.extend&&m>g&&(i=g,g=m,m=i);var y=Qn(o,m),b=Qn(o,g);if(y&&b&&(1!==f.rangeCount||f.anchorNode!==y.node||f.anchorOffset!==y.offset||f.focusNode!==b.node||f.focusOffset!==b.offset)){var v=d.createRange();v.setStart(y.node,y.offset),f.removeAllRanges(),m>g?(f.addRange(v),f.extend(b.node,b.offset)):(v.setEnd(b.node,b.offset),f.addRange(v))}}}}for(d=[],f=o;f=f.parentNode;)1===f.nodeType&&d.push({element:f,left:f.scrollLeft,top:f.scrollTop});for("function"===typeof o.focus&&o.focus(),o=0;o<d.length;o++){var w=d[o];w.element.scrollLeft=w.left,w.element.scrollTop=w.top}}nh=!!td,nd=td=null}finally{nc=a,j.p=r,N.T=n}}e.current=t,xc=2}}function au(){if(2===xc){xc=0;var e=Oc,t=Ac,n=0!==(8772&t.flags);if(0!==(8772&t.subtreeFlags)||n){n=N.T,N.T=null;var r=j.p;j.p=2;var a=nc;nc|=4;try{El(e,t.alternate,t)}finally{nc=a,j.p=r,N.T=n}}xc=3}}function su(){if(4===xc||3===xc){xc=0,ee();var e=Oc,t=Ac,n=Ic,r=Pc;0!==(10256&t.subtreeFlags)||0!==(10256&t.flags)?xc=5:(xc=0,Ac=Oc=null,iu(e,e.pendingLanes));var a=e.pendingLanes;if(0===a&&(Ec=null),$e(n),t=t.stateNode,de&&"function"===typeof de.onCommitFiberRoot)try{de.onCommitFiberRoot(ue,t,void 0,128===(128&t.current.flags))}catch(l){}if(null!==r){t=N.T,a=j.p,j.p=2,N.T=null;try{for(var s=e.onRecoverableError,i=0;i<r.length;i++){var o=r[i];s(o.value,{componentStack:o.stack})}}finally{N.T=t,j.p=a}}0!==(3&Ic)&&ou(),Su(e),a=e.pendingLanes,0!==(4194090&n)&&0!==(42&a)?e===Cc?Rc++:(Rc=0,Cc=e):Rc=0,ku(0,!1)}}function iu(e,t){0===(e.pooledCacheLanes&=t)&&(null!=(t=e.pooledCache)&&(e.pooledCache=null,Na(t)))}function ou(e){return ru(),au(),su(),lu()}function lu(){if(5!==xc)return!1;var e=Oc,t=$c;$c=0;var n=$e(Ic),r=N.T,a=j.p;try{j.p=32>n?32:n,N.T=null,n=Tc,Tc=null;var s=Oc,o=Ic;if(xc=0,Ac=Oc=null,Ic=0,0!==(6&nc))throw Error(i(331));var l=nc;if(nc|=4,Xl(s.current),ql(s,s.current,o,n),nc=l,ku(0,!1),de&&"function"===typeof de.onPostCommitFiberRoot)try{de.onPostCommitFiberRoot(ue,s)}catch(c){}return!0}finally{j.p=a,N.T=r,iu(e,t)}}function cu(e,t,n){t=Er(n,t),null!==(e=ss(e,t=ko(e.stateNode,t,2),2))&&(xe(e,2),Su(e))}function uu(e,t,n){if(3===e.tag)cu(e,e,n);else for(;null!==t;){if(3===t.tag){cu(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===Ec||!Ec.has(r))){e=Er(n,e),null!==(r=ss(t,n=Eo(2),2))&&(xo(n,r,t,e),xe(r,2),Su(r));break}}t=t.return}}function du(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new tc;var a=new Set;r.set(t,a)}else void 0===(a=r.get(t))&&(a=new Set,r.set(t,a));a.has(n)||(uc=!0,a.add(n),e=hu.bind(null,e,t,n),t.then(e,e))}function hu(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),e.pingedLanes|=e.suspendedLanes&n,e.warmLanes&=~n,rc===e&&(sc&n)===n&&(4===hc||3===hc&&(62914560&sc)===sc&&300>te()-_c?0===(2&nc)&&qc(e,0):mc|=n,yc===sc&&(yc=0)),Su(e)}function fu(e,t){0===t&&(t=ke()),null!==(e=Pr(e,t))&&(xe(e,t),Su(e))}function pu(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),fu(e,n)}function mu(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,a=e.memoizedState;null!==a&&(n=a.retryLane);break;case 19:r=e.stateNode;break;case 22:r=e.stateNode._retryCache;break;default:throw Error(i(314))}null!==r&&r.delete(t),fu(e,n)}var gu=null,yu=null,bu=!1,vu=!1,wu=!1,_u=0;function Su(e){e!==yu&&null===e.next&&(null===yu?gu=yu=e:yu=yu.next=e),vu=!0,bu||(bu=!0,dd(function(){0!==(6&nc)?X(re,Eu):xu()}))}function ku(e,t){if(!wu&&vu){wu=!0;do{for(var n=!1,r=gu;null!==r;){if(!t)if(0!==e){var a=r.pendingLanes;if(0===a)var s=0;else{var i=r.suspendedLanes,o=r.pingedLanes;s=(1<<31-fe(42|e)+1)-1,s=201326741&(s&=a&~(i&~o))?201326741&s|1:s?2|s:0}0!==s&&(n=!0,Iu(r,s))}else s=sc,0===(3&(s=ve(r,r===rc?s:0,null!==r.cancelPendingCommit||-1!==r.timeoutHandle)))||we(r,s)||(n=!0,Iu(r,s));r=r.next}}while(n);wu=!1}}function Eu(){xu()}function xu(){vu=bu=!1;var e=0;0!==_u&&(function(){var e=window.event;if(e&&"popstate"===e.type)return e!==od&&(od=e,!0);return od=null,!1}()&&(e=_u),_u=0);for(var t=te(),n=null,r=gu;null!==r;){var a=r.next,s=Ou(r,t);0===s?(r.next=null,null===n?gu=a:n.next=a,null===a&&(yu=n)):(n=r,(0!==e||0!==(3&s))&&(vu=!0)),r=a}ku(e,!1)}function Ou(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,a=e.expirationTimes,s=-62914561&e.pendingLanes;0<s;){var i=31-fe(s),o=1<<i,l=a[i];-1===l?0!==(o&n)&&0===(o&r)||(a[i]=_e(o,t)):l<=t&&(e.expiredLanes|=o),s&=~o}if(n=sc,n=ve(e,e===(t=rc)?n:0,null!==e.cancelPendingCommit||-1!==e.timeoutHandle),r=e.callbackNode,0===n||e===t&&(2===ic||9===ic)||null!==e.cancelPendingCommit)return null!==r&&null!==r&&Q(r),e.callbackNode=null,e.callbackPriority=0;if(0===(3&n)||we(e,n)){if((t=n&-n)===e.callbackPriority)return t;switch(null!==r&&Q(r),$e(n)){case 2:case 8:n=ae;break;case 32:default:n=se;break;case 268435456:n=oe}return r=Au.bind(null,e),n=X(n,r),e.callbackPriority=t,e.callbackNode=n,t}return null!==r&&null!==r&&Q(r),e.callbackPriority=2,e.callbackNode=null,2}function Au(e,t){if(0!==xc&&5!==xc)return e.callbackNode=null,e.callbackPriority=0,null;var n=e.callbackNode;if(ou()&&e.callbackNode!==n)return null;var r=sc;return 0===(r=ve(e,e===rc?r:0,null!==e.cancelPendingCommit||-1!==e.timeoutHandle))?null:(Mc(e,r,t),Ou(e,te()),null!=e.callbackNode&&e.callbackNode===n?Au.bind(null,e):null)}function Iu(e,t){if(ou())return null;Mc(e,t,!0)}function $u(){return 0===_u&&(_u=Se()),_u}function Tu(e){return null==e||"symbol"===typeof e||"boolean"===typeof e?null:"function"===typeof e?e:$t(""+e)}function Pu(e,t){var n=t.ownerDocument.createElement("input");return n.name=t.name,n.value=t.value,e.id&&n.setAttribute("form",e.id),t.parentNode.insertBefore(n,t),e=new FormData(e),n.parentNode.removeChild(n),e}for(var Ru=0;Ru<_r.length;Ru++){var Cu=_r[Ru];Sr(Cu.toLowerCase(),"on"+(Cu[0].toUpperCase()+Cu.slice(1)))}Sr(fr,"onAnimationEnd"),Sr(pr,"onAnimationIteration"),Sr(mr,"onAnimationStart"),Sr("dblclick","onDoubleClick"),Sr("focusin","onFocus"),Sr("focusout","onBlur"),Sr(gr,"onTransitionRun"),Sr(yr,"onTransitionStart"),Sr(br,"onTransitionCancel"),Sr(vr,"onTransitionEnd"),Je("onMouseEnter",["mouseout","mouseover"]),Je("onMouseLeave",["mouseout","mouseover"]),Je("onPointerEnter",["pointerout","pointerover"]),Je("onPointerLeave",["pointerout","pointerover"]),Ge("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Ge("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Ge("onBeforeInput",["compositionend","keypress","textInput","paste"]),Ge("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Ge("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Ge("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Nu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),ju=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Nu));function Lu(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var r=e[n],a=r.event;r=r.listeners;e:{var s=void 0;if(t)for(var i=r.length-1;0<=i;i--){var o=r[i],l=o.instance,c=o.currentTarget;if(o=o.listener,l!==s&&a.isPropagationStopped())break e;s=o,a.currentTarget=c;try{s(a)}catch(u){yo(u)}a.currentTarget=null,s=l}else for(i=0;i<r.length;i++){if(l=(o=r[i]).instance,c=o.currentTarget,o=o.listener,l!==s&&a.isPropagationStopped())break e;s=o,a.currentTarget=c;try{s(a)}catch(u){yo(u)}a.currentTarget=null,s=l}}}}function Mu(e,t){var n=t[je];void 0===n&&(n=t[je]=new Set);var r=e+"__bubble";n.has(r)||(Fu(t,e,2,!1),n.add(r))}function Du(e,t,n){var r=0;t&&(r|=4),Fu(n,e,r,t)}var zu="_reactListening"+Math.random().toString(36).slice(2);function Uu(e){if(!e[zu]){e[zu]=!0,Ve.forEach(function(t){"selectionchange"!==t&&(ju.has(t)||Du(t,!1,e),Du(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[zu]||(t[zu]=!0,Du("selectionchange",!1,t))}}function Fu(e,t,n,r){switch(ch(t)){case 2:var a=rh;break;case 8:a=ah;break;default:a=sh}n=a.bind(null,t,n,e),a=void 0,!zt||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(a=!0),r?void 0!==a?e.addEventListener(t,n,{capture:!0,passive:a}):e.addEventListener(t,n,!0):void 0!==a?e.addEventListener(t,n,{passive:a}):e.addEventListener(t,n,!1)}function Bu(e,t,n,r,a){var s=r;if(0===(1&t)&&0===(2&t)&&null!==r)e:for(;;){if(null===r)return;var i=r.tag;if(3===i||4===i){var o=r.stateNode.containerInfo;if(o===a)break;if(4===i)for(i=r.return;null!==i;){var c=i.tag;if((3===c||4===c)&&i.stateNode.containerInfo===a)return;i=i.return}for(;null!==o;){if(null===(i=Fe(o)))return;if(5===(c=i.tag)||6===c||26===c||27===c){r=s=i;continue e}o=o.parentNode}}r=r.return}Lt(function(){var r=s,a=Pt(n),i=[];e:{var o=wr.get(e);if(void 0!==o){var c=Yt,u=e;switch(e){case"keypress":if(0===Wt(n))break e;case"keydown":case"keyup":c=mn;break;case"focusin":u="focus",c=sn;break;case"focusout":u="blur",c=sn;break;case"beforeblur":case"afterblur":c=sn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":c=rn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":c=an;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":c=yn;break;case fr:case pr:case mr:c=on;break;case vr:c=bn;break;case"scroll":case"scrollend":c=tn;break;case"wheel":c=vn;break;case"copy":case"cut":case"paste":c=ln;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":c=gn;break;case"toggle":case"beforetoggle":c=wn}var d=0!==(4&t),h=!d&&("scroll"===e||"scrollend"===e),f=d?null!==o?o+"Capture":null:o;d=[];for(var p,m=r;null!==m;){var g=m;if(p=g.stateNode,5!==(g=g.tag)&&26!==g&&27!==g||null===p||null===f||null!=(g=Mt(m,f))&&d.push(qu(m,g,p)),h)break;m=m.return}0<d.length&&(o=new c(o,u,null,n,a),i.push({event:o,listeners:d}))}}if(0===(7&t)){if(c="mouseout"===e||"pointerout"===e,(!(o="mouseover"===e||"pointerover"===e)||n===Tt||!(u=n.relatedTarget||n.fromElement)||!Fe(u)&&!u[Ne])&&(c||o)&&(o=a.window===a?a:(o=a.ownerDocument)?o.defaultView||o.parentWindow:window,c?(c=r,null!==(u=(u=n.relatedTarget||n.toElement)?Fe(u):null)&&(h=l(u),d=u.tag,u!==h||5!==d&&27!==d&&6!==d)&&(u=null)):(c=null,u=r),c!==u)){if(d=rn,g="onMouseLeave",f="onMouseEnter",m="mouse","pointerout"!==e&&"pointerover"!==e||(d=gn,g="onPointerLeave",f="onPointerEnter",m="pointer"),h=null==c?o:qe(c),p=null==u?o:qe(u),(o=new d(g,m+"leave",c,n,a)).target=h,o.relatedTarget=p,g=null,Fe(a)===r&&((d=new d(f,m+"enter",u,n,a)).target=p,d.relatedTarget=h,g=d),h=g,c&&u)e:{for(f=u,m=0,p=d=c;p;p=Wu(p))m++;for(p=0,g=f;g;g=Wu(g))p++;for(;0<m-p;)d=Wu(d),m--;for(;0<p-m;)f=Wu(f),p--;for(;m--;){if(d===f||null!==f&&d===f.alternate)break e;d=Wu(d),f=Wu(f)}d=null}else d=null;null!==c&&Vu(i,o,c,d,!1),null!==u&&null!==h&&Vu(i,h,u,d,!0)}if("select"===(c=(o=r?qe(r):window).nodeName&&o.nodeName.toLowerCase())||"input"===c&&"file"===o.type)var y=Dn;else if(Rn(o))if(zn)y=Gn;else{y=Vn;var b=Wn}else!(c=o.nodeName)||"input"!==c.toLowerCase()||"checkbox"!==o.type&&"radio"!==o.type?r&&Ot(r.elementType)&&(y=Dn):y=Zn;switch(y&&(y=y(e,r))?Cn(i,y,n,a):(b&&b(e,o,r),"focusout"===e&&r&&"number"===o.type&&null!=r.memoizedProps.value&&bt(o,"number",o.value)),b=r?qe(r):window,e){case"focusin":(Rn(b)||"true"===b.contentEditable)&&(rr=b,ar=r,sr=null);break;case"focusout":sr=ar=rr=null;break;case"mousedown":ir=!0;break;case"contextmenu":case"mouseup":case"dragend":ir=!1,or(i,n,a);break;case"selectionchange":if(nr)break;case"keydown":case"keyup":or(i,n,a)}var v;if(Sn)e:{switch(e){case"compositionstart":var w="onCompositionStart";break e;case"compositionend":w="onCompositionEnd";break e;case"compositionupdate":w="onCompositionUpdate";break e}w=void 0}else Tn?In(e,n)&&(w="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(w="onCompositionStart");w&&(xn&&"ko"!==n.locale&&(Tn||"onCompositionStart"!==w?"onCompositionEnd"===w&&Tn&&(v=Ht()):(Bt="value"in(Ft=a)?Ft.value:Ft.textContent,Tn=!0)),0<(b=Hu(r,w)).length&&(w=new cn(w,e,null,n,a),i.push({event:w,listeners:b}),v?w.data=v:null!==(v=$n(n))&&(w.data=v))),(v=En?function(e,t){switch(e){case"compositionend":return $n(t);case"keypress":return 32!==t.which?null:(An=!0,On);case"textInput":return(e=t.data)===On&&An?null:e;default:return null}}(e,n):function(e,t){if(Tn)return"compositionend"===e||!Sn&&In(e,t)?(e=Ht(),qt=Bt=Ft=null,Tn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return xn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(w=Hu(r,"onBeforeInput")).length&&(b=new cn("onBeforeInput","beforeinput",null,n,a),i.push({event:b,listeners:w}),b.data=v)),function(e,t,n,r,a){if("submit"===t&&n&&n.stateNode===a){var s=Tu((a[Ce]||null).action),i=r.submitter;i&&null!==(t=(t=i[Ce]||null)?Tu(t.formAction):i.getAttribute("formAction"))&&(s=t,i=null);var o=new Yt("action","action",null,r,a);e.push({event:o,listeners:[{instance:null,listener:function(){if(r.defaultPrevented){if(0!==_u){var e=i?Pu(a,i):new FormData(a);Ti(n,{pending:!0,data:e,method:a.method,action:s},null,e)}}else"function"===typeof s&&(o.preventDefault(),e=i?Pu(a,i):new FormData(a),Ti(n,{pending:!0,data:e,method:a.method,action:s},s,e))},currentTarget:a}]})}}(i,e,r,n,a)}Lu(i,t)})}function qu(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Hu(e,t){for(var n=t+"Capture",r=[];null!==e;){var a=e,s=a.stateNode;if(5!==(a=a.tag)&&26!==a&&27!==a||null===s||(null!=(a=Mt(e,n))&&r.unshift(qu(e,a,s)),null!=(a=Mt(e,t))&&r.push(qu(e,a,s))),3===e.tag)return r;e=e.return}return[]}function Wu(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag&&27!==e.tag);return e||null}function Vu(e,t,n,r,a){for(var s=t._reactName,i=[];null!==n&&n!==r;){var o=n,l=o.alternate,c=o.stateNode;if(o=o.tag,null!==l&&l===r)break;5!==o&&26!==o&&27!==o||null===c||(l=c,a?null!=(c=Mt(n,s))&&i.unshift(qu(n,c,l)):a||null!=(c=Mt(n,s))&&i.push(qu(n,c,l))),n=n.return}0!==i.length&&e.push({event:t,listeners:i})}var Zu=/\r\n?/g,Gu=/\u0000|\uFFFD/g;function Ju(e){return("string"===typeof e?e:""+e).replace(Zu,"\n").replace(Gu,"")}function Ku(e,t){return t=Ju(t),Ju(e)===t}function Xu(){}function Qu(e,t,n,r,a,s){switch(n){case"children":"string"===typeof r?"body"===t||"textarea"===t&&""===r||St(e,r):("number"===typeof r||"bigint"===typeof r)&&"body"!==t&&St(e,""+r);break;case"className":nt(e,"class",r);break;case"tabIndex":nt(e,"tabindex",r);break;case"dir":case"role":case"viewBox":case"width":case"height":nt(e,n,r);break;case"style":xt(e,r,s);break;case"data":if("object"!==t){nt(e,"data",r);break}case"src":case"href":if(""===r&&("a"!==t||"href"!==n)){e.removeAttribute(n);break}if(null==r||"function"===typeof r||"symbol"===typeof r||"boolean"===typeof r){e.removeAttribute(n);break}r=$t(""+r),e.setAttribute(n,r);break;case"action":case"formAction":if("function"===typeof r){e.setAttribute(n,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}if("function"===typeof s&&("formAction"===n?("input"!==t&&Qu(e,t,"name",a.name,a,null),Qu(e,t,"formEncType",a.formEncType,a,null),Qu(e,t,"formMethod",a.formMethod,a,null),Qu(e,t,"formTarget",a.formTarget,a,null)):(Qu(e,t,"encType",a.encType,a,null),Qu(e,t,"method",a.method,a,null),Qu(e,t,"target",a.target,a,null))),null==r||"symbol"===typeof r||"boolean"===typeof r){e.removeAttribute(n);break}r=$t(""+r),e.setAttribute(n,r);break;case"onClick":null!=r&&(e.onclick=Xu);break;case"onScroll":null!=r&&Mu("scroll",e);break;case"onScrollEnd":null!=r&&Mu("scrollend",e);break;case"dangerouslySetInnerHTML":if(null!=r){if("object"!==typeof r||!("__html"in r))throw Error(i(61));if(null!=(n=r.__html)){if(null!=a.children)throw Error(i(60));e.innerHTML=n}}break;case"multiple":e.multiple=r&&"function"!==typeof r&&"symbol"!==typeof r;break;case"muted":e.muted=r&&"function"!==typeof r&&"symbol"!==typeof r;break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":case"autoFocus":break;case"xlinkHref":if(null==r||"function"===typeof r||"boolean"===typeof r||"symbol"===typeof r){e.removeAttribute("xlink:href");break}n=$t(""+r),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":null!=r&&"function"!==typeof r&&"symbol"!==typeof r?e.setAttribute(n,""+r):e.removeAttribute(n);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":r&&"function"!==typeof r&&"symbol"!==typeof r?e.setAttribute(n,""):e.removeAttribute(n);break;case"capture":case"download":!0===r?e.setAttribute(n,""):!1!==r&&null!=r&&"function"!==typeof r&&"symbol"!==typeof r?e.setAttribute(n,r):e.removeAttribute(n);break;case"cols":case"rows":case"size":case"span":null!=r&&"function"!==typeof r&&"symbol"!==typeof r&&!isNaN(r)&&1<=r?e.setAttribute(n,r):e.removeAttribute(n);break;case"rowSpan":case"start":null==r||"function"===typeof r||"symbol"===typeof r||isNaN(r)?e.removeAttribute(n):e.setAttribute(n,r);break;case"popover":Mu("beforetoggle",e),Mu("toggle",e),tt(e,"popover",r);break;case"xlinkActuate":rt(e,"http://www.w3.org/1999/xlink","xlink:actuate",r);break;case"xlinkArcrole":rt(e,"http://www.w3.org/1999/xlink","xlink:arcrole",r);break;case"xlinkRole":rt(e,"http://www.w3.org/1999/xlink","xlink:role",r);break;case"xlinkShow":rt(e,"http://www.w3.org/1999/xlink","xlink:show",r);break;case"xlinkTitle":rt(e,"http://www.w3.org/1999/xlink","xlink:title",r);break;case"xlinkType":rt(e,"http://www.w3.org/1999/xlink","xlink:type",r);break;case"xmlBase":rt(e,"http://www.w3.org/XML/1998/namespace","xml:base",r);break;case"xmlLang":rt(e,"http://www.w3.org/XML/1998/namespace","xml:lang",r);break;case"xmlSpace":rt(e,"http://www.w3.org/XML/1998/namespace","xml:space",r);break;case"is":tt(e,"is",r);break;case"innerText":case"textContent":break;default:(!(2<n.length)||"o"!==n[0]&&"O"!==n[0]||"n"!==n[1]&&"N"!==n[1])&&tt(e,n=At.get(n)||n,r)}}function Yu(e,t,n,r,a,s){switch(n){case"style":xt(e,r,s);break;case"dangerouslySetInnerHTML":if(null!=r){if("object"!==typeof r||!("__html"in r))throw Error(i(61));if(null!=(n=r.__html)){if(null!=a.children)throw Error(i(60));e.innerHTML=n}}break;case"children":"string"===typeof r?St(e,r):("number"===typeof r||"bigint"===typeof r)&&St(e,""+r);break;case"onScroll":null!=r&&Mu("scroll",e);break;case"onScrollEnd":null!=r&&Mu("scrollend",e);break;case"onClick":null!=r&&(e.onclick=Xu);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":case"innerText":case"textContent":break;default:Ze.hasOwnProperty(n)||("o"!==n[0]||"n"!==n[1]||(a=n.endsWith("Capture"),t=n.slice(2,a?n.length-7:void 0),"function"===typeof(s=null!=(s=e[Ce]||null)?s[n]:null)&&e.removeEventListener(t,s,a),"function"!==typeof r)?n in e?e[n]=r:!0===r?e.setAttribute(n,""):tt(e,n,r):("function"!==typeof s&&null!==s&&(n in e?e[n]=null:e.hasAttribute(n)&&e.removeAttribute(n)),e.addEventListener(t,r,a)))}}function ed(e,t,n){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Mu("error",e),Mu("load",e);var r,a=!1,s=!1;for(r in n)if(n.hasOwnProperty(r)){var o=n[r];if(null!=o)switch(r){case"src":a=!0;break;case"srcSet":s=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(i(137,t));default:Qu(e,t,r,o,n,null)}}return s&&Qu(e,t,"srcSet",n.srcSet,n,null),void(a&&Qu(e,t,"src",n.src,n,null));case"input":Mu("invalid",e);var l=r=o=s=null,c=null,u=null;for(a in n)if(n.hasOwnProperty(a)){var d=n[a];if(null!=d)switch(a){case"name":s=d;break;case"type":o=d;break;case"checked":c=d;break;case"defaultChecked":u=d;break;case"value":r=d;break;case"defaultValue":l=d;break;case"children":case"dangerouslySetInnerHTML":if(null!=d)throw Error(i(137,t));break;default:Qu(e,t,a,d,n,null)}}return yt(e,r,l,c,u,o,s,!1),void dt(e);case"select":for(s in Mu("invalid",e),a=o=r=null,n)if(n.hasOwnProperty(s)&&null!=(l=n[s]))switch(s){case"value":r=l;break;case"defaultValue":o=l;break;case"multiple":a=l;default:Qu(e,t,s,l,n,null)}return t=r,n=o,e.multiple=!!a,void(null!=t?vt(e,!!a,t,!1):null!=n&&vt(e,!!a,n,!0));case"textarea":for(o in Mu("invalid",e),r=s=a=null,n)if(n.hasOwnProperty(o)&&null!=(l=n[o]))switch(o){case"value":a=l;break;case"defaultValue":s=l;break;case"children":r=l;break;case"dangerouslySetInnerHTML":if(null!=l)throw Error(i(91));break;default:Qu(e,t,o,l,n,null)}return _t(e,a,s,r),void dt(e);case"option":for(c in n)if(n.hasOwnProperty(c)&&null!=(a=n[c]))if("selected"===c)e.selected=a&&"function"!==typeof a&&"symbol"!==typeof a;else Qu(e,t,c,a,n,null);return;case"dialog":Mu("beforetoggle",e),Mu("toggle",e),Mu("cancel",e),Mu("close",e);break;case"iframe":case"object":Mu("load",e);break;case"video":case"audio":for(a=0;a<Nu.length;a++)Mu(Nu[a],e);break;case"image":Mu("error",e),Mu("load",e);break;case"details":Mu("toggle",e);break;case"embed":case"source":case"link":Mu("error",e),Mu("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(u in n)if(n.hasOwnProperty(u)&&null!=(a=n[u]))switch(u){case"children":case"dangerouslySetInnerHTML":throw Error(i(137,t));default:Qu(e,t,u,a,n,null)}return;default:if(Ot(t)){for(d in n)n.hasOwnProperty(d)&&(void 0!==(a=n[d])&&Yu(e,t,d,a,n,void 0));return}}for(l in n)n.hasOwnProperty(l)&&(null!=(a=n[l])&&Qu(e,t,l,a,n,null))}var td=null,nd=null;function rd(e){return 9===e.nodeType?e:e.ownerDocument}function ad(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function sd(e,t){if(0===e)switch(t){case"svg":return 1;case"math":return 2;default:return 0}return 1===e&&"foreignObject"===t?0:e}function id(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"bigint"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var od=null;var ld="function"===typeof setTimeout?setTimeout:void 0,cd="function"===typeof clearTimeout?clearTimeout:void 0,ud="function"===typeof Promise?Promise:void 0,dd="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof ud?function(e){return ud.resolve(null).then(e).catch(hd)}:ld;function hd(e){setTimeout(function(){throw e})}function fd(e){return"head"===e}function pd(e,t){var n=t,r=0,a=0;do{var s=n.nextSibling;if(e.removeChild(n),s&&8===s.nodeType)if("/$"===(n=s.data)){if(0<r&&8>r){n=r;var i=e.ownerDocument;if(1&n&&_d(i.documentElement),2&n&&_d(i.body),4&n)for(_d(n=i.head),i=n.firstChild;i;){var o=i.nextSibling,l=i.nodeName;i[ze]||"SCRIPT"===l||"STYLE"===l||"LINK"===l&&"stylesheet"===i.rel.toLowerCase()||n.removeChild(i),i=o}}if(0===a)return e.removeChild(s),void Ah(t);a--}else"$"===n||"$?"===n||"$!"===n?a++:r=n.charCodeAt(0)-48;else r=0;n=s}while(n);Ah(t)}function md(e){var t=e.firstChild;for(t&&10===t.nodeType&&(t=t.nextSibling);t;){var n=t;switch(t=t.nextSibling,n.nodeName){case"HTML":case"HEAD":case"BODY":md(n),Ue(n);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if("stylesheet"===n.rel.toLowerCase())continue}e.removeChild(n)}}function gd(e){return"$!"===e.data||"$?"===e.data&&"complete"===e.ownerDocument.readyState}function yd(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t||"F!"===t||"F"===t)break;if("/$"===t)return null}}return e}var bd=null;function vd(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}function wd(e,t,n){switch(t=rd(n),e){case"html":if(!(e=t.documentElement))throw Error(i(452));return e;case"head":if(!(e=t.head))throw Error(i(453));return e;case"body":if(!(e=t.body))throw Error(i(454));return e;default:throw Error(i(451))}}function _d(e){for(var t=e.attributes;t.length;)e.removeAttributeNode(t[0]);Ue(e)}var Sd=new Map,kd=new Set;function Ed(e){return"function"===typeof e.getRootNode?e.getRootNode():9===e.nodeType?e:e.ownerDocument}var xd=j.d;j.d={f:function(){var e=xd.f(),t=Fc();return e||t},r:function(e){var t=Be(e);null!==t&&5===t.tag&&"form"===t.type?Ri(t):xd.r(e)},D:function(e){xd.D(e),Ad("dns-prefetch",e,null)},C:function(e,t){xd.C(e,t),Ad("preconnect",e,t)},L:function(e,t,n){xd.L(e,t,n);var r=Od;if(r&&e&&t){var a='link[rel="preload"][as="'+mt(t)+'"]';"image"===t&&n&&n.imageSrcSet?(a+='[imagesrcset="'+mt(n.imageSrcSet)+'"]',"string"===typeof n.imageSizes&&(a+='[imagesizes="'+mt(n.imageSizes)+'"]')):a+='[href="'+mt(e)+'"]';var s=a;switch(t){case"style":s=$d(e);break;case"script":s=Rd(e)}Sd.has(s)||(e=h({rel:"preload",href:"image"===t&&n&&n.imageSrcSet?void 0:e,as:t},n),Sd.set(s,e),null!==r.querySelector(a)||"style"===t&&r.querySelector(Td(s))||"script"===t&&r.querySelector(Cd(s))||(ed(t=r.createElement("link"),"link",e),We(t),r.head.appendChild(t)))}},m:function(e,t){xd.m(e,t);var n=Od;if(n&&e){var r=t&&"string"===typeof t.as?t.as:"script",a='link[rel="modulepreload"][as="'+mt(r)+'"][href="'+mt(e)+'"]',s=a;switch(r){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":s=Rd(e)}if(!Sd.has(s)&&(e=h({rel:"modulepreload",href:e},t),Sd.set(s,e),null===n.querySelector(a))){switch(r){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(n.querySelector(Cd(s)))return}ed(r=n.createElement("link"),"link",e),We(r),n.head.appendChild(r)}}},X:function(e,t){xd.X(e,t);var n=Od;if(n&&e){var r=He(n).hoistableScripts,a=Rd(e),s=r.get(a);s||((s=n.querySelector(Cd(a)))||(e=h({src:e,async:!0},t),(t=Sd.get(a))&&Md(e,t),We(s=n.createElement("script")),ed(s,"link",e),n.head.appendChild(s)),s={type:"script",instance:s,count:1,state:null},r.set(a,s))}},S:function(e,t,n){xd.S(e,t,n);var r=Od;if(r&&e){var a=He(r).hoistableStyles,s=$d(e);t=t||"default";var i=a.get(s);if(!i){var o={loading:0,preload:null};if(i=r.querySelector(Td(s)))o.loading=5;else{e=h({rel:"stylesheet",href:e,"data-precedence":t},n),(n=Sd.get(s))&&Ld(e,n);var l=i=r.createElement("link");We(l),ed(l,"link",e),l._p=new Promise(function(e,t){l.onload=e,l.onerror=t}),l.addEventListener("load",function(){o.loading|=1}),l.addEventListener("error",function(){o.loading|=2}),o.loading|=4,jd(i,t,r)}i={type:"stylesheet",instance:i,count:1,state:o},a.set(s,i)}}},M:function(e,t){xd.M(e,t);var n=Od;if(n&&e){var r=He(n).hoistableScripts,a=Rd(e),s=r.get(a);s||((s=n.querySelector(Cd(a)))||(e=h({src:e,async:!0,type:"module"},t),(t=Sd.get(a))&&Md(e,t),We(s=n.createElement("script")),ed(s,"link",e),n.head.appendChild(s)),s={type:"script",instance:s,count:1,state:null},r.set(a,s))}}};var Od="undefined"===typeof document?null:document;function Ad(e,t,n){var r=Od;if(r&&"string"===typeof t&&t){var a=mt(t);a='link[rel="'+e+'"][href="'+a+'"]',"string"===typeof n&&(a+='[crossorigin="'+n+'"]'),kd.has(a)||(kd.add(a),e={rel:e,crossOrigin:n,href:t},null===r.querySelector(a)&&(ed(t=r.createElement("link"),"link",e),We(t),r.head.appendChild(t)))}}function Id(e,t,n,r){var a,s,o,l,c=(c=H.current)?Ed(c):null;if(!c)throw Error(i(446));switch(e){case"meta":case"title":return null;case"style":return"string"===typeof n.precedence&&"string"===typeof n.href?(t=$d(n.href),(r=(n=He(c).hoistableStyles).get(t))||(r={type:"style",instance:null,count:0,state:null},n.set(t,r)),r):{type:"void",instance:null,count:0,state:null};case"link":if("stylesheet"===n.rel&&"string"===typeof n.href&&"string"===typeof n.precedence){e=$d(n.href);var u=He(c).hoistableStyles,d=u.get(e);if(d||(c=c.ownerDocument||c,d={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},u.set(e,d),(u=c.querySelector(Td(e)))&&!u._p&&(d.instance=u,d.state.loading=5),Sd.has(e)||(n={rel:"preload",as:"style",href:n.href,crossOrigin:n.crossOrigin,integrity:n.integrity,media:n.media,hrefLang:n.hrefLang,referrerPolicy:n.referrerPolicy},Sd.set(e,n),u||(a=c,s=e,o=n,l=d.state,a.querySelector('link[rel="preload"][as="style"]['+s+"]")?l.loading=1:(s=a.createElement("link"),l.preload=s,s.addEventListener("load",function(){return l.loading|=1}),s.addEventListener("error",function(){return l.loading|=2}),ed(s,"link",o),We(s),a.head.appendChild(s))))),t&&null===r)throw Error(i(528,""));return d}if(t&&null!==r)throw Error(i(529,""));return null;case"script":return t=n.async,"string"===typeof(n=n.src)&&t&&"function"!==typeof t&&"symbol"!==typeof t?(t=Rd(n),(r=(n=He(c).hoistableScripts).get(t))||(r={type:"script",instance:null,count:0,state:null},n.set(t,r)),r):{type:"void",instance:null,count:0,state:null};default:throw Error(i(444,e))}}function $d(e){return'href="'+mt(e)+'"'}function Td(e){return'link[rel="stylesheet"]['+e+"]"}function Pd(e){return h({},e,{"data-precedence":e.precedence,precedence:null})}function Rd(e){return'[src="'+mt(e)+'"]'}function Cd(e){return"script[async]"+e}function Nd(e,t,n){if(t.count++,null===t.instance)switch(t.type){case"style":var r=e.querySelector('style[data-href~="'+mt(n.href)+'"]');if(r)return t.instance=r,We(r),r;var a=h({},n,{"data-href":n.href,"data-precedence":n.precedence,href:null,precedence:null});return We(r=(e.ownerDocument||e).createElement("style")),ed(r,"style",a),jd(r,n.precedence,e),t.instance=r;case"stylesheet":a=$d(n.href);var s=e.querySelector(Td(a));if(s)return t.state.loading|=4,t.instance=s,We(s),s;r=Pd(n),(a=Sd.get(a))&&Ld(r,a),We(s=(e.ownerDocument||e).createElement("link"));var o=s;return o._p=new Promise(function(e,t){o.onload=e,o.onerror=t}),ed(s,"link",r),t.state.loading|=4,jd(s,n.precedence,e),t.instance=s;case"script":return s=Rd(n.src),(a=e.querySelector(Cd(s)))?(t.instance=a,We(a),a):(r=n,(a=Sd.get(s))&&Md(r=h({},n),a),We(a=(e=e.ownerDocument||e).createElement("script")),ed(a,"link",r),e.head.appendChild(a),t.instance=a);case"void":return null;default:throw Error(i(443,t.type))}else"stylesheet"===t.type&&0===(4&t.state.loading)&&(r=t.instance,t.state.loading|=4,jd(r,n.precedence,e));return t.instance}function jd(e,t,n){for(var r=n.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),a=r.length?r[r.length-1]:null,s=a,i=0;i<r.length;i++){var o=r[i];if(o.dataset.precedence===t)s=o;else if(s!==a)break}s?s.parentNode.insertBefore(e,s.nextSibling):(t=9===n.nodeType?n.head:n).insertBefore(e,t.firstChild)}function Ld(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.title&&(e.title=t.title)}function Md(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.integrity&&(e.integrity=t.integrity)}var Dd=null;function zd(e,t,n){if(null===Dd){var r=new Map,a=Dd=new Map;a.set(n,r)}else(r=(a=Dd).get(n))||(r=new Map,a.set(n,r));if(r.has(e))return r;for(r.set(e,null),n=n.getElementsByTagName(e),a=0;a<n.length;a++){var s=n[a];if(!(s[ze]||s[Re]||"link"===e&&"stylesheet"===s.getAttribute("rel"))&&"http://www.w3.org/2000/svg"!==s.namespaceURI){var i=s.getAttribute(t)||"";i=e+i;var o=r.get(i);o?o.push(s):r.set(i,[s])}}return r}function Ud(e,t,n){(e=e.ownerDocument||e).head.insertBefore(n,"title"===t?e.querySelector("head > title"):null)}function Fd(e){return"stylesheet"!==e.type||0!==(3&e.state.loading)}var Bd=null;function qd(){}function Hd(){if(this.count--,0===this.count)if(this.stylesheets)Vd(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}var Wd=null;function Vd(e,t){e.stylesheets=null,null!==e.unsuspend&&(e.count++,Wd=new Map,t.forEach(Zd,e),Wd=null,Hd.call(e))}function Zd(e,t){if(!(4&t.state.loading)){var n=Wd.get(e);if(n)var r=n.get(null);else{n=new Map,Wd.set(e,n);for(var a=e.querySelectorAll("link[data-precedence],style[data-precedence]"),s=0;s<a.length;s++){var i=a[s];"LINK"!==i.nodeName&&"not all"===i.getAttribute("media")||(n.set(i.dataset.precedence,i),r=i)}r&&n.set(null,r)}i=(a=t.instance).getAttribute("data-precedence"),(s=n.get(i)||r)===r&&n.set(null,a),n.set(i,a),this.count++,r=Hd.bind(this),a.addEventListener("load",r),a.addEventListener("error",r),s?s.parentNode.insertBefore(a,s.nextSibling):(e=9===e.nodeType?e.head:e).insertBefore(a,e.firstChild),t.state.loading|=4}}var Gd={$$typeof:_,Provider:null,Consumer:null,_currentValue:L,_currentValue2:L,_threadCount:0};function Jd(e,t,n,r,a,s,i,o){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Ee(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ee(0),this.hiddenUpdates=Ee(null),this.identifierPrefix=r,this.onUncaughtError=a,this.onCaughtError=s,this.onRecoverableError=i,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=o,this.incompleteTransitions=new Map}function Kd(e,t,n,r,a,s,i,o,l,c,u,d){return e=new Jd(e,t,n,i,o,l,c,d),t=1,!0===s&&(t|=24),s=Lr(3,null,null,t),e.current=s,s.stateNode=e,(t=Ca()).refCount++,e.pooledCache=t,t.refCount++,s.memoizedState={element:r,isDehydrated:n,cache:t},ns(s),e}function Xd(e){return e?e=Nr:Nr}function Qd(e,t,n,r,a,s){a=Xd(a),null===r.context?r.context=a:r.pendingContext=a,(r=as(t)).payload={element:n},null!==(s=void 0===s?null:s)&&(r.callback=s),null!==(n=ss(e,r,t))&&(Lc(n,0,t),is(n,e,t))}function Yd(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function eh(e,t){Yd(e,t),(e=e.alternate)&&Yd(e,t)}function th(e){if(13===e.tag){var t=Pr(e,67108864);null!==t&&Lc(t,0,67108864),eh(e,67108864)}}var nh=!0;function rh(e,t,n,r){var a=N.T;N.T=null;var s=j.p;try{j.p=2,sh(e,t,n,r)}finally{j.p=s,N.T=a}}function ah(e,t,n,r){var a=N.T;N.T=null;var s=j.p;try{j.p=8,sh(e,t,n,r)}finally{j.p=s,N.T=a}}function sh(e,t,n,r){if(nh){var a=ih(r);if(null===a)Bu(e,t,r,oh,n),bh(e,r);else if(function(e,t,n,r,a){switch(t){case"focusin":return dh=vh(dh,e,t,n,r,a),!0;case"dragenter":return hh=vh(hh,e,t,n,r,a),!0;case"mouseover":return fh=vh(fh,e,t,n,r,a),!0;case"pointerover":var s=a.pointerId;return ph.set(s,vh(ph.get(s)||null,e,t,n,r,a)),!0;case"gotpointercapture":return s=a.pointerId,mh.set(s,vh(mh.get(s)||null,e,t,n,r,a)),!0}return!1}(a,e,t,n,r))r.stopPropagation();else if(bh(e,r),4&t&&-1<yh.indexOf(e)){for(;null!==a;){var s=Be(a);if(null!==s)switch(s.tag){case 3:if((s=s.stateNode).current.memoizedState.isDehydrated){var i=be(s.pendingLanes);if(0!==i){var o=s;for(o.pendingLanes|=2,o.entangledLanes|=2;i;){var l=1<<31-fe(i);o.entanglements[1]|=l,i&=~l}Su(s),0===(6&nc)&&(Sc=te()+500,ku(0,!1))}}break;case 13:null!==(o=Pr(s,2))&&Lc(o,0,2),Fc(),eh(s,2)}if(null===(s=ih(r))&&Bu(e,t,r,oh,n),s===a)break;a=s}null!==a&&r.stopPropagation()}else Bu(e,t,r,null,n)}}function ih(e){return lh(e=Pt(e))}var oh=null;function lh(e){if(oh=null,null!==(e=Fe(e))){var t=l(e);if(null===t)e=null;else{var n=t.tag;if(13===n){if(null!==(e=c(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null)}}return oh=e,null}function ch(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(ne()){case re:return 2;case ae:return 8;case se:case ie:return 32;case oe:return 268435456;default:return 32}default:return 32}}var uh=!1,dh=null,hh=null,fh=null,ph=new Map,mh=new Map,gh=[],yh="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function bh(e,t){switch(e){case"focusin":case"focusout":dh=null;break;case"dragenter":case"dragleave":hh=null;break;case"mouseover":case"mouseout":fh=null;break;case"pointerover":case"pointerout":ph.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":mh.delete(t.pointerId)}}function vh(e,t,n,r,a,s){return null===e||e.nativeEvent!==s?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:s,targetContainers:[a]},null!==t&&(null!==(t=Be(t))&&th(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==a&&-1===t.indexOf(a)&&t.push(a),e)}function wh(e){var t=Fe(e.target);if(null!==t){var n=l(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=c(n)))return e.blockedOn=t,void function(e,t){var n=j.p;try{return j.p=e,t()}finally{j.p=n}}(e.priority,function(){if(13===n.tag){var e=Nc();e=Ie(e);var t=Pr(n,e);null!==t&&Lc(t,0,e),eh(n,e)}})}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function _h(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=ih(e.nativeEvent);if(null!==n)return null!==(t=Be(n))&&th(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);Tt=r,n.target.dispatchEvent(r),Tt=null,t.shift()}return!0}function Sh(e,t,n){_h(e)&&n.delete(t)}function kh(){uh=!1,null!==dh&&_h(dh)&&(dh=null),null!==hh&&_h(hh)&&(hh=null),null!==fh&&_h(fh)&&(fh=null),ph.forEach(Sh),mh.forEach(Sh)}function Eh(e,t){e.blockedOn===t&&(e.blockedOn=null,uh||(uh=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,kh)))}var xh=null;function Oh(e){xh!==e&&(xh=e,r.unstable_scheduleCallback(r.unstable_NormalPriority,function(){xh===e&&(xh=null);for(var t=0;t<e.length;t+=3){var n=e[t],r=e[t+1],a=e[t+2];if("function"!==typeof r){if(null===lh(r||n))continue;break}var s=Be(n);null!==s&&(e.splice(t,3),t-=3,Ti(s,{pending:!0,data:a,method:n.method,action:r},r,a))}}))}function Ah(e){function t(t){return Eh(t,e)}null!==dh&&Eh(dh,e),null!==hh&&Eh(hh,e),null!==fh&&Eh(fh,e),ph.forEach(t),mh.forEach(t);for(var n=0;n<gh.length;n++){var r=gh[n];r.blockedOn===e&&(r.blockedOn=null)}for(;0<gh.length&&null===(n=gh[0]).blockedOn;)wh(n),null===n.blockedOn&&gh.shift();if(null!=(n=(e.ownerDocument||e).$$reactFormReplay))for(r=0;r<n.length;r+=3){var a=n[r],s=n[r+1],i=a[Ce]||null;if("function"===typeof s)i||Oh(n);else if(i){var o=null;if(s&&s.hasAttribute("formAction")){if(a=s,i=s[Ce]||null)o=i.formAction;else if(null!==lh(a))continue}else o=i.action;"function"===typeof o?n[r+1]=o:(n.splice(r,3),r-=3),Oh(n)}}}function Ih(e){this._internalRoot=e}function $h(e){this._internalRoot=e}$h.prototype.render=Ih.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(i(409));Qd(t.current,Nc(),e,t,null,null)},$h.prototype.unmount=Ih.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;Qd(e.current,2,null,e,null,null),Fc(),t[Ne]=null}},$h.prototype.unstable_scheduleHydration=function(e){if(e){var t=Te();e={blockedOn:null,target:e,priority:t};for(var n=0;n<gh.length&&0!==t&&t<gh[n].priority;n++);gh.splice(n,0,e),0===n&&wh(e)}};var Th=a.version;if("19.1.0"!==Th)throw Error(i(527,Th,"19.1.0"));j.findDOMNode=function(e){var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(i(188));throw e=Object.keys(e).join(","),Error(i(268,e))}return e=function(e){var t=e.alternate;if(!t){if(null===(t=l(e)))throw Error(i(188));return t!==e?null:e}for(var n=e,r=t;;){var a=n.return;if(null===a)break;var s=a.alternate;if(null===s){if(null!==(r=a.return)){n=r;continue}break}if(a.child===s.child){for(s=a.child;s;){if(s===n)return u(a),e;if(s===r)return u(a),t;s=s.sibling}throw Error(i(188))}if(n.return!==r.return)n=a,r=s;else{for(var o=!1,c=a.child;c;){if(c===n){o=!0,n=a,r=s;break}if(c===r){o=!0,r=a,n=s;break}c=c.sibling}if(!o){for(c=s.child;c;){if(c===n){o=!0,n=s,r=a;break}if(c===r){o=!0,r=s,n=a;break}c=c.sibling}if(!o)throw Error(i(189))}}if(n.alternate!==r)throw Error(i(190))}if(3!==n.tag)throw Error(i(188));return n.stateNode.current===n?e:t}(t),e=null===(e=null!==e?d(e):null)?null:e.stateNode};var Ph={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:N,reconcilerVersion:"19.1.0"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var Rh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Rh.isDisabled&&Rh.supportsFiber)try{ue=Rh.inject(Ph),de=Rh}catch(Nh){}}t.createRoot=function(e,t){if(!o(e))throw Error(i(299));var n=!1,r="",a=bo,s=vo,l=wo;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onUncaughtError&&(a=t.onUncaughtError),void 0!==t.onCaughtError&&(s=t.onCaughtError),void 0!==t.onRecoverableError&&(l=t.onRecoverableError),void 0!==t.unstable_transitionCallbacks&&t.unstable_transitionCallbacks),t=Kd(e,1,!1,null,0,n,r,a,s,l,0,null),e[Ne]=t.current,Uu(e),new Ih(t)},t.hydrateRoot=function(e,t,n){if(!o(e))throw Error(i(299));var r=!1,a="",s=bo,l=vo,c=wo,u=null;return null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(r=!0),void 0!==n.identifierPrefix&&(a=n.identifierPrefix),void 0!==n.onUncaughtError&&(s=n.onUncaughtError),void 0!==n.onCaughtError&&(l=n.onCaughtError),void 0!==n.onRecoverableError&&(c=n.onRecoverableError),void 0!==n.unstable_transitionCallbacks&&n.unstable_transitionCallbacks,void 0!==n.formState&&(u=n.formState)),(t=Kd(e,1,!0,t,0,r,a,s,l,c,0,u)).context=Xd(null),n=t.current,(a=as(r=Ie(r=Nc()))).callback=null,ss(n,a,r),n=r,t.current.lanes=n,xe(t,n),Su(t),e[Ne]=t.current,Uu(e),new $h(t)},t.version="19.1.0"},7300:(e,t,n)=>{"use strict";const r=n(1595);e.exports=(e,t)=>r(e,t,!0)},7530:(e,t,n)=>{"use strict";const r=n(5059);e.exports=(e,t)=>{const n=r(e,t);return n?n.version:null}},7542:(e,t,n)=>{"use strict";const r=n(8125),a=n(1595);e.exports=(e,t,n)=>{const s=[];let i=null,o=null;const l=e.sort((e,t)=>a(e,t,n));for(const a of l){r(a,t,n)?(o=a,i||(i=a)):(o&&s.push([i,o]),o=null,i=null)}i&&s.push([i,null]);const c=[];for(const[r,a]of s)r===a?c.push(r):a||r!==l[0]?a?r===l[0]?c.push(`<=${a}`):c.push(`${r} - ${a}`):c.push(`>=${r}`):c.push("*");const u=c.join(" || "),d="string"===typeof t.raw?t.raw:String(t);return u.length<d.length?u:t}},7921:e=>{"use strict";const t="object"===typeof process&&{NODE_ENV:"production",PUBLIC_URL:"/zkulik-bot.github.io",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.NODE_DEBUG&&/\bsemver\b/i.test({NODE_ENV:"production",PUBLIC_URL:"/zkulik-bot.github.io",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.NODE_DEBUG)?function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return console.error("SEMVER",...t)}:()=>{};e.exports=t},7950:(e,t,n)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(6672)},8125:(e,t,n)=>{"use strict";const r=n(5252);e.exports=(e,t,n)=>{try{t=new r(t,n)}catch(a){return!1}return t.test(e)}},8292:(e,t,n)=>{"use strict";const r=n(5059);e.exports=(e,t)=>{const n=r(e,t);return n&&n.prerelease.length?n.prerelease:null}},8853:(e,t,n)=>{"use strict";e.exports=n(5896)},8969:(e,t,n)=>{"use strict";const{MAX_SAFE_COMPONENT_LENGTH:r,MAX_SAFE_BUILD_LENGTH:a,MAX_LENGTH:s}=n(6615),i=n(7921),o=(t=e.exports={}).re=[],l=t.safeRe=[],c=t.src=[],u=t.safeSrc=[],d=t.t={};let h=0;const f="[a-zA-Z0-9-]",p=[["\\s",1],["\\d",s],[f,a]],m=(e,t,n)=>{const r=(e=>{for(const[t,n]of p)e=e.split(`${t}*`).join(`${t}{0,${n}}`).split(`${t}+`).join(`${t}{1,${n}}`);return e})(t),a=h++;i(e,a,t),d[e]=a,c[a]=t,u[a]=r,o[a]=new RegExp(t,n?"g":void 0),l[a]=new RegExp(r,n?"g":void 0)};m("NUMERICIDENTIFIER","0|[1-9]\\d*"),m("NUMERICIDENTIFIERLOOSE","\\d+"),m("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${f}*`),m("MAINVERSION",`(${c[d.NUMERICIDENTIFIER]})\\.(${c[d.NUMERICIDENTIFIER]})\\.(${c[d.NUMERICIDENTIFIER]})`),m("MAINVERSIONLOOSE",`(${c[d.NUMERICIDENTIFIERLOOSE]})\\.(${c[d.NUMERICIDENTIFIERLOOSE]})\\.(${c[d.NUMERICIDENTIFIERLOOSE]})`),m("PRERELEASEIDENTIFIER",`(?:${c[d.NONNUMERICIDENTIFIER]}|${c[d.NUMERICIDENTIFIER]})`),m("PRERELEASEIDENTIFIERLOOSE",`(?:${c[d.NONNUMERICIDENTIFIER]}|${c[d.NUMERICIDENTIFIERLOOSE]})`),m("PRERELEASE",`(?:-(${c[d.PRERELEASEIDENTIFIER]}(?:\\.${c[d.PRERELEASEIDENTIFIER]})*))`),m("PRERELEASELOOSE",`(?:-?(${c[d.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${c[d.PRERELEASEIDENTIFIERLOOSE]})*))`),m("BUILDIDENTIFIER",`${f}+`),m("BUILD",`(?:\\+(${c[d.BUILDIDENTIFIER]}(?:\\.${c[d.BUILDIDENTIFIER]})*))`),m("FULLPLAIN",`v?${c[d.MAINVERSION]}${c[d.PRERELEASE]}?${c[d.BUILD]}?`),m("FULL",`^${c[d.FULLPLAIN]}$`),m("LOOSEPLAIN",`[v=\\s]*${c[d.MAINVERSIONLOOSE]}${c[d.PRERELEASELOOSE]}?${c[d.BUILD]}?`),m("LOOSE",`^${c[d.LOOSEPLAIN]}$`),m("GTLT","((?:<|>)?=?)"),m("XRANGEIDENTIFIERLOOSE",`${c[d.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),m("XRANGEIDENTIFIER",`${c[d.NUMERICIDENTIFIER]}|x|X|\\*`),m("XRANGEPLAIN",`[v=\\s]*(${c[d.XRANGEIDENTIFIER]})(?:\\.(${c[d.XRANGEIDENTIFIER]})(?:\\.(${c[d.XRANGEIDENTIFIER]})(?:${c[d.PRERELEASE]})?${c[d.BUILD]}?)?)?`),m("XRANGEPLAINLOOSE",`[v=\\s]*(${c[d.XRANGEIDENTIFIERLOOSE]})(?:\\.(${c[d.XRANGEIDENTIFIERLOOSE]})(?:\\.(${c[d.XRANGEIDENTIFIERLOOSE]})(?:${c[d.PRERELEASELOOSE]})?${c[d.BUILD]}?)?)?`),m("XRANGE",`^${c[d.GTLT]}\\s*${c[d.XRANGEPLAIN]}$`),m("XRANGELOOSE",`^${c[d.GTLT]}\\s*${c[d.XRANGEPLAINLOOSE]}$`),m("COERCEPLAIN",`(^|[^\\d])(\\d{1,${r}})(?:\\.(\\d{1,${r}}))?(?:\\.(\\d{1,${r}}))?`),m("COERCE",`${c[d.COERCEPLAIN]}(?:$|[^\\d])`),m("COERCEFULL",c[d.COERCEPLAIN]+`(?:${c[d.PRERELEASE]})?`+`(?:${c[d.BUILD]})?(?:$|[^\\d])`),m("COERCERTL",c[d.COERCE],!0),m("COERCERTLFULL",c[d.COERCEFULL],!0),m("LONETILDE","(?:~>?)"),m("TILDETRIM",`(\\s*)${c[d.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",m("TILDE",`^${c[d.LONETILDE]}${c[d.XRANGEPLAIN]}$`),m("TILDELOOSE",`^${c[d.LONETILDE]}${c[d.XRANGEPLAINLOOSE]}$`),m("LONECARET","(?:\\^)"),m("CARETTRIM",`(\\s*)${c[d.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",m("CARET",`^${c[d.LONECARET]}${c[d.XRANGEPLAIN]}$`),m("CARETLOOSE",`^${c[d.LONECARET]}${c[d.XRANGEPLAINLOOSE]}$`),m("COMPARATORLOOSE",`^${c[d.GTLT]}\\s*(${c[d.LOOSEPLAIN]})$|^$`),m("COMPARATOR",`^${c[d.GTLT]}\\s*(${c[d.FULLPLAIN]})$|^$`),m("COMPARATORTRIM",`(\\s*)${c[d.GTLT]}\\s*(${c[d.LOOSEPLAIN]}|${c[d.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",m("HYPHENRANGE",`^\\s*(${c[d.XRANGEPLAIN]})\\s+-\\s+(${c[d.XRANGEPLAIN]})\\s*$`),m("HYPHENRANGELOOSE",`^\\s*(${c[d.XRANGEPLAINLOOSE]})\\s+-\\s+(${c[d.XRANGEPLAINLOOSE]})\\s*$`),m("STAR","(<|>)?=?\\s*\\*"),m("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),m("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")},9181:(e,t,n)=>{"use strict";const r=n(6357);e.exports=(e,t)=>new r(e,t).major},9325:(e,t,n)=>{"use strict";const r=Symbol("SemVer ANY");class a{static get ANY(){return r}constructor(e,t){if(t=s(t),e instanceof a){if(e.loose===!!t.loose)return e;e=e.value}e=e.trim().split(/\s+/).join(" "),c("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===r?this.value="":this.value=this.operator+this.semver.version,c("comp",this)}parse(e){const t=this.options.loose?i[o.COMPARATORLOOSE]:i[o.COMPARATOR],n=e.match(t);if(!n)throw new TypeError(`Invalid comparator: ${e}`);this.operator=void 0!==n[1]?n[1]:"","="===this.operator&&(this.operator=""),n[2]?this.semver=new u(n[2],this.options.loose):this.semver=r}toString(){return this.value}test(e){if(c("Comparator.test",e,this.options.loose),this.semver===r||e===r)return!0;if("string"===typeof e)try{e=new u(e,this.options)}catch(t){return!1}return l(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof a))throw new TypeError("a Comparator is required");return""===this.operator?""===this.value||new d(e.value,t).test(this.value):""===e.operator?""===e.value||new d(this.value,t).test(e.semver):(!(t=s(t)).includePrerelease||"<0.0.0-0"!==this.value&&"<0.0.0-0"!==e.value)&&(!(!t.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0")))&&(!(!this.operator.startsWith(">")||!e.operator.startsWith(">"))||(!(!this.operator.startsWith("<")||!e.operator.startsWith("<"))||(!(this.semver.version!==e.semver.version||!this.operator.includes("=")||!e.operator.includes("="))||(!!(l(this.semver,"<",e.semver,t)&&this.operator.startsWith(">")&&e.operator.startsWith("<"))||!!(l(this.semver,">",e.semver,t)&&this.operator.startsWith("<")&&e.operator.startsWith(">")))))))}}e.exports=a;const s=n(4806),{safeRe:i,t:o}=n(8969),l=n(6612),c=n(7921),u=n(6357),d=n(5252)},9410:(e,t,n)=>{"use strict";const r=n(8969),a=n(6615),s=n(6357),i=n(2990),o=n(5059),l=n(7530),c=n(4073),u=n(1492),d=n(21),h=n(9181),f=n(6457),p=n(5986),m=n(8292),g=n(1595),y=n(3011),b=n(7300),v=n(4570),w=n(5210),_=n(1634),S=n(209),k=n(4238),E=n(1824),x=n(76),O=n(3042),A=n(4695),I=n(6612),$=n(5343),T=n(9325),P=n(5252),R=n(8125),C=n(3868),N=n(9887),j=n(2941),L=n(4192),M=n(2027),D=n(422),z=n(5962),U=n(5919),F=n(2527),B=n(7542),q=n(5415);e.exports={parse:o,valid:l,clean:c,inc:u,diff:d,major:h,minor:f,patch:p,prerelease:m,compare:g,rcompare:y,compareLoose:b,compareBuild:v,sort:w,rsort:_,gt:S,lt:k,eq:E,neq:x,gte:O,lte:A,cmp:I,coerce:$,Comparator:T,Range:P,satisfies:R,toComparators:C,maxSatisfying:N,minSatisfying:j,minVersion:L,validRange:M,outside:D,gtr:z,ltr:U,intersects:F,simplifyRange:B,subset:q,SemVer:s,re:r.re,src:r.src,tokens:r.t,SEMVER_SPEC_VERSION:a.SEMVER_SPEC_VERSION,RELEASE_TYPES:a.RELEASE_TYPES,compareIdentifiers:i.compareIdentifiers,rcompareIdentifiers:i.rcompareIdentifiers}},9764:(e,t,n)=>{e.exports=n(3914)},9887:(e,t,n)=>{"use strict";const r=n(6357),a=n(5252);e.exports=(e,t,n)=>{let s=null,i=null,o=null;try{o=new a(t,n)}catch(l){return null}return e.forEach(e=>{o.test(e)&&(s&&-1!==i.compare(e)||(s=e,i=new r(s,n)))}),s}}},t={};function n(r){var a=t[r];if(void 0!==a)return a.exports;var s=t[r]={id:r,loaded:!1,exports:{}};return e[r](s,s.exports,n),s.loaded=!0,s.exports}n.m=e,n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.f={},n.e=e=>Promise.all(Object.keys(n.f).reduce((t,r)=>(n.f[r](e,t),t),[])),n.u=e=>"static/js/"+e+".702826e2.chunk.js",n.miniCssF=e=>{},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={},t="chatbot-ui:";n.l=(r,a,s,i)=>{if(e[r])e[r].push(a);else{var o,l;if(void 0!==s)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var d=c[u];if(d.getAttribute("src")==r||d.getAttribute("data-webpack")==t+s){o=d;break}}o||(l=!0,(o=document.createElement("script")).charset="utf-8",o.timeout=120,n.nc&&o.setAttribute("nonce",n.nc),o.setAttribute("data-webpack",t+s),o.src=r),e[r]=[a];var h=(t,n)=>{o.onerror=o.onload=null,clearTimeout(f);var a=e[r];if(delete e[r],o.parentNode&&o.parentNode.removeChild(o),a&&a.forEach(e=>e(n)),t)return t(n)},f=setTimeout(h.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=h.bind(null,o.onerror),o.onload=h.bind(null,o.onload),l&&document.head.appendChild(o)}}})(),n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),n.p="/zkulik-bot.github.io/",(()=>{var e={792:0};n.f.j=(t,r)=>{var a=n.o(e,t)?e[t]:void 0;if(0!==a)if(a)r.push(a[2]);else{var s=new Promise((n,r)=>a=e[t]=[n,r]);r.push(a[2]=s);var i=n.p+n.u(t),o=new Error;n.l(i,r=>{if(n.o(e,t)&&(0!==(a=e[t])&&(e[t]=void 0),a)){var s=r&&("load"===r.type?"missing":r.type),i=r&&r.target&&r.target.src;o.message="Loading chunk "+t+" failed.\n("+s+": "+i+")",o.name="ChunkLoadError",o.type=s,o.request=i,a[1](o)}},"chunk-"+t,t)}};var t=(t,r)=>{var a,s,i=r[0],o=r[1],l=r[2],c=0;if(i.some(t=>0!==e[t])){for(a in o)n.o(o,a)&&(n.m[a]=o[a]);if(l)l(n)}for(t&&t(r);c<i.length;c++)s=i[c],n.o(e,s)&&e[s]&&e[s][0](),e[s]=0},r=self.webpackChunkchatbot_ui=self.webpackChunkchatbot_ui||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})(),(()=>{"use strict";var e={};n.r(e),n.d(e,{JsonPatchError:()=>qs,_areEquals:()=>Ys,applyOperation:()=>Gs,applyPatch:()=>Js,applyReducer:()=>Ks,deepClone:()=>Hs,getValueByPointer:()=>Zs,validate:()=>Qs,validator:()=>Xs});var t=n(5043),r=n(4391);function a(e,t,n,r,a){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?a.call(e,n):a?a.value=n:t.set(e,n),n}function s(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)}let i=function(){const{crypto:e}=globalThis;if(e?.randomUUID)return i=e.randomUUID.bind(e),e.randomUUID();const t=new Uint8Array(1),n=e?()=>e.getRandomValues(t)[0]:()=>255*Math.random()&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>(+e^n()&15>>+e/4).toString(16))};function o(e){return"object"===typeof e&&null!==e&&("name"in e&&"AbortError"===e.name||"message"in e&&String(e.message).includes("FetchRequestCanceledException"))}const l=e=>{if(e instanceof Error)return e;if("object"===typeof e&&null!==e){try{if("[object Error]"===Object.prototype.toString.call(e)){const t=new Error(e.message,e.cause?{cause:e.cause}:{});return e.stack&&(t.stack=e.stack),e.cause&&!t.cause&&(t.cause=e.cause),e.name&&(t.name=e.name),t}}catch{}try{return new Error(JSON.stringify(e))}catch{}}return new Error(e)};class c extends Error{}class u extends c{constructor(e,t,n,r){super(`${u.makeMessage(e,t,n)}`),this.status=e,this.headers=r,this.requestID=r?.get("x-request-id"),this.error=t;const a=t;this.code=a?.code,this.param=a?.param,this.type=a?.type}static makeMessage(e,t,n){const r=t?.message?"string"===typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&r?`${e} ${r}`:e?`${e} status code (no body)`:r||"(no status code or body)"}static generate(e,t,n,r){if(!e||!r)return new h({message:n,cause:l(t)});const a=t?.error;return 400===e?new p(e,a,n,r):401===e?new m(e,a,n,r):403===e?new g(e,a,n,r):404===e?new y(e,a,n,r):409===e?new b(e,a,n,r):422===e?new v(e,a,n,r):429===e?new w(e,a,n,r):e>=500?new _(e,a,n,r):new u(e,a,n,r)}}class d extends u{constructor(){let{message:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(void 0,void 0,e||"Request was aborted.",void 0)}}class h extends u{constructor(e){let{message:t,cause:n}=e;super(void 0,void 0,t||"Connection error.",void 0),n&&(this.cause=n)}}class f extends h{constructor(){let{message:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({message:e??"Request timed out."})}}class p extends u{}class m extends u{}class g extends u{}class y extends u{}class b extends u{}class v extends u{}class w extends u{}class _ extends u{}class S extends c{constructor(){super("Could not parse response content as the length limit was reached")}}class k extends c{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}class E extends Error{constructor(e){super(e)}}const x=/^[a-z][a-z0-9+.-]*:/i;let O=e=>(O=Array.isArray,O(e)),A=O;function I(e){return null!=e&&"object"===typeof e&&!Array.isArray(e)}const $=e=>new Promise(t=>setTimeout(t,e)),T="5.8.3";const P=()=>{const e="undefined"!==typeof Deno&&null!=Deno.build?"deno":"undefined"!==typeof EdgeRuntime?"edge":"[object process]"===Object.prototype.toString.call("undefined"!==typeof globalThis.process?globalThis.process:0)?"node":"unknown";if("deno"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":T,"X-Stainless-OS":C(Deno.build.os),"X-Stainless-Arch":R(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"===typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"};if("undefined"!==typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":T,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if("node"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":T,"X-Stainless-OS":C(globalThis.process.platform??"unknown"),"X-Stainless-Arch":R(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};const t=function(){if("undefined"===typeof navigator||!navigator)return null;const e=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:t,pattern:n}of e){const e=n.exec(navigator.userAgent);if(e){return{browser:t,version:`${e[1]||0}.${e[2]||0}.${e[3]||0}`}}}return null}();return t?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":T,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":T,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};const R=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",C=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown";let N;function j(){const e=globalThis.ReadableStream;if("undefined"===typeof e)throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return new e(...n)}function L(e){let t=Symbol.asyncIterator in e?e[Symbol.asyncIterator]():e[Symbol.iterator]();return j({start(){},async pull(e){const{done:n,value:r}=await t.next();n?e.close():e.enqueue(r)},async cancel(){await(t.return?.())}})}function M(e){if(e[Symbol.asyncIterator])return e;const t=e.getReader();return{async next(){try{const e=await t.read();return e?.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){const e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}const D=e=>{let{headers:t,body:n}=e;return{bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(n)}},z="RFC3986",U=e=>String(e),F={RFC1738:e=>String(e).replace(/%20/g,"+"),RFC3986:U},B="RFC1738";let q=(e,t)=>(q=Object.hasOwn??Function.prototype.call.bind(Object.prototype.hasOwnProperty),q(e,t));const H=(()=>{const e=[];for(let t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e})();const W=1024;function V(e,t){if(O(e)){const n=[];for(let r=0;r<e.length;r+=1)n.push(t(e[r]));return n}return t(e)}const Z={brackets:e=>String(e)+"[]",comma:"comma",indices:(e,t)=>String(e)+"["+t+"]",repeat:e=>String(e)},G=function(e,t){Array.prototype.push.apply(e,O(t)?t:[t])};let J;const K={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:(e,t,n,r,a)=>{if(0===e.length)return e;let s=e;if("symbol"===typeof e?s=Symbol.prototype.toString.call(e):"string"!==typeof e&&(s=String(e)),"iso-8859-1"===n)return escape(s).replace(/%u[0-9a-f]{4}/gi,function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"});let i="";for(let o=0;o<s.length;o+=W){const e=s.length>=W?s.slice(o,o+W):s,t=[];for(let n=0;n<e.length;++n){let r=e.charCodeAt(n);45===r||46===r||95===r||126===r||r>=48&&r<=57||r>=65&&r<=90||r>=97&&r<=122||a===B&&(40===r||41===r)?t[t.length]=e.charAt(n):r<128?t[t.length]=H[r]:r<2048?t[t.length]=H[192|r>>6]+H[128|63&r]:r<55296||r>=57344?t[t.length]=H[224|r>>12]+H[128|r>>6&63]+H[128|63&r]:(n+=1,r=65536+((1023&r)<<10|1023&e.charCodeAt(n)),t[t.length]=H[240|r>>18]+H[128|r>>12&63]+H[128|r>>6&63]+H[128|63&r])}i+=t.join("")}return i},encodeValuesOnly:!1,format:z,formatter:U,indices:!1,serializeDate:e=>(J??(J=Function.prototype.call.bind(Date.prototype.toISOString)))(e),skipNulls:!1,strictNullHandling:!1};const X={};function Q(e,t,n,r,a,s,i,o,l,c,u,d,h,f,p,m,g,y){let b=e,v=y,w=0,_=!1;for(;void 0!==(v=v.get(X))&&!_;){const t=v.get(e);if(w+=1,"undefined"!==typeof t){if(t===w)throw new RangeError("Cyclic object value");_=!0}"undefined"===typeof v.get(X)&&(w=0)}if("function"===typeof c?b=c(t,b):b instanceof Date?b=h?.(b):"comma"===n&&O(b)&&(b=V(b,function(e){return e instanceof Date?h?.(e):e})),null===b){if(s)return l&&!m?l(t,K.encoder,g,"key",f):t;b=""}if("string"===typeof(S=b)||"number"===typeof S||"boolean"===typeof S||"symbol"===typeof S||"bigint"===typeof S||function(e){return!(!e||"object"!==typeof e)&&!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))}(b)){if(l){const e=m?t:l(t,K.encoder,g,"key",f);return[p?.(e)+"="+p?.(l(b,K.encoder,g,"value",f))]}return[p?.(t)+"="+p?.(String(b))]}var S;const k=[];if("undefined"===typeof b)return k;let E;if("comma"===n&&O(b))m&&l&&(b=V(b,l)),E=[{value:b.length>0?b.join(",")||null:void 0}];else if(O(c))E=c;else{const e=Object.keys(b);E=u?e.sort(u):e}const x=o?String(t).replace(/\./g,"%2E"):String(t),A=r&&O(b)&&1===b.length?x+"[]":x;if(a&&O(b)&&0===b.length)return A+"[]";for(let I=0;I<E.length;++I){const t=E[I],v="object"===typeof t&&"undefined"!==typeof t.value?t.value:b[t];if(i&&null===v)continue;const _=d&&o?t.replace(/\./g,"%2E"):t,S=O(b)?"function"===typeof n?n(A,_):A:A+(d?"."+_:"["+_+"]");y.set(e,w);const x=new WeakMap;x.set(X,y),G(k,Q(v,S,n,r,a,s,i,o,"comma"===n&&m&&O(b)?null:l,c,u,d,h,f,p,m,g,x))}return k}function Y(e){let t=e;const n=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:K;if("undefined"!==typeof e.allowEmptyArrays&&"boolean"!==typeof e.allowEmptyArrays)throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if("undefined"!==typeof e.encodeDotInKeys&&"boolean"!==typeof e.encodeDotInKeys)throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.encoder&&"undefined"!==typeof e.encoder&&"function"!==typeof e.encoder)throw new TypeError("Encoder has to be a function.");const t=e.charset||K.charset;if("undefined"!==typeof e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let n=z;if("undefined"!==typeof e.format){if(!q(F,e.format))throw new TypeError("Unknown format option provided.");n=e.format}const r=F[n];let a,s=K.filter;if(("function"===typeof e.filter||O(e.filter))&&(s=e.filter),a=e.arrayFormat&&e.arrayFormat in Z?e.arrayFormat:"indices"in e?e.indices?"indices":"repeat":K.arrayFormat,"commaRoundTrip"in e&&"boolean"!==typeof e.commaRoundTrip)throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const i="undefined"===typeof e.allowDots?!0===!!e.encodeDotInKeys||K.allowDots:!!e.allowDots;return{addQueryPrefix:"boolean"===typeof e.addQueryPrefix?e.addQueryPrefix:K.addQueryPrefix,allowDots:i,allowEmptyArrays:"boolean"===typeof e.allowEmptyArrays?!!e.allowEmptyArrays:K.allowEmptyArrays,arrayFormat:a,charset:t,charsetSentinel:"boolean"===typeof e.charsetSentinel?e.charsetSentinel:K.charsetSentinel,commaRoundTrip:!!e.commaRoundTrip,delimiter:"undefined"===typeof e.delimiter?K.delimiter:e.delimiter,encode:"boolean"===typeof e.encode?e.encode:K.encode,encodeDotInKeys:"boolean"===typeof e.encodeDotInKeys?e.encodeDotInKeys:K.encodeDotInKeys,encoder:"function"===typeof e.encoder?e.encoder:K.encoder,encodeValuesOnly:"boolean"===typeof e.encodeValuesOnly?e.encodeValuesOnly:K.encodeValuesOnly,filter:s,format:n,formatter:r,serializeDate:"function"===typeof e.serializeDate?e.serializeDate:K.serializeDate,skipNulls:"boolean"===typeof e.skipNulls?e.skipNulls:K.skipNulls,sort:"function"===typeof e.sort?e.sort:null,strictNullHandling:"boolean"===typeof e.strictNullHandling?e.strictNullHandling:K.strictNullHandling}}(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{});let r,a;"function"===typeof n.filter?(a=n.filter,t=a("",t)):O(n.filter)&&(a=n.filter,r=a);const s=[];if("object"!==typeof t||null===t)return"";const i=Z[n.arrayFormat],o="comma"===i&&n.commaRoundTrip;r||(r=Object.keys(t)),n.sort&&r.sort(n.sort);const l=new WeakMap;for(let d=0;d<r.length;++d){const e=r[d];n.skipNulls&&null===t[e]||G(s,Q(t[e],e,i,o,n.allowEmptyArrays,n.strictNullHandling,n.skipNulls,n.encodeDotInKeys,n.encode?n.encoder:null,n.filter,n.sort,n.allowDots,n.serializeDate,n.format,n.formatter,n.encodeValuesOnly,n.charset,l))}const c=s.join(n.delimiter);let u=!0===n.addQueryPrefix?"?":"";return n.charsetSentinel&&("iso-8859-1"===n.charset?u+="utf8=%26%2310003%3B&":u+="utf8=%E2%9C%93&"),c.length>0?u+c:""}let ee,te;function ne(e){let t;return(ee??(t=new globalThis.TextEncoder,ee=t.encode.bind(t)))(e)}function re(e){let t;return(te??(t=new globalThis.TextDecoder,te=t.decode.bind(t)))(e)}var ae,se;class ie{constructor(){ae.set(this,void 0),se.set(this,void 0),a(this,ae,new Uint8Array,"f"),a(this,se,null,"f")}decode(e){if(null==e)return[];const t=e instanceof ArrayBuffer?new Uint8Array(e):"string"===typeof e?ne(e):e;a(this,ae,function(e){let t=0;for(const a of e)t+=a.length;const n=new Uint8Array(t);let r=0;for(const a of e)n.set(a,r),r+=a.length;return n}([s(this,ae,"f"),t]),"f");const n=[];let r;for(;null!=(r=oe(s(this,ae,"f"),s(this,se,"f")));){if(r.carriage&&null==s(this,se,"f")){a(this,se,r.index,"f");continue}if(null!=s(this,se,"f")&&(r.index!==s(this,se,"f")+1||r.carriage)){n.push(re(s(this,ae,"f").subarray(0,s(this,se,"f")-1))),a(this,ae,s(this,ae,"f").subarray(s(this,se,"f")),"f"),a(this,se,null,"f");continue}const e=null!==s(this,se,"f")?r.preceding-1:r.preceding,t=re(s(this,ae,"f").subarray(0,e));n.push(t),a(this,ae,s(this,ae,"f").subarray(r.index),"f"),a(this,se,null,"f")}return n}flush(){return s(this,ae,"f").length?this.decode("\n"):[]}}function oe(e,t){for(let n=t??0;n<e.length;n++){if(10===e[n])return{preceding:n,index:n+1,carriage:!1};if(13===e[n])return{preceding:n,index:n+1,carriage:!0}}return null}function le(e){for(let t=0;t<e.length-1;t++){if(10===e[t]&&10===e[t+1])return t+2;if(13===e[t]&&13===e[t+1])return t+2;if(13===e[t]&&10===e[t+1]&&t+3<e.length&&13===e[t+2]&&10===e[t+3])return t+4}return-1}ae=new WeakMap,se=new WeakMap,ie.NEWLINE_CHARS=new Set(["\n","\r"]),ie.NEWLINE_REGEXP=/\r\n|[\n\r]/g;const ce={off:0,error:200,warn:300,info:400,debug:500},ue=(e,t,n)=>{var r,a;if(e)return r=ce,a=e,Object.prototype.hasOwnProperty.call(r,a)?e:void me(n).warn(`${t} was set to ${JSON.stringify(e)}, expected one of ${JSON.stringify(Object.keys(ce))}`)};function de(){}function he(e,t,n){return!t||ce[e]>ce[n]?de:t[e].bind(t)}const fe={error:de,warn:de,info:de,debug:de};let pe=new WeakMap;function me(e){const t=e.logger,n=e.logLevel??"off";if(!t)return fe;const r=pe.get(t);if(r&&r[0]===n)return r[1];const a={error:he("error",t,n),warn:he("warn",t,n),info:he("info",t,n),debug:he("debug",t,n)};return pe.set(t,[n,a]),a}const ge=e=>(e.options&&(e.options={...e.options},delete e.options.headers),e.headers&&(e.headers=Object.fromEntries((e.headers instanceof Headers?[...e.headers]:Object.entries(e.headers)).map(e=>{let[t,n]=e;return[t,"authorization"===t.toLowerCase()||"cookie"===t.toLowerCase()||"set-cookie"===t.toLowerCase()?"***":n]}))),"retryOfRequestLogID"in e&&(e.retryOfRequestLogID&&(e.retryOf=e.retryOfRequestLogID),delete e.retryOfRequestLogID),e);var ye,be,ve;class we{constructor(e,t,n){this.iterator=e,ye.set(this,void 0),this.controller=t,a(this,ye,n,"f")}static fromSSEResponse(e,t,n){let r=!1;const a=n?me(n):console;return new we(async function*(){if(r)throw new c("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let n=!1;try{for await(const r of async function*(e,t){if(!e.body){if(t.abort(),"undefined"!==typeof globalThis.navigator&&"ReactNative"===globalThis.navigator.product)throw new c("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api");throw new c("Attempted to iterate over a response with no body")}const n=new _e,r=new ie,a=M(e.body);for await(const s of async function*(e){let t=new Uint8Array;for await(const n of e){if(null==n)continue;const e=n instanceof ArrayBuffer?new Uint8Array(n):"string"===typeof n?ne(n):n;let r,a=new Uint8Array(t.length+e.length);for(a.set(t),a.set(e,t.length),t=a;-1!==(r=le(t));)yield t.slice(0,r),t=t.slice(r)}t.length>0&&(yield t)}(a))for(const e of r.decode(s)){const t=n.decode(e);t&&(yield t)}for(const s of r.flush()){const e=n.decode(s);e&&(yield e)}}(e,t))if(!n)if(r.data.startsWith("[DONE]"))n=!0;else if(null===r.event||r.event.startsWith("response.")||r.event.startsWith("transcript.")){let t;try{t=JSON.parse(r.data)}catch(s){throw a.error("Could not parse message into JSON:",r.data),a.error("From chunk:",r.raw),s}if(t&&t.error)throw new u(void 0,t.error,void 0,e.headers);yield t}else{let e;try{e=JSON.parse(r.data)}catch(s){throw console.error("Could not parse message into JSON:",r.data),console.error("From chunk:",r.raw),s}if("error"==r.event)throw new u(void 0,e.error,e.message,void 0);yield{event:r.event,data:e}}n=!0}catch(s){if(o(s))return;throw s}finally{n||t.abort()}},t,n)}static fromReadableStream(e,t,n){let r=!1;return new we(async function*(){if(r)throw new c("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let n=!1;try{for await(const t of async function*(){const t=new ie,n=M(e);for await(const e of n)for(const n of t.decode(e))yield n;for(const e of t.flush())yield e}())n||t&&(yield JSON.parse(t));n=!0}catch(a){if(o(a))return;throw a}finally{n||t.abort()}},t,n)}[(ye=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){const e=[],t=[],n=this.iterator(),r=r=>({next:()=>{if(0===r.length){const r=n.next();e.push(r),t.push(r)}return r.shift()}});return[new we(()=>r(e),this.controller,s(this,ye,"f")),new we(()=>r(t),this.controller,s(this,ye,"f"))]}toReadableStream(){const e=this;let t;return j({async start(){t=e[Symbol.asyncIterator]()},async pull(e){try{const{value:n,done:r}=await t.next();if(r)return e.close();const a=ne(JSON.stringify(n)+"\n");e.enqueue(a)}catch(n){e.error(n)}},async cancel(){await(t.return?.())}})}}class _e{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,r]=function(e,t){const n=e.indexOf(t);if(-1!==n)return[e.substring(0,n),t,e.substring(n+t.length)];return[e,"",""]}(e,":");return r.startsWith(" ")&&(r=r.substring(1)),"event"===t?this.event=r:"data"===t&&this.data.push(r),null}}async function Se(e,t){const{response:n,requestLogID:r,retryOfRequestLogID:a,startTime:s}=t,i=await(async()=>{if(t.options.stream)return me(e).debug("response",n.status,n.url,n.headers,n.body),t.options.__streamClass?t.options.__streamClass.fromSSEResponse(n,t.controller,e):we.fromSSEResponse(n,t.controller,e);if(204===n.status)return null;if(t.options.__binaryResponse)return n;const r=n.headers.get("content-type"),a=r?.split(";")[0]?.trim();if(a?.includes("application/json")||a?.endsWith("+json")){return ke(await n.json(),n)}return await n.text()})();return me(e).debug(`[${r}] response parsed`,ge({retryOfRequestLogID:a,url:n.url,status:n.status,body:i,durationMs:Date.now()-s})),i}function ke(e,t){return!e||"object"!==typeof e||Array.isArray(e)?e:Object.defineProperty(e,"_request_id",{value:t.headers.get("x-request-id"),enumerable:!1})}class Ee extends Promise{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Se;super(e=>{e(null)}),this.responsePromise=t,this.parseResponse=n,be.set(this,void 0),a(this,be,e,"f")}_thenUnwrap(e){return new Ee(s(this,be,"f"),this.responsePromise,async(t,n)=>ke(e(await this.parseResponse(t,n),n),n.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(s(this,be,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}be=new WeakMap;class xe{constructor(e,t,n,r){ve.set(this,void 0),a(this,ve,e,"f"),this.options=r,this.response=t,this.body=n}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageRequestOptions()}async getNextPage(){const e=this.nextPageRequestOptions();if(!e)throw new c("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await s(this,ve,"f").requestAPIList(this.constructor,e)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(ve=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class Oe extends Ee{constructor(e,t,n){super(e,t,async(e,t)=>new n(e,t.response,await Se(e,t),t.options))}async*[Symbol.asyncIterator](){const e=await(this);for await(const t of e)yield t}}class Ae extends xe{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[],this.object=n.object}getPaginatedItems(){return this.data??[]}nextPageRequestOptions(){return null}}class Ie extends xe{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[],this.has_more=n.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){const e=this.getPaginatedItems(),t=e[e.length-1]?.id;return t?{...this.options,query:{...(n=this.options.query,"object"!==typeof n?{}:n??{}),after:t}}:null;var n}}const $e=()=>{if("undefined"===typeof File){const{process:e}=globalThis,t="string"===typeof e?.versions?.node&&parseInt(e.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(t?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function Te(e,t,n){return $e(),new File(e,t??"unknown_file",n)}function Pe(e){return("object"===typeof e&&null!==e&&("name"in e&&e.name&&String(e.name)||"url"in e&&e.url&&String(e.url)||"filename"in e&&e.filename&&String(e.filename)||"path"in e&&e.path&&String(e.path))||"").split(/[\\/]/).pop()||void 0}const Re=e=>null!=e&&"object"===typeof e&&"function"===typeof e[Symbol.asyncIterator],Ce=async(e,t)=>({...e,body:await je(e.body,t)}),Ne=new WeakMap;const je=async(e,t)=>{if(!await function(e){const t="function"===typeof e?e:e.fetch,n=Ne.get(t);if(n)return n;const r=(async()=>{try{const e="Response"in t?t.Response:(await t("data:,")).constructor,n=new FormData;return n.toString()!==await new e(n).text()}catch{return!0}})();return Ne.set(t,r),r}(t))throw new TypeError("The provided fetch function does not support file uploads with the current global FormData class.");const n=new FormData;return await Promise.all(Object.entries(e||{}).map(e=>{let[t,r]=e;return Me(n,t,r)})),n},Le=e=>e instanceof Blob&&"name"in e,Me=async(e,t,n)=>{if(void 0!==n){if(null==n)throw new TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if("string"===typeof n||"number"===typeof n||"boolean"===typeof n)e.append(t,String(n));else if(n instanceof Response)e.append(t,Te([await n.blob()],Pe(n)));else if(Re(n))e.append(t,Te([await new Response(L(n)).blob()],Pe(n)));else if(Le(n))e.append(t,n,Pe(n));else if(Array.isArray(n))await Promise.all(n.map(n=>Me(e,t+"[]",n)));else{if("object"!==typeof n)throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${n} instead`);await Promise.all(Object.entries(n).map(n=>{let[r,a]=n;return Me(e,`${t}[${r}]`,a)}))}}},De=e=>null!=e&&"object"===typeof e&&"number"===typeof e.size&&"string"===typeof e.type&&"function"===typeof e.text&&"function"===typeof e.slice&&"function"===typeof e.arrayBuffer;async function ze(e){let t=[];if("string"===typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(De(e))t.push(e instanceof Blob?e:await e.arrayBuffer());else{if(!Re(e)){const t=e?.constructor?.name;throw new Error(`Unexpected data type: ${typeof e}${t?`; constructor: ${t}`:""}${function(e){if("object"!==typeof e||null===e)return"";const t=Object.getOwnPropertyNames(e);return`; props: [${t.map(e=>`"${e}"`).join(", ")}]`}(e)}`)}for await(const n of e)t.push(...await ze(n))}return t}class Ue{constructor(e){this._client=e}}function Fe(e){return e.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}const Be=Object.freeze(Object.create(null)),qe=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Fe;return function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];if(1===t.length)return t[0];let s=!1;const i=[],o=t.reduce((t,n,a)=>{/[?#]/.test(n)&&(s=!0);const o=r[a];let l=(s?encodeURIComponent:e)(""+o);return a!==r.length&&(null==o||"object"===typeof o&&o.toString===Object.getPrototypeOf(Object.getPrototypeOf(o.hasOwnProperty??Be)??Be)?.toString)&&(l=o+"",i.push({start:t.length+n.length,length:l.length,error:`Value of type ${Object.prototype.toString.call(o).slice(8,-1)} is not a valid path parameter`})),t+n+(a===r.length?"":l)},""),l=o.split(/[?#]/,1)[0],u=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi;let d;for(;null!==(d=u.exec(l));)i.push({start:d.index,length:d[0].length,error:`Value "${d[0]}" can't be safely passed as a path parameter`});if(i.sort((e,t)=>e.start-t.start),i.length>0){let e=0;const t=i.reduce((t,n)=>{const r=" ".repeat(n.start-e),a="^".repeat(n.length);return e=n.start+n.length,t+r+a},"");throw new c(`Path parameters result in path with invalid segments:\n${i.map(e=>e.error).join("\n")}\n${o}\n${t}`)}return o}},He=qe(Fe);class We extends Ue{list(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return this._client.getAPIList(He`/chat/completions/${e}/messages`,Ie,{query:t,...n})}}function Ve(e){return"function"===typeof e.parse}const Ze=e=>"assistant"===e?.role,Ge=e=>"tool"===e?.role;var Je,Ke,Xe,Qe,Ye,et,tt,nt,rt,at,st,it,ot,lt,ct,ut,dt,ht,ft,pt,mt;class gt{constructor(){Je.add(this),this.controller=new AbortController,Ke.set(this,void 0),Xe.set(this,()=>{}),Qe.set(this,()=>{}),Ye.set(this,void 0),et.set(this,()=>{}),tt.set(this,()=>{}),nt.set(this,{}),rt.set(this,!1),at.set(this,!1),st.set(this,!1),it.set(this,!1),a(this,Ke,new Promise((e,t)=>{a(this,Xe,e,"f"),a(this,Qe,t,"f")}),"f"),a(this,Ye,new Promise((e,t)=>{a(this,et,e,"f"),a(this,tt,t,"f")}),"f"),s(this,Ke,"f").catch(()=>{}),s(this,Ye,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},s(this,Je,"m",ot).bind(this))},0)}_connected(){this.ended||(s(this,Xe,"f").call(this),this._emit("connect"))}get ended(){return s(this,rt,"f")}get errored(){return s(this,at,"f")}get aborted(){return s(this,st,"f")}abort(){this.controller.abort()}on(e,t){return(s(this,nt,"f")[e]||(s(this,nt,"f")[e]=[])).push({listener:t}),this}off(e,t){const n=s(this,nt,"f")[e];if(!n)return this;const r=n.findIndex(e=>e.listener===t);return r>=0&&n.splice(r,1),this}once(e,t){return(s(this,nt,"f")[e]||(s(this,nt,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,n)=>{a(this,it,!0,"f"),"error"!==e&&this.once("error",n),this.once(e,t)})}async done(){a(this,it,!0,"f"),await s(this,Ye,"f")}_emit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if(s(this,rt,"f"))return;"end"===e&&(a(this,rt,!0,"f"),s(this,et,"f").call(this));const i=s(this,nt,"f")[e];if(i&&(s(this,nt,"f")[e]=i.filter(e=>!e.once),i.forEach(e=>{let{listener:t}=e;return t(...n)})),"abort"===e){const e=n[0];return s(this,it,"f")||i?.length||Promise.reject(e),s(this,Qe,"f").call(this,e),s(this,tt,"f").call(this,e),void this._emit("end")}if("error"===e){const e=n[0];s(this,it,"f")||i?.length||Promise.reject(e),s(this,Qe,"f").call(this,e),s(this,tt,"f").call(this,e),this._emit("end")}}_emitFinal(){}}function yt(e){return"auto-parseable-response-format"===e?.$brand}function bt(e){return"auto-parseable-tool"===e?.$brand}function vt(e,t){const n=e.choices.map(e=>{if("length"===e.finish_reason)throw new S;if("content_filter"===e.finish_reason)throw new k;return{...e,message:{...e.message,...e.message.tool_calls?{tool_calls:e.message.tool_calls?.map(e=>function(e,t){const n=e.tools?.find(e=>e.function?.name===t.function.name);return{...t,function:{...t.function,parsed_arguments:bt(n)?n.$parseRaw(t.function.arguments):n?.function.strict?JSON.parse(t.function.arguments):null}}}(t,e))??void 0}:void 0,parsed:e.message.content&&!e.message.refusal?wt(t,e.message.content):null}}});return{...e,choices:n}}function wt(e,t){if("json_schema"!==e.response_format?.type)return null;if("json_schema"===e.response_format?.type){if("$parseRaw"in e.response_format){return e.response_format.$parseRaw(t)}return JSON.parse(t)}return null}function _t(e,t){if(!e)return!1;const n=e.tools?.find(e=>e.function?.name===t.function.name);return bt(n)||n?.function.strict||!1}function St(e){return!!yt(e.response_format)||(e.tools?.some(e=>bt(e)||"function"===e.type&&!0===e.function.strict)??!1)}Ke=new WeakMap,Xe=new WeakMap,Qe=new WeakMap,Ye=new WeakMap,et=new WeakMap,tt=new WeakMap,nt=new WeakMap,rt=new WeakMap,at=new WeakMap,st=new WeakMap,it=new WeakMap,Je=new WeakSet,ot=function(e){if(a(this,at,!0,"f"),e instanceof Error&&"AbortError"===e.name&&(e=new d),e instanceof d)return a(this,st,!0,"f"),this._emit("abort",e);if(e instanceof c)return this._emit("error",e);if(e instanceof Error){const t=new c(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new c(String(e)))};const kt=10;class Et extends gt{constructor(){super(...arguments),lt.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if("content"in e||(e.content=null),this.messages.push(e),t)if(this._emit("message",e),Ge(e)&&e.content)this._emit("functionToolCallResult",e.content);else if(Ze(e)&&e.tool_calls)for(const n of e.tool_calls)"function"===n.type&&this._emit("functionToolCall",n.function)}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new c("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),s(this,lt,"m",ct).call(this)}async finalMessage(){return await this.done(),s(this,lt,"m",ut).call(this)}async finalFunctionToolCall(){return await this.done(),s(this,lt,"m",dt).call(this)}async finalFunctionToolCallResult(){return await this.done(),s(this,lt,"m",ht).call(this)}async totalUsage(){return await this.done(),s(this,lt,"m",ft).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=s(this,lt,"m",ut).call(this);t&&this._emit("finalMessage",t);const n=s(this,lt,"m",ct).call(this);n&&this._emit("finalContent",n);const r=s(this,lt,"m",dt).call(this);r&&this._emit("finalFunctionToolCall",r);const a=s(this,lt,"m",ht).call(this);null!=a&&this._emit("finalFunctionToolCallResult",a),this._chatCompletions.some(e=>e.usage)&&this._emit("totalUsage",s(this,lt,"m",ft).call(this))}async _createChatCompletion(e,t,n){const r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),s(this,lt,"m",pt).call(this,t);const a=await e.chat.completions.create({...t,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addChatCompletion(vt(a,t))}async _runChatCompletion(e,t,n){for(const r of t.messages)this._addMessage(r,!1);return await this._createChatCompletion(e,t,n)}async _runTools(e,t,n){const r="tool",{tool_choice:a="auto",stream:i,...o}=t,l="string"!==typeof a&&a?.function?.name,{maxChatCompletions:u=kt}=n||{},d=t.tools.map(e=>{if(bt(e)){if(!e.$callback)throw new c("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:e.$callback,name:e.function.name,description:e.function.description||"",parameters:e.function.parameters,parse:e.$parseRaw,strict:!0}}}return e}),h={};for(const s of d)"function"===s.type&&(h[s.function.name||s.function.function.name]=s.function);const f="tools"in t?d.map(e=>"function"===e.type?{type:"function",function:{name:e.function.name||e.function.function.name,parameters:e.function.parameters,description:e.function.description,strict:e.function.strict}}:e):void 0;for(const s of t.messages)this._addMessage(s,!1);for(let m=0;m<u;++m){const t=await this._createChatCompletion(e,{...o,tool_choice:a,tools:f,messages:[...this.messages]},n),i=t.choices[0]?.message;if(!i)throw new c("missing message in ChatCompletion response");if(!i.tool_calls?.length)return;for(const e of i.tool_calls){if("function"!==e.type)continue;const t=e.id,{name:n,arguments:a}=e.function,i=h[n];if(!i){const e=`Invalid tool_call: ${JSON.stringify(n)}. Available options are: ${Object.keys(h).map(e=>JSON.stringify(e)).join(", ")}. Please try again`;this._addMessage({role:r,tool_call_id:t,content:e});continue}if(l&&l!==n){const e=`Invalid tool_call: ${JSON.stringify(n)}. ${JSON.stringify(l)} requested. Please try again`;this._addMessage({role:r,tool_call_id:t,content:e});continue}let o;try{o=Ve(i)?await i.parse(a):a}catch(p){const e=p instanceof Error?p.message:String(p);this._addMessage({role:r,tool_call_id:t,content:e});continue}const c=await i.function(o,this),u=s(this,lt,"m",mt).call(this,c);if(this._addMessage({role:r,tool_call_id:t,content:u}),l)return}}}}lt=new WeakSet,ct=function(){return s(this,lt,"m",ut).call(this).content??null},ut=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(Ze(t)){return{...t,content:t.content??null,refusal:t.refusal??null}}}throw new c("stream ended without producing a ChatCompletionMessage with role=assistant")},dt=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(Ze(t)&&t?.tool_calls?.length)return t.tool_calls.at(-1)?.function}},ht=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(Ge(t)&&null!=t.content&&"string"===typeof t.content&&this.messages.some(e=>"assistant"===e.role&&e.tool_calls?.some(e=>"function"===e.type&&e.id===t.tool_call_id)))return t.content}},ft=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},pt=function(e){if(null!=e.n&&e.n>1)throw new c("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},mt=function(e){return"string"===typeof e?e:void 0===e?"undefined":JSON.stringify(e)};class xt extends Et{static runTools(e,t,n){const r=new xt,a={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run(()=>r._runTools(e,t,a)),r}_addMessage(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super._addMessage(e,t),Ze(e)&&e.content&&this._emit("content",e.content)}}const Ot={STR:1,NUM:2,ARR:4,OBJ:8,NULL:16,BOOL:32,NAN:64,INFINITY:128,MINUS_INFINITY:256,INF:384,SPECIAL:496,ATOM:499,COLLECTION:12,ALL:511};class At extends Error{}class It extends Error{}const $t=(e,t)=>{const n=e.length;let r=0;const a=e=>{throw new At(`${e} at position ${r}`)},s=e=>{throw new It(`${e} at position ${r}`)},i=()=>(d(),r>=n&&a("Unexpected end of input"),'"'===e[r]?o():"{"===e[r]?l():"["===e[r]?c():"null"===e.substring(r,r+4)||Ot.NULL&t&&n-r<4&&"null".startsWith(e.substring(r))?(r+=4,null):"true"===e.substring(r,r+4)||Ot.BOOL&t&&n-r<4&&"true".startsWith(e.substring(r))?(r+=4,!0):"false"===e.substring(r,r+5)||Ot.BOOL&t&&n-r<5&&"false".startsWith(e.substring(r))?(r+=5,!1):"Infinity"===e.substring(r,r+8)||Ot.INFINITY&t&&n-r<8&&"Infinity".startsWith(e.substring(r))?(r+=8,1/0):"-Infinity"===e.substring(r,r+9)||Ot.MINUS_INFINITY&t&&1<n-r&&n-r<9&&"-Infinity".startsWith(e.substring(r))?(r+=9,-1/0):"NaN"===e.substring(r,r+3)||Ot.NAN&t&&n-r<3&&"NaN".startsWith(e.substring(r))?(r+=3,NaN):u()),o=()=>{const i=r;let o=!1;for(r++;r<n&&('"'!==e[r]||o&&"\\"===e[r-1]);)o="\\"===e[r]&&!o,r++;if('"'==e.charAt(r))try{return JSON.parse(e.substring(i,++r-Number(o)))}catch(l){s(String(l))}else if(Ot.STR&t)try{return JSON.parse(e.substring(i,r-Number(o))+'"')}catch(l){return JSON.parse(e.substring(i,e.lastIndexOf("\\"))+'"')}a("Unterminated string literal")},l=()=>{r++,d();const s={};try{for(;"}"!==e[r];){if(d(),r>=n&&Ot.OBJ&t)return s;const a=o();d(),r++;try{const e=i();Object.defineProperty(s,a,{value:e,writable:!0,enumerable:!0,configurable:!0})}catch(l){if(Ot.OBJ&t)return s;throw l}d(),","===e[r]&&r++}}catch(l){if(Ot.OBJ&t)return s;a("Expected '}' at end of object")}return r++,s},c=()=>{r++;const n=[];try{for(;"]"!==e[r];)n.push(i()),d(),","===e[r]&&r++}catch(s){if(Ot.ARR&t)return n;a("Expected ']' at end of array")}return r++,n},u=()=>{if(0===r){"-"===e&&Ot.NUM&t&&a("Not sure what '-' is");try{return JSON.parse(e)}catch(o){if(Ot.NUM&t)try{return"."===e[e.length-1]?JSON.parse(e.substring(0,e.lastIndexOf("."))):JSON.parse(e.substring(0,e.lastIndexOf("e")))}catch(o){}s(String(o))}}const i=r;for("-"===e[r]&&r++;e[r]&&!",]}".includes(e[r]);)r++;r!=n||Ot.NUM&t||a("Unterminated number literal");try{return JSON.parse(e.substring(i,r))}catch(o){"-"===e.substring(i,r)&&Ot.NUM&t&&a("Not sure what '-' is");try{return JSON.parse(e.substring(i,e.lastIndexOf("e")))}catch(o){s(String(o))}}},d=()=>{for(;r<n&&" \n\r\t".includes(e[r]);)r++};return i()},Tt=e=>function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ot.ALL;if("string"!==typeof e)throw new TypeError("expecting str, got "+typeof e);if(!e.trim())throw new Error(`${e} is empty`);return $t(e.trim(),t)}(e,Ot.ALL^Ot.NUM);var Pt,Rt,Ct,Nt,jt,Lt,Mt,Dt,zt,Ut,Ft,Bt;class qt extends Et{constructor(e){super(),Pt.add(this),Rt.set(this,void 0),Ct.set(this,void 0),Nt.set(this,void 0),a(this,Rt,e,"f"),a(this,Ct,[],"f")}get currentChatCompletionSnapshot(){return s(this,Nt,"f")}static fromReadableStream(e){const t=new qt(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,n){const r=new qt(t);return r._run(()=>r._runChatCompletion(e,{...t,stream:!0},{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),r}async _createChatCompletion(e,t,n){super._createChatCompletion;const r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),s(this,Pt,"m",jt).call(this);const a=await e.chat.completions.create({...t,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(const i of a)s(this,Pt,"m",Mt).call(this,i);if(a.controller.signal?.aborted)throw new d;return this._addChatCompletion(s(this,Pt,"m",Ut).call(this))}async _fromReadableStream(e,t){const n=t?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),s(this,Pt,"m",jt).call(this),this._connected();const r=we.fromReadableStream(e,this.controller);let a;for await(const i of r)a&&a!==i.id&&this._addChatCompletion(s(this,Pt,"m",Ut).call(this)),s(this,Pt,"m",Mt).call(this,i),a=i.id;if(r.controller.signal?.aborted)throw new d;return this._addChatCompletion(s(this,Pt,"m",Ut).call(this))}[(Rt=new WeakMap,Ct=new WeakMap,Nt=new WeakMap,Pt=new WeakSet,jt=function(){this.ended||a(this,Nt,void 0,"f")},Lt=function(e){let t=s(this,Ct,"f")[e.index];return t||(t={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},s(this,Ct,"f")[e.index]=t,t)},Mt=function(e){if(this.ended)return;const t=s(this,Pt,"m",Bt).call(this,e);this._emit("chunk",e,t);for(const n of e.choices){const e=t.choices[n.index];null!=n.delta.content&&"assistant"===e.message?.role&&e.message?.content&&(this._emit("content",n.delta.content,e.message.content),this._emit("content.delta",{delta:n.delta.content,snapshot:e.message.content,parsed:e.message.parsed})),null!=n.delta.refusal&&"assistant"===e.message?.role&&e.message?.refusal&&this._emit("refusal.delta",{delta:n.delta.refusal,snapshot:e.message.refusal}),null!=n.logprobs?.content&&"assistant"===e.message?.role&&this._emit("logprobs.content.delta",{content:n.logprobs?.content,snapshot:e.logprobs?.content??[]}),null!=n.logprobs?.refusal&&"assistant"===e.message?.role&&this._emit("logprobs.refusal.delta",{refusal:n.logprobs?.refusal,snapshot:e.logprobs?.refusal??[]});const r=s(this,Pt,"m",Lt).call(this,e);e.finish_reason&&(s(this,Pt,"m",zt).call(this,e),null!=r.current_tool_call_index&&s(this,Pt,"m",Dt).call(this,e,r.current_tool_call_index));for(const t of n.delta.tool_calls??[])r.current_tool_call_index!==t.index&&(s(this,Pt,"m",zt).call(this,e),null!=r.current_tool_call_index&&s(this,Pt,"m",Dt).call(this,e,r.current_tool_call_index)),r.current_tool_call_index=t.index;for(const t of n.delta.tool_calls??[]){const n=e.message.tool_calls?.[t.index];n?.type&&("function"===n?.type?this._emit("tool_calls.function.arguments.delta",{name:n.function?.name,index:t.index,arguments:n.function.arguments,parsed_arguments:n.function.parsed_arguments,arguments_delta:t.function?.arguments??""}):Vt(n?.type))}}},Dt=function(e,t){if(s(this,Pt,"m",Lt).call(this,e).done_tool_calls.has(t))return;const n=e.message.tool_calls?.[t];if(!n)throw new Error("no tool call snapshot");if(!n.type)throw new Error("tool call snapshot missing `type`");if("function"===n.type){const e=s(this,Rt,"f")?.tools?.find(e=>"function"===e.type&&e.function.name===n.function.name);this._emit("tool_calls.function.arguments.done",{name:n.function.name,index:t,arguments:n.function.arguments,parsed_arguments:bt(e)?e.$parseRaw(n.function.arguments):e?.function.strict?JSON.parse(n.function.arguments):null})}else n.type},zt=function(e){const t=s(this,Pt,"m",Lt).call(this,e);if(e.message.content&&!t.content_done){t.content_done=!0;const n=s(this,Pt,"m",Ft).call(this);this._emit("content.done",{content:e.message.content,parsed:n?n.$parseRaw(e.message.content):null})}e.message.refusal&&!t.refusal_done&&(t.refusal_done=!0,this._emit("refusal.done",{refusal:e.message.refusal})),e.logprobs?.content&&!t.logprobs_content_done&&(t.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:e.logprobs.content})),e.logprobs?.refusal&&!t.logprobs_refusal_done&&(t.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:e.logprobs.refusal}))},Ut=function(){if(this.ended)throw new c("stream has ended, this shouldn't happen");const e=s(this,Nt,"f");if(!e)throw new c("request ended without sending any chunks");return a(this,Nt,void 0,"f"),a(this,Ct,[],"f"),function(e,t){const{id:n,choices:r,created:a,model:s,system_fingerprint:i,...o}=e,l={...o,id:n,choices:r.map(t=>{let{message:n,finish_reason:r,index:a,logprobs:s,...i}=t;if(!r)throw new c(`missing finish_reason for choice ${a}`);const{content:o=null,function_call:l,tool_calls:u,...d}=n,h=n.role;if(!h)throw new c(`missing role for choice ${a}`);if(l){const{arguments:e,name:t}=l;if(null==e)throw new c(`missing function_call.arguments for choice ${a}`);if(!t)throw new c(`missing function_call.name for choice ${a}`);return{...i,message:{content:o,function_call:{arguments:e,name:t},role:h,refusal:n.refusal??null},finish_reason:r,index:a,logprobs:s}}return u?{...i,index:a,finish_reason:r,logprobs:s,message:{...d,role:h,content:o,refusal:n.refusal??null,tool_calls:u.map((t,n)=>{const{function:r,type:s,id:i,...o}=t,{arguments:l,name:u,...d}=r||{};if(null==i)throw new c(`missing choices[${a}].tool_calls[${n}].id\n${Ht(e)}`);if(null==s)throw new c(`missing choices[${a}].tool_calls[${n}].type\n${Ht(e)}`);if(null==u)throw new c(`missing choices[${a}].tool_calls[${n}].function.name\n${Ht(e)}`);if(null==l)throw new c(`missing choices[${a}].tool_calls[${n}].function.arguments\n${Ht(e)}`);return{...o,id:i,type:s,function:{...d,name:u,arguments:l}}})}}:{...i,message:{...d,content:o,role:h,refusal:n.refusal??null},finish_reason:r,index:a,logprobs:s}}),created:a,model:s,object:"chat.completion",...i?{system_fingerprint:i}:{}};return function(e,t){return t&&St(t)?vt(e,t):{...e,choices:e.choices.map(e=>({...e,message:{...e.message,parsed:null,...e.message.tool_calls?{tool_calls:e.message.tool_calls}:void 0}}))}}(l,t)}(e,s(this,Rt,"f"))},Ft=function(){const e=s(this,Rt,"f")?.response_format;return yt(e)?e:null},Bt=function(e){var t,n,r,i;let o=s(this,Nt,"f");const{choices:l,...c}=e;o?Object.assign(o,c):o=a(this,Nt,{...c,choices:[]},"f");for(const{delta:a,finish_reason:u,index:d,logprobs:h=null,...f}of e.choices){let e=o.choices[d];if(e||(e=o.choices[d]={finish_reason:u,index:d,message:{},logprobs:h,...f}),h)if(e.logprobs){const{content:r,refusal:a,...s}=h;Wt(s),Object.assign(e.logprobs,s),r&&((t=e.logprobs).content??(t.content=[]),e.logprobs.content.push(...r)),a&&((n=e.logprobs).refusal??(n.refusal=[]),e.logprobs.refusal.push(...a))}else e.logprobs=Object.assign({},h);if(u&&(e.finish_reason=u,s(this,Rt,"f")&&St(s(this,Rt,"f")))){if("length"===u)throw new S;if("content_filter"===u)throw new k}if(Object.assign(e,f),!a)continue;const{content:l,refusal:c,function_call:p,role:m,tool_calls:g,...y}=a;if(Wt(y),Object.assign(e.message,y),c&&(e.message.refusal=(e.message.refusal||"")+c),m&&(e.message.role=m),p&&(e.message.function_call?(p.name&&(e.message.function_call.name=p.name),p.arguments&&((r=e.message.function_call).arguments??(r.arguments=""),e.message.function_call.arguments+=p.arguments)):e.message.function_call=p),l&&(e.message.content=(e.message.content||"")+l,!e.message.refusal&&s(this,Pt,"m",Ft).call(this)&&(e.message.parsed=Tt(e.message.content))),g){e.message.tool_calls||(e.message.tool_calls=[]);for(const{index:t,id:n,type:r,function:a,...o}of g){const l=(i=e.message.tool_calls)[t]??(i[t]={});Object.assign(l,o),n&&(l.id=n),r&&(l.type=r),a&&(l.function??(l.function={name:a.name??"",arguments:""})),a?.name&&(l.function.name=a.name),a?.arguments&&(l.function.arguments+=a.arguments,_t(s(this,Rt,"f"),l)&&(l.function.parsed_arguments=Tt(l.function.arguments)))}}}return o},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("chunk",n=>{const r=t.shift();r?r.resolve(n):e.push(n)}),this.on("end",()=>{n=!0;for(const e of t)e.resolve(void 0);t.length=0}),this.on("abort",e=>{n=!0;for(const n of t)n.reject(e);t.length=0}),this.on("error",e=>{n=!0;for(const n of t)n.reject(e);t.length=0}),{next:async()=>{if(!e.length)return n?{value:void 0,done:!0}:new Promise((e,n)=>t.push({resolve:e,reject:n})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0});return{value:e.shift(),done:!1}},return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new we(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function Ht(e){return JSON.stringify(e)}function Wt(e){}function Vt(e){}class Zt extends qt{static fromReadableStream(e){const t=new Zt(null);return t._run(()=>t._fromReadableStream(e)),t}static runTools(e,t,n){const r=new Zt(t),a={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run(()=>r._runTools(e,t,a)),r}}class Gt extends Ue{constructor(){super(...arguments),this.messages=new We(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(He`/chat/completions/${e}`,t)}update(e,t,n){return this._client.post(He`/chat/completions/${e}`,{body:t,...n})}list(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return this._client.getAPIList("/chat/completions",Ie,{query:e,...t})}delete(e,t){return this._client.delete(He`/chat/completions/${e}`,t)}parse(e,t){return function(e){for(const t of e??[]){if("function"!==t.type)throw new c(`Currently only \`function\` tool types support auto-parsing; Received \`${t.type}\``);if(!0!==t.function.strict)throw new c(`The \`${t.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"chat.completions.parse"}})._thenUnwrap(t=>vt(t,e))}runTools(e,t){return e.stream?Zt.runTools(this._client,e,t):xt.runTools(this._client,e,t)}stream(e,t){return qt.createChatCompletion(this._client,e,t)}}Gt.Messages=We;class Jt extends Ue{constructor(){super(...arguments),this.completions=new Gt(this._client)}}Jt.Completions=Gt;const Kt=Symbol("brand.privateNullableHeaders");function*Xt(e){if(!e)return;if(Kt in e){const{values:t,nulls:n}=e;yield*t.entries();for(const e of n)yield[e,null];return}let t,n=!1;e instanceof Headers?t=e.entries():A(e)?t=e:(n=!0,t=Object.entries(e??{}));for(let r of t){const e=r[0];if("string"!==typeof e)throw new TypeError("expected header name to be a string");const t=A(r[1])?r[1]:[r[1]];let a=!1;for(const r of t)void 0!==r&&(n&&!a&&(a=!0,yield[e,null]),yield[e,r])}}const Qt=e=>{const t=new Headers,n=new Set;for(const r of e){const e=new Set;for(const[a,s]of Xt(r)){const r=a.toLowerCase();e.has(r)||(t.delete(a),e.add(r)),null===s?(t.delete(a),n.add(r)):(t.append(a,s),n.delete(r))}}return{[Kt]:!0,values:t,nulls:n}};class Yt extends Ue{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:Qt([{Accept:"application/octet-stream"},t?.headers]),__binaryResponse:!0})}}class en extends Ue{create(e,t){return this._client.post("/audio/transcriptions",Ce({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}},this._client))}}class tn extends Ue{create(e,t){return this._client.post("/audio/translations",Ce({body:e,...t,__metadata:{model:e.model}},this._client))}}class nn extends Ue{constructor(){super(...arguments),this.transcriptions=new en(this._client),this.translations=new tn(this._client),this.speech=new Yt(this._client)}}nn.Transcriptions=en,nn.Translations=tn,nn.Speech=Yt;class rn extends Ue{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(He`/batches/${e}`,t)}list(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return this._client.getAPIList("/batches",Ie,{query:e,...t})}cancel(e,t){return this._client.post(He`/batches/${e}/cancel`,t)}}class an extends Ue{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:Qt([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(He`/assistants/${e}`,{...t,headers:Qt([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,n){return this._client.post(He`/assistants/${e}`,{body:t,...n,headers:Qt([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return this._client.getAPIList("/assistants",Ie,{query:e,...t,headers:Qt([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete(He`/assistants/${e}`,{...t,headers:Qt([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class sn extends Ue{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:Qt([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class on extends Ue{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:Qt([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class ln extends Ue{constructor(){super(...arguments),this.sessions=new sn(this._client),this.transcriptionSessions=new on(this._client)}}ln.Sessions=sn,ln.TranscriptionSessions=on;class cn extends Ue{create(e,t,n){return this._client.post(He`/threads/${e}/messages`,{body:t,...n,headers:Qt([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}retrieve(e,t,n){const{thread_id:r}=t;return this._client.get(He`/threads/${r}/messages/${e}`,{...n,headers:Qt([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}update(e,t,n){const{thread_id:r,...a}=t;return this._client.post(He`/threads/${r}/messages/${e}`,{body:a,...n,headers:Qt([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return this._client.getAPIList(He`/threads/${e}/messages`,Ie,{query:t,...n,headers:Qt([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}delete(e,t,n){const{thread_id:r}=t;return this._client.delete(He`/threads/${r}/messages/${e}`,{...n,headers:Qt([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}}class un extends Ue{retrieve(e,t,n){const{thread_id:r,run_id:a,...s}=t;return this._client.get(He`/threads/${r}/runs/${a}/steps/${e}`,{query:s,...n,headers:Qt([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e,t,n){const{thread_id:r,...a}=t;return this._client.getAPIList(He`/threads/${r}/runs/${e}/steps`,Ie,{query:a,...n,headers:Qt([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}}const dn=e=>"undefined"!==typeof globalThis.process?globalThis.process.env?.[e]?.trim()??void 0:"undefined"!==typeof globalThis.Deno?globalThis.Deno.env?.get?.(e)?.trim():void 0;var hn,fn,pn,mn,gn,yn,bn,vn,wn,_n,Sn,kn,En,xn,On,An,In,$n,Tn,Pn,Rn,Cn,Nn,jn,Ln,Mn,Dn,zn,Un,Fn,Bn;class qn extends gt{constructor(){super(...arguments),hn.add(this),pn.set(this,[]),mn.set(this,{}),gn.set(this,{}),yn.set(this,void 0),bn.set(this,void 0),vn.set(this,void 0),wn.set(this,void 0),_n.set(this,void 0),Sn.set(this,void 0),kn.set(this,void 0),En.set(this,void 0),xn.set(this,void 0)}[(pn=new WeakMap,mn=new WeakMap,gn=new WeakMap,yn=new WeakMap,bn=new WeakMap,vn=new WeakMap,wn=new WeakMap,_n=new WeakMap,Sn=new WeakMap,kn=new WeakMap,En=new WeakMap,xn=new WeakMap,hn=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("event",n=>{const r=t.shift();r?r.resolve(n):e.push(n)}),this.on("end",()=>{n=!0;for(const e of t)e.resolve(void 0);t.length=0}),this.on("abort",e=>{n=!0;for(const n of t)n.reject(e);t.length=0}),this.on("error",e=>{n=!0;for(const n of t)n.reject(e);t.length=0}),{next:async()=>{if(!e.length)return n?{value:void 0,done:!0}:new Promise((e,n)=>t.push({resolve:e,reject:n})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0});return{value:e.shift(),done:!1}},return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new fn;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){const n=t?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),this._connected();const r=we.fromReadableStream(e,this.controller);for await(const a of r)s(this,hn,"m",On).call(this,a);if(r.controller.signal?.aborted)throw new d;return this._addRun(s(this,hn,"m",An).call(this))}toReadableStream(){return new we(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,n,r){const a=new fn;return a._run(()=>a._runToolAssistantStream(e,t,n,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createToolAssistantStream(e,t,n,r){const a=r?.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const i={...n,stream:!0},o=await e.submitToolOutputs(t,i,{...r,signal:this.controller.signal});this._connected();for await(const l of o)s(this,hn,"m",On).call(this,l);if(o.controller.signal?.aborted)throw new d;return this._addRun(s(this,hn,"m",An).call(this))}static createThreadAssistantStream(e,t,n){const r=new fn;return r._run(()=>r._threadAssistantStream(e,t,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),r}static createAssistantStream(e,t,n,r){const a=new fn;return a._run(()=>a._runAssistantStream(e,t,n,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),a}currentEvent(){return s(this,kn,"f")}currentRun(){return s(this,En,"f")}currentMessageSnapshot(){return s(this,yn,"f")}currentRunStepSnapshot(){return s(this,xn,"f")}async finalRunSteps(){return await this.done(),Object.values(s(this,mn,"f"))}async finalMessages(){return await this.done(),Object.values(s(this,gn,"f"))}async finalRun(){if(await this.done(),!s(this,bn,"f"))throw Error("Final run was not received.");return s(this,bn,"f")}async _createThreadAssistantStream(e,t,n){const r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort()));const a={...t,stream:!0},i=await e.createAndRun(a,{...n,signal:this.controller.signal});this._connected();for await(const o of i)s(this,hn,"m",On).call(this,o);if(i.controller.signal?.aborted)throw new d;return this._addRun(s(this,hn,"m",An).call(this))}async _createAssistantStream(e,t,n,r){const a=r?.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const i={...n,stream:!0},o=await e.create(t,i,{...r,signal:this.controller.signal});this._connected();for await(const l of o)s(this,hn,"m",On).call(this,l);if(o.controller.signal?.aborted)throw new d;return this._addRun(s(this,hn,"m",An).call(this))}static accumulateDelta(e,t){for(const[n,r]of Object.entries(t)){if(!e.hasOwnProperty(n)){e[n]=r;continue}let t=e[n];if(null!==t&&void 0!==t)if("index"!==n&&"type"!==n){if("string"===typeof t&&"string"===typeof r)t+=r;else if("number"===typeof t&&"number"===typeof r)t+=r;else{if(!I(t)||!I(r)){if(Array.isArray(t)&&Array.isArray(r)){if(t.every(e=>"string"===typeof e||"number"===typeof e)){t.push(...r);continue}for(const e of r){if(!I(e))throw new Error(`Expected array delta entry to be an object but got: ${e}`);const n=e.index;if(null==n)throw console.error(e),new Error("Expected array delta entry to have an `index` property");if("number"!==typeof n)throw new Error(`Expected array delta entry \`index\` property to be a number but got ${n}`);const r=t[n];null==r?t.push(e):t[n]=this.accumulateDelta(r,e)}continue}throw Error(`Unhandled record type: ${n}, deltaValue: ${r}, accValue: ${t}`)}t=this.accumulateDelta(t,r)}e[n]=t}else e[n]=r;else e[n]=r}return e}_addRun(e){return e}async _threadAssistantStream(e,t,n){return await this._createThreadAssistantStream(t,e,n)}async _runAssistantStream(e,t,n,r){return await this._createAssistantStream(t,e,n,r)}async _runToolAssistantStream(e,t,n,r){return await this._createToolAssistantStream(t,e,n,r)}}fn=qn,On=function(e){if(!this.ended)switch(a(this,kn,e,"f"),s(this,hn,"m",Tn).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":s(this,hn,"m",Nn).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":s(this,hn,"m",$n).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":s(this,hn,"m",In).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},An=function(){if(this.ended)throw new c("stream has ended, this shouldn't happen");if(!s(this,bn,"f"))throw Error("Final run has not been received");return s(this,bn,"f")},In=function(e){const[t,n]=s(this,hn,"m",Rn).call(this,e,s(this,yn,"f"));a(this,yn,t,"f"),s(this,gn,"f")[t.id]=t;for(const r of n){const e=t.content[r.index];"text"==e?.type&&this._emit("textCreated",e.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const n of e.data.delta.content){if("text"==n.type&&n.text){let e=n.text,r=t.content[n.index];if(!r||"text"!=r.type)throw Error("The snapshot associated with this text delta is not text or missing");this._emit("textDelta",e,r.text)}if(n.index!=s(this,vn,"f")){if(s(this,wn,"f"))switch(s(this,wn,"f").type){case"text":this._emit("textDone",s(this,wn,"f").text,s(this,yn,"f"));break;case"image_file":this._emit("imageFileDone",s(this,wn,"f").image_file,s(this,yn,"f"))}a(this,vn,n.index,"f")}a(this,wn,t.content[n.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(void 0!==s(this,vn,"f")){const t=e.data.content[s(this,vn,"f")];if(t)switch(t.type){case"image_file":this._emit("imageFileDone",t.image_file,s(this,yn,"f"));break;case"text":this._emit("textDone",t.text,s(this,yn,"f"))}}s(this,yn,"f")&&this._emit("messageDone",e.data),a(this,yn,void 0,"f")}},$n=function(e){const t=s(this,hn,"m",Pn).call(this,e);switch(a(this,xn,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const n=e.data.delta;if(n.step_details&&"tool_calls"==n.step_details.type&&n.step_details.tool_calls&&"tool_calls"==t.step_details.type)for(const e of n.step_details.tool_calls)e.index==s(this,_n,"f")?this._emit("toolCallDelta",e,t.step_details.tool_calls[e.index]):(s(this,Sn,"f")&&this._emit("toolCallDone",s(this,Sn,"f")),a(this,_n,e.index,"f"),a(this,Sn,t.step_details.tool_calls[e.index],"f"),s(this,Sn,"f")&&this._emit("toolCallCreated",s(this,Sn,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":a(this,xn,void 0,"f");"tool_calls"==e.data.step_details.type&&s(this,Sn,"f")&&(this._emit("toolCallDone",s(this,Sn,"f")),a(this,Sn,void 0,"f")),this._emit("runStepDone",e.data,t)}},Tn=function(e){s(this,pn,"f").push(e),this._emit("event",e)},Pn=function(e){switch(e.event){case"thread.run.step.created":return s(this,mn,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=s(this,mn,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let n=e.data;if(n.delta){const r=fn.accumulateDelta(t,n.delta);s(this,mn,"f")[e.data.id]=r}return s(this,mn,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":s(this,mn,"f")[e.data.id]=e.data}if(s(this,mn,"f")[e.data.id])return s(this,mn,"f")[e.data.id];throw new Error("No snapshot available")},Rn=function(e,t){let n=[];switch(e.event){case"thread.message.created":return[e.data,n];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let r=e.data;if(r.delta.content)for(const e of r.delta.content)if(e.index in t.content){let n=t.content[e.index];t.content[e.index]=s(this,hn,"m",Cn).call(this,e,n)}else t.content[e.index]=e,n.push(e);return[t,n];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,n];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},Cn=function(e,t){return fn.accumulateDelta(t,e)},Nn=function(e){switch(a(this,En,e.data,"f"),e.event){case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.cancelling":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":case"thread.run.incomplete":a(this,bn,e.data,"f"),s(this,Sn,"f")&&(this._emit("toolCallDone",s(this,Sn,"f")),a(this,Sn,void 0,"f"))}};class Hn extends Ue{constructor(){super(...arguments),this.steps=new un(this._client)}create(e,t,n){const{include:r,...a}=t;return this._client.post(He`/threads/${e}/runs`,{query:{include:r},body:a,...n,headers:Qt([{"OpenAI-Beta":"assistants=v2"},n?.headers]),stream:t.stream??!1})}retrieve(e,t,n){const{thread_id:r}=t;return this._client.get(He`/threads/${r}/runs/${e}`,{...n,headers:Qt([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}update(e,t,n){const{thread_id:r,...a}=t;return this._client.post(He`/threads/${r}/runs/${e}`,{body:a,...n,headers:Qt([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return this._client.getAPIList(He`/threads/${e}/runs`,Ie,{query:t,...n,headers:Qt([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}cancel(e,t,n){const{thread_id:r}=t;return this._client.post(He`/threads/${r}/runs/${e}/cancel`,{...n,headers:Qt([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async createAndPoll(e,t,n){const r=await this.create(e,t,n);return await this.poll(r.id,{thread_id:e},n)}createAndStream(e,t,n){return qn.createAssistantStream(e,this._client.beta.threads.runs,t,n)}async poll(e,t,n){const r=Qt([n?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){const{data:a,response:s}=await this.retrieve(e,t,{...n,headers:{...n?.headers,...r}}).withResponse();switch(a.status){case"queued":case"in_progress":case"cancelling":let e=5e3;if(n?.pollIntervalMs)e=n.pollIntervalMs;else{const t=s.headers.get("openai-poll-after-ms");if(t){const n=parseInt(t);isNaN(n)||(e=n)}}await $(e);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return a}}}stream(e,t,n){return qn.createAssistantStream(e,this._client.beta.threads.runs,t,n)}submitToolOutputs(e,t,n){const{thread_id:r,...a}=t;return this._client.post(He`/threads/${r}/runs/${e}/submit_tool_outputs`,{body:a,...n,headers:Qt([{"OpenAI-Beta":"assistants=v2"},n?.headers]),stream:t.stream??!1})}async submitToolOutputsAndPoll(e,t,n){const r=await this.submitToolOutputs(e,t,n);return await this.poll(r.id,t,n)}submitToolOutputsStream(e,t,n){return qn.createToolAssistantStream(e,this._client.beta.threads.runs,t,n)}}Hn.Steps=un;class Wn extends Ue{constructor(){super(...arguments),this.runs=new Hn(this._client),this.messages=new cn(this._client)}create(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return this._client.post("/threads",{body:e,...t,headers:Qt([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(He`/threads/${e}`,{...t,headers:Qt([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,n){return this._client.post(He`/threads/${e}`,{body:t,...n,headers:Qt([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}delete(e,t){return this._client.delete(He`/threads/${e}`,{...t,headers:Qt([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:Qt([{"OpenAI-Beta":"assistants=v2"},t?.headers]),stream:e.stream??!1})}async createAndRunPoll(e,t){const n=await this.createAndRun(e,t);return await this.runs.poll(n.id,{thread_id:n.thread_id},t)}createAndRunStream(e,t){return qn.createThreadAssistantStream(e,this._client.beta.threads,t)}}Wn.Runs=Hn,Wn.Messages=cn;class Vn extends Ue{constructor(){super(...arguments),this.realtime=new ln(this._client),this.assistants=new an(this._client),this.threads=new Wn(this._client)}}Vn.Realtime=ln,Vn.Assistants=an,Vn.Threads=Wn;class Zn extends Ue{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}class Gn extends Ue{retrieve(e,t,n){const{container_id:r}=t;return this._client.get(He`/containers/${r}/files/${e}/content`,{...n,headers:Qt([{Accept:"application/binary"},n?.headers]),__binaryResponse:!0})}}class Jn extends Ue{constructor(){super(...arguments),this.content=new Gn(this._client)}create(e,t,n){return this._client.post(He`/containers/${e}/files`,Ce({body:t,...n},this._client))}retrieve(e,t,n){const{container_id:r}=t;return this._client.get(He`/containers/${r}/files/${e}`,n)}list(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return this._client.getAPIList(He`/containers/${e}/files`,Ie,{query:t,...n})}delete(e,t,n){const{container_id:r}=t;return this._client.delete(He`/containers/${r}/files/${e}`,{...n,headers:Qt([{Accept:"*/*"},n?.headers])})}}Jn.Content=Gn;class Kn extends Ue{constructor(){super(...arguments),this.files=new Jn(this._client)}create(e,t){return this._client.post("/containers",{body:e,...t})}retrieve(e,t){return this._client.get(He`/containers/${e}`,t)}list(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return this._client.getAPIList("/containers",Ie,{query:e,...t})}delete(e,t){return this._client.delete(He`/containers/${e}`,{...t,headers:Qt([{Accept:"*/*"},t?.headers])})}}Kn.Files=Jn;class Xn extends Ue{create(e,t){const n=!!e.encoding_format;let r=n?e.encoding_format:"base64";n&&me(this._client).debug("embeddings/user defined encoding_format:",e.encoding_format);const a=this._client.post("/embeddings",{body:{...e,encoding_format:r},...t});return n?a:(me(this._client).debug("embeddings/decoding base64 embeddings from base64"),a._thenUnwrap(e=>(e&&e.data&&e.data.forEach(e=>{const t=e.embedding;e.embedding=(e=>{if("undefined"!==typeof Buffer){const t=Buffer.from(e,"base64");return Array.from(new Float32Array(t.buffer,t.byteOffset,t.length/Float32Array.BYTES_PER_ELEMENT))}{const t=atob(e),n=t.length,r=new Uint8Array(n);for(let e=0;e<n;e++)r[e]=t.charCodeAt(e);return Array.from(new Float32Array(r.buffer))}})(t)}),e)))}}class Qn extends Ue{retrieve(e,t,n){const{eval_id:r,run_id:a}=t;return this._client.get(He`/evals/${r}/runs/${a}/output_items/${e}`,n)}list(e,t,n){const{eval_id:r,...a}=t;return this._client.getAPIList(He`/evals/${r}/runs/${e}/output_items`,Ie,{query:a,...n})}}class Yn extends Ue{constructor(){super(...arguments),this.outputItems=new Qn(this._client)}create(e,t,n){return this._client.post(He`/evals/${e}/runs`,{body:t,...n})}retrieve(e,t,n){const{eval_id:r}=t;return this._client.get(He`/evals/${r}/runs/${e}`,n)}list(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return this._client.getAPIList(He`/evals/${e}/runs`,Ie,{query:t,...n})}delete(e,t,n){const{eval_id:r}=t;return this._client.delete(He`/evals/${r}/runs/${e}`,n)}cancel(e,t,n){const{eval_id:r}=t;return this._client.post(He`/evals/${r}/runs/${e}`,n)}}Yn.OutputItems=Qn;class er extends Ue{constructor(){super(...arguments),this.runs=new Yn(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(He`/evals/${e}`,t)}update(e,t,n){return this._client.post(He`/evals/${e}`,{body:t,...n})}list(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return this._client.getAPIList("/evals",Ie,{query:e,...t})}delete(e,t){return this._client.delete(He`/evals/${e}`,t)}}er.Runs=Yn;class tr extends Ue{create(e,t){return this._client.post("/files",Ce({body:e,...t},this._client))}retrieve(e,t){return this._client.get(He`/files/${e}`,t)}list(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return this._client.getAPIList("/files",Ie,{query:e,...t})}delete(e,t){return this._client.delete(He`/files/${e}`,t)}content(e,t){return this._client.get(He`/files/${e}/content`,{...t,headers:Qt([{Accept:"application/binary"},t?.headers]),__binaryResponse:!0})}async waitForProcessing(e){let{pollInterval:t=5e3,maxWait:n=18e5}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=new Set(["processed","error","deleted"]),a=Date.now();let s=await this.retrieve(e);for(;!s.status||!r.has(s.status);)if(await $(t),s=await this.retrieve(e),Date.now()-a>n)throw new f({message:`Giving up on waiting for file ${e} to finish processing after ${n} milliseconds.`});return s}}class nr extends Ue{}class rr extends Ue{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}}class ar extends Ue{constructor(){super(...arguments),this.graders=new rr(this._client)}}ar.Graders=rr;class sr extends Ue{create(e,t,n){return this._client.getAPIList(He`/fine_tuning/checkpoints/${e}/permissions`,Ae,{body:t,method:"post",...n})}retrieve(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return this._client.get(He`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...n})}delete(e,t,n){const{fine_tuned_model_checkpoint:r}=t;return this._client.delete(He`/fine_tuning/checkpoints/${r}/permissions/${e}`,n)}}class ir extends Ue{constructor(){super(...arguments),this.permissions=new sr(this._client)}}ir.Permissions=sr;class or extends Ue{list(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return this._client.getAPIList(He`/fine_tuning/jobs/${e}/checkpoints`,Ie,{query:t,...n})}}class lr extends Ue{constructor(){super(...arguments),this.checkpoints=new or(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(He`/fine_tuning/jobs/${e}`,t)}list(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return this._client.getAPIList("/fine_tuning/jobs",Ie,{query:e,...t})}cancel(e,t){return this._client.post(He`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return this._client.getAPIList(He`/fine_tuning/jobs/${e}/events`,Ie,{query:t,...n})}pause(e,t){return this._client.post(He`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post(He`/fine_tuning/jobs/${e}/resume`,t)}}lr.Checkpoints=or;class cr extends Ue{constructor(){super(...arguments),this.methods=new nr(this._client),this.jobs=new lr(this._client),this.checkpoints=new ir(this._client),this.alpha=new ar(this._client)}}cr.Methods=nr,cr.Jobs=lr,cr.Checkpoints=ir,cr.Alpha=ar;class ur extends Ue{}class dr extends Ue{constructor(){super(...arguments),this.graderModels=new ur(this._client)}}dr.GraderModels=ur;class hr extends Ue{createVariation(e,t){return this._client.post("/images/variations",Ce({body:e,...t},this._client))}edit(e,t){return this._client.post("/images/edits",Ce({body:e,...t},this._client))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}class fr extends Ue{retrieve(e,t){return this._client.get(He`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",Ae,e)}delete(e,t){return this._client.delete(He`/models/${e}`,t)}}class pr extends Ue{create(e,t){return this._client.post("/moderations",{body:e,...t})}}function mr(e,t){return t&&function(e){if(yt(e.text?.format))return!0;return!1}(t)?gr(e,t):{...e,output_parsed:null,output:e.output.map(e=>"function_call"===e.type?{...e,parsed_arguments:null}:"message"===e.type?{...e,content:e.content.map(e=>({...e,parsed:null}))}:e)}}function gr(e,t){const n=e.output.map(e=>{if("function_call"===e.type)return{...e,parsed_arguments:wr(t,e)};if("message"===e.type){const n=e.content.map(e=>"output_text"===e.type?{...e,parsed:yr(t,e.text)}:e);return{...e,content:n}}return e}),r=Object.assign({},e,{output:n});return Object.getOwnPropertyDescriptor(e,"output_text")||_r(r),Object.defineProperty(r,"output_parsed",{enumerable:!0,get(){for(const e of r.output)if("message"===e.type)for(const t of e.content)if("output_text"===t.type&&null!==t.parsed)return t.parsed;return null}}),r}function yr(e,t){if("json_schema"!==e.text?.format?.type)return null;if("$parseRaw"in e.text?.format){const n=e.text?.format;return n.$parseRaw(t)}return JSON.parse(t)}function br(e){return"auto-parseable-tool"===e?.$brand}function vr(e,t){return e.find(e=>"function"===e.type&&e.name===t)}function wr(e,t){const n=vr(e.tools??[],t.name);return{...t,...t,parsed_arguments:br(n)?n.$parseRaw(t.arguments):n?.strict?JSON.parse(t.arguments):null}}function _r(e){const t=[];for(const n of e.output)if("message"===n.type)for(const e of n.content)"output_text"===e.type&&t.push(e.text);e.output_text=t.join("")}class Sr extends gt{constructor(e){super(),jn.add(this),Ln.set(this,void 0),Mn.set(this,void 0),Dn.set(this,void 0),a(this,Ln,e,"f")}static createResponse(e,t,n){const r=new Sr(t);return r._run(()=>r._createOrRetrieveResponse(e,t,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),r}async _createOrRetrieveResponse(e,t,n){const r=n?.signal;let a;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),s(this,jn,"m",zn).call(this);let i=null;"response_id"in t?(a=await e.responses.retrieve(t.response_id,{stream:!0},{...n,signal:this.controller.signal,stream:!0}),i=t.starting_after??null):a=await e.responses.create({...t,stream:!0},{...n,signal:this.controller.signal}),this._connected();for await(const o of a)s(this,jn,"m",Un).call(this,o,i);if(a.controller.signal?.aborted)throw new d;return s(this,jn,"m",Fn).call(this)}[(Ln=new WeakMap,Mn=new WeakMap,Dn=new WeakMap,jn=new WeakSet,zn=function(){this.ended||a(this,Mn,void 0,"f")},Un=function(e,t){if(this.ended)return;const n=(e,n)=>{(null==t||n.sequence_number>t)&&this._emit(e,n)},r=s(this,jn,"m",Bn).call(this,e);switch(n("event",e),e.type){case"response.output_text.delta":{const t=r.output[e.output_index];if(!t)throw new c(`missing output at index ${e.output_index}`);if("message"===t.type){const r=t.content[e.content_index];if(!r)throw new c(`missing content at index ${e.content_index}`);if("output_text"!==r.type)throw new c(`expected content to be 'output_text', got ${r.type}`);n("response.output_text.delta",{...e,snapshot:r.text})}break}case"response.function_call_arguments.delta":{const t=r.output[e.output_index];if(!t)throw new c(`missing output at index ${e.output_index}`);"function_call"===t.type&&n("response.function_call_arguments.delta",{...e,snapshot:t.arguments});break}default:n(e.type,e)}},Fn=function(){if(this.ended)throw new c("stream has ended, this shouldn't happen");const e=s(this,Mn,"f");if(!e)throw new c("request ended without sending any events");a(this,Mn,void 0,"f");const t=function(e,t){return mr(e,t)}(e,s(this,Ln,"f"));return a(this,Dn,t,"f"),t},Bn=function(e){let t=s(this,Mn,"f");if(!t){if("response.created"!==e.type)throw new c(`When snapshot hasn't been set yet, expected 'response.created' event, got ${e.type}`);return t=a(this,Mn,e.response,"f"),t}switch(e.type){case"response.output_item.added":t.output.push(e.item);break;case"response.content_part.added":{const n=t.output[e.output_index];if(!n)throw new c(`missing output at index ${e.output_index}`);"message"===n.type&&n.content.push(e.part);break}case"response.output_text.delta":{const n=t.output[e.output_index];if(!n)throw new c(`missing output at index ${e.output_index}`);if("message"===n.type){const t=n.content[e.content_index];if(!t)throw new c(`missing content at index ${e.content_index}`);if("output_text"!==t.type)throw new c(`expected content to be 'output_text', got ${t.type}`);t.text+=e.delta}break}case"response.function_call_arguments.delta":{const n=t.output[e.output_index];if(!n)throw new c(`missing output at index ${e.output_index}`);"function_call"===n.type&&(n.arguments+=e.delta);break}case"response.completed":a(this,Mn,e.response,"f")}return t},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("event",n=>{const r=t.shift();r?r.resolve(n):e.push(n)}),this.on("end",()=>{n=!0;for(const e of t)e.resolve(void 0);t.length=0}),this.on("abort",e=>{n=!0;for(const n of t)n.reject(e);t.length=0}),this.on("error",e=>{n=!0;for(const n of t)n.reject(e);t.length=0}),{next:async()=>{if(!e.length)return n?{value:void 0,done:!0}:new Promise((e,n)=>t.push({resolve:e,reject:n})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0});return{value:e.shift(),done:!1}},return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();const e=s(this,Dn,"f");if(!e)throw new c("stream ended without producing a ChatCompletion");return e}}class kr extends Ue{list(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return this._client.getAPIList(He`/responses/${e}/input_items`,Ie,{query:t,...n})}}class Er extends Ue{constructor(){super(...arguments),this.inputItems=new kr(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap(e=>("object"in e&&"response"===e.object&&_r(e),e))}retrieve(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return this._client.get(He`/responses/${e}`,{query:t,...n,stream:t?.stream??!1})._thenUnwrap(e=>("object"in e&&"response"===e.object&&_r(e),e))}delete(e,t){return this._client.delete(He`/responses/${e}`,{...t,headers:Qt([{Accept:"*/*"},t?.headers])})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(t=>gr(t,e))}stream(e,t){return Sr.createResponse(this._client,e,t)}cancel(e,t){return this._client.post(He`/responses/${e}/cancel`,t)}}Er.InputItems=kr;class xr extends Ue{create(e,t,n){return this._client.post(He`/uploads/${e}/parts`,Ce({body:t,...n},this._client))}}class Or extends Ue{constructor(){super(...arguments),this.parts=new xr(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(He`/uploads/${e}/cancel`,t)}complete(e,t,n){return this._client.post(He`/uploads/${e}/complete`,{body:t,...n})}}Or.Parts=xr;class Ar extends Ue{create(e,t,n){return this._client.post(He`/vector_stores/${e}/file_batches`,{body:t,...n,headers:Qt([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}retrieve(e,t,n){const{vector_store_id:r}=t;return this._client.get(He`/vector_stores/${r}/file_batches/${e}`,{...n,headers:Qt([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}cancel(e,t,n){const{vector_store_id:r}=t;return this._client.post(He`/vector_stores/${r}/file_batches/${e}/cancel`,{...n,headers:Qt([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async createAndPoll(e,t,n){const r=await this.create(e,t);return await this.poll(e,r.id,n)}listFiles(e,t,n){const{vector_store_id:r,...a}=t;return this._client.getAPIList(He`/vector_stores/${r}/file_batches/${e}/files`,Ie,{query:a,...n,headers:Qt([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async poll(e,t,n){const r=Qt([n?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){const{data:a,response:s}=await this.retrieve(t,{vector_store_id:e},{...n,headers:r}).withResponse();switch(a.status){case"in_progress":let e=5e3;if(n?.pollIntervalMs)e=n.pollIntervalMs;else{const t=s.headers.get("openai-poll-after-ms");if(t){const n=parseInt(t);isNaN(n)||(e=n)}}await $(e);break;case"failed":case"cancelled":case"completed":return a}}}async uploadAndPoll(e,t,n){let{files:r,fileIds:a=[]}=t;if(null==r||0==r.length)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const s=n?.maxConcurrency??5,i=Math.min(s,r.length),o=this._client,l=r.values(),c=[...a];const u=Array(i).fill(l).map(async function(e){for(let t of e){const e=await o.files.create({file:t,purpose:"assistants"},n);c.push(e.id)}});return await(async e=>{const t=await Promise.allSettled(e),n=t.filter(e=>"rejected"===e.status);if(n.length){for(const e of n)console.error(e.reason);throw new Error(`${n.length} promise(s) failed - see the above errors`)}const r=[];for(const a of t)"fulfilled"===a.status&&r.push(a.value);return r})(u),await this.createAndPoll(e,{file_ids:c})}}class Ir extends Ue{create(e,t,n){return this._client.post(He`/vector_stores/${e}/files`,{body:t,...n,headers:Qt([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}retrieve(e,t,n){const{vector_store_id:r}=t;return this._client.get(He`/vector_stores/${r}/files/${e}`,{...n,headers:Qt([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}update(e,t,n){const{vector_store_id:r,...a}=t;return this._client.post(He`/vector_stores/${r}/files/${e}`,{body:a,...n,headers:Qt([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return this._client.getAPIList(He`/vector_stores/${e}/files`,Ie,{query:t,...n,headers:Qt([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}delete(e,t,n){const{vector_store_id:r}=t;return this._client.delete(He`/vector_stores/${r}/files/${e}`,{...n,headers:Qt([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async createAndPoll(e,t,n){const r=await this.create(e,t,n);return await this.poll(e,r.id,n)}async poll(e,t,n){const r=Qt([n?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){const a=await this.retrieve(t,{vector_store_id:e},{...n,headers:r}).withResponse(),s=a.data;switch(s.status){case"in_progress":let e=5e3;if(n?.pollIntervalMs)e=n.pollIntervalMs;else{const t=a.response.headers.get("openai-poll-after-ms");if(t){const n=parseInt(t);isNaN(n)||(e=n)}}await $(e);break;case"failed":case"completed":return s}}}async upload(e,t,n){const r=await this._client.files.create({file:t,purpose:"assistants"},n);return this.create(e,{file_id:r.id},n)}async uploadAndPoll(e,t,n){const r=await this.upload(e,t,n);return await this.poll(e,r.id,n)}content(e,t,n){const{vector_store_id:r}=t;return this._client.getAPIList(He`/vector_stores/${r}/files/${e}/content`,Ae,{...n,headers:Qt([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}}class $r extends Ue{constructor(){super(...arguments),this.files=new Ir(this._client),this.fileBatches=new Ar(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:Qt([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(He`/vector_stores/${e}`,{...t,headers:Qt([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,n){return this._client.post(He`/vector_stores/${e}`,{body:t,...n,headers:Qt([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return this._client.getAPIList("/vector_stores",Ie,{query:e,...t,headers:Qt([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete(He`/vector_stores/${e}`,{...t,headers:Qt([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}search(e,t,n){return this._client.getAPIList(He`/vector_stores/${e}/search`,Ae,{body:t,method:"post",...n,headers:Qt([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}}var Tr,Pr,Rr,Cr,Nr,jr,Lr;$r.Files=Ir,$r.FileBatches=Ar;class Mr extends Ue{constructor(){super(...arguments),Tr.add(this)}async unwrap(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._client.webhookSecret,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:300;return await this.verifySignature(e,t,n,r),JSON.parse(e)}async verifySignature(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._client.webhookSecret,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:300;if("undefined"===typeof crypto||"function"!==typeof crypto.subtle.importKey||"function"!==typeof crypto.subtle.verify)throw new Error("Webhook signature verification is only supported when the `crypto` global is defined");s(this,Tr,"m",Pr).call(this,n);const a=Qt([t]).values,i=s(this,Tr,"m",Rr).call(this,a,"webhook-signature"),o=s(this,Tr,"m",Rr).call(this,a,"webhook-timestamp"),l=s(this,Tr,"m",Rr).call(this,a,"webhook-id"),c=parseInt(o,10);if(isNaN(c))throw new E("Invalid webhook timestamp format");const u=Math.floor(Date.now()/1e3);if(u-c>r)throw new E("Webhook timestamp is too old");if(c>u+r)throw new E("Webhook timestamp is too new");const d=i.split(" ").map(e=>e.startsWith("v1,")?e.substring(3):e),h=n.startsWith("whsec_")?Buffer.from(n.replace("whsec_",""),"base64"):Buffer.from(n,"utf-8"),f=l?`${l}.${o}.${e}`:`${o}.${e}`,p=await crypto.subtle.importKey("raw",h,{name:"HMAC",hash:"SHA-256"},!1,["verify"]);for(const s of d)try{const e=Buffer.from(s,"base64");if(await crypto.subtle.verify("HMAC",p,e,(new TextEncoder).encode(f)))return}catch{continue}throw new E("The given webhook signature does not match the expected signature")}}Tr=new WeakSet,Pr=function(e){if("string"!==typeof e||0===e.length)throw new Error("The webhook secret must either be set using the env var, OPENAI_WEBHOOK_SECRET, on the client class, OpenAI({ webhookSecret: '123' }), or passed to this function")},Rr=function(e,t){if(!e)throw new Error("Headers are required");const n=e.get(t);if(null===n||void 0===n)throw new Error(`Missing required header: ${t}`);return n};class Dr{constructor(){let{baseURL:e=dn("OPENAI_BASE_URL"),apiKey:t=dn("OPENAI_API_KEY"),organization:n=dn("OPENAI_ORG_ID")??null,project:r=dn("OPENAI_PROJECT_ID")??null,webhookSecret:s=dn("OPENAI_WEBHOOK_SECRET")??null,...i}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(Cr.add(this),jr.set(this,void 0),this.completions=new Zn(this),this.chat=new Jt(this),this.embeddings=new Xn(this),this.files=new tr(this),this.images=new hr(this),this.audio=new nn(this),this.moderations=new pr(this),this.models=new fr(this),this.fineTuning=new cr(this),this.graders=new dr(this),this.vectorStores=new $r(this),this.webhooks=new Mr(this),this.beta=new Vn(this),this.batches=new rn(this),this.uploads=new Or(this),this.responses=new Er(this),this.evals=new er(this),this.containers=new Kn(this),void 0===t)throw new c("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const o={apiKey:t,organization:n,project:r,webhookSecret:s,...i,baseURL:e||"https://api.openai.com/v1"};if(!o.dangerouslyAllowBrowser&&"undefined"!==typeof window&&"undefined"!==typeof window.document&&"undefined"!==typeof navigator)throw new c("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew OpenAI({ apiKey, dangerouslyAllowBrowser: true });\n\nhttps://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety\n");this.baseURL=o.baseURL,this.timeout=o.timeout??Nr.DEFAULT_TIMEOUT,this.logger=o.logger??console;const l="warn";this.logLevel=l,this.logLevel=ue(o.logLevel,"ClientOptions.logLevel",this)??ue(dn("OPENAI_LOG"),"process.env['OPENAI_LOG']",this)??l,this.fetchOptions=o.fetchOptions,this.maxRetries=o.maxRetries??2,this.fetch=o.fetch??function(){if("undefined"!==typeof fetch)return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}(),a(this,jr,D,"f"),this._options=o,this.apiKey=t,this.organization=n,this.project=r,this.webhookSecret=s}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,organization:this.organization,project:this.project,webhookSecret:this.webhookSecret,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders(e){let{values:t,nulls:n}=e}authHeaders(e){return Qt([{Authorization:`Bearer ${this.apiKey}`}])}stringifyQuery(e){return Y(e,{arrayFormat:"brackets"})}getUserAgent(){return`${this.constructor.name}/JS ${T}`}defaultIdempotencyKey(){return`stainless-node-retry-${i()}`}makeStatusError(e,t,n,r){return u.generate(e,t,n,r)}buildURL(e,t,n){const r=!s(this,Cr,"m",Lr).call(this)&&n||this.baseURL,a=(e=>x.test(e))(e)?new URL(e):new URL(r+(r.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),i=this.defaultQuery();return function(e){if(!e)return!0;for(const t in e)return!1;return!0}(i)||(t={...i,...t}),"object"===typeof t&&t&&!Array.isArray(t)&&(a.search=this.stringifyQuery(t)),a.toString()}async prepareOptions(e){}async prepareRequest(e,t){let{url:n,options:r}=t}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then(n=>({method:e,path:t,...n})))}request(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new Ee(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,n){const r=await e,a=r.maxRetries??this.maxRetries;null==t&&(t=a),await this.prepareOptions(r);const{req:s,url:i,timeout:c}=this.buildRequest(r,{retryCount:a-t});await this.prepareRequest(s,{url:i,options:r});const u="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),p=void 0===n?"":`, retryOf: ${n}`,m=Date.now();if(me(this).debug(`[${u}] sending request`,ge({retryOfRequestLogID:n,method:r.method,url:i,options:r,headers:s.headers})),r.signal?.aborted)throw new d;const g=new AbortController,y=await this.fetchWithTimeout(i,s,c,g).catch(l),b=Date.now();if(y instanceof Error){const e=`retrying, ${t} attempts remaining`;if(r.signal?.aborted)throw new d;const a=o(y)||/timed? ?out/i.test(String(y)+("cause"in y?String(y.cause):""));if(t)return me(this).info(`[${u}] connection ${a?"timed out":"failed"} - ${e}`),me(this).debug(`[${u}] connection ${a?"timed out":"failed"} (${e})`,ge({retryOfRequestLogID:n,url:i,durationMs:b-m,message:y.message})),this.retryRequest(r,t,n??u);if(me(this).info(`[${u}] connection ${a?"timed out":"failed"} - error; no more retries left`),me(this).debug(`[${u}] connection ${a?"timed out":"failed"} (error; no more retries left)`,ge({retryOfRequestLogID:n,url:i,durationMs:b-m,message:y.message})),a)throw new f;throw new h({cause:y})}const v=`[${u}${p}${[...y.headers.entries()].filter(e=>{let[t]=e;return"x-request-id"===t}).map(e=>{let[t,n]=e;return", "+t+": "+JSON.stringify(n)}).join("")}] ${s.method} ${i} ${y.ok?"succeeded":"failed"} with status ${y.status} in ${b-m}ms`;if(!y.ok){const e=this.shouldRetry(y);if(t&&e){const e=`retrying, ${t} attempts remaining`;return await async function(e){if(null===e||"object"!==typeof e)return;if(e[Symbol.asyncIterator])return void await(e[Symbol.asyncIterator]().return?.());const t=e.getReader(),n=t.cancel();t.releaseLock(),await n}(y.body),me(this).info(`${v} - ${e}`),me(this).debug(`[${u}] response error (${e})`,ge({retryOfRequestLogID:n,url:y.url,status:y.status,headers:y.headers,durationMs:b-m})),this.retryRequest(r,t,n??u,y.headers)}const a=e?"error; no more retries left":"error; not retryable";me(this).info(`${v} - ${a}`);const s=await y.text().catch(e=>l(e).message),i=(e=>{try{return JSON.parse(e)}catch(t){return}})(s),o=i?void 0:s;me(this).debug(`[${u}] response error (${a})`,ge({retryOfRequestLogID:n,url:y.url,status:y.status,headers:y.headers,message:o,durationMs:Date.now()-m}));throw this.makeStatusError(y.status,i,o,y.headers)}return me(this).info(v),me(this).debug(`[${u}] response start`,ge({retryOfRequestLogID:n,url:y.url,status:y.status,headers:y.headers,durationMs:b-m})),{response:y,options:r,controller:g,requestLogID:u,retryOfRequestLogID:n,startTime:m}}getAPIList(e,t,n){return this.requestAPIList(t,{method:"get",path:e,...n})}requestAPIList(e,t){const n=this.makeRequest(t,null,void 0);return new Oe(this,n,e)}async fetchWithTimeout(e,t,n,r){const{signal:a,method:s,...i}=t||{};a&&a.addEventListener("abort",()=>r.abort());const o=setTimeout(()=>r.abort(),n),l=globalThis.ReadableStream&&i.body instanceof globalThis.ReadableStream||"object"===typeof i.body&&null!==i.body&&Symbol.asyncIterator in i.body,c={signal:r.signal,...l?{duplex:"half"}:{},method:"GET",...i};s&&(c.method=s.toUpperCase());try{return await this.fetch.call(void 0,e,c)}finally{clearTimeout(o)}}shouldRetry(e){const t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||(409===e.status||(429===e.status||e.status>=500)))}async retryRequest(e,t,n,r){let a;const s=r?.get("retry-after-ms");if(s){const e=parseFloat(s);Number.isNaN(e)||(a=e)}const i=r?.get("retry-after");if(i&&!a){const e=parseFloat(i);a=Number.isNaN(e)?Date.parse(i)-Date.now():1e3*e}if(!(a&&0<=a&&a<6e4)){const n=e.maxRetries??this.maxRetries;a=this.calculateDefaultRetryTimeoutMillis(t,n)}return await $(a),this.makeRequest(e,t-1,n)}calculateDefaultRetryTimeoutMillis(e,t){const n=t-e;return Math.min(.5*Math.pow(2,n),8)*(1-.25*Math.random())*1e3}buildRequest(e){let{retryCount:t=0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n={...e},{method:r,path:a,query:s,defaultBaseURL:i}=n,o=this.buildURL(a,s,i);"timeout"in n&&((e,t)=>{if("number"!==typeof t||!Number.isInteger(t))throw new c(`${e} must be an integer`);if(t<0)throw new c(`${e} must be a positive integer`)})("timeout",n.timeout),n.timeout=n.timeout??this.timeout;const{bodyHeaders:l,body:u}=this.buildBody({options:n});return{req:{method:r,headers:this.buildHeaders({options:e,method:r,bodyHeaders:l,retryCount:t}),...n.signal&&{signal:n.signal},...globalThis.ReadableStream&&u instanceof globalThis.ReadableStream&&{duplex:"half"},...u&&{body:u},...this.fetchOptions??{},...n.fetchOptions??{}},url:o,timeout:n.timeout}}buildHeaders(e){let{options:t,method:n,bodyHeaders:r,retryCount:a}=e,s={};this.idempotencyHeader&&"get"!==n&&(t.idempotencyKey||(t.idempotencyKey=this.defaultIdempotencyKey()),s[this.idempotencyHeader]=t.idempotencyKey);const i=Qt([s,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(a),...t.timeout?{"X-Stainless-Timeout":String(Math.trunc(t.timeout/1e3))}:{},...N??(N=P()),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project},this.authHeaders(t),this._options.defaultHeaders,r,t.headers]);return this.validateHeaders(i),i.values}buildBody(e){let{options:{body:t,headers:n}}=e;if(!t)return{bodyHeaders:void 0,body:void 0};const r=Qt([n]);return ArrayBuffer.isView(t)||t instanceof ArrayBuffer||t instanceof DataView||"string"===typeof t&&r.values.has("content-type")||t instanceof Blob||t instanceof FormData||t instanceof URLSearchParams||globalThis.ReadableStream&&t instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:t}:"object"===typeof t&&(Symbol.asyncIterator in t||Symbol.iterator in t&&"next"in t&&"function"===typeof t.next)?{bodyHeaders:void 0,body:L(t)}:s(this,jr,"f").call(this,{body:t,headers:r})}}Nr=Dr,jr=new WeakMap,Cr=new WeakSet,Lr=function(){return"https://api.openai.com/v1"!==this.baseURL},Dr.OpenAI=Nr,Dr.DEFAULT_TIMEOUT=6e5,Dr.OpenAIError=c,Dr.APIError=u,Dr.APIConnectionError=h,Dr.APIConnectionTimeoutError=f,Dr.APIUserAbortError=d,Dr.NotFoundError=y,Dr.ConflictError=b,Dr.RateLimitError=w,Dr.BadRequestError=p,Dr.AuthenticationError=m,Dr.InternalServerError=_,Dr.PermissionDeniedError=g,Dr.UnprocessableEntityError=v,Dr.InvalidWebhookSignatureError=E,Dr.toFile=async function(e,t,n){if($e(),(e=>null!=e&&"object"===typeof e&&"string"===typeof e.name&&"number"===typeof e.lastModified&&De(e))(e=await e))return e instanceof File?e:Te([await e.arrayBuffer()],e.name);if((e=>null!=e&&"object"===typeof e&&"string"===typeof e.url&&"function"===typeof e.blob)(e)){const r=await e.blob();return t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()),Te(await ze(r),t,n)}const r=await ze(e);if(t||(t=Pe(e)),!n?.type){const e=r.find(e=>"object"===typeof e&&"type"in e&&e.type);"string"===typeof e&&(n={...n,type:e})}return Te(r,t,n)},Dr.Completions=Zn,Dr.Chat=Jt,Dr.Embeddings=Xn,Dr.Files=tr,Dr.Images=hr,Dr.Audio=nn,Dr.Moderations=pr,Dr.Models=fr,Dr.FineTuning=cr,Dr.Graders=dr,Dr.VectorStores=$r,Dr.Webhooks=Mr,Dr.Beta=Vn,Dr.Batches=rn,Dr.Uploads=Or,Dr.Responses=Er,Dr.Evals=er,Dr.Containers=Kn;new Set(["/completions","/chat/completions","/embeddings","/audio/transcriptions","/audio/translations","/audio/speech","/images/generations","/batches","/images/edits"]);class zr{constructor(e){Object.defineProperty(this,"pageContent",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.pageContent=void 0!==e.pageContent?e.pageContent.toString():"",this.metadata=e.metadata??{},this.id=e.id}}var Ur,Fr;!function(e){e.assertEqual=e=>{},e.assertIs=function(e){},e.assertNever=function(e){throw new Error},e.arrayToEnum=e=>{const t={};for(const n of e)t[n]=n;return t},e.getValidEnumValues=t=>{const n=e.objectKeys(t).filter(e=>"number"!==typeof t[t[e]]),r={};for(const e of n)r[e]=t[e];return e.objectValues(r)},e.objectValues=t=>e.objectKeys(t).map(function(e){return t[e]}),e.objectKeys="function"===typeof Object.keys?e=>Object.keys(e):e=>{const t=[];for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t},e.find=(e,t)=>{for(const n of e)if(t(n))return n},e.isInteger="function"===typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"===typeof e&&Number.isFinite(e)&&Math.floor(e)===e,e.joinValues=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:" | ";return e.map(e=>"string"===typeof e?`'${e}'`:e).join(t)},e.jsonStringifyReplacer=(e,t)=>"bigint"===typeof t?t.toString():t}(Ur||(Ur={})),function(e){e.mergeShapes=(e,t)=>({...e,...t})}(Fr||(Fr={}));const Br=Ur.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),qr=e=>{switch(typeof e){case"undefined":return Br.undefined;case"string":return Br.string;case"number":return Number.isNaN(e)?Br.nan:Br.number;case"boolean":return Br.boolean;case"function":return Br.function;case"bigint":return Br.bigint;case"symbol":return Br.symbol;case"object":return Array.isArray(e)?Br.array:null===e?Br.null:e.then&&"function"===typeof e.then&&e.catch&&"function"===typeof e.catch?Br.promise:"undefined"!==typeof Map&&e instanceof Map?Br.map:"undefined"!==typeof Set&&e instanceof Set?Br.set:"undefined"!==typeof Date&&e instanceof Date?Br.date:Br.object;default:return Br.unknown}},Hr=Ur.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class Wr extends Error{get errors(){return this.issues}constructor(e){var t;super(),t=this,this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];t.issues=[...t.issues,...e]};const n=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,n):this.__proto__=n,this.name="ZodError",this.issues=e}format(e){const t=e||function(e){return e.message},n={_errors:[]},r=e=>{for(const a of e.issues)if("invalid_union"===a.code)a.unionErrors.map(r);else if("invalid_return_type"===a.code)r(a.returnTypeError);else if("invalid_arguments"===a.code)r(a.argumentsError);else if(0===a.path.length)n._errors.push(t(a));else{let e=n,r=0;for(;r<a.path.length;){const n=a.path[r];r===a.path.length-1?(e[n]=e[n]||{_errors:[]},e[n]._errors.push(t(a))):e[n]=e[n]||{_errors:[]},e=e[n],r++}}};return r(this),n}static assert(e){if(!(e instanceof Wr))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Ur.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e=>e.message;const t={},n=[];for(const r of this.issues)if(r.path.length>0){const n=r.path[0];t[n]=t[n]||[],t[n].push(e(r))}else n.push(e(r));return{formErrors:n,fieldErrors:t}}get formErrors(){return this.flatten()}}Wr.create=e=>new Wr(e);const Vr=(e,t)=>{let n;switch(e.code){case Hr.invalid_type:n=e.received===Br.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case Hr.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(e.expected,Ur.jsonStringifyReplacer)}`;break;case Hr.unrecognized_keys:n=`Unrecognized key(s) in object: ${Ur.joinValues(e.keys,", ")}`;break;case Hr.invalid_union:n="Invalid input";break;case Hr.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${Ur.joinValues(e.options)}`;break;case Hr.invalid_enum_value:n=`Invalid enum value. Expected ${Ur.joinValues(e.options)}, received '${e.received}'`;break;case Hr.invalid_arguments:n="Invalid function arguments";break;case Hr.invalid_return_type:n="Invalid function return type";break;case Hr.invalid_date:n="Invalid date";break;case Hr.invalid_string:"object"===typeof e.validation?"includes"in e.validation?(n=`Invalid input: must include "${e.validation.includes}"`,"number"===typeof e.validation.position&&(n=`${n} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?n=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?n=`Invalid input: must end with "${e.validation.endsWith}"`:Ur.assertNever(e.validation):n="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case Hr.too_small:n="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type||"bigint"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case Hr.too_big:n="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case Hr.custom:n="Invalid input";break;case Hr.invalid_intersection_types:n="Intersection results could not be merged";break;case Hr.not_multiple_of:n=`Number must be a multiple of ${e.multipleOf}`;break;case Hr.not_finite:n="Number must be finite";break;default:n=t.defaultError,Ur.assertNever(e)}return{message:n}};let Zr=Vr;function Gr(){return Zr}var Jr;!function(e){e.errToObj=e=>"string"===typeof e?{message:e}:e||{},e.toString=e=>"string"===typeof e?e:e?.message}(Jr||(Jr={}));const Kr=e=>{const{data:t,path:n,errorMaps:r,issueData:a}=e,s=[...n,...a.path||[]],i={...a,path:s};if(void 0!==a.message)return{...a,path:s,message:a.message};let o="";const l=r.filter(e=>!!e).slice().reverse();for(const c of l)o=c(i,{data:t,defaultError:o}).message;return{...a,path:s,message:o}};function Xr(e,t){const n=Gr(),r=Kr({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,n,n===Vr?void 0:Vr].filter(e=>!!e)});e.common.issues.push(r)}class Qr{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){const n=[];for(const r of t){if("aborted"===r.status)return Yr;"dirty"===r.status&&e.dirty(),n.push(r.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,t){const n=[];for(const r of t){const e=await r.key,t=await r.value;n.push({key:e,value:t})}return Qr.mergeObjectSync(e,n)}static mergeObjectSync(e,t){const n={};for(const r of t){const{key:t,value:a}=r;if("aborted"===t.status)return Yr;if("aborted"===a.status)return Yr;"dirty"===t.status&&e.dirty(),"dirty"===a.status&&e.dirty(),"__proto__"===t.value||"undefined"===typeof a.value&&!r.alwaysSet||(n[t.value]=a.value)}return{status:e.value,value:n}}}const Yr=Object.freeze({status:"aborted"}),ea=e=>({status:"dirty",value:e}),ta=e=>({status:"valid",value:e}),na=e=>"aborted"===e.status,ra=e=>"dirty"===e.status,aa=e=>"valid"===e.status,sa=e=>"undefined"!==typeof Promise&&e instanceof Promise;class ia{constructor(e,t,n,r){this._cachedPath=[],this.parent=e,this.data=t,this._path=n,this._key=r}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const oa=(e,t)=>{if(aa(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new Wr(e.common.issues);return this._error=t,this._error}}};function la(e){if(!e)return{};const{errorMap:t,invalid_type_error:n,required_error:r,description:a}=e;if(t&&(n||r))throw new Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');if(t)return{errorMap:t,description:a};return{errorMap:(t,a)=>{const{message:s}=e;return"invalid_enum_value"===t.code?{message:s??a.defaultError}:"undefined"===typeof a.data?{message:s??r??a.defaultError}:"invalid_type"!==t.code?{message:a.defaultError}:{message:s??n??a.defaultError}},description:a}}class ca{get description(){return this._def.description}_getType(e){return qr(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:qr(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Qr,ctx:{common:e.parent.common,data:e.data,parsedType:qr(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(sa(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const n=this.safeParse(e,t);if(n.success)return n.data;throw n.error}safeParse(e,t){const n={common:{issues:[],async:t?.async??!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:qr(e)},r=this._parseSync({data:e,path:n.path,parent:n});return oa(n,r)}"~validate"(e){const t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:qr(e)};if(!this["~standard"].async)try{const n=this._parseSync({data:e,path:[],parent:t});return aa(n)?{value:n.value}:{issues:t.common.issues}}catch(n){n?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(e=>aa(e)?{value:e.value}:{issues:t.common.issues})}async parseAsync(e,t){const n=await this.safeParseAsync(e,t);if(n.success)return n.data;throw n.error}async safeParseAsync(e,t){const n={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:qr(e)},r=this._parse({data:e,path:n.path,parent:n}),a=await(sa(r)?r:Promise.resolve(r));return oa(n,a)}refine(e,t){const n=e=>"string"===typeof t||"undefined"===typeof t?{message:t}:"function"===typeof t?t(e):t;return this._refinement((t,r)=>{const a=e(t),s=()=>r.addIssue({code:Hr.custom,...n(t)});return"undefined"!==typeof Promise&&a instanceof Promise?a.then(e=>!!e||(s(),!1)):!!a||(s(),!1)})}refinement(e,t){return this._refinement((n,r)=>!!e(n)||(r.addIssue("function"===typeof t?t(n,r):t),!1))}_refinement(e){return new os({schema:this,typeName:gs.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return ls.create(this,this._def)}nullable(){return cs.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Va.create(this)}promise(){return is.create(this,this._def)}or(e){return Ja.create([this,e],this._def)}and(e){return Xa.create(this,e,this._def)}transform(e){return new os({...la(this._def),schema:this,typeName:gs.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t="function"===typeof e?e:()=>e;return new us({...la(this._def),innerType:this,defaultValue:t,typeName:gs.ZodDefault})}brand(){return new fs({typeName:gs.ZodBranded,type:this,...la(this._def)})}catch(e){const t="function"===typeof e?e:()=>e;return new ds({...la(this._def),innerType:this,catchValue:t,typeName:gs.ZodCatch})}describe(e){return new(0,this.constructor)({...this._def,description:e})}pipe(e){return ps.create(this,e)}readonly(){return ms.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const ua=/^c[^\s-]{8,}$/i,da=/^[0-9a-z]+$/,ha=/^[0-9A-HJKMNP-TV-Z]{26}$/i,fa=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,pa=/^[a-z0-9_-]{21}$/i,ma=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,ga=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,ya=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i;let ba;const va=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,wa=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,_a=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,Sa=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,ka=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Ea=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,xa="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Oa=new RegExp(`^${xa}$`);function Aa(e){let t="[0-5]\\d";e.precision?t=`${t}\\.\\d{${e.precision}}`:null==e.precision&&(t=`${t}(\\.\\d+)?`);return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${e.precision?"+":"?"}`}function Ia(e){return new RegExp(`^${Aa(e)}$`)}function $a(e){let t=`${xa}T${Aa(e)}`;const n=[];return n.push(e.local?"Z?":"Z"),e.offset&&n.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${n.join("|")})`,new RegExp(`^${t}$`)}function Ta(e,t){return!("v4"!==t&&t||!va.test(e))||!("v6"!==t&&t||!_a.test(e))}function Pa(e,t){if(!ma.test(e))return!1;try{const[n]=e.split(".");if(!n)return!1;const r=n.replace(/-/g,"+").replace(/_/g,"/").padEnd(n.length+(4-n.length%4)%4,"="),a=JSON.parse(atob(r));return"object"===typeof a&&null!==a&&((!("typ"in a)||"JWT"===a?.typ)&&(!!a.alg&&(!t||a.alg===t)))}catch{return!1}}function Ra(e,t){return!("v4"!==t&&t||!wa.test(e))||!("v6"!==t&&t||!Sa.test(e))}class Ca extends ca{_parse(e){this._def.coerce&&(e.data=String(e.data));if(this._getType(e)!==Br.string){const t=this._getOrReturnCtx(e);return Xr(t,{code:Hr.invalid_type,expected:Br.string,received:t.parsedType}),Yr}const t=new Qr;let n;for(const r of this._def.checks)if("min"===r.kind)e.data.length<r.value&&(n=this._getOrReturnCtx(e,n),Xr(n,{code:Hr.too_small,minimum:r.value,type:"string",inclusive:!0,exact:!1,message:r.message}),t.dirty());else if("max"===r.kind)e.data.length>r.value&&(n=this._getOrReturnCtx(e,n),Xr(n,{code:Hr.too_big,maximum:r.value,type:"string",inclusive:!0,exact:!1,message:r.message}),t.dirty());else if("length"===r.kind){const a=e.data.length>r.value,s=e.data.length<r.value;(a||s)&&(n=this._getOrReturnCtx(e,n),a?Xr(n,{code:Hr.too_big,maximum:r.value,type:"string",inclusive:!0,exact:!0,message:r.message}):s&&Xr(n,{code:Hr.too_small,minimum:r.value,type:"string",inclusive:!0,exact:!0,message:r.message}),t.dirty())}else if("email"===r.kind)ya.test(e.data)||(n=this._getOrReturnCtx(e,n),Xr(n,{validation:"email",code:Hr.invalid_string,message:r.message}),t.dirty());else if("emoji"===r.kind)ba||(ba=new RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),ba.test(e.data)||(n=this._getOrReturnCtx(e,n),Xr(n,{validation:"emoji",code:Hr.invalid_string,message:r.message}),t.dirty());else if("uuid"===r.kind)fa.test(e.data)||(n=this._getOrReturnCtx(e,n),Xr(n,{validation:"uuid",code:Hr.invalid_string,message:r.message}),t.dirty());else if("nanoid"===r.kind)pa.test(e.data)||(n=this._getOrReturnCtx(e,n),Xr(n,{validation:"nanoid",code:Hr.invalid_string,message:r.message}),t.dirty());else if("cuid"===r.kind)ua.test(e.data)||(n=this._getOrReturnCtx(e,n),Xr(n,{validation:"cuid",code:Hr.invalid_string,message:r.message}),t.dirty());else if("cuid2"===r.kind)da.test(e.data)||(n=this._getOrReturnCtx(e,n),Xr(n,{validation:"cuid2",code:Hr.invalid_string,message:r.message}),t.dirty());else if("ulid"===r.kind)ha.test(e.data)||(n=this._getOrReturnCtx(e,n),Xr(n,{validation:"ulid",code:Hr.invalid_string,message:r.message}),t.dirty());else if("url"===r.kind)try{new URL(e.data)}catch{n=this._getOrReturnCtx(e,n),Xr(n,{validation:"url",code:Hr.invalid_string,message:r.message}),t.dirty()}else if("regex"===r.kind){r.regex.lastIndex=0;r.regex.test(e.data)||(n=this._getOrReturnCtx(e,n),Xr(n,{validation:"regex",code:Hr.invalid_string,message:r.message}),t.dirty())}else if("trim"===r.kind)e.data=e.data.trim();else if("includes"===r.kind)e.data.includes(r.value,r.position)||(n=this._getOrReturnCtx(e,n),Xr(n,{code:Hr.invalid_string,validation:{includes:r.value,position:r.position},message:r.message}),t.dirty());else if("toLowerCase"===r.kind)e.data=e.data.toLowerCase();else if("toUpperCase"===r.kind)e.data=e.data.toUpperCase();else if("startsWith"===r.kind)e.data.startsWith(r.value)||(n=this._getOrReturnCtx(e,n),Xr(n,{code:Hr.invalid_string,validation:{startsWith:r.value},message:r.message}),t.dirty());else if("endsWith"===r.kind)e.data.endsWith(r.value)||(n=this._getOrReturnCtx(e,n),Xr(n,{code:Hr.invalid_string,validation:{endsWith:r.value},message:r.message}),t.dirty());else if("datetime"===r.kind){$a(r).test(e.data)||(n=this._getOrReturnCtx(e,n),Xr(n,{code:Hr.invalid_string,validation:"datetime",message:r.message}),t.dirty())}else if("date"===r.kind){Oa.test(e.data)||(n=this._getOrReturnCtx(e,n),Xr(n,{code:Hr.invalid_string,validation:"date",message:r.message}),t.dirty())}else if("time"===r.kind){Ia(r).test(e.data)||(n=this._getOrReturnCtx(e,n),Xr(n,{code:Hr.invalid_string,validation:"time",message:r.message}),t.dirty())}else"duration"===r.kind?ga.test(e.data)||(n=this._getOrReturnCtx(e,n),Xr(n,{validation:"duration",code:Hr.invalid_string,message:r.message}),t.dirty()):"ip"===r.kind?Ta(e.data,r.version)||(n=this._getOrReturnCtx(e,n),Xr(n,{validation:"ip",code:Hr.invalid_string,message:r.message}),t.dirty()):"jwt"===r.kind?Pa(e.data,r.alg)||(n=this._getOrReturnCtx(e,n),Xr(n,{validation:"jwt",code:Hr.invalid_string,message:r.message}),t.dirty()):"cidr"===r.kind?Ra(e.data,r.version)||(n=this._getOrReturnCtx(e,n),Xr(n,{validation:"cidr",code:Hr.invalid_string,message:r.message}),t.dirty()):"base64"===r.kind?ka.test(e.data)||(n=this._getOrReturnCtx(e,n),Xr(n,{validation:"base64",code:Hr.invalid_string,message:r.message}),t.dirty()):"base64url"===r.kind?Ea.test(e.data)||(n=this._getOrReturnCtx(e,n),Xr(n,{validation:"base64url",code:Hr.invalid_string,message:r.message}),t.dirty()):Ur.assertNever(r);return{status:t.value,value:e.data}}_regex(e,t,n){return this.refinement(t=>e.test(t),{validation:t,code:Hr.invalid_string,...Jr.errToObj(n)})}_addCheck(e){return new Ca({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...Jr.errToObj(e)})}url(e){return this._addCheck({kind:"url",...Jr.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...Jr.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...Jr.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...Jr.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...Jr.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...Jr.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...Jr.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...Jr.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...Jr.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...Jr.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...Jr.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...Jr.errToObj(e)})}datetime(e){return"string"===typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:"undefined"===typeof e?.precision?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...Jr.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return"string"===typeof e?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:"undefined"===typeof e?.precision?null:e?.precision,...Jr.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...Jr.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...Jr.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t?.position,...Jr.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...Jr.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...Jr.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...Jr.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...Jr.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...Jr.errToObj(t)})}nonempty(e){return this.min(1,Jr.errToObj(e))}trim(){return new Ca({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Ca({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Ca({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>"datetime"===e.kind)}get isDate(){return!!this._def.checks.find(e=>"date"===e.kind)}get isTime(){return!!this._def.checks.find(e=>"time"===e.kind)}get isDuration(){return!!this._def.checks.find(e=>"duration"===e.kind)}get isEmail(){return!!this._def.checks.find(e=>"email"===e.kind)}get isURL(){return!!this._def.checks.find(e=>"url"===e.kind)}get isEmoji(){return!!this._def.checks.find(e=>"emoji"===e.kind)}get isUUID(){return!!this._def.checks.find(e=>"uuid"===e.kind)}get isNANOID(){return!!this._def.checks.find(e=>"nanoid"===e.kind)}get isCUID(){return!!this._def.checks.find(e=>"cuid"===e.kind)}get isCUID2(){return!!this._def.checks.find(e=>"cuid2"===e.kind)}get isULID(){return!!this._def.checks.find(e=>"ulid"===e.kind)}get isIP(){return!!this._def.checks.find(e=>"ip"===e.kind)}get isCIDR(){return!!this._def.checks.find(e=>"cidr"===e.kind)}get isBase64(){return!!this._def.checks.find(e=>"base64"===e.kind)}get isBase64url(){return!!this._def.checks.find(e=>"base64url"===e.kind)}get minLength(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}function Na(e,t){const n=(e.toString().split(".")[1]||"").length,r=(t.toString().split(".")[1]||"").length,a=n>r?n:r;return Number.parseInt(e.toFixed(a).replace(".",""))%Number.parseInt(t.toFixed(a).replace(".",""))/10**a}Ca.create=e=>new Ca({checks:[],typeName:gs.ZodString,coerce:e?.coerce??!1,...la(e)});class ja extends ca{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){this._def.coerce&&(e.data=Number(e.data));if(this._getType(e)!==Br.number){const t=this._getOrReturnCtx(e);return Xr(t,{code:Hr.invalid_type,expected:Br.number,received:t.parsedType}),Yr}let t;const n=new Qr;for(const r of this._def.checks)if("int"===r.kind)Ur.isInteger(e.data)||(t=this._getOrReturnCtx(e,t),Xr(t,{code:Hr.invalid_type,expected:"integer",received:"float",message:r.message}),n.dirty());else if("min"===r.kind){(r.inclusive?e.data<r.value:e.data<=r.value)&&(t=this._getOrReturnCtx(e,t),Xr(t,{code:Hr.too_small,minimum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),n.dirty())}else if("max"===r.kind){(r.inclusive?e.data>r.value:e.data>=r.value)&&(t=this._getOrReturnCtx(e,t),Xr(t,{code:Hr.too_big,maximum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),n.dirty())}else"multipleOf"===r.kind?0!==Na(e.data,r.value)&&(t=this._getOrReturnCtx(e,t),Xr(t,{code:Hr.not_multiple_of,multipleOf:r.value,message:r.message}),n.dirty()):"finite"===r.kind?Number.isFinite(e.data)||(t=this._getOrReturnCtx(e,t),Xr(t,{code:Hr.not_finite,message:r.message}),n.dirty()):Ur.assertNever(r);return{status:n.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,Jr.toString(t))}gt(e,t){return this.setLimit("min",e,!1,Jr.toString(t))}lte(e,t){return this.setLimit("max",e,!0,Jr.toString(t))}lt(e,t){return this.setLimit("max",e,!1,Jr.toString(t))}setLimit(e,t,n,r){return new ja({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:Jr.toString(r)}]})}_addCheck(e){return new ja({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:Jr.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:Jr.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:Jr.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:Jr.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:Jr.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:Jr.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:Jr.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:Jr.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:Jr.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>"int"===e.kind||"multipleOf"===e.kind&&Ur.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const n of this._def.checks){if("finite"===n.kind||"int"===n.kind||"multipleOf"===n.kind)return!0;"min"===n.kind?(null===t||n.value>t)&&(t=n.value):"max"===n.kind&&(null===e||n.value<e)&&(e=n.value)}return Number.isFinite(t)&&Number.isFinite(e)}}ja.create=e=>new ja({checks:[],typeName:gs.ZodNumber,coerce:e?.coerce||!1,...la(e)});class La extends ca{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==Br.bigint)return this._getInvalidInput(e);let t;const n=new Qr;for(const r of this._def.checks)if("min"===r.kind){(r.inclusive?e.data<r.value:e.data<=r.value)&&(t=this._getOrReturnCtx(e,t),Xr(t,{code:Hr.too_small,type:"bigint",minimum:r.value,inclusive:r.inclusive,message:r.message}),n.dirty())}else if("max"===r.kind){(r.inclusive?e.data>r.value:e.data>=r.value)&&(t=this._getOrReturnCtx(e,t),Xr(t,{code:Hr.too_big,type:"bigint",maximum:r.value,inclusive:r.inclusive,message:r.message}),n.dirty())}else"multipleOf"===r.kind?e.data%r.value!==BigInt(0)&&(t=this._getOrReturnCtx(e,t),Xr(t,{code:Hr.not_multiple_of,multipleOf:r.value,message:r.message}),n.dirty()):Ur.assertNever(r);return{status:n.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return Xr(t,{code:Hr.invalid_type,expected:Br.bigint,received:t.parsedType}),Yr}gte(e,t){return this.setLimit("min",e,!0,Jr.toString(t))}gt(e,t){return this.setLimit("min",e,!1,Jr.toString(t))}lte(e,t){return this.setLimit("max",e,!0,Jr.toString(t))}lt(e,t){return this.setLimit("max",e,!1,Jr.toString(t))}setLimit(e,t,n,r){return new La({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:Jr.toString(r)}]})}_addCheck(e){return new La({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:Jr.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:Jr.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:Jr.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:Jr.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:Jr.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}La.create=e=>new La({checks:[],typeName:gs.ZodBigInt,coerce:e?.coerce??!1,...la(e)});class Ma extends ca{_parse(e){this._def.coerce&&(e.data=Boolean(e.data));if(this._getType(e)!==Br.boolean){const t=this._getOrReturnCtx(e);return Xr(t,{code:Hr.invalid_type,expected:Br.boolean,received:t.parsedType}),Yr}return ta(e.data)}}Ma.create=e=>new Ma({typeName:gs.ZodBoolean,coerce:e?.coerce||!1,...la(e)});class Da extends ca{_parse(e){this._def.coerce&&(e.data=new Date(e.data));if(this._getType(e)!==Br.date){const t=this._getOrReturnCtx(e);return Xr(t,{code:Hr.invalid_type,expected:Br.date,received:t.parsedType}),Yr}if(Number.isNaN(e.data.getTime())){return Xr(this._getOrReturnCtx(e),{code:Hr.invalid_date}),Yr}const t=new Qr;let n;for(const r of this._def.checks)"min"===r.kind?e.data.getTime()<r.value&&(n=this._getOrReturnCtx(e,n),Xr(n,{code:Hr.too_small,message:r.message,inclusive:!0,exact:!1,minimum:r.value,type:"date"}),t.dirty()):"max"===r.kind?e.data.getTime()>r.value&&(n=this._getOrReturnCtx(e,n),Xr(n,{code:Hr.too_big,message:r.message,inclusive:!0,exact:!1,maximum:r.value,type:"date"}),t.dirty()):Ur.assertNever(r);return{status:t.value,value:new Date(e.data.getTime())}}_addCheck(e){return new Da({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:Jr.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:Jr.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}Da.create=e=>new Da({checks:[],coerce:e?.coerce||!1,typeName:gs.ZodDate,...la(e)});class za extends ca{_parse(e){if(this._getType(e)!==Br.symbol){const t=this._getOrReturnCtx(e);return Xr(t,{code:Hr.invalid_type,expected:Br.symbol,received:t.parsedType}),Yr}return ta(e.data)}}za.create=e=>new za({typeName:gs.ZodSymbol,...la(e)});class Ua extends ca{_parse(e){if(this._getType(e)!==Br.undefined){const t=this._getOrReturnCtx(e);return Xr(t,{code:Hr.invalid_type,expected:Br.undefined,received:t.parsedType}),Yr}return ta(e.data)}}Ua.create=e=>new Ua({typeName:gs.ZodUndefined,...la(e)});class Fa extends ca{_parse(e){if(this._getType(e)!==Br.null){const t=this._getOrReturnCtx(e);return Xr(t,{code:Hr.invalid_type,expected:Br.null,received:t.parsedType}),Yr}return ta(e.data)}}Fa.create=e=>new Fa({typeName:gs.ZodNull,...la(e)});class Ba extends ca{constructor(){super(...arguments),this._any=!0}_parse(e){return ta(e.data)}}Ba.create=e=>new Ba({typeName:gs.ZodAny,...la(e)});class qa extends ca{constructor(){super(...arguments),this._unknown=!0}_parse(e){return ta(e.data)}}qa.create=e=>new qa({typeName:gs.ZodUnknown,...la(e)});class Ha extends ca{_parse(e){const t=this._getOrReturnCtx(e);return Xr(t,{code:Hr.invalid_type,expected:Br.never,received:t.parsedType}),Yr}}Ha.create=e=>new Ha({typeName:gs.ZodNever,...la(e)});class Wa extends ca{_parse(e){if(this._getType(e)!==Br.undefined){const t=this._getOrReturnCtx(e);return Xr(t,{code:Hr.invalid_type,expected:Br.void,received:t.parsedType}),Yr}return ta(e.data)}}Wa.create=e=>new Wa({typeName:gs.ZodVoid,...la(e)});class Va extends ca{_parse(e){const{ctx:t,status:n}=this._processInputParams(e),r=this._def;if(t.parsedType!==Br.array)return Xr(t,{code:Hr.invalid_type,expected:Br.array,received:t.parsedType}),Yr;if(null!==r.exactLength){const e=t.data.length>r.exactLength.value,a=t.data.length<r.exactLength.value;(e||a)&&(Xr(t,{code:e?Hr.too_big:Hr.too_small,minimum:a?r.exactLength.value:void 0,maximum:e?r.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:r.exactLength.message}),n.dirty())}if(null!==r.minLength&&t.data.length<r.minLength.value&&(Xr(t,{code:Hr.too_small,minimum:r.minLength.value,type:"array",inclusive:!0,exact:!1,message:r.minLength.message}),n.dirty()),null!==r.maxLength&&t.data.length>r.maxLength.value&&(Xr(t,{code:Hr.too_big,maximum:r.maxLength.value,type:"array",inclusive:!0,exact:!1,message:r.maxLength.message}),n.dirty()),t.common.async)return Promise.all([...t.data].map((e,n)=>r.type._parseAsync(new ia(t,e,t.path,n)))).then(e=>Qr.mergeArray(n,e));const a=[...t.data].map((e,n)=>r.type._parseSync(new ia(t,e,t.path,n)));return Qr.mergeArray(n,a)}get element(){return this._def.type}min(e,t){return new Va({...this._def,minLength:{value:e,message:Jr.toString(t)}})}max(e,t){return new Va({...this._def,maxLength:{value:e,message:Jr.toString(t)}})}length(e,t){return new Va({...this._def,exactLength:{value:e,message:Jr.toString(t)}})}nonempty(e){return this.min(1,e)}}function Za(e){if(e instanceof Ga){const t={};for(const n in e.shape){const r=e.shape[n];t[n]=ls.create(Za(r))}return new Ga({...e._def,shape:()=>t})}return e instanceof Va?new Va({...e._def,type:Za(e.element)}):e instanceof ls?ls.create(Za(e.unwrap())):e instanceof cs?cs.create(Za(e.unwrap())):e instanceof Qa?Qa.create(e.items.map(e=>Za(e))):e}Va.create=(e,t)=>new Va({type:e,minLength:null,maxLength:null,exactLength:null,typeName:gs.ZodArray,...la(t)});class Ga extends ca{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;const e=this._def.shape(),t=Ur.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==Br.object){const t=this._getOrReturnCtx(e);return Xr(t,{code:Hr.invalid_type,expected:Br.object,received:t.parsedType}),Yr}const{status:t,ctx:n}=this._processInputParams(e),{shape:r,keys:a}=this._getCached(),s=[];if(!(this._def.catchall instanceof Ha&&"strip"===this._def.unknownKeys))for(const o in n.data)a.includes(o)||s.push(o);const i=[];for(const o of a){const e=r[o],t=n.data[o];i.push({key:{status:"valid",value:o},value:e._parse(new ia(n,t,n.path,o)),alwaysSet:o in n.data})}if(this._def.catchall instanceof Ha){const e=this._def.unknownKeys;if("passthrough"===e)for(const t of s)i.push({key:{status:"valid",value:t},value:{status:"valid",value:n.data[t]}});else if("strict"===e)s.length>0&&(Xr(n,{code:Hr.unrecognized_keys,keys:s}),t.dirty());else if("strip"!==e)throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const e=this._def.catchall;for(const t of s){const r=n.data[t];i.push({key:{status:"valid",value:t},value:e._parse(new ia(n,r,n.path,t)),alwaysSet:t in n.data})}}return n.common.async?Promise.resolve().then(async()=>{const e=[];for(const t of i){const n=await t.key,r=await t.value;e.push({key:n,value:r,alwaysSet:t.alwaysSet})}return e}).then(e=>Qr.mergeObjectSync(t,e)):Qr.mergeObjectSync(t,i)}get shape(){return this._def.shape()}strict(e){return Jr.errToObj,new Ga({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,n)=>{const r=this._def.errorMap?.(t,n).message??n.defaultError;return"unrecognized_keys"===t.code?{message:Jr.errToObj(e).message??r}:{message:r}}}:{}})}strip(){return new Ga({...this._def,unknownKeys:"strip"})}passthrough(){return new Ga({...this._def,unknownKeys:"passthrough"})}extend(e){return new Ga({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new Ga({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:gs.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new Ga({...this._def,catchall:e})}pick(e){const t={};for(const n of Ur.objectKeys(e))e[n]&&this.shape[n]&&(t[n]=this.shape[n]);return new Ga({...this._def,shape:()=>t})}omit(e){const t={};for(const n of Ur.objectKeys(this.shape))e[n]||(t[n]=this.shape[n]);return new Ga({...this._def,shape:()=>t})}deepPartial(){return Za(this)}partial(e){const t={};for(const n of Ur.objectKeys(this.shape)){const r=this.shape[n];e&&!e[n]?t[n]=r:t[n]=r.optional()}return new Ga({...this._def,shape:()=>t})}required(e){const t={};for(const n of Ur.objectKeys(this.shape))if(e&&!e[n])t[n]=this.shape[n];else{let e=this.shape[n];for(;e instanceof ls;)e=e._def.innerType;t[n]=e}return new Ga({...this._def,shape:()=>t})}keyof(){return rs(Ur.objectKeys(this.shape))}}Ga.create=(e,t)=>new Ga({shape:()=>e,unknownKeys:"strip",catchall:Ha.create(),typeName:gs.ZodObject,...la(t)}),Ga.strictCreate=(e,t)=>new Ga({shape:()=>e,unknownKeys:"strict",catchall:Ha.create(),typeName:gs.ZodObject,...la(t)}),Ga.lazycreate=(e,t)=>new Ga({shape:e,unknownKeys:"strip",catchall:Ha.create(),typeName:gs.ZodObject,...la(t)});class Ja extends ca{_parse(e){const{ctx:t}=this._processInputParams(e),n=this._def.options;if(t.common.async)return Promise.all(n.map(async e=>{const n={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:n}),ctx:n}})).then(function(e){for(const t of e)if("valid"===t.result.status)return t.result;for(const r of e)if("dirty"===r.result.status)return t.common.issues.push(...r.ctx.common.issues),r.result;const n=e.map(e=>new Wr(e.ctx.common.issues));return Xr(t,{code:Hr.invalid_union,unionErrors:n}),Yr});{let e;const r=[];for(const s of n){const n={...t,common:{...t.common,issues:[]},parent:null},a=s._parseSync({data:t.data,path:t.path,parent:n});if("valid"===a.status)return a;"dirty"!==a.status||e||(e={result:a,ctx:n}),n.common.issues.length&&r.push(n.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;const a=r.map(e=>new Wr(e));return Xr(t,{code:Hr.invalid_union,unionErrors:a}),Yr}}get options(){return this._def.options}}Ja.create=(e,t)=>new Ja({options:e,typeName:gs.ZodUnion,...la(t)});function Ka(e,t){const n=qr(e),r=qr(t);if(e===t)return{valid:!0,data:e};if(n===Br.object&&r===Br.object){const n=Ur.objectKeys(t),r=Ur.objectKeys(e).filter(e=>-1!==n.indexOf(e)),a={...e,...t};for(const s of r){const n=Ka(e[s],t[s]);if(!n.valid)return{valid:!1};a[s]=n.data}return{valid:!0,data:a}}if(n===Br.array&&r===Br.array){if(e.length!==t.length)return{valid:!1};const n=[];for(let r=0;r<e.length;r++){const a=Ka(e[r],t[r]);if(!a.valid)return{valid:!1};n.push(a.data)}return{valid:!0,data:n}}return n===Br.date&&r===Br.date&&+e===+t?{valid:!0,data:e}:{valid:!1}}class Xa extends ca{_parse(e){const{status:t,ctx:n}=this._processInputParams(e),r=(e,r)=>{if(na(e)||na(r))return Yr;const a=Ka(e.value,r.value);return a.valid?((ra(e)||ra(r))&&t.dirty(),{status:t.value,value:a.data}):(Xr(n,{code:Hr.invalid_intersection_types}),Yr)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(e=>{let[t,n]=e;return r(t,n)}):r(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}}Xa.create=(e,t,n)=>new Xa({left:e,right:t,typeName:gs.ZodIntersection,...la(n)});class Qa extends ca{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==Br.array)return Xr(n,{code:Hr.invalid_type,expected:Br.array,received:n.parsedType}),Yr;if(n.data.length<this._def.items.length)return Xr(n,{code:Hr.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Yr;!this._def.rest&&n.data.length>this._def.items.length&&(Xr(n,{code:Hr.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const r=[...n.data].map((e,t)=>{const r=this._def.items[t]||this._def.rest;return r?r._parse(new ia(n,e,n.path,t)):null}).filter(e=>!!e);return n.common.async?Promise.all(r).then(e=>Qr.mergeArray(t,e)):Qr.mergeArray(t,r)}get items(){return this._def.items}rest(e){return new Qa({...this._def,rest:e})}}Qa.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Qa({items:e,typeName:gs.ZodTuple,rest:null,...la(t)})};class Ya extends ca{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==Br.map)return Xr(n,{code:Hr.invalid_type,expected:Br.map,received:n.parsedType}),Yr;const r=this._def.keyType,a=this._def.valueType,s=[...n.data.entries()].map((e,t)=>{let[s,i]=e;return{key:r._parse(new ia(n,s,n.path,[t,"key"])),value:a._parse(new ia(n,i,n.path,[t,"value"]))}});if(n.common.async){const e=new Map;return Promise.resolve().then(async()=>{for(const n of s){const r=await n.key,a=await n.value;if("aborted"===r.status||"aborted"===a.status)return Yr;"dirty"!==r.status&&"dirty"!==a.status||t.dirty(),e.set(r.value,a.value)}return{status:t.value,value:e}})}{const e=new Map;for(const n of s){const r=n.key,a=n.value;if("aborted"===r.status||"aborted"===a.status)return Yr;"dirty"!==r.status&&"dirty"!==a.status||t.dirty(),e.set(r.value,a.value)}return{status:t.value,value:e}}}}Ya.create=(e,t,n)=>new Ya({valueType:t,keyType:e,typeName:gs.ZodMap,...la(n)});class es extends ca{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==Br.set)return Xr(n,{code:Hr.invalid_type,expected:Br.set,received:n.parsedType}),Yr;const r=this._def;null!==r.minSize&&n.data.size<r.minSize.value&&(Xr(n,{code:Hr.too_small,minimum:r.minSize.value,type:"set",inclusive:!0,exact:!1,message:r.minSize.message}),t.dirty()),null!==r.maxSize&&n.data.size>r.maxSize.value&&(Xr(n,{code:Hr.too_big,maximum:r.maxSize.value,type:"set",inclusive:!0,exact:!1,message:r.maxSize.message}),t.dirty());const a=this._def.valueType;function s(e){const n=new Set;for(const r of e){if("aborted"===r.status)return Yr;"dirty"===r.status&&t.dirty(),n.add(r.value)}return{status:t.value,value:n}}const i=[...n.data.values()].map((e,t)=>a._parse(new ia(n,e,n.path,t)));return n.common.async?Promise.all(i).then(e=>s(e)):s(i)}min(e,t){return new es({...this._def,minSize:{value:e,message:Jr.toString(t)}})}max(e,t){return new es({...this._def,maxSize:{value:e,message:Jr.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}es.create=(e,t)=>new es({valueType:e,minSize:null,maxSize:null,typeName:gs.ZodSet,...la(t)});class ts extends ca{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}ts.create=(e,t)=>new ts({getter:e,typeName:gs.ZodLazy,...la(t)});class ns extends ca{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return Xr(t,{received:t.data,code:Hr.invalid_literal,expected:this._def.value}),Yr}return{status:"valid",value:e.data}}get value(){return this._def.value}}function rs(e,t){return new as({values:e,typeName:gs.ZodEnum,...la(t)})}ns.create=(e,t)=>new ns({value:e,typeName:gs.ZodLiteral,...la(t)});class as extends ca{_parse(e){if("string"!==typeof e.data){const t=this._getOrReturnCtx(e),n=this._def.values;return Xr(t,{expected:Ur.joinValues(n),received:t.parsedType,code:Hr.invalid_type}),Yr}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){const t=this._getOrReturnCtx(e),n=this._def.values;return Xr(t,{received:t.data,code:Hr.invalid_enum_value,options:n}),Yr}return ta(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._def;return as.create(e,{...this._def,...t})}exclude(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._def;return as.create(this.options.filter(t=>!e.includes(t)),{...this._def,...t})}}as.create=rs;class ss extends ca{_parse(e){const t=Ur.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==Br.string&&n.parsedType!==Br.number){const e=Ur.objectValues(t);return Xr(n,{expected:Ur.joinValues(e),received:n.parsedType,code:Hr.invalid_type}),Yr}if(this._cache||(this._cache=new Set(Ur.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){const e=Ur.objectValues(t);return Xr(n,{received:n.data,code:Hr.invalid_enum_value,options:e}),Yr}return ta(e.data)}get enum(){return this._def.values}}ss.create=(e,t)=>new ss({values:e,typeName:gs.ZodNativeEnum,...la(t)});class is extends ca{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==Br.promise&&!1===t.common.async)return Xr(t,{code:Hr.invalid_type,expected:Br.promise,received:t.parsedType}),Yr;const n=t.parsedType===Br.promise?t.data:Promise.resolve(t.data);return ta(n.then(e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap})))}}is.create=(e,t)=>new is({type:e,typeName:gs.ZodPromise,...la(t)});class os extends ca{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===gs.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:n}=this._processInputParams(e),r=this._def.effect||null,a={addIssue:e=>{Xr(n,e),e.fatal?t.abort():t.dirty()},get path(){return n.path}};if(a.addIssue=a.addIssue.bind(a),"preprocess"===r.type){const e=r.transform(n.data,a);if(n.common.async)return Promise.resolve(e).then(async e=>{if("aborted"===t.value)return Yr;const r=await this._def.schema._parseAsync({data:e,path:n.path,parent:n});return"aborted"===r.status?Yr:"dirty"===r.status||"dirty"===t.value?ea(r.value):r});{if("aborted"===t.value)return Yr;const r=this._def.schema._parseSync({data:e,path:n.path,parent:n});return"aborted"===r.status?Yr:"dirty"===r.status||"dirty"===t.value?ea(r.value):r}}if("refinement"===r.type){const e=e=>{const t=r.refinement(e,a);if(n.common.async)return Promise.resolve(t);if(t instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1===n.common.async){const r=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return"aborted"===r.status?Yr:("dirty"===r.status&&t.dirty(),e(r.value),{status:t.value,value:r.value})}return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(n=>"aborted"===n.status?Yr:("dirty"===n.status&&t.dirty(),e(n.value).then(()=>({status:t.value,value:n.value}))))}if("transform"===r.type){if(!1===n.common.async){const e=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!aa(e))return Yr;const s=r.transform(e.value,a);if(s instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:s}}return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(e=>aa(e)?Promise.resolve(r.transform(e.value,a)).then(e=>({status:t.value,value:e})):Yr)}Ur.assertNever(r)}}os.create=(e,t,n)=>new os({schema:e,typeName:gs.ZodEffects,effect:t,...la(n)}),os.createWithPreprocess=(e,t,n)=>new os({schema:t,effect:{type:"preprocess",transform:e},typeName:gs.ZodEffects,...la(n)});class ls extends ca{_parse(e){return this._getType(e)===Br.undefined?ta(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}ls.create=(e,t)=>new ls({innerType:e,typeName:gs.ZodOptional,...la(t)});class cs extends ca{_parse(e){return this._getType(e)===Br.null?ta(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}cs.create=(e,t)=>new cs({innerType:e,typeName:gs.ZodNullable,...la(t)});class us extends ca{_parse(e){const{ctx:t}=this._processInputParams(e);let n=t.data;return t.parsedType===Br.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}us.create=(e,t)=>new us({innerType:e,typeName:gs.ZodDefault,defaultValue:"function"===typeof t.default?t.default:()=>t.default,...la(t)});class ds extends ca{_parse(e){const{ctx:t}=this._processInputParams(e),n={...t,common:{...t.common,issues:[]}},r=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return sa(r)?r.then(e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new Wr(n.common.issues)},input:n.data})})):{status:"valid",value:"valid"===r.status?r.value:this._def.catchValue({get error(){return new Wr(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}}ds.create=(e,t)=>new ds({innerType:e,typeName:gs.ZodCatch,catchValue:"function"===typeof t.catch?t.catch:()=>t.catch,...la(t)});class hs extends ca{_parse(e){if(this._getType(e)!==Br.nan){const t=this._getOrReturnCtx(e);return Xr(t,{code:Hr.invalid_type,expected:Br.nan,received:t.parsedType}),Yr}return{status:"valid",value:e.data}}}hs.create=e=>new hs({typeName:gs.ZodNaN,...la(e)});Symbol("zod_brand");class fs extends ca{_parse(e){const{ctx:t}=this._processInputParams(e),n=t.data;return this._def.type._parse({data:n,path:t.path,parent:t})}unwrap(){return this._def.type}}class ps extends ca{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.common.async){return(async()=>{const e=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return"aborted"===e.status?Yr:"dirty"===e.status?(t.dirty(),ea(e.value)):this._def.out._parseAsync({data:e.value,path:n.path,parent:n})})()}{const e=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return"aborted"===e.status?Yr:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:n.path,parent:n})}}static create(e,t){return new ps({in:e,out:t,typeName:gs.ZodPipeline})}}class ms extends ca{_parse(e){const t=this._def.innerType._parse(e),n=e=>(aa(e)&&(e.value=Object.freeze(e.value)),e);return sa(t)?t.then(e=>n(e)):n(t)}unwrap(){return this._def.innerType}}ms.create=(e,t)=>new ms({innerType:e,typeName:gs.ZodReadonly,...la(t)});Ga.lazycreate;var gs;!function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"}(gs||(gs={}));const ys=Ca.create,bs=(ja.create,hs.create,La.create,Ma.create,Da.create,za.create,Ua.create,Fa.create,Ba.create),vs=(qa.create,Ha.create,Wa.create,Va.create,Ga.create);Ga.strictCreate,Ja.create,Xa.create,Qa.create,Ya.create,es.create,ts.create,ns.create,as.create,ss.create,is.create,os.create,ls.create,cs.create,os.createWithPreprocess,ps.create;var ws=n(2569);const _s={randomUUID:"undefined"!==typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};var Ss,ks=new Uint8Array(16);function Es(){if(!Ss&&!(Ss="undefined"!==typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Ss(ks)}for(var xs=[],Os=0;Os<256;++Os)xs.push((Os+256).toString(16).slice(1));function As(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(xs[e[t+0]]+xs[e[t+1]]+xs[e[t+2]]+xs[e[t+3]]+"-"+xs[e[t+4]]+xs[e[t+5]]+"-"+xs[e[t+6]]+xs[e[t+7]]+"-"+xs[e[t+8]]+xs[e[t+9]]+"-"+xs[e[t+10]]+xs[e[t+11]]+xs[e[t+12]]+xs[e[t+13]]+xs[e[t+14]]+xs[e[t+15]]).toLowerCase()}const Is=function(e,t,n){if(_s.randomUUID&&!t&&!e)return _s.randomUUID();var r=(e=e||{}).random||(e.rng||Es)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(var a=0;a<16;++a)t[n+a]=r[a];return t}return As(r)};const $s=Symbol.for("ls:tracing_async_local_storage"),Ts=new class{getStore(){}run(e,t){return t()}};const Ps=new class{getInstance(){return globalThis[$s]??Ts}initializeGlobalInstance(e){void 0===globalThis[$s]&&(globalThis[$s]=e)}};Symbol.for("langsmith:traceable:root");function Rs(e){return"function"===typeof e&&"langsmith:traceable"in e}const Cs=Object.prototype.hasOwnProperty;function Ns(e,t){return Cs.call(e,t)}function js(e){if(Array.isArray(e)){const t=new Array(e.length);for(let e=0;e<t.length;e++)t[e]=""+e;return t}if(Object.keys)return Object.keys(e);let t=[];for(let n in e)Ns(e,n)&&t.push(n);return t}function Ls(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function Ms(e){let t=0;const n=e.length;let r;for(;t<n;){if(r=e.charCodeAt(t),!(r>=48&&r<=57))return!1;t++}return!0}function Ds(e){return-1===e.indexOf("/")&&-1===e.indexOf("~")?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function zs(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function Us(e){if(void 0===e)return!0;if(e)if(Array.isArray(e)){for(let n=0,r=e.length;n<r;n++)if(Us(e[n]))return!0}else if("object"===typeof e){const n=js(e),r=n.length;for(var t=0;t<r;t++)if(Us(e[n[t]]))return!0}return!1}function Fs(e,t){const n=[e];for(const r in t){const e="object"===typeof t[r]?JSON.stringify(t[r],null,2):t[r];"undefined"!==typeof e&&n.push(`${r}: ${e}`)}return n.join("\n")}class Bs extends Error{constructor(e,t,n,r,a){super(Fs(e,{name:t,index:n,operation:r,tree:a})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.setPrototypeOf(this,new.target.prototype),this.message=Fs(e,{name:t,index:n,operation:r,tree:a})}}const qs=Bs,Hs=Ls,Ws={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var r=e[t];return delete e[t],{newDocument:n,removed:r}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:function(e,t,n){let r=Zs(n,this.path);r&&(r=Ls(r));const a=Gs(n,{op:"remove",path:this.from}).removed;return Gs(n,{op:"add",path:this.path,value:a}),{newDocument:n,removed:r}},copy:function(e,t,n){const r=Zs(n,this.from);return Gs(n,{op:"add",path:this.path,value:Ls(r)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:Ys(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}};var Vs={add:function(e,t,n){return Ms(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){return{newDocument:n,removed:e.splice(t,1)[0]}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:Ws.move,copy:Ws.copy,test:Ws.test,_get:Ws._get};function Zs(e,t){if(""==t)return e;var n={op:"_get",path:t};return Gs(e,n),n.value}function Gs(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;if(n&&("function"==typeof n?n(t,0,e,t.path):Xs(t,0)),""===t.path){let r={newDocument:e};if("add"===t.op)return r.newDocument=t.value,r;if("replace"===t.op)return r.newDocument=t.value,r.removed=e,r;if("move"===t.op||"copy"===t.op)return r.newDocument=Zs(e,t.from),"move"===t.op&&(r.removed=e),r;if("test"===t.op){if(r.test=Ys(e,t.value),!1===r.test)throw new qs("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return r.newDocument=e,r}if("remove"===t.op)return r.removed=e,r.newDocument=null,r;if("_get"===t.op)return t.value=e,r;if(n)throw new qs("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,t,e);return r}{r||(e=Ls(e));const i=(t.path||"").split("/");let o,l,c,u=e,d=1,h=i.length;for(c="function"==typeof n?n:Xs;;){if(l=i[d],l&&-1!=l.indexOf("~")&&(l=zs(l)),a&&("__proto__"==l||"prototype"==l&&d>0&&"constructor"==i[d-1]))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&void 0===o&&(void 0===u[l]?o=i.slice(0,d).join("/"):d==h-1&&(o=t.path),void 0!==o&&c(t,0,e,o)),d++,Array.isArray(u)){if("-"===l)l=u.length;else{if(n&&!Ms(l))throw new qs("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,t,e);Ms(l)&&(l=~~l)}if(d>=h){if(n&&"add"===t.op&&l>u.length)throw new qs("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,t,e);const r=Vs[t.op].call(t,u,l,e);if(!1===r.test)throw new qs("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return r}}else if(d>=h){const n=Ws[t.op].call(t,u,l,e);if(!1===n.test)throw new qs("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return n}if(u=u[l],n&&d<h&&(!u||"object"!==typeof u))throw new qs("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,t,e)}}}function Js(e,t,n){let r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(n&&!Array.isArray(t))throw new qs("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(e=Ls(e));const s=new Array(t.length);for(let i=0,o=t.length;i<o;i++)s[i]=Gs(e,t[i],n,!0,a,i),e=s[i].newDocument;return s.newDocument=e,s}function Ks(e,t,n){const r=Gs(e,t);if(!1===r.test)throw new qs("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return r.newDocument}function Xs(e,t,n,r){if("object"!==typeof e||null===e||Array.isArray(e))throw new qs("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(!Ws[e.op])throw new qs("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n);if("string"!==typeof e.path)throw new qs("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(0!==e.path.indexOf("/")&&e.path.length>0)throw new qs('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if(("move"===e.op||"copy"===e.op)&&"string"!==typeof e.from)throw new qs("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&void 0===e.value)throw new qs("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&Us(e.value))throw new qs("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n)if("add"==e.op){var a=e.path.split("/").length,s=r.split("/").length;if(a!==s+1&&a!==s)throw new qs("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if("replace"===e.op||"remove"===e.op||"_get"===e.op){if(e.path!==r)throw new qs("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if("move"===e.op||"copy"===e.op){var i=Qs([{op:"_get",path:e.from,value:void 0}],n);if(i&&"OPERATION_PATH_UNRESOLVABLE"===i.name)throw new qs("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}function Qs(e,t,n){try{if(!Array.isArray(e))throw new qs("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)Js(Ls(t),Ls(e),n||!0);else{n=n||Xs;for(var r=0;r<e.length;r++)n(e[r],r,t,void 0)}}catch(a){if(a instanceof qs)return a;throw a}}function Ys(e,t){if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t){var n,r,a,s=Array.isArray(e),i=Array.isArray(t);if(s&&i){if((r=e.length)!=t.length)return!1;for(n=r;0!==n--;)if(!Ys(e[n],t[n]))return!1;return!0}if(s!=i)return!1;var o=Object.keys(e);if((r=o.length)!==Object.keys(t).length)return!1;for(n=r;0!==n--;)if(!t.hasOwnProperty(o[n]))return!1;for(n=r;0!==n--;)if(!Ys(e[a=o[n]],t[a]))return!1;return!0}return e!==e&&t!==t}new WeakMap;const ei=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;const ti=function(e){return"string"===typeof e&&ei.test(e)};const ni=function(e){if(!ti(e))throw TypeError("Invalid UUID");var t,n=new Uint8Array(16);return n[0]=(t=parseInt(e.slice(0,8),16))>>>24,n[1]=t>>>16&255,n[2]=t>>>8&255,n[3]=255&t,n[4]=(t=parseInt(e.slice(9,13),16))>>>8,n[5]=255&t,n[6]=(t=parseInt(e.slice(14,18),16))>>>8,n[7]=255&t,n[8]=(t=parseInt(e.slice(19,23),16))>>>8,n[9]=255&t,n[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,n[11]=t/4294967296&255,n[12]=t>>>24&255,n[13]=t>>>16&255,n[14]=t>>>8&255,n[15]=255&t,n};function ri(e,t,n,r){switch(e){case 0:return t&n^~t&r;case 1:case 3:return t^n^r;case 2:return t&n^t&r^n&r}}function ai(e,t){return e<<t|e>>>32-t}const si=function(e){var t=[1518500249,1859775393,2400959708,3395469782],n=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"===typeof e){var r=unescape(encodeURIComponent(e));e=[];for(var a=0;a<r.length;++a)e.push(r.charCodeAt(a))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);for(var s=e.length/4+2,i=Math.ceil(s/16),o=new Array(i),l=0;l<i;++l){for(var c=new Uint32Array(16),u=0;u<16;++u)c[u]=e[64*l+4*u]<<24|e[64*l+4*u+1]<<16|e[64*l+4*u+2]<<8|e[64*l+4*u+3];o[l]=c}o[i-1][14]=8*(e.length-1)/Math.pow(2,32),o[i-1][14]=Math.floor(o[i-1][14]),o[i-1][15]=8*(e.length-1)&4294967295;for(var d=0;d<i;++d){for(var h=new Uint32Array(80),f=0;f<16;++f)h[f]=o[d][f];for(var p=16;p<80;++p)h[p]=ai(h[p-3]^h[p-8]^h[p-14]^h[p-16],1);for(var m=n[0],g=n[1],y=n[2],b=n[3],v=n[4],w=0;w<80;++w){var _=Math.floor(w/20),S=ai(m,5)+ri(_,g,y,b)+v+t[_]+h[w]>>>0;v=b,b=y,y=ai(g,30)>>>0,g=m,m=S}n[0]=n[0]+m>>>0,n[1]=n[1]+g>>>0,n[2]=n[2]+y>>>0,n[3]=n[3]+b>>>0,n[4]=n[4]+v>>>0}return[n[0]>>24&255,n[0]>>16&255,n[0]>>8&255,255&n[0],n[1]>>24&255,n[1]>>16&255,n[1]>>8&255,255&n[1],n[2]>>24&255,n[2]>>16&255,n[2]>>8&255,255&n[2],n[3]>>24&255,n[3]>>16&255,n[3]>>8&255,255&n[3],n[4]>>24&255,n[4]>>16&255,n[4]>>8&255,255&n[4]]};var ii=function(e,t,n){function r(e,r,a,s){var i;if("string"===typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));for(var t=[],n=0;n<e.length;++n)t.push(e.charCodeAt(n));return t}(e)),"string"===typeof r&&(r=ni(r)),16!==(null===(i=r)||void 0===i?void 0:i.length))throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var o=new Uint8Array(16+e.length);if(o.set(r),o.set(e,r.length),(o=n(o))[6]=15&o[6]|t,o[8]=63&o[8]|128,a){s=s||0;for(var l=0;l<16;++l)a[s+l]=o[l];return a}return As(o)}try{r.name=e}catch(a){}return r.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",r.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",r}("v5",80,si);const oi=ii,li="gen_ai.request.model",ci="gen_ai.usage.input_tokens",ui="gen_ai.usage.output_tokens",di="gen_ai.usage.total_tokens",hi="langsmith.span.tags",fi=function(){return fetch(...arguments)},pi=Symbol.for("ls:fetch_implementation"),mi=e=>async function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];if(e||"true"===Oi("DEBUG")){const[e,t]=n;console.log(`\u2192 ${t?.method||"GET"} ${e}`)}const a=await(globalThis[pi]??fi)(...n);return(e||"true"===Oi("DEBUG"))&&console.log(`\u2190 ${a.status} ${a.statusText} ${a.url}`),a},gi=()=>Oi("PROJECT")??xi("LANGCHAIN_SESSION")??"default",yi="0.3.41";let bi;const vi=()=>"undefined"!==typeof Deno,wi=()=>bi||(bi="undefined"!==typeof window&&"undefined"!==typeof window.document?"browser":"undefined"===typeof process||"undefined"===typeof process.versions||"undefined"===typeof process.versions.node||vi()?"object"===typeof globalThis&&globalThis.constructor&&"DedicatedWorkerGlobalScope"===globalThis.constructor.name?"webworker":"undefined"!==typeof window&&"nodejs"===window.name||"undefined"!==typeof navigator&&navigator.userAgent.includes("jsdom")?"jsdom":vi()?"deno":"other":"node",bi);let _i,Si;function ki(){if(void 0===_i){const e=wi(),t=function(){if(void 0!==Si)return Si;const e=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],t={};for(const n of e){const e=xi(n);void 0!==e&&(t[n]=e)}return Si=t,t}();_i={library:"langsmith",runtime:e,sdk:"langsmith-js",sdk_version:yi,...t}}return _i}function Ei(){try{return"undefined"!==typeof process?Object.entries({NODE_ENV:"production",PUBLIC_URL:"/zkulik-bot.github.io",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).reduce((e,t)=>{let[n,r]=t;return e[n]=String(r),e},{}):void 0}catch(e){return}}function xi(e){try{return"undefined"!==typeof process?{NODE_ENV:"production",PUBLIC_URL:"/zkulik-bot.github.io",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}?.[e]:void 0}catch(t){return}}function Oi(e){return xi(`LANGSMITH_${e}`)||xi(`LANGCHAIN_${e}`)}class Ai{constructor(){Object.defineProperty(this,"hasWarned",{enumerable:!0,configurable:!0,writable:!0,value:!1})}startActiveSpan(e){let t;if(this.hasWarned||"true"!==xi("OTEL_ENABLED")||(console.warn('You have enabled OTEL export via the `OTEL_ENABLED` environment variable, but have not initialized the required OTEL instances. Please add:\n```\nimport { initializeOTEL } from "langsmith/experimental/otel/setup";\ninitializeOTEL();\n```\nat the beginning of your code.'),this.hasWarned=!0),1===(arguments.length<=1?0:arguments.length-1)&&"function"===typeof(arguments.length<=1?void 0:arguments[1])?t=arguments.length<=1?void 0:arguments[1]:2===(arguments.length<=1?0:arguments.length-1)&&"function"===typeof(arguments.length<=2?void 0:arguments[2])?t=arguments.length<=2?void 0:arguments[2]:3===(arguments.length<=1?0:arguments.length-1)&&"function"===typeof(arguments.length<=3?void 0:arguments[3])&&(t=arguments.length<=3?void 0:arguments[3]),"function"===typeof t)return t()}}const Ii=Symbol.for("ls:otel_trace"),$i=Symbol.for("ls:otel_context"),Ti=Symbol.for("ls:otel_get_default_otlp_tracer_provider"),Pi=new class{constructor(){Object.defineProperty(this,"mockTracer",{enumerable:!0,configurable:!0,writable:!0,value:new Ai})}getTracer(e,t){return this.mockTracer}getActiveSpan(){}setSpan(e,t){return e}getSpan(e){}setSpanContext(e,t){return e}getTracerProvider(){}setGlobalTracerProvider(e){return!1}},Ri=new class{active(){return{}}with(e,t){return t()}};const Ci=new class{getTraceInstance(){return globalThis[Ii]??Pi}getContextInstance(){return globalThis[$i]??Ri}initializeGlobalInstances(e){void 0===globalThis[Ii]&&(globalThis[Ii]=e.trace),void 0===globalThis[$i]&&(globalThis[$i]=e.context)}setDefaultOTLPTracerComponents(e){globalThis[Ti]=e}getDefaultOTLPTracerComponents(){return globalThis[Ti]??void 0}};function Ni(){return Ci.getTraceInstance()}const ji={llm:"chat",tool:"execute_tool",retriever:"embeddings",embedding:"embeddings",prompt:"chat"};class Li{constructor(){Object.defineProperty(this,"spans",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}exportBatch(e,t){for(const r of e)try{if(!r.run)continue;if("post"===r.operation){const e=this.createSpanForRun(r,r.run,t.get(r.id));e&&!r.run.end_time&&this.spans.set(r.id,e)}else this.updateSpanForRun(r,r.run)}catch(n){console.error(`Error processing operation ${r.id}:`,n)}}createSpanForRun(e,t,n){const r=n&&Ni().getSpan(n);if(r)try{return this.finishSpanSetup(r,t,e)}catch(a){return void console.error(`Failed to create span for run ${e.id}:`,a)}}finishSpanSetup(e,t,n){return this.setSpanAttributes(e,t,n),t.error?(e.setStatus({code:2}),e.recordException(new Error(t.error))):e.setStatus({code:1}),t.end_time&&e.end(t.end_time),e}updateSpanForRun(e,t){try{const n=this.spans.get(e.id);if(!n)return void console.debug(`No span found for run ${e.id} during update`);this.setSpanAttributes(n,t,e),t.error?(n.setStatus({code:2}),n.recordException(new Error(t.error))):n.setStatus({code:1});const r=t.end_time;r&&(n.end(r),this.spans.delete(e.id))}catch(n){console.error(`Failed to update span for run ${e.id}:`,n)}}extractModelName(e){if(e.extra?.metadata){const t=e.extra.metadata;if(t.ls_model_name)return t.ls_model_name;if(t.invocation_params){const e=t.invocation_params;if(e.model)return e.model;if(e.model_name)return e.model_name}}}setSpanAttributes(e,t,n){if("run_type"in t&&t.run_type){e.setAttribute("langsmith.span.kind",t.run_type);const n=(r=t.run_type||"chain",ji[r]||r);e.setAttribute("gen_ai.operation.name",n)}var r;"name"in t&&t.name&&e.setAttribute("langsmith.trace.name",t.name),"session_id"in t&&t.session_id&&e.setAttribute("langsmith.trace.session_id",t.session_id),"session_name"in t&&t.session_name&&e.setAttribute("langsmith.trace.session_name",t.session_name),this.setGenAiSystem(e,t);const a=this.extractModelName(t);a&&e.setAttribute(li,a),"prompt_tokens"in t&&"number"===typeof t.prompt_tokens&&e.setAttribute(ci,t.prompt_tokens),"completion_tokens"in t&&"number"===typeof t.completion_tokens&&e.setAttribute(ui,t.completion_tokens),"total_tokens"in t&&"number"===typeof t.total_tokens&&e.setAttribute(di,t.total_tokens),this.setInvocationParameters(e,t);const s=t.extra?.metadata||{};for(const[o,l]of Object.entries(s))null!==l&&void 0!==l&&e.setAttribute(`langsmith.metadata.${o}`,String(l));const i=t.tags;if(i&&Array.isArray(i)?e.setAttribute(hi,i.join(", ")):i&&e.setAttribute(hi,String(i)),"serialized"in t&&"object"===typeof t.serialized){const n=t.serialized;n.name&&e.setAttribute("gen_ai.serialized.name",String(n.name)),n.signature&&e.setAttribute("gen_ai.serialized.signature",String(n.signature)),n.doc&&e.setAttribute("gen_ai.serialized.doc",String(n.doc))}this.setIOAttributes(e,n)}setGenAiSystem(e,t){let n="langchain";const r=this.extractModelName(t);if(r){const e=r.toLowerCase();e.includes("anthropic")||e.startsWith("claude")?n="anthropic":e.includes("bedrock")?n="aws.bedrock":e.includes("azure")&&e.includes("openai")?n="az.ai.openai":e.includes("azure")&&e.includes("inference")?n="az.ai.inference":e.includes("cohere")?n="cohere":e.includes("deepseek")?n="deepseek":e.includes("gemini")?n="gemini":e.includes("groq")?n="groq":e.includes("watson")||e.includes("ibm")?n="ibm.watsonx.ai":e.includes("mistral")?n="mistral_ai":e.includes("gpt")||e.includes("openai")?n="openai":e.includes("perplexity")||e.includes("sonar")?n="perplexity":e.includes("vertex")?n="vertex_ai":(e.includes("xai")||e.includes("grok"))&&(n="xai")}e.setAttribute("gen_ai.system",n)}setInvocationParameters(e,t){if(!t.extra?.metadata?.invocation_params)return;const n=t.extra.metadata.invocation_params;void 0!==n.max_tokens&&e.setAttribute("gen_ai.request.max_tokens",n.max_tokens),void 0!==n.temperature&&e.setAttribute("gen_ai.request.temperature",n.temperature),void 0!==n.top_p&&e.setAttribute("gen_ai.request.top_p",n.top_p),void 0!==n.frequency_penalty&&e.setAttribute("gen_ai.request.frequency_penalty",n.frequency_penalty),void 0!==n.presence_penalty&&e.setAttribute("gen_ai.request.presence_penalty",n.presence_penalty)}setIOAttributes(e,t){if(t.run.inputs)try{const n=t.run.inputs;"object"===typeof n&&null!==n&&(n.model&&Array.isArray(n.messages)&&e.setAttribute(li,n.model),void 0!==n.stream&&e.setAttribute("langsmith.request.streaming",n.stream),n.extra_headers&&e.setAttribute("langsmith.request.headers",JSON.stringify(n.extra_headers)),n.extra_query&&e.setAttribute("gen_ai.request.extra_query",JSON.stringify(n.extra_query)),n.extra_body&&e.setAttribute("gen_ai.request.extra_body",JSON.stringify(n.extra_body))),e.setAttribute("gen_ai.prompt",JSON.stringify(n))}catch(n){console.debug(`Failed to process inputs for run ${t.id}`,n)}if(t.run.outputs)try{const n=t.run.outputs,r=this.getUnifiedRunTokens(n);if(r&&(e.setAttribute(ci,r[0]),e.setAttribute(ui,r[1]),e.setAttribute(di,r[0]+r[1])),n&&"object"===typeof n){if(n.model&&e.setAttribute("gen_ai.response.model",String(n.model)),n.id&&e.setAttribute("gen_ai.response.id",n.id),n.choices&&Array.isArray(n.choices)){const t=n.choices.map(e=>e.finish_reason).filter(e=>e).map(String);t.length>0&&e.setAttribute("gen_ai.response.finish_reasons",t.join(", "))}if(n.service_tier&&e.setAttribute("gen_ai.response.service_tier",n.service_tier),n.system_fingerprint&&e.setAttribute("gen_ai.response.system_fingerprint",n.system_fingerprint),n.usage_metadata&&"object"===typeof n.usage_metadata){const t=n.usage_metadata;t.input_token_details&&e.setAttribute("gen_ai.usage.input_token_details",JSON.stringify(t.input_token_details)),t.output_token_details&&e.setAttribute("gen_ai.usage.output_token_details",JSON.stringify(t.output_token_details))}}e.setAttribute("gen_ai.completion",JSON.stringify(n))}catch(n){console.debug(`Failed to process outputs for run ${t.id}`,n)}}getUnifiedRunTokens(e){if(!e)return null;let t=this.extractUnifiedRunTokens(e.usage_metadata);if(t)return t;const n=Object.keys(e);for(const s of n){const n=e[s];if(n&&"object"===typeof n){if(t=this.extractUnifiedRunTokens(n.usage_metadata),t)return t;if(1===n.lc&&n.kwargs&&"object"===typeof n.kwargs&&(t=this.extractUnifiedRunTokens(n.kwargs.usage_metadata),t))return t}}const r=e.generations||[];if(!Array.isArray(r))return null;const a=Array.isArray(r[0])?r.flat():r;for(const s of a)if("object"===typeof s&&s.message&&"object"===typeof s.message&&s.message.kwargs&&"object"===typeof s.message.kwargs&&(t=this.extractUnifiedRunTokens(s.message.kwargs.usage_metadata),t))return t;return null}extractUnifiedRunTokens(e){return e&&"object"===typeof e?"number"!==typeof e.input_tokens||"number"!==typeof e.output_tokens?null:[e.input_tokens,e.output_tokens]:null}}var Mi=n(3737);const Di=[400,401,403,404,405,406,407,408],zi=[409];class Ui{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"debug",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.debug=e.debug,this.queue=new Mi.default({concurrency:this.maxConcurrency}),this.onFailedResponseHook=e?.onFailedResponseHook}call(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const a=this.onFailedResponseHook;return this.queue.add(()=>ws(()=>e(...n).catch(e=>{throw e instanceof Error?e:new Error(e)}),{async onFailedAttempt(e){if(e.message.startsWith("Cancel")||e.message.startsWith("TimeoutError")||e.message.startsWith("AbortError"))throw e;if("ECONNABORTED"===e?.code)throw e;const t=e?.response,n=t?.status;if(n){if(Di.includes(+n))throw e;if(zi.includes(+n))return;a&&await a(t)}},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];return e.signal?Promise.race([this.call(t,...r),new Promise((t,n)=>{e.signal?.addEventListener("abort",()=>{n(new Error("AbortError"))})})]):this.call(t,...r)}fetch(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.call(()=>mi(this.debug)(...t).then(e=>e.ok?e:Promise.reject(e)))}}function Fi(e){return"function"===typeof e?._getType}function Bi(e){const t={type:e._getType(),data:{content:e.content}};return e?.additional_kwargs&&Object.keys(e.additional_kwargs).length>0&&(t.data.additional_kwargs={...e.additional_kwargs}),t}const qi=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;function Hi(e,t){if(!qi.test(e)){throw new Error(void 0!==t?`Invalid UUID for ${t}: ${e}`:`Invalid UUID: ${e}`)}return e}const Wi={};function Vi(e){Wi[e]||(console.warn(e),Wi[e]=!0)}n(9410);function Zi(e){if(!e||e.split("/").length>2||e.startsWith("/")||e.endsWith("/")||e.split(":").length>2)throw new Error(`Invalid identifier format: ${e}`);const[t,n]=e.split(":"),r=n||"latest";if(t.includes("/")){const[n,a]=t.split("/",2);if(!n||!a)throw new Error(`Invalid identifier format: ${e}`);return[n,a,r]}if(!t)throw new Error(`Invalid identifier format: ${e}`);return["-",t,r]}class Gi extends Error{constructor(e){super(e),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="LangSmithConflictError",this.status=409}}async function Ji(e,t,n){let r;if(e.ok)return void(n&&(r=await e.text()));r=await e.text();const a=`Failed to ${t}. Received status [${e.status}]: ${e.statusText}. Server response: ${r}`;if(409===e.status)throw new Gi(a);const s=new Error(a);throw s.status=e.status,s}var Ki="[...]",Xi={result:"[Circular]"},Qi=[],Yi=[];const eo=new TextEncoder;function to(){return{depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}}function no(e){return eo.encode(e)}function ro(e){if(e&&"object"===typeof e&&null!==e){if(e instanceof Map)return Object.fromEntries(e);if(e instanceof Set)return Array.from(e);if(e instanceof Date)return e.toISOString();if(e instanceof RegExp)return e.toString();if(e instanceof Error)return{name:e.name,message:e.message}}else if("bigint"===typeof e)return e.toString();return e}function ao(e,t,n,r,a){try{return no(JSON.stringify(e,(s=n,function(e,t){if(s){const n=s.call(this,e,t);if(void 0!==n)return n}return ro(t)}),r))}catch(i){if(!i.message?.includes("Converting circular structure to JSON"))return console.warn("[WARNING]: LangSmith received unserializable value."+(t?`\nContext: ${t}`:"")),no("[Unserializable]");let s;"true"!==Oi("SUPPRESS_CIRCULAR_JSON_WARNINGS")&&console.warn("[WARNING]: LangSmith received circular JSON. This will decrease tracer performance. "+(t?`\nContext: ${t}`:"")),"undefined"===typeof a&&(a=to()),io(e,"",0,[],void 0,0,a);try{s=0===Yi.length?JSON.stringify(e,n,r):JSON.stringify(e,oo(n),r)}catch(o){return no("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;0!==Qi.length;){const e=Qi.pop();4===e.length?Object.defineProperty(e[0],e[1],e[3]):e[0][e[1]]=e[2]}}return no(s)}var s}function so(e,t,n,r){var a=Object.getOwnPropertyDescriptor(r,n);void 0!==a.get?a.configurable?(Object.defineProperty(r,n,{value:e}),Qi.push([r,n,t,a])):Yi.push([t,n,e]):(r[n]=e,Qi.push([r,n,t]))}function io(e,t,n,r,a,s,i){var o;if(s+=1,"object"===typeof e&&null!==e){for(o=0;o<r.length;o++)if(r[o]===e)return void so(Xi,e,t,a);if("undefined"!==typeof i.depthLimit&&s>i.depthLimit)return void so(Ki,e,t,a);if("undefined"!==typeof i.edgesLimit&&n+1>i.edgesLimit)return void so(Ki,e,t,a);if(r.push(e),Array.isArray(e))for(o=0;o<e.length;o++)io(e[o],o,o,r,e,s,i);else{e=ro(e);var l=Object.keys(e);for(o=0;o<l.length;o++){var c=l[o];io(e[c],c,o,r,e,s,i)}}r.pop()}}function oo(e){return e="undefined"!==typeof e?e:function(e,t){return t},function(t,n){if(Yi.length>0)for(var r=0;r<Yi.length;r++){var a=Yi[r];if(a[1]===t&&a[0]===n){n=a[2],Yi.splice(r,1);break}}return e.call(this,t,n)}}function lo(e){const t=ki(),n=function(){const e=Ei()||{},t={},n=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION","LANGSMITH_API_KEY","LANGSMITH_ENDPOINT","LANGSMITH_TRACING_V2","LANGSMITH_PROJECT","LANGSMITH_SESSION"];for(const[r,a]of Object.entries(e))!r.startsWith("LANGCHAIN_")&&!r.startsWith("LANGSMITH_")||"string"!==typeof a||n.includes(r)||r.toLowerCase().includes("key")||r.toLowerCase().includes("secret")||r.toLowerCase().includes("token")||("LANGCHAIN_REVISION_ID"===r?t.revision_id=a:t[r]=a);return t}(),r=e.extra??{},a=r.metadata;return e.extra={...r,runtime:{...t,...r?.runtime},metadata:{...n,...n.revision_id||e.revision_id?{revision_id:e.revision_id??n.revision_id}:{},...a}},e}function co(e){if(void 0!==e)return e.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}const uo=async e=>{if(429===e?.status){const t=1e3*parseInt(e.headers.get("retry-after")??"30",10);if(t>0)return await new Promise(e=>setTimeout(e,t)),!0}return!1};function ho(e){return"number"===typeof e?Number(e.toFixed(4)):e}class fo{constructor(){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"sizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:0})}peek(){return this.items[0]}push(e){let t;const n=new Promise(e=>{t=e}),r=ao(e.item,`Serializing run with id: ${e.item.id}`).length;return this.items.push({action:e.action,payload:e.item,otelContext:e.otelContext,itemPromiseResolve:t,itemPromise:n,size:r}),this.sizeBytes+=r,n}pop(e){if(e<1)throw new Error("Number of bytes to pop off may not be less than 1.");const t=[];let n=0;for(;n+(this.peek()?.size??0)<e&&this.items.length>0;){const e=this.items.shift();e&&(t.push(e),n+=e.size,this.sizeBytes-=e.size)}if(0===t.length&&this.items.length>0){const e=this.items.shift();t.push(e),n+=e.size,this.sizeBytes-=e.size}return[t.map(e=>({action:e.action,item:e.payload,otelContext:e.otelContext})),()=>t.forEach(e=>e.itemPromiseResolve())]}}class po{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filteredPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:new fo}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"batchSizeBytesLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"settings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blockOnRootRunFinalization",{enumerable:!0,configurable:!0,writable:!0,value:"false"===xi("LANGSMITH_TRACING_BACKGROUND")}),Object.defineProperty(this,"traceBatchConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(this,"_serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_getServerInfoPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"manualFlushMode",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"langSmithToOTELTranslator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"debug",{enumerable:!0,configurable:!0,writable:!0,value:"true"===xi("LANGSMITH_DEBUG")});const t=po.getDefaultClientConfig();if(this.tracingSampleRate=(e=>{const t=e?.toString()??Oi("TRACING_SAMPLING_RATE");if(void 0===t)return;const n=parseFloat(t);if(n<0||n>1)throw new Error(`LANGSMITH_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${n}`);return n})(e.tracingSamplingRate),this.apiUrl=co(e.apiUrl??t.apiUrl)??"",this.apiUrl.endsWith("/")&&(this.apiUrl=this.apiUrl.slice(0,-1)),this.apiKey=co(e.apiKey??t.apiKey),this.webUrl=co(e.webUrl??t.webUrl),this.webUrl?.endsWith("/")&&(this.webUrl=this.webUrl.slice(0,-1)),this.timeout_ms=e.timeout_ms??9e4,this.caller=new Ui({...e.callerOptions??{},debug:e.debug??this.debug}),this.traceBatchConcurrency=e.traceBatchConcurrency??this.traceBatchConcurrency,this.traceBatchConcurrency<1)throw new Error("Trace batch concurrency must be positive.");this.debug=e.debug??this.debug,this.batchIngestCaller=new Ui({maxRetries:2,maxConcurrency:this.traceBatchConcurrency,...e.callerOptions??{},onFailedResponseHook:uo,debug:e.debug??this.debug}),this.hideInputs=e.hideInputs??e.anonymizer??t.hideInputs,this.hideOutputs=e.hideOutputs??e.anonymizer??t.hideOutputs,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.blockOnRootRunFinalization=e.blockOnRootRunFinalization??this.blockOnRootRunFinalization,this.batchSizeBytesLimit=e.batchSizeBytesLimit,this.fetchOptions=e.fetchOptions||{},this.manualFlushMode=e.manualFlushMode??this.manualFlushMode,"true"===xi("OTEL_ENABLED")&&(this.langSmithToOTELTranslator=new Li)}static getDefaultClientConfig(){const e=Oi("API_KEY");return{apiUrl:Oi("ENDPOINT")??"https://api.smith.langchain.com",apiKey:e,webUrl:void 0,hideInputs:"true"===Oi("HIDE_INPUTS"),hideOutputs:"true"===Oi("HIDE_OUTPUTS")}}getHostUrl(){return this.webUrl?this.webUrl:(e=>{const t=e.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return"localhost"===t||"127.0.0.1"===t||"::1"===t})(this.apiUrl)?(this.webUrl="http://localhost:3000",this.webUrl):this.apiUrl.endsWith("/api/v1")?(this.webUrl=this.apiUrl.replace("/api/v1",""),this.webUrl):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("eu")?(this.webUrl="https://eu.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("beta")?(this.webUrl="https://beta.smith.langchain.com",this.webUrl):(this.webUrl="https://smith.langchain.com",this.webUrl)}get headers(){const e={"User-Agent":`langsmith-js/${yi}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}async processInputs(e){return!1===this.hideInputs?e:!0===this.hideInputs?{}:"function"===typeof this.hideInputs?this.hideInputs(e):e}async processOutputs(e){return!1===this.hideOutputs?e:!0===this.hideOutputs?{}:"function"===typeof this.hideOutputs?this.hideOutputs(e):e}async prepareRunCreateOrUpdateInputs(e){const t={...e};return void 0!==t.inputs&&(t.inputs=await this.processInputs(t.inputs)),void 0!==t.outputs&&(t.outputs=await this.processOutputs(t.outputs)),t}async _getResponse(e,t){const n=t?.toString()??"",r=`${this.apiUrl}${e}?${n}`,a=await this.caller.call(mi(this.debug),r,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ji(a,`Failed to fetch ${e}`),a}async _get(e,t){return(await this._getResponse(e,t)).json()}_getPaginated(e){var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new URLSearchParams,r=arguments.length>2?arguments[2]:void 0;return async function*(){let a=Number(n.get("offset"))||0;const s=Number(n.get("limit"))||100;for(;;){n.set("offset",String(a)),n.set("limit",String(s));const i=`${t.apiUrl}${e}?${n}`,o=await t.caller.call(mi(t.debug),i,{method:"GET",headers:t.headers,signal:AbortSignal.timeout(t.timeout_ms),...t.fetchOptions});await Ji(o,`Failed to fetch ${e}`);const l=r?r(await o.json()):await o.json();if(0===l.length)break;if(yield l,l.length<s)break;a+=l.length}}()}_getCursorPaginatedList(e){var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"POST",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"runs";return async function*(){const s=n?{...n}:{};for(;;){const n=await t.caller.call(mi(t.debug),`${t.apiUrl}${e}`,{method:r,headers:{...t.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(t.timeout_ms),...t.fetchOptions,body:JSON.stringify(s)}),i=await n.json();if(!i)break;if(!i[a])break;yield i[a];const o=i.cursors;if(!o)break;if(!o.next)break;s.cursor=o.next}}()}_shouldSample(){return void 0===this.tracingSampleRate||Math.random()<this.tracingSampleRate}_filterForSampling(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===this.tracingSampleRate)return e;if(t){const t=[];for(const n of e)this.filteredPostUuids.has(n.id)?this.filteredPostUuids.delete(n.id):t.push(n);return t}{const t=[];for(const n of e){const e=n.trace_id??n.id;this.filteredPostUuids.has(e)||(n.id===e?this._shouldSample()?t.push(n):this.filteredPostUuids.add(e):t.push(n))}return t}}async _getBatchSizeLimitBytes(){const e=await this._ensureServerInfo();return this.batchSizeBytesLimit??e.batch_ingest_config?.size_limit_bytes??20971520}async _getMultiPartSupport(){const e=await this._ensureServerInfo();return e.instance_flags?.dataset_examples_multipart_enabled??!1}drainAutoBatchQueue(e){const t=[];for(;this.autoBatchQueue.items.length>0;){const[n,r]=this.autoBatchQueue.pop(e);if(!n.length){r();break}const a=this._processBatch(n,r).catch(console.error);t.push(a)}return Promise.all(t)}async _processBatch(e,t){if(e.length)try{if(void 0!==this.langSmithToOTELTranslator)this._sendBatchToOTELTranslator(e);else{const t={runCreates:e.filter(e=>"create"===e.action).map(e=>e.item),runUpdates:e.filter(e=>"update"===e.action).map(e=>e.item)},n=await this._ensureServerInfo();n?.batch_ingest_config?.use_multipart_endpoint?await this.multipartIngestRuns(t):await this.batchIngestRuns(t)}}catch(n){console.error("Error exporting batch:",n)}finally{t()}else t()}_sendBatchToOTELTranslator(e){if(void 0!==this.langSmithToOTELTranslator){const t=new Map,n=[];for(const r of e)r.item.id&&r.otelContext&&(t.set(r.item.id,r.otelContext),"create"===r.action?n.push({operation:"post",id:r.item.id,trace_id:r.item.trace_id??r.item.id,run:r.item}):n.push({operation:"patch",id:r.item.id,trace_id:r.item.trace_id??r.item.id,run:r.item}));this.langSmithToOTELTranslator.exportBatch(n,t)}}async processRunOperation(e){clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0,"create"===e.action&&(e.item=lo(e.item));const t=this.autoBatchQueue.push(e);if(this.manualFlushMode)return t;const n=await this._getBatchSizeLimitBytes();return this.autoBatchQueue.sizeBytes>n&&this.drainAutoBatchQueue(n),this.autoBatchQueue.items.length>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue(n)},this.autoBatchAggregationDelayMs)),t}async _getServerInfo(){const e=await this.caller.call(mi(this.debug),`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(2500),...this.fetchOptions});await Ji(e,"get server info");const t=await e.json();return this.debug&&console.log("\n=== LangSmith Server Configuration ===\n"+JSON.stringify(t,null,2)+"\n"),t}async _ensureServerInfo(){return void 0===this._getServerInfoPromise&&(this._getServerInfoPromise=(async()=>{if(void 0===this._serverInfo)try{this._serverInfo=await this._getServerInfo()}catch(e){console.warn(`[WARNING]: LangSmith failed to fetch info on supported operations with status code ${e.status}. Falling back to batch operations and default limits.`)}return this._serverInfo??{}})()),this._getServerInfoPromise.then(e=>(void 0===this._serverInfo&&(this._getServerInfoPromise=void 0),e))}async _getSettings(){return this.settings||(this.settings=this._get("/settings")),await this.settings}async flush(){const e=await this._getBatchSizeLimitBytes();await this.drainAutoBatchQueue(e)}_cloneCurrentOTELContext(){const e=Ni(),t=Ci.getContextInstance();if(void 0!==this.langSmithToOTELTranslator){const n=e.getActiveSpan();if(n)return e.setSpan(t.active(),n)}}async createRun(e){if(!this._filterForSampling([e]).length)return;const t={...this.headers,"Content-Type":"application/json"},n=e.project_name;delete e.project_name;const r=await this.prepareRunCreateOrUpdateInputs({session_name:n,...e,start_time:e.start_time??Date.now()});if(this.autoBatchTracing&&void 0!==r.trace_id&&void 0!==r.dotted_order){const e=this._cloneCurrentOTELContext();return void this.processRunOperation({action:"create",item:r,otelContext:e}).catch(console.error)}const a=lo(r),s=await this.caller.call(mi(this.debug),`${this.apiUrl}/runs`,{method:"POST",headers:t,body:ao(a,`Creating run with id: ${a.id}`),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ji(s,"create run",!0)}async batchIngestRuns(e){let{runCreates:t,runUpdates:n}=e;if(void 0===t&&void 0===n)return;let r=await Promise.all(t?.map(e=>this.prepareRunCreateOrUpdateInputs(e))??[]),a=await Promise.all(n?.map(e=>this.prepareRunCreateOrUpdateInputs(e))??[]);if(r.length>0&&a.length>0){const e=r.reduce((e,t)=>t.id?(e[t.id]=t,e):e,{}),t=[];for(const n of a)void 0!==n.id&&e[n.id]?e[n.id]={...e[n.id],...n}:t.push(n);r=Object.values(e),a=t}const s={post:r,patch:a};if(!s.post.length&&!s.patch.length)return;const i={post:[],patch:[]};for(const o of["post","patch"]){const e=o,t=s[e].reverse();let n=t.pop();for(;void 0!==n;)i[e].push(n),n=t.pop()}if(i.post.length>0||i.patch.length>0){const e=i.post.map(e=>e.id).concat(i.patch.map(e=>e.id)).join(",");await this._postBatchIngestRuns(ao(i,`Ingesting runs with ids: ${e}`))}}async _postBatchIngestRuns(e){const t={...this.headers,"Content-Type":"application/json",Accept:"application/json"},n=await this.batchIngestCaller.call(mi(this.debug),`${this.apiUrl}/runs/batch`,{method:"POST",headers:t,body:e,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ji(n,"batch create run",!0)}async multipartIngestRuns(e){let{runCreates:t,runUpdates:n}=e;if(void 0===t&&void 0===n)return;const r={};let a=[];for(const l of t??[]){const e=await this.prepareRunCreateOrUpdateInputs(l);void 0!==e.id&&void 0!==e.attachments&&(r[e.id]=e.attachments),delete e.attachments,a.push(e)}let s=[];for(const l of n??[])s.push(await this.prepareRunCreateOrUpdateInputs(l));if(void 0!==a.find(e=>void 0===e.trace_id||void 0===e.dotted_order))throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when creating a run');if(void 0!==s.find(e=>void 0===e.trace_id||void 0===e.dotted_order))throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when updating a run');if(a.length>0&&s.length>0){const e=a.reduce((e,t)=>t.id?(e[t.id]=t,e):e,{}),t=[];for(const n of s)void 0!==n.id&&e[n.id]?e[n.id]={...e[n.id],...n}:t.push(n);a=Object.values(e),s=t}if(0===a.length&&0===s.length)return;const i=[],o=[];for(const[l,c]of[["post",a],["patch",s]])for(const e of c){const{inputs:t,outputs:n,events:a,attachments:s,...c}=e,u={inputs:t,outputs:n,events:a},d=ao(c,`Serializing for multipart ingestion of run with id: ${c.id}`);o.push({name:`${l}.${c.id}`,payload:new Blob([d],{type:`application/json; length=${d.length}`})});for(const[e,r]of Object.entries(u)){if(void 0===r)continue;const t=ao(r,`Serializing ${e} for multipart ingestion of run with id: ${c.id}`);o.push({name:`${l}.${c.id}.${e}`,payload:new Blob([t],{type:`application/json; length=${t.length}`})})}if(void 0!==c.id){const e=r[c.id];if(e){delete r[c.id];for(const[t,n]of Object.entries(e)){let e,r;Array.isArray(n)?[e,r]=n:(e=n.mimeType,r=n.data),t.includes(".")?console.warn(`Skipping attachment '${t}' for run ${c.id}: Invalid attachment name. Attachment names must not contain periods ('.'). Please rename the attachment and try again.`):o.push({name:`attachment.${c.id}.${t}`,payload:new Blob([r],{type:`${e}; length=${r.byteLength}`})})}}}i.push(`trace=${c.trace_id},id=${c.id}`)}await this._sendMultipartRequest(o,i.join("; "))}async _createNodeFetchBody(e,t){const n=[];for(const a of e)n.push(new Blob([`--${t}\r\n`])),n.push(new Blob([`Content-Disposition: form-data; name="${a.name}"\r\n`,`Content-Type: ${a.payload.type}\r\n\r\n`])),n.push(a.payload),n.push(new Blob(["\r\n"]));n.push(new Blob([`--${t}--\r\n`]));const r=new Blob(n);return await r.arrayBuffer()}async _createMultipartStream(e,t){const n=new TextEncoder;return new ReadableStream({async start(r){const a=async e=>{"string"===typeof e?r.enqueue(n.encode(e)):r.enqueue(e)};for(const n of e){await a(`--${t}\r\n`),await a(`Content-Disposition: form-data; name="${n.name}"\r\n`),await a(`Content-Type: ${n.payload.type}\r\n\r\n`);const e=n.payload.stream().getReader();try{let t;for(;!(t=await e.read()).done;)r.enqueue(t.value)}finally{e.releaseLock()}await a("\r\n")}await a(`--${t}--\r\n`),r.close()}})}async _sendMultipartRequest(e,t){try{const t="----LangSmithFormBoundary"+Math.random().toString(36).slice(2),n=await((()=>{const e=globalThis[pi];return!!e&&"function"===typeof e&&"Headers"in e&&"Request"in e&&"Response"in e})()?this._createNodeFetchBody(e,t):this._createMultipartStream(e,t)),r=await this.batchIngestCaller.call(mi(this.debug),`${this.apiUrl}/runs/multipart`,{method:"POST",headers:{...this.headers,"Content-Type":`multipart/form-data; boundary=${t}`},body:n,duplex:"half",signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ji(r,"ingest multipart runs",!0)}catch(n){console.warn(`${n.message.trim()}\n\nContext: ${t}`)}}async updateRun(e,t){Hi(e),t.inputs&&(t.inputs=await this.processInputs(t.inputs)),t.outputs&&(t.outputs=await this.processOutputs(t.outputs));const n={...t,id:e};if(!this._filterForSampling([n],!0).length)return;if(this.autoBatchTracing&&void 0!==n.trace_id&&void 0!==n.dotted_order){const e=this._cloneCurrentOTELContext();return void 0!==t.end_time&&void 0===n.parent_run_id&&this.blockOnRootRunFinalization&&!this.manualFlushMode?void await this.processRunOperation({action:"update",item:n,otelContext:e}).catch(console.error):void this.processRunOperation({action:"update",item:n,otelContext:e}).catch(console.error)}const r={...this.headers,"Content-Type":"application/json"},a=await this.caller.call(mi(this.debug),`${this.apiUrl}/runs/${e}`,{method:"PATCH",headers:r,body:ao(t,`Serializing payload to update run with id: ${e}`),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ji(a,"update run",!0)}async readRun(e){let{loadChildRuns:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{loadChildRuns:!1};Hi(e);let n=await this._get(`/runs/${e}`);return t&&(n=await this._loadChildRuns(n)),n}async getRunUrl(e){let{runId:t,run:n,projectOpts:r}=e;if(void 0!==n){let e;if(n.session_id)e=n.session_id;else if(r?.projectName)e=(await this.readProject({projectName:r?.projectName})).id;else if(r?.projectId)e=r?.projectId;else{e=(await this.readProject({projectName:Oi("PROJECT")||"default"})).id}const t=await this._getTenantId();return`${this.getHostUrl()}/o/${t}/projects/p/${e}/r/${n.id}?poll=true`}if(void 0!==t){const e=await this.readRun(t);if(!e.app_path)throw new Error(`Run ${t} has no app_path`);return`${this.getHostUrl()}${e.app_path}`}throw new Error("Must provide either runId or run")}async _loadChildRuns(e){const t=await async function(e){const t=[];for await(const n of e)t.push(n);return t}(this.listRuns({isRoot:!1,projectId:e.session_id,traceId:e.trace_id})),n={},r={};t.sort((e,t)=>(e?.dotted_order??"").localeCompare(t?.dotted_order??""));for(const a of t){if(null===a.parent_run_id||void 0===a.parent_run_id)throw new Error(`Child run ${a.id} has no parent`);a.dotted_order?.startsWith(e.dotted_order??"")&&a.id!==e.id&&(a.parent_run_id in n||(n[a.parent_run_id]=[]),n[a.parent_run_id].push(a),r[a.id]=a)}e.child_runs=n[e.id]||[];for(const a in n)a!==e.id&&(r[a].child_runs=n[a]);return e}async*listRuns(e){const{projectId:t,projectName:n,parentRunId:r,traceId:a,referenceExampleId:s,startTime:i,executionOrder:o,isRoot:l,runType:c,error:u,id:d,query:h,filter:f,traceFilter:p,treeFilter:m,limit:g,select:y,order:b}=e;let v=[];if(t&&(v=Array.isArray(t)?t:[t]),n){const e=Array.isArray(n)?n:[n],t=await Promise.all(e.map(e=>this.readProject({projectName:e}).then(e=>e.id)));v.push(...t)}const w={session:v.length?v:null,run_type:c,reference_example:s,query:h,filter:f,trace_filter:p,tree_filter:m,execution_order:o,parent_run:r,start_time:i?i.toISOString():null,error:u,id:d,limit:g,trace:a,select:y||["app_path","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],is_root:l,order:b};let _=0;for await(const S of this._getCursorPaginatedList("/runs/query",w))if(g){if(_>=g)break;if(S.length+_>g){const e=S.slice(0,g-_);yield*e;break}_+=S.length,yield*S}else yield*S}async*listGroupRuns(e){const{projectId:t,projectName:n,groupBy:r,filter:a,startTime:s,endTime:i,limit:o,offset:l}=e,c={session_id:t||(await this.readProject({projectName:n})).id,group_by:r,filter:a,start_time:s?s.toISOString():null,end_time:i?i.toISOString():null,limit:Number(o)||100};let u=Number(l)||0;const d="/runs/group",h=`${this.apiUrl}${d}`;for(;;){const e={...c,offset:u},t=Object.fromEntries(Object.entries(e).filter(e=>{let[t,n]=e;return void 0!==n})),n=await this.caller.call(mi(),h,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ji(n,`Failed to fetch ${d}`);const r=await n.json(),{groups:a,total:s}=r;if(0===a.length)break;for(const i of a)yield i;if(u+=a.length,u>=s)break}}async getRunStats(e){let{id:t,trace:n,parentRun:r,runType:a,projectNames:s,projectIds:i,referenceExampleIds:o,startTime:l,endTime:c,error:u,query:d,filter:h,traceFilter:f,treeFilter:p,isRoot:m,dataSourceType:g}=e,y=i||[];s&&(y=[...i||[],...await Promise.all(s.map(e=>this.readProject({projectName:e}).then(e=>e.id)))]);const b={id:t,trace:n,parent_run:r,run_type:a,session:y,reference_example:o,start_time:l,end_time:c,error:u,query:d,filter:h,trace_filter:f,tree_filter:p,is_root:m,data_source_type:g},v=Object.fromEntries(Object.entries(b).filter(e=>{let[t,n]=e;return void 0!==n})),w=await this.caller.call(mi(this.debug),`${this.apiUrl}/runs/stats`,{method:"POST",headers:this.headers,body:JSON.stringify(v),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await w.json()}async shareRun(e){let{shareId:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n={run_id:e,share_token:t||Is()};Hi(e);const r=await this.caller.call(mi(this.debug),`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),a=await r.json();if(null===a||!("share_token"in a))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${a.share_token}/r`}async unshareRun(e){Hi(e);const t=await this.caller.call(mi(this.debug),`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ji(t,"unshare run",!0)}async readRunSharedLink(e){Hi(e);const t=await this.caller.call(mi(this.debug),`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),n=await t.json();if(null!==n&&"share_token"in n)return`${this.getHostUrl()}/public/${n.share_token}/r`}async listSharedRuns(e){let{runIds:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=new URLSearchParams({share_token:e});if(void 0!==t)for(const a of t)n.append("id",a);Hi(e);const r=await this.caller.call(mi(this.debug),`${this.apiUrl}/public/${e}/runs${n}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await r.json()}async readDatasetSharedSchema(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");if(!e){e=(await this.readDataset({datasetName:t})).id}Hi(e);const n=await this.caller.call(mi(this.debug),`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),r=await n.json();return r.url=`${this.getHostUrl()}/public/${r.share_token}/d`,r}async shareDataset(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");if(!e){e=(await this.readDataset({datasetName:t})).id}const n={dataset_id:e};Hi(e);const r=await this.caller.call(mi(this.debug),`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),a=await r.json();return a.url=`${this.getHostUrl()}/public/${a.share_token}/d`,a}async unshareDataset(e){Hi(e);const t=await this.caller.call(mi(this.debug),`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ji(t,"unshare dataset",!0)}async readSharedDataset(e){Hi(e);const t=await this.caller.call(mi(this.debug),`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await t.json()}async listSharedExamples(e,t){const n={};t?.exampleIds&&(n.id=t.exampleIds);const r=new URLSearchParams;Object.entries(n).forEach(e=>{let[t,n]=e;Array.isArray(n)?n.forEach(e=>r.append(t,e)):r.append(t,n)});const a=await this.caller.call(mi(this.debug),`${this.apiUrl}/public/${e}/examples?${r.toString()}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),s=await a.json();if(!a.ok){if("detail"in s)throw new Error(`Failed to list shared examples.\nStatus: ${a.status}\nMessage: ${Array.isArray(s.detail)?s.detail.join("\n"):"Unspecified error"}`);throw new Error(`Failed to list shared examples: ${a.status} ${a.statusText}`)}return s.map(e=>({...e,_hostUrl:this.getHostUrl()}))}async createProject(e){let{projectName:t,description:n=null,metadata:r=null,upsert:a=!1,projectExtra:s=null,referenceDatasetId:i=null}=e;const o=a?"?upsert=true":"",l=`${this.apiUrl}/sessions${o}`,c=s||{};r&&(c.metadata=r);const u={name:t,extra:c,description:n};null!==i&&(u.reference_dataset_id=i);const d=await this.caller.call(mi(this.debug),l,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ji(d,"create project");return await d.json()}async updateProject(e,t){let{name:n=null,description:r=null,metadata:a=null,projectExtra:s=null,endTime:i=null}=t;const o=`${this.apiUrl}/sessions/${e}`;let l=s;a&&(l={...l||{},metadata:a});const c={name:n,extra:l,description:r,end_time:i?new Date(i).toISOString():null},u=await this.caller.call(mi(this.debug),o,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ji(u,"update project");return await u.json()}async hasProject(e){let{projectId:t,projectName:n}=e,r="/sessions";const a=new URLSearchParams;if(void 0!==t&&void 0!==n)throw new Error("Must provide either projectName or projectId, not both");if(void 0!==t)Hi(t),r+=`/${t}`;else{if(void 0===n)throw new Error("Must provide projectName or projectId");a.append("name",n)}const s=await this.caller.call(mi(this.debug),`${this.apiUrl}${r}?${a}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});try{const e=await s.json();return!!s.ok&&(!Array.isArray(e)||e.length>0)}catch(i){return!1}}async readProject(e){let{projectId:t,projectName:n,includeStats:r}=e,a="/sessions";const s=new URLSearchParams;if(void 0!==t&&void 0!==n)throw new Error("Must provide either projectName or projectId, not both");if(void 0!==t)Hi(t),a+=`/${t}`;else{if(void 0===n)throw new Error("Must provide projectName or projectId");s.append("name",n)}void 0!==r&&s.append("include_stats",r.toString());const i=await this._get(a,s);let o;if(Array.isArray(i)){if(0===i.length)throw new Error(`Project[id=${t}, name=${n}] not found`);o=i[0]}else o=i;return o}async getProjectUrl(e){let{projectId:t,projectName:n}=e;if(void 0===t&&void 0===n)throw new Error("Must provide either projectName or projectId");const r=await this.readProject({projectId:t,projectName:n}),a=await this._getTenantId();return`${this.getHostUrl()}/o/${a}/projects/p/${r.id}`}async getDatasetUrl(e){let{datasetId:t,datasetName:n}=e;if(void 0===t&&void 0===n)throw new Error("Must provide either datasetName or datasetId");const r=await this.readDataset({datasetId:t,datasetName:n}),a=await this._getTenantId();return`${this.getHostUrl()}/o/${a}/datasets/${r.id}`}async _getTenantId(){if(null!==this._tenantId)return this._tenantId;const e=new URLSearchParams({limit:"1"});for await(const t of this._getPaginated("/sessions",e))return this._tenantId=t[0].tenant_id,t[0].tenant_id;throw new Error("No projects found to resolve tenant.")}listProjects(){var e=this;let{projectIds:t,name:n,nameContains:r,referenceDatasetId:a,referenceDatasetName:s,referenceFree:i,metadata:o}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return async function*(){const l=new URLSearchParams;if(void 0!==t)for(const e of t)l.append("id",e);if(void 0!==n&&l.append("name",n),void 0!==r&&l.append("name_contains",r),void 0!==a)l.append("reference_dataset",a);else if(void 0!==s){const t=await e.readDataset({datasetName:s});l.append("reference_dataset",t.id)}void 0!==i&&l.append("reference_free",i.toString()),void 0!==o&&l.append("metadata",JSON.stringify(o));for await(const t of e._getPaginated("/sessions",l))yield*t}()}async deleteProject(e){let t,{projectId:n,projectName:r}=e;if(void 0===n&&void 0===r)throw new Error("Must provide projectName or projectId");if(void 0!==n&&void 0!==r)throw new Error("Must provide either projectName or projectId, not both");t=void 0===n?(await this.readProject({projectName:r})).id:n,Hi(t);const a=await this.caller.call(mi(this.debug),`${this.apiUrl}/sessions/${t}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ji(a,`delete session ${t} (${r})`,!0)}async uploadCsv(e){let{csvFile:t,fileName:n,inputKeys:r,outputKeys:a,description:s,dataType:i,name:o}=e;const l=`${this.apiUrl}/datasets/upload`,c=new FormData;c.append("file",t,n),r.forEach(e=>{c.append("input_keys",e)}),a.forEach(e=>{c.append("output_keys",e)}),s&&c.append("description",s),i&&c.append("data_type",i),o&&c.append("name",o);const u=await this.caller.call(mi(this.debug),l,{method:"POST",headers:this.headers,body:c,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ji(u,"upload CSV");return await u.json()}async createDataset(e){let{description:t,dataType:n,inputsSchema:r,outputsSchema:a,metadata:s}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i={name:e,description:t,extra:s?{metadata:s}:void 0};n&&(i.data_type=n),r&&(i.inputs_schema_definition=r),a&&(i.outputs_schema_definition=a);const o=await this.caller.call(mi(this.debug),`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ji(o,"create dataset");return await o.json()}async readDataset(e){let{datasetId:t,datasetName:n}=e,r="/datasets";const a=new URLSearchParams({limit:"1"});if(void 0!==t&&void 0!==n)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0!==t)Hi(t),r+=`/${t}`;else{if(void 0===n)throw new Error("Must provide datasetName or datasetId");a.append("name",n)}const s=await this._get(r,a);let i;if(Array.isArray(s)){if(0===s.length)throw new Error(`Dataset[id=${t}, name=${n}] not found`);i=s[0]}else i=s;return i}async hasDataset(e){let{datasetId:t,datasetName:n}=e;try{return await this.readDataset({datasetId:t,datasetName:n}),!0}catch(r){if(r instanceof Error&&r.message.toLocaleLowerCase().includes("not found"))return!1;throw r}}async diffDatasetVersions(e){let{datasetId:t,datasetName:n,fromVersion:r,toVersion:a}=e,s=t;if(void 0===s&&void 0===n)throw new Error("Must provide either datasetName or datasetId");if(void 0!==s&&void 0!==n)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0===s){s=(await this.readDataset({datasetName:n})).id}const i=new URLSearchParams({from_version:"string"===typeof r?r:r.toISOString(),to_version:"string"===typeof a?a:a.toISOString()});return await this._get(`/datasets/${s}/versions/diff`,i)}async readDatasetOpenaiFinetuning(e){let{datasetId:t,datasetName:n}=e;if(void 0!==t);else{if(void 0===n)throw new Error("Must provide either datasetName or datasetId");t=(await this.readDataset({datasetName:n})).id}const r=await this._getResponse(`/datasets/${t}/openai_ft`);return(await r.text()).trim().split("\n").map(e=>JSON.parse(e))}listDatasets(){var e=this;let{limit:t=100,offset:n=0,datasetIds:r,datasetName:a,datasetNameContains:s,metadata:i}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return async function*(){const o=new URLSearchParams({limit:t.toString(),offset:n.toString()});if(void 0!==r)for(const e of r)o.append("id",e);void 0!==a&&o.append("name",a),void 0!==s&&o.append("name_contains",s),void 0!==i&&o.append("metadata",JSON.stringify(i));for await(const t of e._getPaginated("/datasets",o))yield*t}()}async updateDataset(e){const{datasetId:t,datasetName:n,...r}=e;if(!t&&!n)throw new Error("Must provide either datasetName or datasetId");const a=t??(await this.readDataset({datasetName:n})).id;Hi(a);const s=await this.caller.call(mi(this.debug),`${this.apiUrl}/datasets/${a}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ji(s,"update dataset"),await s.json()}async updateDatasetTag(e){const{datasetId:t,datasetName:n,asOf:r,tag:a}=e;if(!t&&!n)throw new Error("Must provide either datasetName or datasetId");const s=t??(await this.readDataset({datasetName:n})).id;Hi(s);const i=await this.caller.call(mi(this.debug),`${this.apiUrl}/datasets/${s}/tags`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({as_of:"string"===typeof r?r:r.toISOString(),tag:a}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ji(i,"update dataset tags")}async deleteDataset(e){let{datasetId:t,datasetName:n}=e,r="/datasets",a=t;if(void 0!==t&&void 0!==n)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0!==n){a=(await this.readDataset({datasetName:n})).id}if(void 0===a)throw new Error("Must provide datasetName or datasetId");Hi(a),r+=`/${a}`;const s=await this.caller.call(mi(this.debug),this.apiUrl+r,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ji(s,`delete ${r}`),await s.json()}async indexDataset(e){let{datasetId:t,datasetName:n,tag:r}=e,a=t;if(!a&&!n)throw new Error("Must provide either datasetName or datasetId");if(a&&n)throw new Error("Must provide either datasetName or datasetId, not both");if(!a){a=(await this.readDataset({datasetName:n})).id}Hi(a);const s={tag:r},i=await this.caller.call(mi(this.debug),`${this.apiUrl}/datasets/${a}/index`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ji(i,"index dataset"),await i.json()}async similarExamples(e,t,n){let{filter:r}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const a={limit:n,inputs:e};void 0!==r&&(a.filter=r),Hi(t);const s=await this.caller.call(mi(this.debug),`${this.apiUrl}/datasets/${t}/search`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ji(s,"fetch similar examples");return(await s.json()).examples}async createExample(e,t,n){if(mo(e)&&(void 0!==t||void 0!==n))throw new Error("Cannot provide outputs or options when using ExampleCreate object");let r=t?n?.datasetId:e.dataset_id;const a=t?n?.datasetName:e.dataset_name;if(void 0===r&&void 0===a)throw new Error("Must provide either datasetName or datasetId");if(void 0!==r&&void 0!==a)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0===r){r=(await this.readDataset({datasetName:a})).id}const s=(t?n?.createdAt:e.created_at)||new Date;let i;i=mo(e)?e:{inputs:e,outputs:t,created_at:s?.toISOString(),id:n?.exampleId,metadata:n?.metadata,split:n?.split,source_run_id:n?.sourceRunId,use_source_run_io:n?.useSourceRunIO,use_source_run_attachments:n?.useSourceRunAttachments,attachments:n?.attachments};const o=await this._uploadExamplesMultipart(r,[i]);return await this.readExample(o.example_ids?.[0]??Is())}async createExamples(e){if(Array.isArray(e)){if(0===e.length)return[];const t=e;let n=t[0].dataset_id;const r=t[0].dataset_name;if(void 0===n&&void 0===r)throw new Error("Must provide either datasetName or datasetId");if(void 0!==n&&void 0!==r)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0===n){n=(await this.readDataset({datasetName:r})).id}const a=await this._uploadExamplesMultipart(n,t);return await Promise.all(a.example_ids.map(e=>this.readExample(e)))}const{inputs:t,outputs:n,metadata:r,splits:a,sourceRunIds:s,useSourceRunIOs:i,useSourceRunAttachments:o,attachments:l,exampleIds:c,datasetId:u,datasetName:d}=e;if(void 0===t)throw new Error("Must provide inputs when using legacy parameters");let h=u;const f=d;if(void 0===h&&void 0===f)throw new Error("Must provide either datasetName or datasetId");if(void 0!==h&&void 0!==f)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0===h){const e=await this.readDataset({datasetName:f});h=e.id}const p=t.map((e,t)=>({dataset_id:h,inputs:e,outputs:n?.[t],metadata:r?.[t],split:a?.[t],id:c?.[t],attachments:l?.[t],source_run_id:s?.[t],use_source_run_io:i?.[t],use_source_run_attachments:o?.[t]})),m=await this._uploadExamplesMultipart(h,p);return await Promise.all(m.example_ids.map(e=>this.readExample(e)))}async createLLMExample(e,t,n){return this.createExample({input:e},{output:t},n)}async createChatExample(e,t,n){const r=e.map(e=>Fi(e)?Bi(e):e),a=Fi(t)?Bi(t):t;return this.createExample({input:r},{output:a},n)}async readExample(e){Hi(e);const t=`/examples/${e}`,n=await this._get(t),{attachment_urls:r,...a}=n,s=a;return r&&(s.attachments=Object.entries(r).reduce((e,t)=>{let[n,r]=t;return e[n.slice(11)]={presigned_url:r.presigned_url,mime_type:r.mime_type},e},{})),s}listExamples(){var e=this;let{datasetId:t,datasetName:n,exampleIds:r,asOf:a,splits:s,inlineS3Urls:i,metadata:o,limit:l,offset:c,filter:u,includeAttachments:d}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return async function*(){let h;if(void 0!==t&&void 0!==n)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0!==t)h=t;else{if(void 0===n)throw new Error("Must provide a datasetName or datasetId");h=(await e.readDataset({datasetName:n})).id}const f=new URLSearchParams({dataset:h}),p=a?"string"===typeof a?a:a?.toISOString():void 0;p&&f.append("as_of",p);const m=i??!0;if(f.append("inline_s3_urls",m.toString()),void 0!==r)for(const e of r)f.append("id",e);if(void 0!==s)for(const e of s)f.append("splits",e);if(void 0!==o){const e=JSON.stringify(o);f.append("metadata",e)}void 0!==l&&f.append("limit",l.toString()),void 0!==c&&f.append("offset",c.toString()),void 0!==u&&f.append("filter",u),!0===d&&["attachment_urls","outputs","metadata"].forEach(e=>f.append("select",e));let g=0;for await(const t of e._getPaginated("/examples",f)){for(const e of t){const{attachment_urls:t,...n}=e,r=n;t&&(r.attachments=Object.entries(t).reduce((e,t)=>{let[n,r]=t;return e[n.slice(11)]={presigned_url:r.presigned_url,mime_type:r.mime_type||void 0},e},{})),yield r,g++}if(void 0!==l&&g>=l)break}}()}async deleteExample(e){Hi(e);const t=`/examples/${e}`,n=await this.caller.call(mi(this.debug),this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ji(n,`delete ${t}`),await n.json()}async updateExample(e,t){let n,r,a;if(n=t?e:e.id,Hi(n),r=t?{id:n,...t}:e,void 0!==r.dataset_id)a=r.dataset_id;else{a=(await this.readExample(n)).dataset_id}return this._updateExamplesMultipart(a,[r])}async updateExamples(e){let t;if(void 0===e[0].dataset_id){t=(await this.readExample(e[0].id)).dataset_id}else t=e[0].dataset_id;return this._updateExamplesMultipart(t,e)}async readDatasetVersion(e){let t,{datasetId:n,datasetName:r,asOf:a,tag:s}=e;if(n)t=n;else{t=(await this.readDataset({datasetName:r})).id}if(Hi(t),a&&s||!a&&!s)throw new Error("Exactly one of asOf and tag must be specified.");const i=new URLSearchParams;void 0!==a&&i.append("as_of","string"===typeof a?a:a.toISOString()),void 0!==s&&i.append("tag",s);const o=await this.caller.call(mi(this.debug),`${this.apiUrl}/datasets/${t}/version?${i.toString()}`,{method:"GET",headers:{...this.headers},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ji(o,"read dataset version"),await o.json()}async listDatasetSplits(e){let t,{datasetId:n,datasetName:r,asOf:a}=e;if(void 0===n&&void 0===r)throw new Error("Must provide dataset name or ID");if(void 0!==n&&void 0!==r)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0===n){t=(await this.readDataset({datasetName:r})).id}else t=n;Hi(t);const s=new URLSearchParams,i=a?"string"===typeof a?a:a?.toISOString():void 0;i&&s.append("as_of",i);return await this._get(`/datasets/${t}/splits`,s)}async updateDatasetSplits(e){let t,{datasetId:n,datasetName:r,splitName:a,exampleIds:s,remove:i=!1}=e;if(void 0===n&&void 0===r)throw new Error("Must provide dataset name or ID");if(void 0!==n&&void 0!==r)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0===n){t=(await this.readDataset({datasetName:r})).id}else t=n;Hi(t);const o={split_name:a,examples:s.map(e=>(Hi(e),e)),remove:i},l=await this.caller.call(mi(this.debug),`${this.apiUrl}/datasets/${t}/splits`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ji(l,"update dataset splits",!0)}async evaluateRun(e,t){let n,{sourceInfo:r,loadChildRuns:a,referenceExample:s}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{loadChildRuns:!1};if(Vi("This method is deprecated and will be removed in future LangSmith versions, use `evaluate` from `langsmith/evaluation` instead."),"string"===typeof e)n=await this.readRun(e,{loadChildRuns:a});else{if("object"!==typeof e||!("id"in e))throw new Error("Invalid run type: "+typeof e);n=e}null!==n.reference_example_id&&void 0!==n.reference_example_id&&(s=await this.readExample(n.reference_example_id));const i=await t.evaluateRun(n,s),[o,l]=await this._logEvaluationFeedback(i,n,r);return l[0]}async createFeedback(e,t,n){let{score:r,value:a,correction:s,comment:i,sourceInfo:o,feedbackSourceType:l="api",sourceRunId:c,feedbackId:u,feedbackConfig:d,projectId:h,comparativeExperimentId:f}=n;if(!e&&!h)throw new Error("One of runId or projectId must be provided");if(e&&h)throw new Error("Only one of runId or projectId can be provided");const p={type:l??"api",metadata:o??{}};void 0===c||void 0===p?.metadata||p.metadata.__run||(p.metadata.__run={run_id:c}),void 0!==p?.metadata&&void 0!==p.metadata.__run?.run_id&&Hi(p.metadata.__run.run_id);const m={id:u??Is(),run_id:e,key:t,score:ho(r),value:a,correction:s,comment:i,feedback_source:p,comparative_experiment_id:f,feedbackConfig:d,session_id:h},g=`${this.apiUrl}/feedback`,y=await this.caller.call(mi(this.debug),g,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(m),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ji(y,"create feedback",!0),m}async updateFeedback(e,t){let{score:n,value:r,correction:a,comment:s}=t;const i={};void 0!==n&&null!==n&&(i.score=ho(n)),void 0!==r&&null!==r&&(i.value=r),void 0!==a&&null!==a&&(i.correction=a),void 0!==s&&null!==s&&(i.comment=s),Hi(e);const o=await this.caller.call(mi(this.debug),`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ji(o,"update feedback",!0)}async readFeedback(e){Hi(e);const t=`/feedback/${e}`;return await this._get(t)}async deleteFeedback(e){Hi(e);const t=`/feedback/${e}`,n=await this.caller.call(mi(this.debug),this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ji(n,`delete ${t}`),await n.json()}listFeedback(){var e=this;let{runIds:t,feedbackKeys:n,feedbackSourceTypes:r}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return async function*(){const a=new URLSearchParams;if(t&&a.append("run",t.join(",")),n)for(const e of n)a.append("key",e);if(r)for(const e of r)a.append("source",e);for await(const t of e._getPaginated("/feedback",a))yield*t}()}async createPresignedFeedbackToken(e,t){let{expiration:n,feedbackConfig:r}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const a={run_id:e,feedback_key:t,feedback_config:r};n?"string"===typeof n?a.expires_at=n:(n?.hours||n?.minutes||n?.days)&&(a.expires_in=n):a.expires_in={hours:3};const s=await this.caller.call(mi(this.debug),`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await s.json()}async createComparativeExperiment(e){let{name:t,experimentIds:n,referenceDatasetId:r,createdAt:a,description:s,metadata:i,id:o}=e;if(0===n.length)throw new Error("At least one experiment is required");if(r||(r=(await this.readProject({projectId:n[0]})).reference_dataset_id),null==!r)throw new Error("A reference dataset is required");const l={id:o,name:t,experiment_ids:n,reference_dataset_id:r,description:s,created_at:(a??new Date)?.toISOString(),extra:{}};i&&(l.extra.metadata=i);const c=await this.caller.call(mi(this.debug),`${this.apiUrl}/datasets/comparative`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await c.json()}async*listPresignedFeedbackTokens(e){Hi(e);const t=new URLSearchParams({run_id:e});for await(const n of this._getPaginated("/feedback/tokens",t))yield*n}_selectEvalResults(e){let t;return t="results"in e?e.results:Array.isArray(e)?e:[e],t}async _logEvaluationFeedback(e,t,n){const r=this._selectEvalResults(e),a=[];for(const s of r){let e=n||{};s.evaluatorInfo&&(e={...s.evaluatorInfo,...e});let r=null;s.targetRunId?r=s.targetRunId:t&&(r=t.id),a.push(await this.createFeedback(r,s.key,{score:s.score,value:s.value,comment:s.comment,correction:s.correction,sourceInfo:e,sourceRunId:s.sourceRunId,feedbackConfig:s.feedbackConfig,feedbackSourceType:"model"}))}return[r,a]}async logEvaluationFeedback(e,t,n){const[r]=await this._logEvaluationFeedback(e,t,n);return r}listAnnotationQueues(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return async function*(){const{queueIds:n,name:r,nameContains:a,limit:s}=t,i=new URLSearchParams;n&&n.forEach((e,t)=>{Hi(e,`queueIds[${t}]`),i.append("ids",e)}),r&&i.append("name",r),a&&i.append("name_contains",a),i.append("limit",(void 0!==s?Math.min(s,100):100).toString());let o=0;for await(const t of e._getPaginated("/annotation-queues",i))if(yield*t,o++,void 0!==s&&o>=s)break}()}async createAnnotationQueue(e){const{name:t,description:n,queueId:r,rubricInstructions:a}=e,s={name:t,description:n,id:r||Is(),rubric_instructions:a},i=await this.caller.call(mi(this.debug),`${this.apiUrl}/annotation-queues`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(Object.fromEntries(Object.entries(s).filter(e=>{let[t,n]=e;return void 0!==n}))),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ji(i,"create annotation queue");return await i.json()}async readAnnotationQueue(e){const t=await this.caller.call(mi(this.debug),`${this.apiUrl}/annotation-queues/${Hi(e,"queueId")}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ji(t,"read annotation queue");return await t.json()}async updateAnnotationQueue(e,t){const{name:n,description:r,rubricInstructions:a}=t,s=await this.caller.call(mi(this.debug),`${this.apiUrl}/annotation-queues/${Hi(e,"queueId")}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({name:n,description:r,rubric_instructions:a}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ji(s,"update annotation queue")}async deleteAnnotationQueue(e){const t=await this.caller.call(mi(this.debug),`${this.apiUrl}/annotation-queues/${Hi(e,"queueId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ji(t,"delete annotation queue")}async addRunsToAnnotationQueue(e,t){const n=await this.caller.call(mi(this.debug),`${this.apiUrl}/annotation-queues/${Hi(e,"queueId")}/runs`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t.map((e,t)=>Hi(e,`runIds[${t}]`).toString())),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ji(n,"add runs to annotation queue")}async getRunFromAnnotationQueue(e,t){const n=`/annotation-queues/${Hi(e,"queueId")}/run`,r=await this.caller.call(mi(this.debug),`${this.apiUrl}${n}/${t}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ji(r,"get run from annotation queue"),await r.json()}async deleteRunFromAnnotationQueue(e,t){const n=await this.caller.call(mi(this.debug),`${this.apiUrl}/annotation-queues/${Hi(e,"queueId")}/runs/${Hi(t,"queueRunId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ji(n,"delete run from annotation queue")}async getSizeFromAnnotationQueue(e){const t=await this.caller.call(mi(this.debug),`${this.apiUrl}/annotation-queues/${Hi(e,"queueId")}/size`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ji(t,"get size from annotation queue"),await t.json()}async _currentTenantIsOwner(e){const t=await this._getSettings();return"-"==e||t.tenant_handle===e}async _ownerConflictError(e,t){const n=await this._getSettings();return new Error(`Cannot ${e} for another tenant.\n\n      Current tenant: ${n.tenant_handle}\n\n      Requested tenant: ${t}`)}async _getLatestCommitHash(e){const t=await this.caller.call(mi(this.debug),`${this.apiUrl}/commits/${e}/?limit=1&offset=0`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),n=await t.json();if(!t.ok){const e="string"===typeof n.detail?n.detail:JSON.stringify(n.detail),r=new Error(`Error ${t.status}: ${t.statusText}\n${e}`);throw r.statusCode=t.status,r}if(0!==n.commits.length)return n.commits[0].commit_hash}async _likeOrUnlikePrompt(e,t){const[n,r,a]=Zi(e),s=await this.caller.call(mi(this.debug),`${this.apiUrl}/likes/${n}/${r}`,{method:"POST",body:JSON.stringify({like:t}),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ji(s,(t?"like":"unlike")+" prompt"),await s.json()}async _getPromptUrl(e){const[t,n,r]=Zi(e);if(await this._currentTenantIsOwner(t)){const e=await this._getSettings();return"latest"!==r?`${this.getHostUrl()}/prompts/${n}/${r.substring(0,8)}?organizationId=${e.id}`:`${this.getHostUrl()}/prompts/${n}?organizationId=${e.id}`}return"latest"!==r?`${this.getHostUrl()}/hub/${t}/${n}/${r.substring(0,8)}`:`${this.getHostUrl()}/hub/${t}/${n}`}async promptExists(e){return!!await this.getPrompt(e)}async likePrompt(e){return this._likeOrUnlikePrompt(e,!0)}async unlikePrompt(e){return this._likeOrUnlikePrompt(e,!1)}async*listCommits(e){for await(const t of this._getPaginated(`/commits/${e}/`,new URLSearchParams,e=>e.commits))yield*t}async*listPrompts(e){const t=new URLSearchParams;t.append("sort_field",e?.sortField??"updated_at"),t.append("sort_direction","desc"),t.append("is_archived",(!!e?.isArchived).toString()),void 0!==e?.isPublic&&t.append("is_public",e.isPublic.toString()),e?.query&&t.append("query",e.query);for await(const n of this._getPaginated("/repos",t,e=>e.repos))yield*n}async getPrompt(e){const[t,n,r]=Zi(e),a=await this.caller.call(mi(this.debug),`${this.apiUrl}/repos/${t}/${n}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(404===a.status)return null;await Ji(a,"get prompt");const s=await a.json();return s.repo?s.repo:null}async createPrompt(e,t){const n=await this._getSettings();if(t?.isPublic&&!n.tenant_handle)throw new Error("Cannot create a public prompt without first\n\n        creating a LangChain Hub handle. \n        You can add a handle by creating a public prompt at:\n\n        https://smith.langchain.com/prompts");const[r,a,s]=Zi(e);if(!await this._currentTenantIsOwner(r))throw await this._ownerConflictError("create a prompt",r);const i={repo_handle:a,...t?.description&&{description:t.description},...t?.readme&&{readme:t.readme},...t?.tags&&{tags:t.tags},is_public:!!t?.isPublic},o=await this.caller.call(mi(this.debug),`${this.apiUrl}/repos/`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ji(o,"create prompt");const{repo:l}=await o.json();return l}async createCommit(e,t,n){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[r,a,s]=Zi(e),i="latest"!==n?.parentCommitHash&&n?.parentCommitHash?n?.parentCommitHash:await this._getLatestCommitHash(`${r}/${a}`),o={manifest:JSON.parse(JSON.stringify(t)),parent_commit:i},l=await this.caller.call(mi(this.debug),`${this.apiUrl}/commits/${r}/${a}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ji(l,"create commit");const c=await l.json();return this._getPromptUrl(`${r}/${a}${c.commit_hash?`:${c.commit_hash}`:""}`)}async updateExamplesMultipart(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return this._updateExamplesMultipart(e,t)}async _updateExamplesMultipart(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(!await this._getMultiPartSupport())throw new Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");const n=new FormData;for(const s of t){const e=s.id,t=ao({...s.metadata&&{metadata:s.metadata},...s.split&&{split:s.split}},`Serializing body for example with id: ${e}`),r=new Blob([t],{type:"application/json"});if(n.append(e,r),s.inputs){const t=ao(s.inputs,`Serializing inputs for example with id: ${e}`),r=new Blob([t],{type:"application/json"});n.append(`${e}.inputs`,r)}if(s.outputs){const t=ao(s.outputs,`Serializing outputs whle updating example with id: ${e}`),r=new Blob([t],{type:"application/json"});n.append(`${e}.outputs`,r)}if(s.attachments)for(const[a,i]of Object.entries(s.attachments)){let t,r;Array.isArray(i)?[t,r]=i:(t=i.mimeType,r=i.data);const s=new Blob([r],{type:`${t}; length=${r.byteLength}`});n.append(`${e}.attachment.${a}`,s)}if(s.attachments_operations){const t=ao(s.attachments_operations,`Serializing attachments while updating example with id: ${e}`),r=new Blob([t],{type:"application/json"});n.append(`${e}.attachments_operations`,r)}}const r=e??t[0]?.dataset_id,a=await this.caller.call(mi(this.debug),`${this.apiUrl}/v1/platform/datasets/${r}/examples`,{method:"PATCH",headers:this.headers,body:n});return await a.json()}async uploadExamplesMultipart(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return this._uploadExamplesMultipart(e,t)}async _uploadExamplesMultipart(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(!await this._getMultiPartSupport())throw new Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");const n=new FormData;for(const a of t){const e=(a.id??Is()).toString(),t=ao({created_at:a.created_at,...a.metadata&&{metadata:a.metadata},...a.split&&{split:a.split},...a.source_run_id&&{source_run_id:a.source_run_id},...a.use_source_run_io&&{use_source_run_io:a.use_source_run_io},...a.use_source_run_attachments&&{use_source_run_attachments:a.use_source_run_attachments}},`Serializing body for uploaded example with id: ${e}`),r=new Blob([t],{type:"application/json"});if(n.append(e,r),a.inputs){const t=ao(a.inputs,`Serializing inputs for uploaded example with id: ${e}`),r=new Blob([t],{type:"application/json"});n.append(`${e}.inputs`,r)}if(a.outputs){const t=ao(a.outputs,`Serializing outputs for uploaded example with id: ${e}`),r=new Blob([t],{type:"application/json"});n.append(`${e}.outputs`,r)}if(a.attachments)for(const[s,i]of Object.entries(a.attachments)){let t,r;Array.isArray(i)?[t,r]=i:(t=i.mimeType,r=i.data);const a=new Blob([r],{type:`${t}; length=${r.byteLength}`});n.append(`${e}.attachment.${s}`,a)}}const r=await this.caller.call(mi(this.debug),`${this.apiUrl}/v1/platform/datasets/${e}/examples`,{method:"POST",headers:this.headers,body:n});await Ji(r,"upload examples");return await r.json()}async updatePrompt(e,t){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[n,r]=Zi(e);if(!await this._currentTenantIsOwner(n))throw await this._ownerConflictError("update a prompt",n);const a={};if(void 0!==t?.description&&(a.description=t.description),void 0!==t?.readme&&(a.readme=t.readme),void 0!==t?.tags&&(a.tags=t.tags),void 0!==t?.isPublic&&(a.is_public=t.isPublic),void 0!==t?.isArchived&&(a.is_archived=t.isArchived),0===Object.keys(a).length)throw new Error("No valid update options provided");const s=await this.caller.call(mi(this.debug),`${this.apiUrl}/repos/${n}/${r}`,{method:"PATCH",body:JSON.stringify(a),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ji(s,"update prompt"),s.json()}async deletePrompt(e){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[t,n,r]=Zi(e);if(!await this._currentTenantIsOwner(t))throw await this._ownerConflictError("delete a prompt",t);const a=await this.caller.call(mi(this.debug),`${this.apiUrl}/repos/${t}/${n}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await a.json()}async pullPromptCommit(e,t){const[n,r,a]=Zi(e),s=await this.caller.call(mi(this.debug),`${this.apiUrl}/commits/${n}/${r}/${a}${t?.includeModel?"?include_model=true":""}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ji(s,"pull prompt commit");const i=await s.json();return{owner:n,repo:r,commit_hash:i.commit_hash,manifest:i.manifest,examples:i.examples}}async _pullPrompt(e,t){const n=await this.pullPromptCommit(e,{includeModel:t?.includeModel});return JSON.stringify(n.manifest)}async pushPrompt(e,t){if(await this.promptExists(e)?t&&Object.keys(t).some(e=>"object"!==e)&&await this.updatePrompt(e,{description:t?.description,readme:t?.readme,tags:t?.tags,isPublic:t?.isPublic}):await this.createPrompt(e,{description:t?.description,readme:t?.readme,tags:t?.tags,isPublic:t?.isPublic}),!t?.object)return await this._getPromptUrl(e);return await this.createCommit(e,t?.object,{parentCommitHash:t?.parentCommitHash})}async clonePublicDataset(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{sourceApiUrl:n=this.apiUrl,datasetName:r}=t,[a,s]=this.parseTokenOrUrl(e,n),i=new po({apiUrl:a,apiKey:"placeholder"}),o=await i.readSharedDataset(s),l=r||o.name;try{if(await this.hasDataset({datasetId:l}))return void console.log(`Dataset ${l} already exists in your tenant. Skipping.`)}catch(d){}const c=await i.listSharedExamples(s),u=await this.createDataset(l,{description:o.description,dataType:o.data_type||"kv",inputsSchema:o.inputs_schema_definition??void 0,outputsSchema:o.outputs_schema_definition??void 0});try{await this.createExamples({inputs:c.map(e=>e.inputs),outputs:c.flatMap(e=>e.outputs?[e.outputs]:[]),datasetId:u.id})}catch(h){throw console.error(`An error occurred while creating dataset ${l}. You should delete it manually.`),h}}parseTokenOrUrl(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"dataset";try{return Hi(e),[t,e]}catch(a){}try{const a=new URL(e).pathname.split("/").filter(e=>""!==e);if(a.length>=n){return[t,a[a.length-n]]}throw new Error(`Invalid public ${r} URL: ${e}`)}catch(s){throw new Error(`Invalid public ${r} URL or token: ${e}`)}}async awaitPendingTraceBatches(){if(this.manualFlushMode)return console.warn("[WARNING]: When tracing in manual flush mode, you must call `await client.flush()` manually to submit trace batches."),Promise.resolve();await Promise.all([...this.autoBatchQueue.items.map(e=>{let{itemPromise:t}=e;return t}),this.batchIngestCaller.queue.onIdle()]),void 0!==this.langSmithToOTELTranslator&&await(Ci.getDefaultOTLPTracerComponents()?.DEFAULT_LANGSMITH_SPAN_PROCESSOR?.forceFlush())}}function mo(e){return"dataset_id"in e||"dataset_name"in e}const go=Symbol.for("lc:context_variables");class yo{constructor(e,t,n,r){Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.metadata=e,this.tags=t,this.project_name=n,this.replicas=r}static fromHeader(e){const t=e.split(",");let n,r,a={},s=[];for(const i of t){const[e,t]=i.split("="),o=decodeURIComponent(t);"langsmith-metadata"===e?a=JSON.parse(o):"langsmith-tags"===e?s=o.split(","):"langsmith-project"===e?n=o:"langsmith-replicas"===e&&(r=JSON.parse(o))}return new yo(a,s,n,r)}toHeader(){const e=[];return this.metadata&&Object.keys(this.metadata).length>0&&e.push(`langsmith-metadata=${encodeURIComponent(JSON.stringify(this.metadata))}`),this.tags&&this.tags.length>0&&e.push(`langsmith-tags=${encodeURIComponent(this.tags.join(","))}`),this.project_name&&e.push(`langsmith-project=${encodeURIComponent(this.project_name)}`),e.join(",")}}class bo{constructor(e){if(Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dotted_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"attachments",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),void 0!==(t=e)&&"function"===typeof t.createChild&&"function"===typeof t.postRun)return void Object.assign(this,{...e});var t;const n=bo.getDefaultConfig(),{metadata:r,...a}=e,s=a.client??bo.getSharedClient(),i={...r,...a?.extra?.metadata};if(a.extra={...a.extra,metadata:i},Object.assign(this,{...n,...a,client:s}),this.trace_id||(this.parent_run?this.trace_id=this.parent_run.trace_id??this.id:this.trace_id=this.id),this.execution_order??=1,this.child_execution_order??=1,!this.dotted_order){const e=function(e,t){const n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:1).toFixed(0).slice(0,3).padStart(3,"0");return`${new Date(e).toISOString().slice(0,-1)}${n}Z`.replace(/[-:.]/g,"")+t}(this.start_time,this.id,this.execution_order);this.parent_run?this.dotted_order=this.parent_run.dotted_order+"."+e:this.dotted_order=e}}set metadata(e){this.extra={...this.extra,metadata:{...this.extra?.metadata,...e}}}get metadata(){return this.extra?.metadata}static getDefaultConfig(){return{id:Is(),run_type:"chain",project_name:gi(),child_runs:[],api_url:xi("LANGCHAIN_ENDPOINT")??"http://localhost:1984",api_key:xi("LANGCHAIN_API_KEY"),caller_options:{},start_time:Date.now(),serialized:{},inputs:{},extra:{}}}static getSharedClient(){return bo.sharedClient||(bo.sharedClient=new po),bo.sharedClient}createChild(e){const t=this.child_execution_order+1,n=new bo({...e,parent_run:this,project_name:this.project_name,replicas:this.replicas,client:this.client,tracingEnabled:this.tracingEnabled,execution_order:t,child_execution_order:t});go in this&&(n[go]=this[go]);const r=Symbol.for("lc:child_config"),a=e.extra?.[r]??this.extra[r];if(void 0!==(s=a)&&"object"===typeof s.callbacks&&(wo(s.callbacks?.handlers)||wo(s.callbacks))){const e={...a},t=function(e){return"object"===typeof e&&null!=e&&Array.isArray(e.handlers)}(e.callbacks)?e.callbacks.copy?.():void 0;t&&(Object.assign(t,{_parentRunId:n.id}),t.handlers?.find(vo)?.updateFromRunTree?.(n),e.callbacks=t),n.extra[r]=e}var s;const i=new Set;let o=this;for(;null!=o&&!i.has(o.id);)i.add(o.id),o.child_execution_order=Math.max(o.child_execution_order,t),o=o.parent_run;return this.child_runs.push(n),n}async end(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Date.now(),r=arguments.length>3?arguments[3]:void 0;this.outputs=this.outputs??e,this.error=this.error??t,this.end_time=this.end_time??n,r&&Object.keys(r).length>0&&(this.extra=this.extra?{...this.extra,metadata:{...this.extra.metadata,...r}}:{metadata:r})}_convertToCreate(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const r=e.extra??{};if(void 0===r?.runtime?.library&&(r.runtime||(r.runtime={}),t))for(const[i,o]of Object.entries(t))r.runtime[i]||(r.runtime[i]=o);let a,s;return n?(s=e.parent_run?.id,a=[]):(a=e.child_runs.map(e=>this._convertToCreate(e,t,n)),s=void 0),{id:e.id,name:e.name,start_time:e.start_time,end_time:e.end_time,run_type:e.run_type,reference_example_id:e.reference_example_id,extra:r,serialized:e.serialized,error:e.error,inputs:e.inputs,outputs:e.outputs,session_name:e.project_name,child_runs:a,parent_run_id:s,trace_id:e.trace_id,dotted_order:e.dotted_order,tags:e.tags,attachments:e.attachments,events:e.events}}_remapForProject(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const r=this._convertToCreate(this,t,n);if(e===this.project_name)return r;const a=t=>oi(`${t}:${e}`,oi.DNS),s=a(r.id),i=r.trace_id?a(r.trace_id):void 0,o=r.parent_run_id?a(r.parent_run_id):void 0;let l;if(r.dotted_order){const e=r.dotted_order.split(".").map(e=>{const t=e.slice(0,-36),n=e.slice(-36),r=parseInt(t.slice(0,4)),a=parseInt(t.slice(4,6))-1,s=parseInt(t.slice(6,8)),i=parseInt(t.slice(9,11)),o=parseInt(t.slice(11,13)),l=parseInt(t.slice(13,15)),c=parseInt(t.slice(15,21));return[new Date(r,a,s,i,o,l,c/1e3),n]}),t=[];for(let r=0;r<e.length-1;r++){const[n,s]=e[r],i=a(s);t.push(n.toISOString().replace(/[-:]/g,"").replace(".","")+i)}const[n]=e[e.length-1];t.push(n.toISOString().replace(/[-:]/g,"").replace(".","")+s),l=t.join(".")}else l=void 0;return{...r,id:s,trace_id:i,parent_run_id:o,dotted_order:l,session_name:e}}async postRun(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];try{const t=ki();if(this.replicas&&this.replicas.length>0)for(const[e]of this.replicas){const n=this._remapForProject(e,t,!0);await this.client.createRun(n)}else{const n=this._convertToCreate(this,t,e);await this.client.createRun(n)}if(!e){Vi("Posting with excludeChildRuns=false is deprecated and will be removed in a future version.");for(const e of this.child_runs)await e.postRun(!1)}}catch(t){console.error(`Error in postRun for run ${this.id}:`,t)}}async patchRun(){if(this.replicas&&this.replicas.length>0)for(const[t,n]of this.replicas){const e=this._remapForProject(t);await this.client.updateRun(e.id,{inputs:e.inputs,outputs:e.outputs,error:e.error,parent_run_id:e.parent_run_id,session_name:e.session_name,reference_example_id:e.reference_example_id,end_time:e.end_time,dotted_order:e.dotted_order,trace_id:e.trace_id,events:e.events,tags:e.tags,extra:e.extra,attachments:this.attachments,...n})}else try{const e={end_time:this.end_time,error:this.error,inputs:this.inputs,outputs:this.outputs,parent_run_id:this.parent_run?.id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events,dotted_order:this.dotted_order,trace_id:this.trace_id,tags:this.tags,attachments:this.attachments,session_name:this.project_name};await this.client.updateRun(this.id,e)}catch(e){console.error(`Error in patchRun for run ${this.id}`,e)}}toJSON(){return this._convertToCreate(this,void 0,!1)}addEvent(e){this.events||(this.events=[]),"string"===typeof e?this.events.push({name:"event",time:(new Date).toISOString(),message:e}):this.events.push({...e,time:e.time??(new Date).toISOString()})}static fromRunnableConfig(e,t){const n=e?.callbacks;let r,a,s,i=(e=>void 0!==e?e:!!["TRACING_V2","TRACING"].find(e=>"true"===Oi(e)))();if(n){const e=n?.getParentRunId?.()??"",t=n?.handlers?.find(e=>"langchain_tracer"==e?.name);r=t?.getRun?.(e),a=t?.projectName,s=t?.client,i=i||!!t}if(!r)return new bo({...t,client:s,tracingEnabled:i,project_name:a});return new bo({name:r.name,id:r.id,trace_id:r.trace_id,dotted_order:r.dotted_order,client:s,tracingEnabled:i,project_name:a,tags:[...new Set((r?.tags??[]).concat(e?.tags??[]))],extra:{metadata:{...r?.extra?.metadata,...e?.metadata}}}).createChild(t)}static fromDottedOrder(e){return this.fromHeaders({"langsmith-trace":e})}static fromHeaders(e,t){const n="get"in e&&"function"===typeof e.get?{"langsmith-trace":e.get("langsmith-trace"),baggage:e.get("baggage")}:e,r=n["langsmith-trace"];if(!r||"string"!==typeof r)return;const a=r.trim(),s=a.split(".").map(e=>{const[t,n]=e.split("Z");return{strTime:t,time:Date.parse(t+"Z"),uuid:n}}),i=s[0].uuid,o={...t,name:t?.name??"parent",run_type:t?.run_type??"chain",start_time:t?.start_time??Date.now(),id:s.at(-1)?.uuid,trace_id:i,dotted_order:a};if(n.baggage&&"string"===typeof n.baggage){const e=yo.fromHeader(n.baggage);o.metadata=e.metadata,o.tags=e.tags,o.project_name=e.project_name,o.replicas=e.replicas}return new bo(o)}toHeaders(e){const t={"langsmith-trace":this.dotted_order,baggage:new yo(this.extra?.metadata,this.tags,this.project_name,this.replicas).toHeader()};if(e)for(const[n,r]of Object.entries(t))e.set(n,r);return t}}function vo(e){return"object"===typeof e&&null!=e&&"string"===typeof e.name&&"langchain_tracer"===e.name}function wo(e){return Array.isArray(e)&&e.some(e=>vo(e))}Object.defineProperty(bo,"sharedClient",{enumerable:!0,configurable:!0,writable:!0,value:null});var _o=n(5609);n(2600);function So(e,t){return t?.[e]||_o(e)}function ko(e,t,n){const r={};for(const a in e)Object.hasOwn(e,a)&&(r[t(a,n)]=e[a]);return r}function Eo(e){return Array.isArray(e)?[...e]:{...e}}function xo(e,t){const n=Eo(e);for(const[r,a]of Object.entries(t)){const[e,...t]=r.split(".").reverse();let s=n;for(const n of t.reverse()){if(void 0===s[n])break;s[n]=Eo(s[n]),s=s[n]}void 0!==s[e]&&(s[e]={lc:1,type:"secret",id:[a]})}return n}function Oo(e){const t=Object.getPrototypeOf(e);return"function"===typeof e.lc_name&&("function"!==typeof t.lc_name||e.lc_name()!==t.lc_name())?e.lc_name():e.name}class Ao{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,Oo(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}constructor(e){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),void 0!==this.lc_serializable_keys?this.lc_kwargs=Object.fromEntries(Object.entries(e||{}).filter(e=>{let[t]=e;return this.lc_serializable_keys?.includes(t)})):this.lc_kwargs=e??{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof Ao||"object"!==typeof this.lc_kwargs||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();const e={},t={},n=Object.keys(this.lc_kwargs).reduce((e,t)=>(e[t]=t in this?this[t]:this.lc_kwargs[t],e),{});for(let r=Object.getPrototypeOf(this);r;r=Object.getPrototypeOf(r))Object.assign(e,Reflect.get(r,"lc_aliases",this)),Object.assign(t,Reflect.get(r,"lc_secrets",this)),Object.assign(n,Reflect.get(r,"lc_attributes",this));return Object.keys(t).forEach(e=>{let t=this,r=n;const[a,...s]=e.split(".").reverse();for(const n of s.reverse()){if(!(n in t)||void 0===t[n])return;n in r&&void 0!==r[n]||("object"===typeof t[n]&&null!=t[n]?r[n]={}:Array.isArray(t[n])&&(r[n]=[])),t=t[n],r=r[n]}a in t&&void 0!==t[a]&&(r[a]=r[a]||t[a])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:ko(Object.keys(t).length?xo(n,t):n,So,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}}const Io=()=>"undefined"!==typeof Deno,$o=()=>{let e;return e="undefined"!==typeof window&&"undefined"!==typeof window.document?"browser":"undefined"===typeof process||"undefined"===typeof process.versions||"undefined"===typeof process.versions.node||Io()?"object"===typeof globalThis&&globalThis.constructor&&"DedicatedWorkerGlobalScope"===globalThis.constructor.name?"webworker":"undefined"!==typeof window&&"nodejs"===window.name||"undefined"!==typeof navigator&&navigator.userAgent.includes("jsdom")?"jsdom":Io()?"deno":"other":"node",e};let To;function Po(){if(void 0===To){const e=$o();To={library:"langchain-js",runtime:e}}return To}function Ro(e){try{return"undefined"!==typeof process?{NODE_ENV:"production",PUBLIC_URL:"/zkulik-bot.github.io",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}?.[e]:Io()?Deno?.env.get(e):void 0}catch(t){return}}class Co{}class No extends Co{get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,Oo(this.constructor)]}constructor(e){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreCustomEvent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"raiseError",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:"false"===Ro("LANGCHAIN_CALLBACKS_BACKGROUND")}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever,this.ignoreCustomEvent=e.ignoreCustomEvent??this.ignoreCustomEvent,this.raiseError=e.raiseError??this.raiseError,this.awaitHandlers=this.raiseError||(e._awaitHandler??this.awaitHandlers))}copy(){return new this.constructor(this)}toJSON(){return Ao.prototype.toJSON.call(this)}toJSONNotImplemented(){return Ao.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){return new class extends No{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:Is()}),Object.assign(this,e)}}}}const jo=e=>{const t=e;return void 0!==t&&"function"===typeof t.copy&&"string"===typeof t.name&&"boolean"===typeof t.awaitHandlers};function Lo(e,t){if(e)return new bo({...e,parent_run:Lo(t),child_runs:e.child_runs.map(e=>Lo(e)).filter(e=>void 0!==e),extra:{...e.extra,runtime:Po()},tracingEnabled:!1})}function Mo(e,t){return e&&!Array.isArray(e)&&"object"===typeof e?e:{[t]:e}}function Do(e){return"function"===typeof e._addRunToRunMap}class zo extends No{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"runTreeMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"usesRunTreeMap",{enumerable:!0,configurable:!0,writable:!0,value:!1})}copy(){return this}getRunById(e){if(void 0!==e)return this.usesRunTreeMap?(e=>{if(e)return e.events=e.events??[],e.child_runs=e.child_runs??[],e})(this.runTreeMap.get(e)):this.runMap.get(e)}stringifyError(e){return e instanceof Error?e.message+(e?.stack?`\n\n${e.stack}`:""):"string"===typeof e?e:`${e}`}_addChildRun(e,t){e.child_runs.push(t)}_addRunToRunMap(e){const t=function(e,t,n){const r=n.toFixed(0).slice(0,3).padStart(3,"0");return`${new Date(e).toISOString().slice(0,-1)}${r}Z`.replace(/[-:.]/g,"")+t}(e.start_time,e.id,e.execution_order),n={...e},r=this.getRunById(n.parent_run_id);if(void 0!==n.parent_run_id?r&&(this._addChildRun(r,n),r.child_execution_order=Math.max(r.child_execution_order,n.child_execution_order),n.trace_id=r.trace_id,void 0!==r.dotted_order&&(n.dotted_order=[r.dotted_order,t].join("."))):(n.trace_id=n.id,n.dotted_order=t),this.usesRunTreeMap){const e=Lo(n,r);void 0!==e&&this.runTreeMap.set(n.id,e)}else this.runMap.set(n.id,n);return n}async _endTrace(e){const t=void 0!==e.parent_run_id&&this.getRunById(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):await this.persistRun(e),await(this.onRunUpdate?.(e)),this.usesRunTreeMap?this.runTreeMap.delete(e.id):this.runMap.delete(e.id)}_getExecutionOrder(e){const t=void 0!==e&&this.getRunById(e);return t?t.child_execution_order+1:1}_createRunForLLMStart(e,t,n,r,a,s,i,o){const l=this._getExecutionOrder(r),c=Date.now(),u=i?{...a,metadata:i}:a,d={id:n,name:o??e.id[e.id.length-1],parent_run_id:r,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{prompts:t},execution_order:l,child_runs:[],child_execution_order:l,run_type:"llm",extra:u??{},tags:s||[]};return this._addRunToRunMap(d)}async handleLLMStart(e,t,n,r,a,s,i,o){const l=this.getRunById(n)??this._createRunForLLMStart(e,t,n,r,a,s,i,o);return await(this.onRunCreate?.(l)),await(this.onLLMStart?.(l)),l}_createRunForChatModelStart(e,t,n,r,a,s,i,o){const l=this._getExecutionOrder(r),c=Date.now(),u=i?{...a,metadata:i}:a,d={id:n,name:o??e.id[e.id.length-1],parent_run_id:r,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{messages:t},execution_order:l,child_runs:[],child_execution_order:l,run_type:"llm",extra:u??{},tags:s||[]};return this._addRunToRunMap(d)}async handleChatModelStart(e,t,n,r,a,s,i,o){const l=this.getRunById(n)??this._createRunForChatModelStart(e,t,n,r,a,s,i,o);return await(this.onRunCreate?.(l)),await(this.onLLMStart?.(l)),l}async handleLLMEnd(e,t,n,r,a){const s=this.getRunById(t);if(!s||"llm"!==s?.run_type)throw new Error("No LLM run to end.");return s.end_time=Date.now(),s.outputs=e,s.events.push({name:"end",time:new Date(s.end_time).toISOString()}),s.extra={...s.extra,...a},await(this.onLLMEnd?.(s)),await this._endTrace(s),s}async handleLLMError(e,t,n,r,a){const s=this.getRunById(t);if(!s||"llm"!==s?.run_type)throw new Error("No LLM run to end.");return s.end_time=Date.now(),s.error=this.stringifyError(e),s.events.push({name:"error",time:new Date(s.end_time).toISOString()}),s.extra={...s.extra,...a},await(this.onLLMError?.(s)),await this._endTrace(s),s}_createRunForChainStart(e,t,n,r,a,s,i,o){const l=this._getExecutionOrder(r),c=Date.now(),u={id:n,name:o??e.id[e.id.length-1],parent_run_id:r,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:t,execution_order:l,child_execution_order:l,run_type:i??"chain",child_runs:[],extra:s?{metadata:s}:{},tags:a||[]};return this._addRunToRunMap(u)}async handleChainStart(e,t,n,r,a,s,i,o){const l=this.getRunById(n)??this._createRunForChainStart(e,t,n,r,a,s,i,o);return await(this.onRunCreate?.(l)),await(this.onChainStart?.(l)),l}async handleChainEnd(e,t,n,r,a){const s=this.getRunById(t);if(!s)throw new Error("No chain run to end.");return s.end_time=Date.now(),s.outputs=Mo(e,"output"),s.events.push({name:"end",time:new Date(s.end_time).toISOString()}),void 0!==a?.inputs&&(s.inputs=Mo(a.inputs,"input")),await(this.onChainEnd?.(s)),await this._endTrace(s),s}async handleChainError(e,t,n,r,a){const s=this.getRunById(t);if(!s)throw new Error("No chain run to end.");return s.end_time=Date.now(),s.error=this.stringifyError(e),s.events.push({name:"error",time:new Date(s.end_time).toISOString()}),void 0!==a?.inputs&&(s.inputs=Mo(a.inputs,"input")),await(this.onChainError?.(s)),await this._endTrace(s),s}_createRunForToolStart(e,t,n,r,a,s,i){const o=this._getExecutionOrder(r),l=Date.now(),c={id:n,name:i??e.id[e.id.length-1],parent_run_id:r,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{input:t},execution_order:o,child_execution_order:o,run_type:"tool",child_runs:[],extra:s?{metadata:s}:{},tags:a||[]};return this._addRunToRunMap(c)}async handleToolStart(e,t,n,r,a,s,i){const o=this.getRunById(n)??this._createRunForToolStart(e,t,n,r,a,s,i);return await(this.onRunCreate?.(o)),await(this.onToolStart?.(o)),o}async handleToolEnd(e,t){const n=this.getRunById(t);if(!n||"tool"!==n?.run_type)throw new Error("No tool run to end");return n.end_time=Date.now(),n.outputs={output:e},n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await(this.onToolEnd?.(n)),await this._endTrace(n),n}async handleToolError(e,t){const n=this.getRunById(t);if(!n||"tool"!==n?.run_type)throw new Error("No tool run to end");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await(this.onToolError?.(n)),await this._endTrace(n),n}async handleAgentAction(e,t){const n=this.getRunById(t);if(!n||"chain"!==n?.run_type)return;const r=n;r.actions=r.actions||[],r.actions.push(e),r.events.push({name:"agent_action",time:(new Date).toISOString(),kwargs:{action:e}}),await(this.onAgentAction?.(n))}async handleAgentEnd(e,t){const n=this.getRunById(t);n&&"chain"===n?.run_type&&(n.events.push({name:"agent_end",time:(new Date).toISOString(),kwargs:{action:e}}),await(this.onAgentEnd?.(n)))}_createRunForRetrieverStart(e,t,n,r,a,s,i){const o=this._getExecutionOrder(r),l=Date.now(),c={id:n,name:i??e.id[e.id.length-1],parent_run_id:r,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{query:t},execution_order:o,child_execution_order:o,run_type:"retriever",child_runs:[],extra:s?{metadata:s}:{},tags:a||[]};return this._addRunToRunMap(c)}async handleRetrieverStart(e,t,n,r,a,s,i){const o=this.getRunById(n)??this._createRunForRetrieverStart(e,t,n,r,a,s,i);return await(this.onRunCreate?.(o)),await(this.onRetrieverStart?.(o)),o}async handleRetrieverEnd(e,t){const n=this.getRunById(t);if(!n||"retriever"!==n?.run_type)throw new Error("No retriever run to end");return n.end_time=Date.now(),n.outputs={documents:e},n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await(this.onRetrieverEnd?.(n)),await this._endTrace(n),n}async handleRetrieverError(e,t){const n=this.getRunById(t);if(!n||"retriever"!==n?.run_type)throw new Error("No retriever run to end");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await(this.onRetrieverError?.(n)),await this._endTrace(n),n}async handleText(e,t){const n=this.getRunById(t);n&&"chain"===n?.run_type&&(n.events.push({name:"text",time:(new Date).toISOString(),kwargs:{text:e}}),await(this.onText?.(n)))}async handleLLMNewToken(e,t,n,r,a,s){const i=this.getRunById(n);if(!i||"llm"!==i?.run_type)throw new Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return i.events.push({name:"new_token",time:(new Date).toISOString(),kwargs:{token:e,idx:t,chunk:s?.chunk}}),await(this.onLLMNewToken?.(i,e,{chunk:s?.chunk})),i}}var Uo=n(5646);function Fo(e,t){return`${e.open}${t}${e.close}`}function Bo(e,t){try{return JSON.stringify(e,null,2)}catch(n){return t}}function qo(e){return"string"===typeof e?e.trim():null===e||void 0===e?e:Bo(e,e.toString())}function Ho(e){if(!e.end_time)return"";const t=e.end_time-e.start_time;return t<1e3?`${t}ms`:`${(t/1e3).toFixed(2)}s`}const{color:Wo}=Uo;class Vo extends zo{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){const t=[];let n=e;for(;n.parent_run_id;){const e=this.runMap.get(n.parent_run_id);if(!e)break;t.push(e),n=e}return t}getBreadcrumbs(e){const t=[...this.getParents(e).reverse(),e].map((e,t,n)=>{const r=`${e.execution_order}:${e.run_type}:${e.name}`;return t===n.length-1?Fo(Uo.bold,r):r}).join(" > ");return Fo(Wo.grey,t)}onChainStart(e){const t=this.getBreadcrumbs(e);console.log(`${Fo(Wo.green,"[chain/start]")} [${t}] Entering Chain run with input: ${Bo(e.inputs,"[inputs]")}`)}onChainEnd(e){const t=this.getBreadcrumbs(e);console.log(`${Fo(Wo.cyan,"[chain/end]")} [${t}] [${Ho(e)}] Exiting Chain run with output: ${Bo(e.outputs,"[outputs]")}`)}onChainError(e){const t=this.getBreadcrumbs(e);console.log(`${Fo(Wo.red,"[chain/error]")} [${t}] [${Ho(e)}] Chain run errored with error: ${Bo(e.error,"[error]")}`)}onLLMStart(e){const t=this.getBreadcrumbs(e),n="prompts"in e.inputs?{prompts:e.inputs.prompts.map(e=>e.trim())}:e.inputs;console.log(`${Fo(Wo.green,"[llm/start]")} [${t}] Entering LLM run with input: ${Bo(n,"[inputs]")}`)}onLLMEnd(e){const t=this.getBreadcrumbs(e);console.log(`${Fo(Wo.cyan,"[llm/end]")} [${t}] [${Ho(e)}] Exiting LLM run with output: ${Bo(e.outputs,"[response]")}`)}onLLMError(e){const t=this.getBreadcrumbs(e);console.log(`${Fo(Wo.red,"[llm/error]")} [${t}] [${Ho(e)}] LLM run errored with error: ${Bo(e.error,"[error]")}`)}onToolStart(e){const t=this.getBreadcrumbs(e);console.log(`${Fo(Wo.green,"[tool/start]")} [${t}] Entering Tool run with input: "${qo(e.inputs.input)}"`)}onToolEnd(e){const t=this.getBreadcrumbs(e);console.log(`${Fo(Wo.cyan,"[tool/end]")} [${t}] [${Ho(e)}] Exiting Tool run with output: "${qo(e.outputs?.output)}"`)}onToolError(e){const t=this.getBreadcrumbs(e);console.log(`${Fo(Wo.red,"[tool/error]")} [${t}] [${Ho(e)}] Tool run errored with error: ${Bo(e.error,"[error]")}`)}onRetrieverStart(e){const t=this.getBreadcrumbs(e);console.log(`${Fo(Wo.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${Bo(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){const t=this.getBreadcrumbs(e);console.log(`${Fo(Wo.cyan,"[retriever/end]")} [${t}] [${Ho(e)}] Exiting Retriever run with output: ${Bo(e.outputs,"[outputs]")}`)}onRetrieverError(e){const t=this.getBreadcrumbs(e);console.log(`${Fo(Wo.red,"[retriever/error]")} [${t}] [${Ho(e)}] Retriever run errored with error: ${Bo(e.error,"[error]")}`)}onAgentAction(e){const t=e,n=this.getBreadcrumbs(e);console.log(`${Fo(Wo.blue,"[agent/action]")} [${n}] Agent selected action: ${Bo(t.actions[t.actions.length-1],"[action]")}`)}}function Zo(e){return!(!e||"object"!==typeof e||!("type"in e)||"tool_call"!==e.type)}class Go extends Error{constructor(e,t){super(e),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.output=t}}function Jo(e){if("undefined"===typeof e)return null;try{return JSON.parse(e)}catch(s){}let t="";const n=[];let r=!1,a=!1;for(let i of e){if(r)'"'!==i||a?"\n"!==i||a?a="\\"===i&&!a:i="\\n":r=!1;else if('"'===i)r=!0,a=!1;else if("{"===i)n.push("}");else if("["===i)n.push("]");else if("}"===i||"]"===i){if(!n||n[n.length-1]!==i)return null;n.pop()}t+=i}r&&(t+='"');for(let i=n.length-1;i>=0;i-=1)t+=n[i];try{return JSON.parse(t)}catch(s){return null}}function Ko(e){return"object"===typeof e&&null!==e&&"type"in e&&"string"===typeof e.type&&"source_type"in e&&("url"===e.source_type||"base64"===e.source_type||"text"===e.source_type||"id"===e.source_type)}function Xo(e,t){return"string"===typeof e?""===e?t:"string"===typeof t?e+t:Array.isArray(t)&&t.some(e=>Ko(e))?[{type:"text",source_type:"text",text:e},...t]:[{type:"text",text:e},...t]:Array.isArray(t)?el(e,t)??[...e,...t]:""===t?e:Array.isArray(e)&&e.some(e=>Ko(e))?[...e,{type:"file",source_type:"text",text:t}]:[...e,{type:"text",text:t}]}class Qo extends Ao{get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}get text(){return"string"===typeof this.content?this.content:Array.isArray(this.content)?this.content.map(e=>"string"===typeof e?e:"text"===e.type?e.text:"").join(""):""}getType(){return this._getType()}constructor(e,t){"string"===typeof e&&(e={content:e,additional_kwargs:t,response_metadata:{}}),e.additional_kwargs||(e.additional_kwargs={}),e.response_metadata||(e.response_metadata={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"response_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs,this.response_metadata=e.response_metadata,this.id=e.id}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}static lc_name(){return"BaseMessage"}get _printableFields(){return{id:this.id,content:this.content,name:this.name,additional_kwargs:this.additional_kwargs,response_metadata:this.response_metadata}}_updateId(e){this.id=e,this.lc_kwargs.id=e}get[Symbol.toStringTag](){return this.constructor.lc_name()}[Symbol.for("nodejs.util.inspect.custom")](e){if(null===e)return this;const t=(n=this._printableFields,r=Math.max(4,e),JSON.stringify(function e(t,n){if("object"!==typeof t||null===t||void 0===t)return t;if(n>=r)return Array.isArray(t)?"[Array]":"[Object]";if(Array.isArray(t))return t.map(t=>e(t,n+1));const a={};for(const r of Object.keys(t))a[r]=e(t[r],n+1);return a}(n,0),null,2));var n,r;return`${this.constructor.lc_name()} ${t}`}}function Yo(e,t){const n={...e};for(const[r,a]of Object.entries(t))if(null==n[r])n[r]=a;else{if(null==a)continue;if(typeof n[r]!==typeof a||Array.isArray(n[r])!==Array.isArray(a))throw new Error(`field[${r}] already exists in the message chunk, but with a different type.`);if("string"===typeof n[r]){if("type"===r)continue;n[r]+=a}else if("object"!==typeof n[r]||Array.isArray(n[r]))if(Array.isArray(n[r]))n[r]=el(n[r],a);else{if(n[r]===a)continue;console.warn(`field[${r}] already exists in this message chunk and value has unsupported type.`)}else n[r]=Yo(n[r],a)}return n}function el(e,t){if(void 0!==e||void 0!==t){if(void 0===e||void 0===t)return e||t;{const n=[...e];for(const e of t)if("object"===typeof e&&"index"in e&&"number"===typeof e.index){const t=n.findIndex(t=>t.index===e.index);-1!==t?n[t]=Yo(n[t],e):n.push(e)}else{if("object"===typeof e&&"text"in e&&""===e.text)continue;n.push(e)}return n}}}class tl extends Qo{}class nl extends Qo{static lc_name(){return"ToolMessage"}get lc_aliases(){return{tool_call_id:"tool_call_id"}}constructor(e,t,n){"string"===typeof e&&(e={content:e,name:n,tool_call_id:t}),super(e),Object.defineProperty(this,"lc_direct_tool_output",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}_getType(){return"tool"}static isInstance(e){return"tool"===e._getType()}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}}class rl extends tl{constructor(e){let t;if("string"===typeof e)t={content:e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else if(void 0===e.tool_call_chunks)t={...e,tool_calls:e.tool_calls??[],invalid_tool_calls:[],tool_call_chunks:[],usage_metadata:void 0!==e.usage_metadata?e.usage_metadata:void 0};else{const r=[],a=[];for(const t of e.tool_call_chunks){let e={};try{if(e=Jo(t.args||"{}"),null===e||"object"!==typeof e||Array.isArray(e))throw new Error("Malformed tool call chunk args.");r.push({name:t.name??"",args:e,id:t.id,type:"tool_call"})}catch(n){a.push({name:t.name,args:t.args,id:t.id,error:"Malformed args.",type:"invalid_tool_call"})}}t={...e,tool_calls:r,invalid_tool_calls:a,usage_metadata:void 0!==e.usage_metadata?e.usage_metadata:void 0}}super(t),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tool_call_chunks",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_chunks=t.tool_call_chunks??this.tool_call_chunks,this.tool_calls=t.tool_calls??this.tool_calls,this.invalid_tool_calls=t.invalid_tool_calls??this.invalid_tool_calls,this.usage_metadata=t.usage_metadata}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"}}static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,tool_call_chunks:this.tool_call_chunks,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}concat(e){const t={content:Xo(this.content,e.content),additional_kwargs:Yo(this.additional_kwargs,e.additional_kwargs),response_metadata:Yo(this.response_metadata,e.response_metadata),tool_call_chunks:[],id:this.id??e.id};if(void 0!==this.tool_call_chunks||void 0!==e.tool_call_chunks){const n=el(this.tool_call_chunks,e.tool_call_chunks);void 0!==n&&n.length>0&&(t.tool_call_chunks=n)}if(void 0!==this.usage_metadata||void 0!==e.usage_metadata){const n={...(void 0!==this.usage_metadata?.input_token_details?.audio||void 0!==e.usage_metadata?.input_token_details?.audio)&&{audio:(this.usage_metadata?.input_token_details?.audio??0)+(e.usage_metadata?.input_token_details?.audio??0)},...(void 0!==this.usage_metadata?.input_token_details?.cache_read||void 0!==e.usage_metadata?.input_token_details?.cache_read)&&{cache_read:(this.usage_metadata?.input_token_details?.cache_read??0)+(e.usage_metadata?.input_token_details?.cache_read??0)},...(void 0!==this.usage_metadata?.input_token_details?.cache_creation||void 0!==e.usage_metadata?.input_token_details?.cache_creation)&&{cache_creation:(this.usage_metadata?.input_token_details?.cache_creation??0)+(e.usage_metadata?.input_token_details?.cache_creation??0)}},r={...(void 0!==this.usage_metadata?.output_token_details?.audio||void 0!==e.usage_metadata?.output_token_details?.audio)&&{audio:(this.usage_metadata?.output_token_details?.audio??0)+(e.usage_metadata?.output_token_details?.audio??0)},...(void 0!==this.usage_metadata?.output_token_details?.reasoning||void 0!==e.usage_metadata?.output_token_details?.reasoning)&&{reasoning:(this.usage_metadata?.output_token_details?.reasoning??0)+(e.usage_metadata?.output_token_details?.reasoning??0)}},a=this.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},s=e.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},i={input_tokens:a.input_tokens+s.input_tokens,output_tokens:a.output_tokens+s.output_tokens,total_tokens:a.total_tokens+s.total_tokens,...Object.keys(n).length>0&&{input_token_details:n},...Object.keys(r).length>0&&{output_token_details:r}};t.usage_metadata=i}return new rl(t)}}function al(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Human",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"AI";const r=[];for(const a of e){let e;if("human"===a._getType())e=t;else if("ai"===a._getType())e=n;else if("system"===a._getType())e="System";else if("function"===a._getType())e="Function";else if("tool"===a._getType())e="Tool";else{if("generic"!==a._getType())throw new Error(`Got unsupported message type: ${a._getType()}`);e=a.role}const s=a.name?`${a.name}, `:"",i="string"===typeof a.content?a.content:JSON.stringify(a.content,null,2);r.push(`${e}: ${s}${i}`)}return r.join("\n")}let sl;class il extends zo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"usesRunTreeMap",{enumerable:!0,configurable:!0,writable:!0,value:!0});const{exampleId:t,projectName:n,client:r,replicas:a}=e;this.projectName=n??gi(),this.replicas=a,this.exampleId=t,this.client=r??(()=>{if(void 0===sl){const e="false"===Ro("LANGCHAIN_CALLBACKS_BACKGROUND")?{blockOnRootRunFinalization:!0}:{};sl=new po(e)}return sl})();const s=il.getTraceableRunTree();s&&this.updateFromRunTree(s)}async persistRun(e){}async onRunCreate(e){const t=this.getRunTreeWithTracingConfig(e.id);await(t?.postRun())}async onRunUpdate(e){const t=this.getRunTreeWithTracingConfig(e.id);await(t?.patchRun())}getRun(e){return this.runTreeMap.get(e)}updateFromRunTree(e){let t=e;const n=new Set;for(;t.parent_run&&!n.has(t.id)&&(n.add(t.id),t.parent_run);)t=t.parent_run;n.clear();const r=[t];for(;r.length>0;){const e=r.shift();e&&!n.has(e.id)&&(n.add(e.id),this.runTreeMap.set(e.id,e),e.child_runs&&r.push(...e.child_runs))}this.client=e.client??this.client,this.replicas=e.replicas??this.replicas,this.projectName=e.project_name??this.projectName,this.exampleId=e.reference_example_id??this.exampleId}getRunTreeWithTracingConfig(e){const t=this.runTreeMap.get(e);if(t)return new bo({...t,client:this.client,project_name:this.projectName,replicas:this.replicas,reference_example_id:this.exampleId,tracingEnabled:!0})}static getTraceableRunTree(){try{return function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=Ps.getInstance().getStore();if(!e&&void 0===t)throw new Error("Could not get the current run tree.\n\nPlease make sure you are calling this method within a traceable function and that tracing is enabled.");return t}(!0)}catch{return}}}const ol=Symbol.for("ls:tracing_async_local_storage"),ll=Symbol.for("lc:context_variables"),cl=()=>globalThis[ol];let ul;function dl(){return"undefined"===typeof ul&&(ul=new(0,Mi.default)({autoStart:!0,concurrency:1})),ul}async function hl(e,t){if(!0===t){const t=cl();void 0!==t?await t.run(void 0,async()=>e()):await e()}else ul=dl(),ul.add(async()=>{const t=cl();void 0!==t?await t.run(void 0,async()=>e()):await e()})}function fl(e){const t=cl();if(void 0===t)return;const n=t.getStore();return n?.[ll]?.[e]}const pl=Symbol("lc:configure_hooks"),ml=()=>fl(pl)||[];function gl(e){return e?Array.isArray(e)||"name"in e?{callbacks:e}:e:{}}class yl{setHandler(e){return this.setHandlers([e])}}class bl{constructor(e,t,n,r,a,s,i,o){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:o})}get parentRunId(){return this._parentRunId}async handleText(e){await Promise.all(this.handlers.map(t=>hl(async()=>{try{await(t.handleText?.(e,this.runId,this._parentRunId,this.tags))}catch(n){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleText: ${n}`),t.raiseError)throw n}},t.awaitHandlers)))}async handleCustomEvent(e,t,n,r,a){await Promise.all(this.handlers.map(n=>hl(async()=>{try{await(n.handleCustomEvent?.(e,t,this.runId,this.tags,this.metadata))}catch(r){if((n.raiseError?console.error:console.warn)(`Error in handler ${n.constructor.name}, handleCustomEvent: ${r}`),n.raiseError)throw r}},n.awaitHandlers)))}}class vl extends bl{getChild(e){const t=new kl(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleRetrieverEnd(e){await Promise.all(this.handlers.map(t=>hl(async()=>{if(!t.ignoreRetriever)try{await(t.handleRetrieverEnd?.(e,this.runId,this._parentRunId,this.tags))}catch(n){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetriever`),t.raiseError)throw n}},t.awaitHandlers)))}async handleRetrieverError(e){await Promise.all(this.handlers.map(t=>hl(async()=>{if(!t.ignoreRetriever)try{await(t.handleRetrieverError?.(e,this.runId,this._parentRunId,this.tags))}catch(n){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetrieverError: ${n}`),t.raiseError)throw e}},t.awaitHandlers)))}}class wl extends bl{async handleLLMNewToken(e,t,n,r,a,s){await Promise.all(this.handlers.map(n=>hl(async()=>{if(!n.ignoreLLM)try{await(n.handleLLMNewToken?.(e,t??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,s))}catch(r){if((n.raiseError?console.error:console.warn)(`Error in handler ${n.constructor.name}, handleLLMNewToken: ${r}`),n.raiseError)throw r}},n.awaitHandlers)))}async handleLLMError(e,t,n,r,a){await Promise.all(this.handlers.map(t=>hl(async()=>{if(!t.ignoreLLM)try{await(t.handleLLMError?.(e,this.runId,this._parentRunId,this.tags,a))}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleLLMError: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}async handleLLMEnd(e,t,n,r,a){await Promise.all(this.handlers.map(t=>hl(async()=>{if(!t.ignoreLLM)try{await(t.handleLLMEnd?.(e,this.runId,this._parentRunId,this.tags,a))}catch(n){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleLLMEnd: ${n}`),t.raiseError)throw n}},t.awaitHandlers)))}}class _l extends bl{getChild(e){const t=new kl(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleChainError(e,t,n,r,a){await Promise.all(this.handlers.map(t=>hl(async()=>{if(!t.ignoreChain)try{await(t.handleChainError?.(e,this.runId,this._parentRunId,this.tags,a))}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleChainError: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}async handleChainEnd(e,t,n,r,a){await Promise.all(this.handlers.map(t=>hl(async()=>{if(!t.ignoreChain)try{await(t.handleChainEnd?.(e,this.runId,this._parentRunId,this.tags,a))}catch(n){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleChainEnd: ${n}`),t.raiseError)throw n}},t.awaitHandlers)))}async handleAgentAction(e){await Promise.all(this.handlers.map(t=>hl(async()=>{if(!t.ignoreAgent)try{await(t.handleAgentAction?.(e,this.runId,this._parentRunId,this.tags))}catch(n){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentAction: ${n}`),t.raiseError)throw n}},t.awaitHandlers)))}async handleAgentEnd(e){await Promise.all(this.handlers.map(t=>hl(async()=>{if(!t.ignoreAgent)try{await(t.handleAgentEnd?.(e,this.runId,this._parentRunId,this.tags))}catch(n){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentEnd: ${n}`),t.raiseError)throw n}},t.awaitHandlers)))}}class Sl extends bl{getChild(e){const t=new kl(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleToolError(e){await Promise.all(this.handlers.map(t=>hl(async()=>{if(!t.ignoreAgent)try{await(t.handleToolError?.(e,this.runId,this._parentRunId,this.tags))}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolError: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}async handleToolEnd(e){await Promise.all(this.handlers.map(t=>hl(async()=>{if(!t.ignoreAgent)try{await(t.handleToolEnd?.(e,this.runId,this._parentRunId,this.tags))}catch(n){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolEnd: ${n}`),t.raiseError)throw n}},t.awaitHandlers)))}}class kl extends yl{constructor(e,t){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=t?.handlers??this.handlers,this.inheritableHandlers=t?.inheritableHandlers??this.inheritableHandlers,this.tags=t?.tags??this.tags,this.inheritableTags=t?.inheritableTags??this.inheritableTags,this.metadata=t?.metadata??this.metadata,this.inheritableMetadata=t?.inheritableMetadata??this.inheritableMetadata,this._parentRunId=e}getParentRunId(){return this._parentRunId}async handleLLMStart(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:void 0;return Promise.all(t.map(async(t,s)=>{const i=0===s&&n?n:Is();return await Promise.all(this.handlers.map(n=>{if(!n.ignoreLLM)return Do(n)&&n._createRunForLLMStart(e,[t],i,this._parentRunId,r,this.tags,this.metadata,a),hl(async()=>{try{await(n.handleLLMStart?.(e,[t],i,this._parentRunId,r,this.tags,this.metadata,a))}catch(s){if((n.raiseError?console.error:console.warn)(`Error in handler ${n.constructor.name}, handleLLMStart: ${s}`),n.raiseError)throw s}},n.awaitHandlers)})),new wl(i,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:void 0;return Promise.all(t.map(async(t,s)=>{const i=0===s&&n?n:Is();return await Promise.all(this.handlers.map(n=>{if(!n.ignoreLLM)return Do(n)&&n._createRunForChatModelStart(e,[t],i,this._parentRunId,r,this.tags,this.metadata,a),hl(async()=>{try{if(n.handleChatModelStart)await(n.handleChatModelStart?.(e,[t],i,this._parentRunId,r,this.tags,this.metadata,a));else if(n.handleLLMStart){const s=al(t);await(n.handleLLMStart?.(e,[s],i,this._parentRunId,r,this.tags,this.metadata,a))}}catch(s){if((n.raiseError?console.error:console.warn)(`Error in handler ${n.constructor.name}, handleLLMStart: ${s}`),n.raiseError)throw s}},n.awaitHandlers)})),new wl(i,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Is(),r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:void 0;return await Promise.all(this.handlers.map(s=>{if(!s.ignoreChain)return Do(s)&&s._createRunForChainStart(e,t,n,this._parentRunId,this.tags,this.metadata,r,a),hl(async()=>{try{await(s.handleChainStart?.(e,t,n,this._parentRunId,this.tags,this.metadata,r,a))}catch(i){if((s.raiseError?console.error:console.warn)(`Error in handler ${s.constructor.name}, handleChainStart: ${i}`),s.raiseError)throw i}},s.awaitHandlers)})),new _l(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Is(),r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:void 0;return await Promise.all(this.handlers.map(a=>{if(!a.ignoreAgent)return Do(a)&&a._createRunForToolStart(e,t,n,this._parentRunId,this.tags,this.metadata,r),hl(async()=>{try{await(a.handleToolStart?.(e,t,n,this._parentRunId,this.tags,this.metadata,r))}catch(s){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleToolStart: ${s}`),a.raiseError)throw s}},a.awaitHandlers)})),new Sl(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Is(),r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:void 0;return await Promise.all(this.handlers.map(a=>{if(!a.ignoreRetriever)return Do(a)&&a._createRunForRetrieverStart(e,t,n,this._parentRunId,this.tags,this.metadata,r),hl(async()=>{try{await(a.handleRetrieverStart?.(e,t,n,this._parentRunId,this.tags,this.metadata,r))}catch(s){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleRetrieverStart: ${s}`),a.raiseError)throw s}},a.awaitHandlers)})),new vl(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleCustomEvent(e,t,n,r,a){await Promise.all(this.handlers.map(r=>hl(async()=>{if(!r.ignoreCustomEvent)try{await(r.handleCustomEvent?.(e,t,n,this.tags,this.metadata))}catch(a){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleCustomEvent: ${a}`),r.raiseError)throw a}},r.awaitHandlers)))}addHandler(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter(t=>t!==e),this.inheritableHandlers=this.inheritableHandlers.filter(t=>t!==e)}setHandlers(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.handlers=[],this.inheritableHandlers=[];for(const n of e)this.addHandler(n,t)}addTags(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter(t=>!e.includes(t)),this.inheritableTags=this.inheritableTags.filter(t=>!e.includes(t))}addMetadata(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.metadata={...this.metadata,...e},t&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(const t of Object.keys(e))delete this.metadata[t],delete this.inheritableMetadata[t]}copy(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=new kl(this._parentRunId);for(const r of this.handlers){const e=this.inheritableHandlers.includes(r);n.addHandler(r,e)}for(const r of this.tags){const e=this.inheritableTags.includes(r);n.addTags([r],e)}for(const r of Object.keys(this.metadata)){const e=Object.keys(this.inheritableMetadata).includes(r);n.addMetadata({[r]:this.metadata[r]},e)}for(const r of e)n.handlers.filter(e=>"console_callback_handler"===e.name).some(e=>e.name===r.name)||n.addHandler(r,t);return n}static fromHandlers(e){const t=new this;return t.addHandler(new class extends No{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:Is()}),Object.assign(this,e)}}),t}static configure(e,t,n,r,a,s,i){return this._configureSync(e,t,n,r,a,s,i)}static _configureSync(e,t,n,r,a,s,i){let o;(e||t)&&(Array.isArray(e)||!e?(o=new kl,o.setHandlers(e?.map(El)??[],!0)):o=e,o=o.copy(Array.isArray(t)?t.map(El):t?.handlers,!1));const l="true"===Ro("LANGCHAIN_VERBOSE")||i?.verbose,c=il.getTraceableRunTree()?.tracingEnabled||(e=>void 0!==e?e:!!["LANGSMITH_TRACING_V2","LANGCHAIN_TRACING_V2","LANGSMITH_TRACING","LANGCHAIN_TRACING"].find(e=>"true"===Ro(e)))(),u=c||(Ro("LANGCHAIN_TRACING")??!1);if(l||u){if(o||(o=new kl),l&&!o.handlers.some(e=>e.name===Vo.prototype.name)){const e=new Vo;o.addHandler(e,!0)}if(u&&!o.handlers.some(e=>"langchain_tracer"===e.name)&&c){const e=new il;o.addHandler(e,!0),o._parentRunId=il.getTraceableRunTree()?.id??o._parentRunId}}for(const{contextVar:d,inheritable:h=!0,handlerClass:f,envVar:p}of ml()){const e=p&&"true"===Ro(p)&&f;let t;const n=void 0!==d?fl(d):void 0;n&&jo(n)?t=n:e&&(t=new f({})),void 0!==t&&(o||(o=new kl),o.handlers.some(e=>e.name===t.name)||o.addHandler(t,h))}return(n||r)&&o&&(o.addTags(n??[]),o.addTags(r??[],!1)),(a||s)&&o&&(o.addMetadata(a??{}),o.addMetadata(s??{},!1)),o}}function El(e){return"name"in e?e:No.fromMethods(e)}const xl=new class{getStore(){}run(e,t){return t()}enterWith(e){}},Ol=Symbol.for("lc:child_config");const Al=new class{getInstance(){return cl()??xl}getRunnableConfig(){const e=this.getInstance();return e.getStore()?.extra?.[Ol]}runWithConfig(e,t,n){const r=kl._configureSync(e?.callbacks,void 0,e?.tags,void 0,e?.metadata),a=this.getInstance(),s=a.getStore(),i=r?.getParentRunId(),o=r?.handlers?.find(e=>"langchain_tracer"===e?.name);let l;return o&&i?l=o.getRunTreeWithTracingConfig(i):n||(l=new bo({name:"<runnable_lambda>",tracingEnabled:!1})),l&&(l.extra={...l.extra,[Ol]:e}),void 0!==s&&void 0!==s[ll]&&(void 0===l&&(l={}),l[ll]=s[ll]),a.run(l,t)}initializeGlobalInstance(e){void 0===cl()&&(e=>{globalThis[ol]=e})(e)}};async function Il(e){return kl._configureSync(e?.callbacks,void 0,e?.tags,void 0,e?.metadata)}function $l(){const e={};for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(const a of n.filter(e=>!!e))for(const t of Object.keys(a))if("metadata"===t)e[t]={...e[t],...a[t]};else if("tags"===t){const n=e[t]??[];e[t]=[...new Set(n.concat(a[t]??[]))]}else if("configurable"===t)e[t]={...e[t],...a[t]};else if("timeout"===t)void 0===e.timeout?e.timeout=a.timeout:void 0!==a.timeout&&(e.timeout=Math.min(e.timeout,a.timeout));else if("signal"===t)void 0===e.signal?e.signal=a.signal:void 0!==a.signal&&("any"in AbortSignal?e.signal=AbortSignal.any([e.signal,a.signal]):e.signal=a.signal);else if("callbacks"===t){const t=e.callbacks,n=a.callbacks;if(Array.isArray(n))if(t)if(Array.isArray(t))e.callbacks=t.concat(n);else{const r=t.copy();for(const e of n)r.addHandler(El(e),!0);e.callbacks=r}else e.callbacks=n;else if(n)if(t)if(Array.isArray(t)){const r=n.copy();for(const e of t)r.addHandler(El(e),!0);e.callbacks=r}else e.callbacks=new kl(n._parentRunId,{handlers:t.handlers.concat(n.handlers),inheritableHandlers:t.inheritableHandlers.concat(n.inheritableHandlers),tags:Array.from(new Set(t.tags.concat(n.tags))),inheritableTags:Array.from(new Set(t.inheritableTags.concat(n.inheritableTags))),metadata:{...t.metadata,...n.metadata}});else e.callbacks=n}else{const n=t;e[n]=a[n]??e[n]}return e}const Tl=new Set(["string","number","boolean"]);function Pl(e){const t=Al.getRunnableConfig();let n={tags:[],metadata:{},recursionLimit:25,runId:void 0};if(t){const{runId:e,runName:r,...a}=t;n=Object.entries(a).reduce((e,t)=>{let[n,r]=t;return void 0!==r&&(e[n]=r),e},n)}if(e&&(n=Object.entries(e).reduce((e,t)=>{let[n,r]=t;return void 0!==r&&(e[n]=r),e},n)),n?.configurable)for(const r of Object.keys(n.configurable))Tl.has(typeof n.configurable[r])&&!n.metadata?.[r]&&(n.metadata||(n.metadata={}),n.metadata[r]=n.configurable[r]);if(void 0!==n.timeout){if(n.timeout<=0)throw new Error("Timeout must be a positive number");const e=AbortSignal.timeout(n.timeout);void 0!==n.signal?"any"in AbortSignal&&(n.signal=AbortSignal.any([n.signal,e])):n.signal=e,delete n.timeout}return n}function Rl(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{callbacks:t,maxConcurrency:n,recursionLimit:r,runName:a,configurable:s,runId:i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const o=Pl(e);return void 0!==t&&(delete o.runName,o.callbacks=t),void 0!==r&&(o.recursionLimit=r),void 0!==n&&(o.maxConcurrency=n),void 0!==a&&(o.runName=a),void 0!==s&&(o.configurable={...o.configurable,...s}),void 0!==i&&delete o.runId,o}function Cl(e){return e?{configurable:e.configurable,recursionLimit:e.recursionLimit,callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,maxConcurrency:e.maxConcurrency,timeout:e.timeout,signal:e.signal}:void 0}async function Nl(e,t){if(void 0===t)return e;let n;return Promise.race([e.catch(e=>{if(!t?.aborted)throw e}),new Promise((e,r)=>{n=()=>{r(new Error("Aborted"))},t.addEventListener("abort",n),t.aborted&&r(new Error("Aborted"))})]).finally(()=>t.removeEventListener("abort",n))}class jl extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{const e=await this.reader.read();return e.done?(this.reader.releaseLock(),{done:!0,value:void 0}):{done:!1,value:e.value}}catch(e){throw this.reader.releaseLock(),e}}async return(){if(this.ensureReader(),this.locked){const e=this.reader.cancel();this.reader.releaseLock(),await e}return{done:!0,value:void 0}}async throw(e){if(this.ensureReader(),this.locked){const e=this.reader.cancel();this.reader.releaseLock(),await e}throw e}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}static fromReadableStream(e){const t=e.getReader();return new jl({start:e=>function n(){return t.read().then(t=>{let{done:r,value:a}=t;if(!r)return e.enqueue(a),n();e.close()})}(),cancel(){t.releaseLock()}})}static fromAsyncGenerator(e){return new jl({async pull(t){const{value:n,done:r}=await e.next();r&&t.close(),t.enqueue(n)},async cancel(t){await e.return(t)}})}}function Ll(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const n=Array.from({length:t},()=>[]);return n.map(async function*(t){for(;;)if(0===t.length){const t=await e.next();for(const e of n)e.push(t)}else{if(t[0].done)return;yield t.shift().value}})}function Ml(e,t){if(Array.isArray(e)&&Array.isArray(t))return e.concat(t);if("string"===typeof e&&"string"===typeof t)return e+t;if("number"===typeof e&&"number"===typeof t)return e+t;if("concat"in e&&"function"===typeof e.concat)return e.concat(t);if("object"===typeof e&&"object"===typeof t){const n={...e};for(const[e,r]of Object.entries(t))e in n&&!Array.isArray(n[e])?n[e]=Ml(n[e],r):n[e]=r;return n}throw new Error(`Cannot concat ${typeof e} and ${typeof t}`)}class Dl{constructor(e){Object.defineProperty(this,"generator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"signal",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResult",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResultUsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.generator=e.generator,this.config=e.config,this.signal=e.signal??this.config?.signal,this.setup=new Promise((t,n)=>{Al.runWithConfig(Cl(e.config),async()=>{this.firstResult=e.generator.next(),e.startSetup?this.firstResult.then(e.startSetup).then(t,n):this.firstResult.then(e=>t(void 0),n)},!0)})}async next(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.signal?.throwIfAborted(),this.firstResultUsed?Al.runWithConfig(Cl(this.config),this.signal?async()=>Nl(this.generator.next(...t),this.signal):async()=>this.generator.next(...t),!0):(this.firstResultUsed=!0,this.firstResult)}async return(e){return this.generator.return(e)}async throw(e){return this.generator.throw(e)}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}}class zl{constructor(e){Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=e.ops??[]}concat(e){const t=this.ops.concat(e.ops),n=Js({},t);return new Ul({ops:t,state:n[n.length-1].newDocument})}}class Ul extends zl{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=e.state}concat(e){const t=this.ops.concat(e.ops),n=Js(this.state,e.ops);return new Ul({ops:t,state:n[n.length-1].newDocument})}static fromRunLogPatch(e){const t=Js({},e.ops);return new Ul({ops:e.ops,state:t[t.length-1].newDocument})}}const Fl=e=>"log_stream_tracer"===e.name;async function Bl(e,t){if("original"===t)throw new Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");const{inputs:n}=e;return["retriever","llm","prompt"].includes(e.run_type)?n:1!==Object.keys(n).length||""!==n?.input?n.input:void 0}async function ql(e,t){const{outputs:n}=e;return"original"===t||["retriever","llm","prompt"].includes(e.run_type)?n:void 0!==n&&1===Object.keys(n).length&&void 0!==n?.output?n.output:n}class Hl extends zo{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_schemaFormat",{enumerable:!0,configurable:!0,writable:!0,value:"original"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this._schemaFormat=e?._schemaFormat??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=jl.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(e.id===this.rootId)return!1;const t=e.tags??[];let n=void 0===this.includeNames&&void 0===this.includeTags&&void 0===this.includeTypes;return void 0!==this.includeNames&&(n=n||this.includeNames.includes(e.name)),void 0!==this.includeTypes&&(n=n||this.includeTypes.includes(e.run_type)),void 0!==this.includeTags&&(n=n||void 0!==t.find(e=>this.includeTags?.includes(e))),void 0!==this.excludeNames&&(n=n&&!this.excludeNames.includes(e.name)),void 0!==this.excludeTypes&&(n=n&&!this.excludeTypes.includes(e.run_type)),void 0!==this.excludeTags&&(n=n&&t.every(e=>!this.excludeTags?.includes(e))),n}async*tapOutputIterable(e,t){for await(const n of t){if(e!==this.rootId){const t=this.keyMapByRunId[e];t&&await this.writer.write(new zl({ops:[{op:"add",path:`/logs/${t}/streamed_output/-`,value:n}]}))}yield n}}async onRunCreate(e){if(void 0===this.rootId&&(this.rootId=e.id,await this.writer.write(new zl({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;void 0===this.counterMapByRunName[e.name]&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;const t=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=1===t?e.name:`${e.name}:${t}`;const n={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:e.extra?.metadata??{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};"streaming_events"===this._schemaFormat&&(n.inputs=await Bl(e,this._schemaFormat)),await this.writer.write(new zl({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:n}]}))}async onRunUpdate(e){try{const t=this.keyMapByRunId[e.id];if(void 0===t)return;const n=[];"streaming_events"===this._schemaFormat&&n.push({op:"replace",path:`/logs/${t}/inputs`,value:await Bl(e,this._schemaFormat)}),n.push({op:"add",path:`/logs/${t}/final_output`,value:await ql(e,this._schemaFormat)}),void 0!==e.end_time&&n.push({op:"add",path:`/logs/${t}/end_time`,value:new Date(e.end_time).toISOString()});const r=new zl({ops:n});await this.writer.write(r)}finally{if(e.id===this.rootId){const t=new zl({ops:[{op:"replace",path:"/final_output",value:await ql(e,this._schemaFormat)}]});await this.writer.write(t),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,t,n){const r=this.keyMapByRunId[e.id];if(void 0===r)return;let a;var s;void 0!==e.inputs.messages?(s=n?.chunk,a=void 0!==s&&void 0!==s.message?n?.chunk:new rl({id:`run-${e.id}`,content:t})):a=t;const i=new zl({ops:[{op:"add",path:`/logs/${r}/streamed_output_str/-`,value:t},{op:"add",path:`/logs/${r}/streamed_output/-`,value:a}]});await this.writer.write(i)}}class Wl{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new Wl({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo}})}}function Vl(e){let{name:t,serialized:n}=e;return void 0!==t?t:void 0!==n?.name?n.name:void 0!==n?.id&&Array.isArray(n?.id)?n.id[n.id.length-1]:"Unnamed"}const Zl=e=>"event_stream_tracer"===e.name;class Gl extends zo{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"runInfoMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"tappedPromises",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"event_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=jl.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){const t=e.tags??[];let n=void 0===this.includeNames&&void 0===this.includeTags&&void 0===this.includeTypes;return void 0!==this.includeNames&&(n=n||this.includeNames.includes(e.name)),void 0!==this.includeTypes&&(n=n||this.includeTypes.includes(e.runType)),void 0!==this.includeTags&&(n=n||void 0!==t.find(e=>this.includeTags?.includes(e))),void 0!==this.excludeNames&&(n=n&&!this.excludeNames.includes(e.name)),void 0!==this.excludeTypes&&(n=n&&!this.excludeTypes.includes(e.runType)),void 0!==this.excludeTags&&(n=n&&t.every(e=>!this.excludeTags?.includes(e))),n}async*tapOutputIterable(e,t){const n=await t.next();if(n.done)return;const r=this.runInfoMap.get(e);if(void 0===r)return void(yield n.value);function a(e,t){return"llm"===e&&"string"===typeof t?new Wl({text:t}):t}let s=this.tappedPromises.get(e);if(void 0===s){let i;s=new Promise(e=>{i=e}),this.tappedPromises.set(e,s);try{const s={event:`on_${r.runType}_stream`,run_id:e,name:r.name,tags:r.tags,metadata:r.metadata,data:{}};await this.send({...s,data:{chunk:a(r.runType,n.value)}},r),yield n.value;for await(const e of t)"tool"!==r.runType&&"retriever"!==r.runType&&await this.send({...s,data:{chunk:a(r.runType,e)}},r),yield e}finally{i()}}else{yield n.value;for await(const e of t)yield e}}async send(e,t){this._includeRun(t)&&await this.writer.write(e)}async sendEndEvent(e,t){const n=this.tappedPromises.get(e.run_id);void 0!==n?n.then(()=>{this.send(e,t)}):await this.send(e,t)}async onLLMStart(e){const t=Vl(e),n=void 0!==e.inputs.messages?"chat_model":"llm",r={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:n,inputs:e.inputs};this.runInfoMap.set(e.id,r);const a=`on_${n}_start`;await this.send({event:a,data:{input:e.inputs},name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},r)}async onLLMNewToken(e,t,n){const r=this.runInfoMap.get(e.id);let a,s;if(void 0===r)throw new Error(`onLLMNewToken: Run ID ${e.id} not found in run map.`);if(1!==this.runInfoMap.size){if("chat_model"===r.runType)s="on_chat_model_stream",a=void 0===n?.chunk?new rl({content:t,id:`run-${e.id}`}):n.chunk.message;else{if("llm"!==r.runType)throw new Error(`Unexpected run type ${r.runType}`);s="on_llm_stream",a=void 0===n?.chunk?new Wl({text:t}):n.chunk}await this.send({event:s,data:{chunk:a},run_id:e.id,name:r.name,tags:r.tags,metadata:r.metadata},r)}}async onLLMEnd(e){const t=this.runInfoMap.get(e.id);let n;if(this.runInfoMap.delete(e.id),void 0===t)throw new Error(`onLLMEnd: Run ID ${e.id} not found in run map.`);const r=e.outputs?.generations;let a;if("chat_model"===t.runType){for(const e of r??[]){if(void 0!==a)break;a=e[0]?.message}n="on_chat_model_end"}else{if("llm"!==t.runType)throw new Error(`onLLMEnd: Unexpected run type: ${t.runType}`);a={generations:r?.map(e=>e.map(e=>({text:e.text,generationInfo:e.generationInfo}))),llmOutput:e.outputs?.llmOutput??{}},n="on_llm_end"}await this.sendEndEvent({event:n,data:{output:a,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onChainStart(e){const t=Vl(e),n=e.run_type??"chain",r={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:e.run_type};let a={};""===e.inputs.input&&1===Object.keys(e.inputs).length?(a={},r.inputs={}):void 0!==e.inputs.input?(a.input=e.inputs.input,r.inputs=e.inputs.input):(a.input=e.inputs,r.inputs=e.inputs),this.runInfoMap.set(e.id,r),await this.send({event:`on_${n}_start`,data:a,name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},r)}async onChainEnd(e){const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),void 0===t)throw new Error(`onChainEnd: Run ID ${e.id} not found in run map.`);const n=`on_${e.run_type}_end`,r=e.inputs??t.inputs??{},a={output:e.outputs?.output??e.outputs,input:r};r.input&&1===Object.keys(r).length&&(a.input=r.input,t.inputs=r.input),await this.sendEndEvent({event:n,data:a,run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata??{}},t)}async onToolStart(e){const t=Vl(e),n={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:"tool",inputs:e.inputs??{}};this.runInfoMap.set(e.id,n),await this.send({event:"on_tool_start",data:{input:e.inputs??{}},name:t,run_id:e.id,tags:e.tags??[],metadata:e.extra?.metadata??{}},n)}async onToolEnd(e){const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),void 0===t)throw new Error(`onToolEnd: Run ID ${e.id} not found in run map.`);if(void 0===t.inputs)throw new Error(`onToolEnd: Run ID ${e.id} is a tool call, and is expected to have traced inputs.`);const n=void 0===e.outputs?.output?e.outputs:e.outputs.output;await this.sendEndEvent({event:"on_tool_end",data:{output:n,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onRetrieverStart(e){const t=Vl(e),n={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:"retriever",inputs:{query:e.inputs.query}};this.runInfoMap.set(e.id,n),await this.send({event:"on_retriever_start",data:{input:{query:e.inputs.query}},name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},n)}async onRetrieverEnd(e){const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),void 0===t)throw new Error(`onRetrieverEnd: Run ID ${e.id} not found in run map.`);await this.sendEndEvent({event:"on_retriever_end",data:{output:e.outputs?.documents??e.outputs,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async handleCustomEvent(e,t,n){const r=this.runInfoMap.get(n);if(void 0===r)throw new Error(`handleCustomEvent: Run ID ${n} not found in run map.`);await this.send({event:"on_custom_event",run_id:n,name:e,tags:r.tags,metadata:r.metadata,data:t},r)}async finish(){const e=[...this.tappedPromises.values()];Promise.all(e).finally(()=>{this.writer.close()})}}const Jl=[400,401,402,403,404,405,406,407,409],Kl=e=>{if(e.message.startsWith("Cancel")||e.message.startsWith("AbortError")||"AbortError"===e.name)throw e;if("ECONNABORTED"===e?.code)throw e;const t=e?.response?.status??e?.status;if(t&&Jl.includes(+t))throw e;if("insufficient_quota"===e?.error?.code){const t=new Error(e?.message);throw t.name="InsufficientQuotaError",t}};class Xl{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??Kl;const t=Mi.default;this.queue=new t({concurrency:this.maxConcurrency})}call(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return this.queue.add(()=>ws(()=>e(...n).catch(e=>{throw e instanceof Error?e:new Error(e)}),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];return e.signal?Promise.race([this.call(t,...r),new Promise((t,n)=>{e.signal?.addEventListener("abort",()=>{n(new Error("AbortError"))})})]):this.call(t,...r)}fetch(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.call(()=>fetch(...t).then(e=>e.ok?e:Promise.reject(e)))}}class Ql extends zo{constructor(e){let{config:t,onStart:n,onEnd:r,onError:a}=e;super({_awaitHandler:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=t,this.argOnStart=n,this.argOnEnd=r,this.argOnError=a}persistRun(e){return Promise.resolve()}async onRunCreate(e){this.rootId||(this.rootId=e.id,this.argOnStart&&await this.argOnStart(e,this.config))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&await this.argOnError(e,this.config):this.argOnEnd&&await this.argOnEnd(e,this.config))}}function Yl(e){return!!e&&e.lc_runnable}class ec{constructor(e){Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.includeNames=e.includeNames,this.includeTypes=e.includeTypes,this.includeTags=e.includeTags,this.excludeNames=e.excludeNames,this.excludeTypes=e.excludeTypes,this.excludeTags=e.excludeTags}includeEvent(e,t){let n=void 0===this.includeNames&&void 0===this.includeTypes&&void 0===this.includeTags;const r=e.tags??[];return void 0!==this.includeNames&&(n=n||this.includeNames.includes(e.name)),void 0!==this.includeTypes&&(n=n||this.includeTypes.includes(t)),void 0!==this.includeTags&&(n=n||r.some(e=>this.includeTags?.includes(e))),void 0!==this.excludeNames&&(n=n&&!this.excludeNames.includes(e.name)),void 0!==this.excludeTypes&&(n=n&&!this.excludeTypes.includes(t)),void 0!==this.excludeTags&&(n=n&&r.every(e=>!this.excludeTags?.includes(e))),n}}function tc(e){return e.replace(/[^a-zA-Z-_0-9]/g,"_")}const nc=["*","_","`"];function rc(e,t,n){const{firstNode:r,lastNode:a,nodeColors:s,withStyles:i=!0,curveStyle:o="linear",wrapLabelNWords:l=9}=n??{};let c=i?`%%{init: {'flowchart': {'curve': '${o}'}}}%%\ngraph TD;\n`:"graph TD;\n";if(i){const t="default",n={[t]:"{0}({1})"};void 0!==r&&(n[r]="{0}([{1}]):::first"),void 0!==a&&(n[a]="{0}([{1}]):::last");for(const[r,a]of Object.entries(e)){const e=a.name.split(":").pop()??"";let s=nc.some(t=>e.startsWith(t)&&e.endsWith(t))?`<p>${e}</p>`:e;Object.keys(a.metadata??{}).length&&(s+=`<hr/><small><em>${Object.entries(a.metadata??{}).map(e=>{let[t,n]=e;return`${t} = ${n}`}).join("\n")}</em></small>`);const i=(n[r]??n[t]).replace("{0}",tc(r)).replace("{1}",s);c+=`\t${i}\n`}}const u={};for(const f of t){const e=f.source.split(":"),t=f.target.split(":"),n=e.filter((e,n)=>e===t[n]).join(":");u[n]||(u[n]=[]),u[n].push(f)}const d=new Set;function h(e,t){const n=1===e.length&&e[0].source===e[0].target;if(t&&!n){const e=t.split(":").pop();if(d.has(e))throw new Error(`Found duplicate subgraph '${e}' -- this likely means that you're reusing a subgraph node with the same name. Please adjust your graph to have subgraph nodes with unique names.`);d.add(e),c+=`\tsubgraph ${e}\n`}for(const r of e){const{source:e,target:t,data:n,conditional:a}=r;let s="";if(void 0!==n){let e=n;const t=e.split(" ");t.length>l&&(e=Array.from({length:Math.ceil(t.length/l)},(e,n)=>t.slice(n*l,(n+1)*l).join(" ")).join("&nbsp;<br>&nbsp;")),s=a?` -. &nbsp;${e}&nbsp; .-> `:` -- &nbsp;${e}&nbsp; --\x3e `}else s=a?" -.-> ":" --\x3e ";c+=`\t${tc(e)}${s}${tc(t)};\n`}for(const r in u)r.startsWith(`${t}:`)&&r!==t&&h(u[r],r);t&&!n&&(c+="\tend\n")}h(u[""]??[],"");for(const f in u)f.includes(":")||""===f||h(u[f],f);return i&&(c+=function(e){let t="";for(const[n,r]of Object.entries(e))t+=`\tclassDef ${n} ${r};\n`;return t}(s??{})),c}Symbol("ZodOutput"),Symbol("ZodInput");class ac{constructor(){this._map=new Map,this._idmap=new Map}add(e){const t=arguments.length<=1?void 0:arguments[1];if(this._map.set(e,t),t&&"object"===typeof t&&"id"in t){if(this._idmap.has(t.id))throw new Error(`ID ${t.id} already exists in the registry`);this._idmap.set(t.id,e)}return this}clear(){return this._map=new Map,this._idmap=new Map,this}remove(e){const t=this._map.get(e);return t&&"object"===typeof t&&"id"in t&&this._idmap.delete(t.id),this._map.delete(e),this}get(e){const t=e._zod.parent;if(t){const n={...this.get(t)??{}};return delete n.id,{...n,...this._map.get(e)}}return this._map.get(e)}has(e){return this._map.has(e)}}function sc(){return new ac}const ic=sc();function oc(e,t){return"bigint"===typeof t?t.toString():t}const lc=Error.captureStackTrace?Error.captureStackTrace:function(){};cc=()=>{if("undefined"!==typeof navigator&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{return new Function(""),!0}catch(e){return!1}};var cc;new Set(["string","number","symbol"]),new Set(["string","number","bigint","boolean","symbol","undefined"]);function uc(e,t,n){const r=new e._zod.constr(t??e._zod.def);return t&&!n?.parent||(r._zod.parent=e),r}function dc(e){const t=e;if(!t)return{};if("string"===typeof t)return{error:()=>t};if(void 0!==t?.message){if(void 0!==t?.error)throw new Error("Cannot specify both `message` and `error` params");t.error=t.message}return delete t.message,"string"===typeof t.error?{...t,error:()=>t.error}:t}Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,Number.MAX_VALUE,Number.MAX_VALUE;function hc(e){for(let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;t<e.issues.length;t++)if(!0!==e.issues[t]?.continue)return!0;return!1}function fc(e){return"string"===typeof e?e:e?.message}function pc(e,t,n){const r={...e,path:e.path??[]};if(!e.message){const a=fc(e.inst?._zod.def?.error?.(e))??fc(t?.error?.(e))??fc(n.customError?.(e))??fc(n.localeError?.(e))??"Invalid input";r.message=a}return delete r.inst,delete r.continue,t?.reportInput||delete r.input,r}class mc{constructor(e){this.counter=0,this.metadataRegistry=e?.metadata??ic,this.target=e?.target??"draft-2020-12",this.unrepresentable=e?.unrepresentable??"throw",this.override=e?.override??(()=>{}),this.io=e?.io??"output",this.seen=new Map}process(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{path:[],schemaPath:[]};var n;const r=e._zod.def,a={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""},s=this.seen.get(e);if(s){s.count++;return t.schemaPath.includes(e)&&(s.cycle=t.path),s.schema}const i={schema:{},count:1,cycle:void 0,path:t.path};this.seen.set(e,i);const o=e._zod.toJSONSchema?.();if(o)i.schema=o;else{const n={...t,schemaPath:[...t.schemaPath,e],path:t.path},s=e._zod.parent;if(s)i.ref=s,this.process(s,n),this.seen.get(s).isParent=!0;else{const t=i.schema;switch(r.type){case"string":{const n=t;n.type="string";const{minimum:r,maximum:s,format:o,patterns:l,contentEncoding:c}=e._zod.bag;if("number"===typeof r&&(n.minLength=r),"number"===typeof s&&(n.maxLength=s),o&&(n.format=a[o]??o,""===n.format&&delete n.format),c&&(n.contentEncoding=c),l&&l.size>0){const e=[...l];1===e.length?n.pattern=e[0].source:e.length>1&&(i.schema.allOf=[...e.map(e=>({..."draft-7"===this.target?{type:"string"}:{},pattern:e.source}))])}break}case"number":{const n=t,{minimum:r,maximum:a,format:s,multipleOf:i,exclusiveMaximum:o,exclusiveMinimum:l}=e._zod.bag;"string"===typeof s&&s.includes("int")?n.type="integer":n.type="number","number"===typeof l&&(n.exclusiveMinimum=l),"number"===typeof r&&(n.minimum=r,"number"===typeof l&&(l>=r?delete n.minimum:delete n.exclusiveMinimum)),"number"===typeof o&&(n.exclusiveMaximum=o),"number"===typeof a&&(n.maximum=a,"number"===typeof o&&(o<=a?delete n.maximum:delete n.exclusiveMaximum)),"number"===typeof i&&(n.multipleOf=i);break}case"boolean":t.type="boolean";break;case"bigint":if("throw"===this.unrepresentable)throw new Error("BigInt cannot be represented in JSON Schema");break;case"symbol":if("throw"===this.unrepresentable)throw new Error("Symbols cannot be represented in JSON Schema");break;case"null":t.type="null";break;case"any":case"unknown":break;case"undefined":if("throw"===this.unrepresentable)throw new Error("Undefined cannot be represented in JSON Schema");break;case"void":if("throw"===this.unrepresentable)throw new Error("Void cannot be represented in JSON Schema");break;case"never":t.not={};break;case"date":if("throw"===this.unrepresentable)throw new Error("Date cannot be represented in JSON Schema");break;case"array":{const a=t,{minimum:s,maximum:i}=e._zod.bag;"number"===typeof s&&(a.minItems=s),"number"===typeof i&&(a.maxItems=i),a.type="array",a.items=this.process(r.element,{...n,path:[...n.path,"items"]});break}case"object":{const e=t;e.type="object",e.properties={};const a=r.shape;for(const t in a)e.properties[t]=this.process(a[t],{...n,path:[...n.path,"properties",t]});const s=new Set(Object.keys(a)),i=new Set([...s].filter(e=>{const t=r.shape[e]._zod;return"input"===this.io?void 0===t.optin:void 0===t.optout}));i.size>0&&(e.required=Array.from(i)),"never"===r.catchall?._zod.def.type?e.additionalProperties=!1:r.catchall?r.catchall&&(e.additionalProperties=this.process(r.catchall,{...n,path:[...n.path,"additionalProperties"]})):"output"===this.io&&(e.additionalProperties=!1);break}case"union":t.anyOf=r.options.map((e,t)=>this.process(e,{...n,path:[...n.path,"anyOf",t]}));break;case"intersection":{const e=t,a=this.process(r.left,{...n,path:[...n.path,"allOf",0]}),s=this.process(r.right,{...n,path:[...n.path,"allOf",1]}),i=e=>"allOf"in e&&1===Object.keys(e).length,o=[...i(a)?a.allOf:[a],...i(s)?s.allOf:[s]];e.allOf=o;break}case"tuple":{const a=t;a.type="array";const s=r.items.map((e,t)=>this.process(e,{...n,path:[...n.path,"prefixItems",t]}));if("draft-2020-12"===this.target?a.prefixItems=s:a.items=s,r.rest){const e=this.process(r.rest,{...n,path:[...n.path,"items"]});"draft-2020-12"===this.target?a.items=e:a.additionalItems=e}r.rest&&(a.items=this.process(r.rest,{...n,path:[...n.path,"items"]}));const{minimum:i,maximum:o}=e._zod.bag;"number"===typeof i&&(a.minItems=i),"number"===typeof o&&(a.maxItems=o);break}case"record":{const e=t;e.type="object",e.propertyNames=this.process(r.keyType,{...n,path:[...n.path,"propertyNames"]}),e.additionalProperties=this.process(r.valueType,{...n,path:[...n.path,"additionalProperties"]});break}case"map":if("throw"===this.unrepresentable)throw new Error("Map cannot be represented in JSON Schema");break;case"set":if("throw"===this.unrepresentable)throw new Error("Set cannot be represented in JSON Schema");break;case"enum":{const e=t,n=function(e){const t=Object.values(e).filter(e=>"number"===typeof e);return Object.entries(e).filter(e=>{let[n,r]=e;return-1===t.indexOf(+n)}).map(e=>{let[t,n]=e;return n})}(r.entries);n.every(e=>"number"===typeof e)&&(e.type="number"),n.every(e=>"string"===typeof e)&&(e.type="string"),e.enum=n;break}case"literal":{const e=t,n=[];for(const t of r.values)if(void 0===t){if("throw"===this.unrepresentable)throw new Error("Literal `undefined` cannot be represented in JSON Schema")}else if("bigint"===typeof t){if("throw"===this.unrepresentable)throw new Error("BigInt literals cannot be represented in JSON Schema");n.push(Number(t))}else n.push(t);if(0===n.length);else if(1===n.length){const t=n[0];e.type=null===t?"null":typeof t,e.const=t}else n.every(e=>"number"===typeof e)&&(e.type="number"),n.every(e=>"string"===typeof e)&&(e.type="string"),n.every(e=>"boolean"===typeof e)&&(e.type="string"),n.every(e=>null===e)&&(e.type="null"),e.enum=n;break}case"file":{const n=t,r={type:"string",format:"binary",contentEncoding:"binary"},{minimum:a,maximum:s,mime:i}=e._zod.bag;void 0!==a&&(r.minLength=a),void 0!==s&&(r.maxLength=s),i?1===i.length?(r.contentMediaType=i[0],Object.assign(n,r)):n.anyOf=i.map(e=>({...r,contentMediaType:e})):Object.assign(n,r);break}case"transform":if("throw"===this.unrepresentable)throw new Error("Transforms cannot be represented in JSON Schema");break;case"nullable":{const e=this.process(r.innerType,n);t.anyOf=[e,{type:"null"}];break}case"nonoptional":case"promise":case"optional":this.process(r.innerType,n),i.ref=r.innerType;break;case"success":t.type="boolean";break;case"default":this.process(r.innerType,n),i.ref=r.innerType,t.default=JSON.parse(JSON.stringify(r.defaultValue));break;case"prefault":this.process(r.innerType,n),i.ref=r.innerType,"input"===this.io&&(t._prefault=JSON.parse(JSON.stringify(r.defaultValue)));break;case"catch":{let e;this.process(r.innerType,n),i.ref=r.innerType;try{e=r.catchValue(void 0)}catch{throw new Error("Dynamic catch values are not supported in JSON Schema")}t.default=e;break}case"nan":if("throw"===this.unrepresentable)throw new Error("NaN cannot be represented in JSON Schema");break;case"template_literal":{const n=t,r=e._zod.pattern;if(!r)throw new Error("Pattern not found in template literal");n.type="string",n.pattern=r.source;break}case"pipe":{const e="input"===this.io?"transform"===r.in._zod.def.type?r.out:r.in:r.out;this.process(e,n),i.ref=e;break}case"readonly":this.process(r.innerType,n),i.ref=r.innerType,t.readOnly=!0;break;case"lazy":{const t=e._zod.innerType;this.process(t,n),i.ref=t;break}case"custom":if("throw"===this.unrepresentable)throw new Error("Custom types cannot be represented in JSON Schema")}}}const l=this.metadataRegistry.get(e);l&&Object.assign(i.schema,l),"input"===this.io&&yc(e)&&(delete i.schema.examples,delete i.schema.default),"input"===this.io&&i.schema._prefault&&((n=i.schema).default??(n.default=i.schema._prefault)),delete i.schema._prefault;return this.seen.get(e).schema}emit(e,t){const n={cycles:t?.cycles??"ref",reused:t?.reused??"inline",external:t?.external??void 0},r=this.seen.get(e);if(!r)throw new Error("Unprocessed schema. This is a bug in Zod.");const a=e=>{const t="draft-2020-12"===this.target?"$defs":"definitions";if(n.external){const r=n.external.registry.get(e[0])?.id,a=n.external.uri??(e=>e);if(r)return{ref:a(r)};const s=e[1].defId??e[1].schema.id??"schema"+this.counter++;return e[1].defId=s,{defId:s,ref:`${a("__shared")}#/${t}/${s}`}}if(e[1]===r)return{ref:"#"};const a=`#/${t}/`,s=e[1].schema.id??"__schema"+this.counter++;return{defId:s,ref:a+s}},s=e=>{if(e[1].schema.$ref)return;const t=e[1],{ref:n,defId:r}=a(e);t.def={...t.schema},r&&(t.defId=r);const s=t.schema;for(const a in s)delete s[a];s.$ref=n};if("throw"===n.cycles)for(const u of this.seen.entries()){const e=u[1];if(e.cycle)throw new Error(`Cycle detected: #/${e.cycle?.join("/")}/<root>\n\nSet the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(const u of this.seen.entries()){const t=u[1];if(e===u[0]){s(u);continue}if(n.external){const t=n.external.registry.get(u[0])?.id;if(e!==u[0]&&t){s(u);continue}}const r=this.metadataRegistry.get(u[0])?.id;r?s(u):(t.cycle||t.count>1&&"ref"===n.reused)&&s(u)}const i=(e,t)=>{const n=this.seen.get(e),r=n.def??n.schema,a={...r};if(null===n.ref)return;const s=n.ref;if(n.ref=null,s){i(s,t);const e=this.seen.get(s).schema;e.$ref&&"draft-7"===t.target?(r.allOf=r.allOf??[],r.allOf.push(e)):(Object.assign(r,e),Object.assign(r,a))}n.isParent||this.override({zodSchema:e,jsonSchema:r,path:n.path??[]})};for(const u of[...this.seen.entries()].reverse())i(u[0],{target:this.target});const o={};if("draft-2020-12"===this.target?o.$schema="https://json-schema.org/draft/2020-12/schema":"draft-7"===this.target?o.$schema="http://json-schema.org/draft-07/schema#":console.warn(`Invalid target: ${this.target}`),n.external?.uri){const t=n.external.registry.get(e)?.id;if(!t)throw new Error("Schema is missing an `id` property");o.$id=n.external.uri(t)}Object.assign(o,r.def);const l=n.external?.defs??{};for(const u of this.seen.entries()){const e=u[1];e.def&&e.defId&&(l[e.defId]=e.def)}n.external||Object.keys(l).length>0&&("draft-2020-12"===this.target?o.$defs=l:o.definitions=l);try{return JSON.parse(JSON.stringify(o))}catch(c){throw new Error("Error converting schema to JSON.")}}}function gc(e,t){if(e instanceof ac){const n=new mc(t),r={};for(const t of e._idmap.entries()){const[e,r]=t;n.process(r)}const a={},s={registry:e,uri:t?.uri,defs:r};for(const i of e._idmap.entries()){const[e,r]=i;a[e]=n.emit(r,{...t,external:s})}if(Object.keys(r).length>0){const e="draft-2020-12"===n.target?"$defs":"definitions";a.__shared={[e]:r}}return{schemas:a}}const n=new mc(t);return n.process(e),n.emit(e,t)}function yc(e,t){const n=t??{seen:new Set};if(n.seen.has(e))return!1;n.seen.add(e);const r=e._zod.def;switch(r.type){case"string":case"number":case"bigint":case"boolean":case"date":case"symbol":case"undefined":case"null":case"any":case"unknown":case"never":case"void":case"literal":case"enum":case"nan":case"file":case"template_literal":case"custom":case"success":case"catch":return!1;case"array":return yc(r.element,n);case"object":for(const e in r.shape)if(yc(r.shape[e],n))return!0;return!1;case"union":for(const e of r.options)if(yc(e,n))return!0;return!1;case"intersection":return yc(r.left,n)||yc(r.right,n);case"tuple":for(const e of r.items)if(yc(e,n))return!0;return!(!r.rest||!yc(r.rest,n));case"record":case"map":return yc(r.keyType,n)||yc(r.valueType,n);case"set":return yc(r.valueType,n);case"promise":case"optional":case"nonoptional":case"nullable":case"readonly":case"default":case"prefault":return yc(r.innerType,n);case"lazy":return yc(r.getter(),n);case"transform":return!0;case"pipe":return yc(r.in,n)||yc(r.out,n)}throw new Error(`Unknown schema type: ${r.type}`)}const bc=Symbol("Let zodToJsonSchema decide on which parser to use"),vc={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref",openAiAnyTypeName:"OpenAiAnyType"},wc=e=>{const t=(e=>"string"===typeof e?{...vc,name:e}:{...vc,...e})(e),n=void 0!==t.name?[...t.basePath,t.definitionPath,t.name]:t.basePath;return{...t,flags:{hasReferencedOpenAiAnyType:!1},currentPath:n,propertyPath:void 0,seen:new Map(Object.entries(t.definitions).map(e=>{let[n,r]=e;return[r._def,{def:r._def,path:[...t.basePath,t.definitionPath,n],jsonSchema:void 0}]}))}},_c=(e,t)=>{let n=0;for(;n<e.length&&n<t.length&&e[n]===t[n];n++);return[(e.length-n).toString(),...t.slice(n)].join("/")};function Sc(e){if("openAi"!==e.target)return{};const t=[...e.basePath,e.definitionPath,e.openAiAnyTypeName];return e.flags.hasReferencedOpenAiAnyType=!0,{$ref:"relative"===e.$refStrategy?_c(t,e.currentPath):t.join("/")}}function kc(e,t,n,r){r?.errorMessages&&n&&(e.errorMessage={...e.errorMessage,[t]:n})}function Ec(e,t,n,r,a){e[t]=n,kc(e,t,r,a)}function xc(e,t){return Qc(e.type._def,t)}function Oc(e,t,n){const r=n??t.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((n,r)=>Oc(e,t,n))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return Ac(e,t)}}const Ac=(e,t)=>{const n={type:"integer",format:"unix-time"};if("openApi3"===t.target)return n;for(const r of e.checks)switch(r.kind){case"min":Ec(n,"minimum",r.value,r.message,t);break;case"max":Ec(n,"maximum",r.value,r.message,t)}return n};let Ic;const $c=/^[cC][^\s-]{8,}$/,Tc=/^[0-9a-z]+$/,Pc=/^[0-9A-HJKMNP-TV-Z]{26}$/,Rc=/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,Cc=()=>(void 0===Ic&&(Ic=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Ic),Nc=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,jc=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Lc=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Mc=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Dc=/^[a-zA-Z0-9_-]{21}$/,zc=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/;function Uc(e,t){const n={type:"string"};if(e.checks)for(const r of e.checks)switch(r.kind){case"min":Ec(n,"minLength","number"===typeof n.minLength?Math.max(n.minLength,r.value):r.value,r.message,t);break;case"max":Ec(n,"maxLength","number"===typeof n.maxLength?Math.min(n.maxLength,r.value):r.value,r.message,t);break;case"email":switch(t.emailStrategy){case"format:email":qc(n,"email",r.message,t);break;case"format:idn-email":qc(n,"idn-email",r.message,t);break;case"pattern:zod":Hc(n,Rc,r.message,t)}break;case"url":qc(n,"uri",r.message,t);break;case"uuid":qc(n,"uuid",r.message,t);break;case"regex":Hc(n,r.regex,r.message,t);break;case"cuid":Hc(n,$c,r.message,t);break;case"cuid2":Hc(n,Tc,r.message,t);break;case"startsWith":Hc(n,RegExp(`^${Fc(r.value,t)}`),r.message,t);break;case"endsWith":Hc(n,RegExp(`${Fc(r.value,t)}$`),r.message,t);break;case"datetime":qc(n,"date-time",r.message,t);break;case"date":qc(n,"date",r.message,t);break;case"time":qc(n,"time",r.message,t);break;case"duration":qc(n,"duration",r.message,t);break;case"length":Ec(n,"minLength","number"===typeof n.minLength?Math.max(n.minLength,r.value):r.value,r.message,t),Ec(n,"maxLength","number"===typeof n.maxLength?Math.min(n.maxLength,r.value):r.value,r.message,t);break;case"includes":Hc(n,RegExp(Fc(r.value,t)),r.message,t);break;case"ip":"v6"!==r.version&&qc(n,"ipv4",r.message,t),"v4"!==r.version&&qc(n,"ipv6",r.message,t);break;case"base64url":Hc(n,Mc,r.message,t);break;case"jwt":Hc(n,zc,r.message,t);break;case"cidr":"v6"!==r.version&&Hc(n,Nc,r.message,t),"v4"!==r.version&&Hc(n,jc,r.message,t);break;case"emoji":Hc(n,Cc(),r.message,t);break;case"ulid":Hc(n,Pc,r.message,t);break;case"base64":switch(t.base64Strategy){case"format:binary":qc(n,"binary",r.message,t);break;case"contentEncoding:base64":Ec(n,"contentEncoding","base64",r.message,t);break;case"pattern:zod":Hc(n,Lc,r.message,t)}break;case"nanoid":Hc(n,Dc,r.message,t);case"toLowerCase":case"toUpperCase":case"trim":break;default:(()=>{})()}return n}function Fc(e,t){return"escape"===t.patternStrategy?function(e){let t="";for(let n=0;n<e.length;n++)Bc.has(e[n])||(t+="\\"),t+=e[n];return t}(e):e}const Bc=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function qc(e,t,n,r){e.format||e.anyOf?.some(e=>e.format)?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format,...e.errorMessage&&r.errorMessages&&{errorMessage:{format:e.errorMessage.format}}}),delete e.format,e.errorMessage&&(delete e.errorMessage.format,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.anyOf.push({format:t,...n&&r.errorMessages&&{errorMessage:{format:n}}})):Ec(e,"format",t,n,r)}function Hc(e,t,n,r){e.pattern||e.allOf?.some(e=>e.pattern)?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern,...e.errorMessage&&r.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}}}),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.allOf.push({pattern:Wc(t,r),...n&&r.errorMessages&&{errorMessage:{pattern:n}}})):Ec(e,"pattern",Wc(t,r),n,r)}function Wc(e,t){if(!t.applyRegexFlags||!e.flags)return e.source;const n=e.flags.includes("i"),r=e.flags.includes("m"),a=e.flags.includes("s"),s=n?e.source.toLowerCase():e.source;let i="",o=!1,l=!1,c=!1;for(let u=0;u<s.length;u++)if(o)i+=s[u],o=!1;else{if(n)if(l){if(s[u].match(/[a-z]/)){c?(i+=s[u],i+=`${s[u-2]}-${s[u]}`.toUpperCase(),c=!1):"-"===s[u+1]&&s[u+2]?.match(/[a-z]/)?(i+=s[u],c=!0):i+=`${s[u]}${s[u].toUpperCase()}`;continue}}else if(s[u].match(/[a-z]/)){i+=`[${s[u]}${s[u].toUpperCase()}]`;continue}if(r){if("^"===s[u]){i+="(^|(?<=[\r\n]))";continue}if("$"===s[u]){i+="($|(?=[\r\n]))";continue}}a&&"."===s[u]?i+=l?`${s[u]}\r\n`:`[${s[u]}\r\n]`:(i+=s[u],"\\"===s[u]?o=!0:l&&"]"===s[u]?l=!1:l||"["!==s[u]||(l=!0))}try{new RegExp(i)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),e.source}return i}function Vc(e,t){if("openAi"===t.target&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),"openApi3"===t.target&&e.keyType?._def.typeName===gs.ZodEnum)return{type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce((n,r)=>({...n,[r]:Qc(e.valueType._def,{...t,currentPath:[...t.currentPath,"properties",r]})??Sc(t)}),{}),additionalProperties:t.rejectedAdditionalProperties};const n={type:"object",additionalProperties:Qc(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??t.allowedAdditionalProperties};if("openApi3"===t.target)return n;if(e.keyType?._def.typeName===gs.ZodString&&e.keyType._def.checks?.length){const{type:r,...a}=Uc(e.keyType._def,t);return{...n,propertyNames:a}}if(e.keyType?._def.typeName===gs.ZodEnum)return{...n,propertyNames:{enum:e.keyType._def.values}};if(e.keyType?._def.typeName===gs.ZodBranded&&e.keyType._def.type._def.typeName===gs.ZodString&&e.keyType._def.type._def.checks?.length){const{type:r,...a}=xc(e.keyType._def,t);return{...n,propertyNames:a}}return n}const Zc={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};const Gc=(e,t)=>{const n=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((e,n)=>Qc(e._def,{...t,currentPath:[...t.currentPath,"anyOf",`${n}`]})).filter(e=>!!e&&(!t.strictUnions||"object"===typeof e&&Object.keys(e).length>0));return n.length?{anyOf:n}:void 0};function Jc(e,t){const n="openAi"===t.target,r={type:"object",properties:{}},a=[],s=e.shape();for(const o in s){let e=s[o];if(void 0===e||void 0===e._def)continue;let i=Kc(e);i&&n&&("ZodOptional"===e._def.typeName&&(e=e._def.innerType),e.isNullable()||(e=e.nullable()),i=!1);const l=Qc(e._def,{...t,currentPath:[...t.currentPath,"properties",o],propertyPath:[...t.currentPath,"properties",o]});void 0!==l&&(r.properties[o]=l,i||a.push(o))}a.length&&(r.required=a);const i=function(e,t){if("ZodNever"!==e.catchall._def.typeName)return Qc(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]});switch(e.unknownKeys){case"passthrough":return t.allowedAdditionalProperties;case"strict":return t.rejectedAdditionalProperties;case"strip":return"strict"===t.removeAdditionalStrategy?t.allowedAdditionalProperties:t.rejectedAdditionalProperties}}(e,t);return void 0!==i&&(r.additionalProperties=i),r}function Kc(e){try{return e.isOptional()}catch{return!0}}const Xc=(e,t,n)=>{switch(t){case gs.ZodString:return Uc(e,n);case gs.ZodNumber:return function(e,t){const n={type:"number"};if(!e.checks)return n;for(const r of e.checks)switch(r.kind){case"int":n.type="integer",kc(n,"type",r.message,t);break;case"min":"jsonSchema7"===t.target?r.inclusive?Ec(n,"minimum",r.value,r.message,t):Ec(n,"exclusiveMinimum",r.value,r.message,t):(r.inclusive||(n.exclusiveMinimum=!0),Ec(n,"minimum",r.value,r.message,t));break;case"max":"jsonSchema7"===t.target?r.inclusive?Ec(n,"maximum",r.value,r.message,t):Ec(n,"exclusiveMaximum",r.value,r.message,t):(r.inclusive||(n.exclusiveMaximum=!0),Ec(n,"maximum",r.value,r.message,t));break;case"multipleOf":Ec(n,"multipleOf",r.value,r.message,t)}return n}(e,n);case gs.ZodObject:return Jc(e,n);case gs.ZodBigInt:return function(e,t){const n={type:"integer",format:"int64"};if(!e.checks)return n;for(const r of e.checks)switch(r.kind){case"min":"jsonSchema7"===t.target?r.inclusive?Ec(n,"minimum",r.value,r.message,t):Ec(n,"exclusiveMinimum",r.value,r.message,t):(r.inclusive||(n.exclusiveMinimum=!0),Ec(n,"minimum",r.value,r.message,t));break;case"max":"jsonSchema7"===t.target?r.inclusive?Ec(n,"maximum",r.value,r.message,t):Ec(n,"exclusiveMaximum",r.value,r.message,t):(r.inclusive||(n.exclusiveMaximum=!0),Ec(n,"maximum",r.value,r.message,t));break;case"multipleOf":Ec(n,"multipleOf",r.value,r.message,t)}return n}(e,n);case gs.ZodBoolean:return{type:"boolean"};case gs.ZodDate:return Oc(e,n);case gs.ZodUndefined:return function(e){return{not:Sc(e)}}(n);case gs.ZodNull:return function(e){return"openApi3"===e.target?{enum:["null"],nullable:!0}:{type:"null"}}(n);case gs.ZodArray:return function(e,t){const n={type:"array"};return e.type?._def&&e.type?._def?.typeName!==gs.ZodAny&&(n.items=Qc(e.type._def,{...t,currentPath:[...t.currentPath,"items"]})),e.minLength&&Ec(n,"minItems",e.minLength.value,e.minLength.message,t),e.maxLength&&Ec(n,"maxItems",e.maxLength.value,e.maxLength.message,t),e.exactLength&&(Ec(n,"minItems",e.exactLength.value,e.exactLength.message,t),Ec(n,"maxItems",e.exactLength.value,e.exactLength.message,t)),n}(e,n);case gs.ZodUnion:case gs.ZodDiscriminatedUnion:return function(e,t){if("openApi3"===t.target)return Gc(e,t);const n=e.options instanceof Map?Array.from(e.options.values()):e.options;if(n.every(e=>e._def.typeName in Zc&&(!e._def.checks||!e._def.checks.length))){const e=n.reduce((e,t)=>{const n=Zc[t._def.typeName];return n&&!e.includes(n)?[...e,n]:e},[]);return{type:e.length>1?e:e[0]}}if(n.every(e=>"ZodLiteral"===e._def.typeName&&!e.description)){const e=n.reduce((e,t)=>{const n=typeof t._def.value;switch(n){case"string":case"number":case"boolean":return[...e,n];case"bigint":return[...e,"integer"];case"object":if(null===t._def.value)return[...e,"null"];default:return e}},[]);if(e.length===n.length){const t=e.filter((e,t,n)=>n.indexOf(e)===t);return{type:t.length>1?t:t[0],enum:n.reduce((e,t)=>e.includes(t._def.value)?e:[...e,t._def.value],[])}}}else if(n.every(e=>"ZodEnum"===e._def.typeName))return{type:"string",enum:n.reduce((e,t)=>[...e,...t._def.values.filter(t=>!e.includes(t))],[])};return Gc(e,t)}(e,n);case gs.ZodIntersection:return function(e,t){const n=[Qc(e.left._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),Qc(e.right._def,{...t,currentPath:[...t.currentPath,"allOf","1"]})].filter(e=>!!e);let r="jsonSchema2019-09"===t.target?{unevaluatedProperties:!1}:void 0;const a=[];return n.forEach(e=>{if("type"in(t=e)&&"string"===t.type||!("allOf"in t)){let t=e;if("additionalProperties"in e&&!1===e.additionalProperties){const{additionalProperties:n,...r}=e;t=r}else r=void 0;a.push(t)}else a.push(...e.allOf),void 0===e.unevaluatedProperties&&(r=void 0);var t}),a.length?{allOf:a,...r}:void 0}(e,n);case gs.ZodTuple:return function(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((e,n)=>Qc(e._def,{...t,currentPath:[...t.currentPath,"items",`${n}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[]),additionalItems:Qc(e.rest._def,{...t,currentPath:[...t.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((e,n)=>Qc(e._def,{...t,currentPath:[...t.currentPath,"items",`${n}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[])}}(e,n);case gs.ZodRecord:return Vc(e,n);case gs.ZodLiteral:return function(e,t){const n=typeof e.value;return"bigint"!==n&&"number"!==n&&"boolean"!==n&&"string"!==n?{type:Array.isArray(e.value)?"array":"object"}:"openApi3"===t.target?{type:"bigint"===n?"integer":n,enum:[e.value]}:{type:"bigint"===n?"integer":n,const:e.value}}(e,n);case gs.ZodEnum:return function(e){return{type:"string",enum:Array.from(e.values)}}(e);case gs.ZodNativeEnum:return function(e){const t=e.values,n=Object.keys(e.values).filter(e=>"number"!==typeof t[t[e]]).map(e=>t[e]),r=Array.from(new Set(n.map(e=>typeof e)));return{type:1===r.length?"string"===r[0]?"string":"number":["string","number"],enum:n}}(e);case gs.ZodNullable:return function(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return"openApi3"===t.target?{type:Zc[e.innerType._def.typeName],nullable:!0}:{type:[Zc[e.innerType._def.typeName],"null"]};if("openApi3"===t.target){const n=Qc(e.innerType._def,{...t,currentPath:[...t.currentPath]});return n&&"$ref"in n?{allOf:[n],nullable:!0}:n&&{...n,nullable:!0}}const n=Qc(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","0"]});return n&&{anyOf:[n,{type:"null"}]}}(e,n);case gs.ZodOptional:return((e,t)=>{if(t.currentPath.toString()===t.propertyPath?.toString())return Qc(e.innerType._def,t);const n=Qc(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","1"]});return n?{anyOf:[{not:Sc(t)},n]}:Sc(t)})(e,n);case gs.ZodMap:return function(e,t){return"record"===t.mapStrategy?Vc(e,t):{type:"array",maxItems:125,items:{type:"array",items:[Qc(e.keyType._def,{...t,currentPath:[...t.currentPath,"items","items","0"]})||Sc(t),Qc(e.valueType._def,{...t,currentPath:[...t.currentPath,"items","items","1"]})||Sc(t)],minItems:2,maxItems:2}}}(e,n);case gs.ZodSet:return function(e,t){const n={type:"array",uniqueItems:!0,items:Qc(e.valueType._def,{...t,currentPath:[...t.currentPath,"items"]})};return e.minSize&&Ec(n,"minItems",e.minSize.value,e.minSize.message,t),e.maxSize&&Ec(n,"maxItems",e.maxSize.value,e.maxSize.message,t),n}(e,n);case gs.ZodLazy:return()=>e.getter()._def;case gs.ZodPromise:return function(e,t){return Qc(e.type._def,t)}(e,n);case gs.ZodNaN:case gs.ZodNever:return function(e){return"openAi"===e.target?void 0:{not:Sc({...e,currentPath:[...e.currentPath,"not"]})}}(n);case gs.ZodEffects:return function(e,t){return"input"===t.effectStrategy?Qc(e.schema._def,t):Sc(t)}(e,n);case gs.ZodAny:return Sc(n);case gs.ZodUnknown:return function(e){return Sc(e)}(n);case gs.ZodDefault:return function(e,t){return{...Qc(e.innerType._def,t),default:e.defaultValue()}}(e,n);case gs.ZodBranded:return xc(e,n);case gs.ZodReadonly:case gs.ZodCatch:return((e,t)=>Qc(e.innerType._def,t))(e,n);case gs.ZodPipeline:return((e,t)=>{if("input"===t.pipeStrategy)return Qc(e.in._def,t);if("output"===t.pipeStrategy)return Qc(e.out._def,t);const n=Qc(e.in._def,{...t,currentPath:[...t.currentPath,"allOf","0"]});return{allOf:[n,Qc(e.out._def,{...t,currentPath:[...t.currentPath,"allOf",n?"1":"0"]})].filter(e=>void 0!==e)}})(e,n);case gs.ZodFunction:case gs.ZodVoid:case gs.ZodSymbol:default:return}};function Qc(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=t.seen.get(e);if(t.override){const a=t.override?.(e,t,r,n);if(a!==bc)return a}if(r&&!n){const e=Yc(r,t);if(void 0!==e)return e}const a={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,a);const s=Xc(e,e.typeName,t),i="function"===typeof s?Qc(s(),t):s;if(i&&eu(e,t,i),t.postProcess){const n=t.postProcess(i,e,t);return a.jsonSchema=i,n}return a.jsonSchema=i,i}const Yc=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:_c(t.currentPath,e.path)};case"none":case"seen":return e.path.length<t.currentPath.length&&e.path.every((e,n)=>t.currentPath[n]===e)?(console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),Sc(t)):"seen"===t.$refStrategy?Sc(t):void 0}},eu=(e,t,n)=>(e.description&&(n.description=e.description,t.markdownDescription&&(n.markdownDescription=e.description)),n);function tu(e,t){const n=typeof e;if(n!==typeof t)return!1;if(Array.isArray(e)){if(!Array.isArray(t))return!1;const n=e.length;if(n!==t.length)return!1;for(let r=0;r<n;r++)if(!tu(e[r],t[r]))return!1;return!0}if("object"===n){if(!e||!t)return e===t;const n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(const a of n)if(!tu(e[a],t[a]))return!1;return!0}return e===t}function nu(e){return encodeURI(function(e){return e.replace(/~/g,"~0").replace(/\//g,"~1")}(e))}const ru={prefixItems:!0,items:!0,allOf:!0,anyOf:!0,oneOf:!0},au={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependentSchemas:!0},su={id:!0,$id:!0,$ref:!0,$schema:!0,$anchor:!0,$vocabulary:!0,$comment:!0,default:!0,enum:!0,const:!0,required:!0,type:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};let iu="undefined"!==typeof self&&self.location&&"null"!==self.location.origin?new URL(self.location.origin+self.location.pathname+location.search):new URL("https://github.com/cfworker");function ou(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object.create(null),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:iu,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";if(e&&"object"===typeof e&&!Array.isArray(e)){const a=e.$id||e.id;if(a){const s=new URL(a,n.href);s.hash.length>1?t[s.href]=e:(s.hash="",""===r?n=s:ou(e,t,n))}}else if(!0!==e&&!1!==e)return t;const a=n.href+(r?"#"+r:"");if(void 0!==t[a])throw new Error(`Duplicate schema URI "${a}".`);if(t[a]=e,!0===e||!1===e)return t;if(void 0===e.__absolute_uri__&&Object.defineProperty(e,"__absolute_uri__",{enumerable:!1,value:a}),e.$ref&&void 0===e.__absolute_ref__){const t=new URL(e.$ref,n.href);t.hash=t.hash,Object.defineProperty(e,"__absolute_ref__",{enumerable:!1,value:t.href})}if(e.$recursiveRef&&void 0===e.__absolute_recursive_ref__){const t=new URL(e.$recursiveRef,n.href);t.hash=t.hash,Object.defineProperty(e,"__absolute_recursive_ref__",{enumerable:!1,value:t.href})}if(e.$anchor){t[new URL("#"+e.$anchor,n.href).href]=e}for(let s in e){if(su[s])continue;const a=`${r}/${nu(s)}`,i=e[s];if(Array.isArray(i)){if(ru[s]){const e=i.length;for(let r=0;r<e;r++)ou(i[r],t,n,`${a}/${r}`)}}else if(au[s])for(let e in i)ou(i[e],t,n,`${a}/${nu(e)}`);else ou(i,t,n,a)}return t}const lu=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,cu=[0,31,28,31,30,31,30,31,31,30,31,30,31],uu=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i;function du(e){return e.test.bind(e)}const hu={date:fu,time:pu.bind(void 0,!1),"date-time":function(e){const t=e.split(mu);return 2==t.length&&fu(t[0])&&pu(!0,t[1])},duration:e=>e.length>1&&e.length<80&&(/^P\d+([.,]\d+)?W$/.test(e)||/^P[\dYMDTHS]*(\d[.,]\d+)?[YMDHS]$/.test(e)&&/^P([.,\d]+Y)?([.,\d]+M)?([.,\d]+D)?(T([.,\d]+H)?([.,\d]+M)?([.,\d]+S)?)?$/.test(e)),uri:function(e){return gu.test(e)&&yu.test(e)},"uri-reference":du(/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i),"uri-template":du(/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i),url:du(/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!10(?:\.\d{1,3}){3})(?!127(?:\.\d{1,3}){3})(?!169\.254(?:\.\d{1,3}){2})(?!192\.168(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)(?:\.(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu),email:e=>{if('"'===e[0])return!1;const[t,n,...r]=e.split("@");return!(!t||!n||0!==r.length||t.length>64||n.length>253)&&("."!==t[0]&&!t.endsWith(".")&&!t.includes("..")&&(!(!/^[a-z0-9.-]+$/i.test(n)||!/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+$/i.test(t))&&n.split(".").every(e=>/^[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?$/i.test(e))))},hostname:du(/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i),ipv4:du(/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/),ipv6:du(/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i),regex:function(e){if(bu.test(e))return!1;try{return new RegExp(e,"u"),!0}catch(t){return!1}},uuid:du(/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i),"json-pointer":du(/^(?:\/(?:[^~/]|~0|~1)*)*$/),"json-pointer-uri-fragment":du(/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i),"relative-json-pointer":du(/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/)};function fu(e){const t=e.match(lu);if(!t)return!1;const n=+t[1],r=+t[2],a=+t[3];return r>=1&&r<=12&&a>=1&&a<=(2==r&&function(e){return e%4===0&&(e%100!==0||e%400===0)}(n)?29:cu[r])}function pu(e,t){const n=t.match(uu);if(!n)return!1;const r=+n[1],a=+n[2],s=+n[3],i=!!n[5];return(r<=23&&a<=59&&s<=59||23==r&&59==a&&60==s)&&(!e||i)}const mu=/t|\s/i;const gu=/\/|:/,yu=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;const bu=/[^\\]\\Z/;var vu;function wu(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"2019-09",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:ou(t),a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"#",o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"#",l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:Object.create(null);if(!0===t)return{valid:!0,errors:[]};if(!1===t)return{valid:!1,errors:[{instanceLocation:i,keyword:"false",keywordLocation:i,error:"False boolean schema."}]};const c=typeof e;let u;switch(c){case"boolean":case"number":case"string":u=c;break;case"object":u=null===e?"null":Array.isArray(e)?"array":"object";break;default:throw new Error(`Instances of "${c}" type are not supported.`)}const{$ref:d,$recursiveRef:h,$recursiveAnchor:f,type:p,const:m,enum:g,required:y,not:b,anyOf:v,allOf:w,oneOf:_,if:S,then:k,else:E,format:x,properties:O,patternProperties:A,additionalProperties:I,unevaluatedProperties:$,minProperties:T,maxProperties:P,propertyNames:R,dependentRequired:C,dependentSchemas:N,dependencies:j,prefixItems:L,items:M,additionalItems:D,unevaluatedItems:z,contains:U,minContains:F,maxContains:B,minItems:q,maxItems:H,uniqueItems:W,minimum:V,maximum:Z,exclusiveMinimum:G,exclusiveMaximum:J,multipleOf:K,minLength:X,maxLength:Q,pattern:Y,__absolute_ref__:ee,__absolute_recursive_ref__:te}=t,ne=[];if(!0===f&&null===s&&(s=t),"#"===h){const c=null===s?r[te]:s,u=`${o}/$recursiveRef`,d=wu(e,null===s?t:s,n,r,a,c,i,u,l);d.valid||ne.push({instanceLocation:i,keyword:"$recursiveRef",keywordLocation:u,error:"A subschema had errors."},...d.errors)}if(void 0!==d){const t=r[ee||d];if(void 0===t){let e=`Unresolved $ref "${d}".`;throw ee&&ee!==d&&(e+=`  Absolute URI "${ee}".`),e+=`\nKnown schemas:\n- ${Object.keys(r).join("\n- ")}`,new Error(e)}const c=`${o}/$ref`,u=wu(e,t,n,r,a,s,i,c,l);if(u.valid||ne.push({instanceLocation:i,keyword:"$ref",keywordLocation:c,error:"A subschema had errors."},...u.errors),"4"===n||"7"===n)return{valid:0===ne.length,errors:ne}}if(Array.isArray(p)){let t=p.length,n=!1;for(let r=0;r<t;r++)if(u===p[r]||"integer"===p[r]&&"number"===u&&e%1===0&&e===e){n=!0;break}n||ne.push({instanceLocation:i,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${u}" is invalid. Expected "${p.join('", "')}".`})}else"integer"===p?("number"!==u||e%1||e!==e)&&ne.push({instanceLocation:i,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${u}" is invalid. Expected "${p}".`}):void 0!==p&&u!==p&&ne.push({instanceLocation:i,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${u}" is invalid. Expected "${p}".`});if(void 0!==m&&("object"===u||"array"===u?tu(e,m)||ne.push({instanceLocation:i,keyword:"const",keywordLocation:`${o}/const`,error:`Instance does not match ${JSON.stringify(m)}.`}):e!==m&&ne.push({instanceLocation:i,keyword:"const",keywordLocation:`${o}/const`,error:`Instance does not match ${JSON.stringify(m)}.`})),void 0!==g&&("object"===u||"array"===u?g.some(t=>tu(e,t))||ne.push({instanceLocation:i,keyword:"enum",keywordLocation:`${o}/enum`,error:`Instance does not match any of ${JSON.stringify(g)}.`}):g.some(t=>e===t)||ne.push({instanceLocation:i,keyword:"enum",keywordLocation:`${o}/enum`,error:`Instance does not match any of ${JSON.stringify(g)}.`})),void 0!==b){const t=`${o}/not`;wu(e,b,n,r,a,s,i,t).valid&&ne.push({instanceLocation:i,keyword:"not",keywordLocation:t,error:'Instance matched "not" schema.'})}let re=[];if(void 0!==v){const t=`${o}/anyOf`,c=ne.length;let u=!1;for(let o=0;o<v.length;o++){const c=v[o],d=Object.create(l),h=wu(e,c,n,r,a,!0===f?s:null,i,`${t}/${o}`,d);ne.push(...h.errors),u=u||h.valid,h.valid&&re.push(d)}u?ne.length=c:ne.splice(c,0,{instanceLocation:i,keyword:"anyOf",keywordLocation:t,error:"Instance does not match any subschemas."})}if(void 0!==w){const t=`${o}/allOf`,c=ne.length;let u=!0;for(let o=0;o<w.length;o++){const c=w[o],d=Object.create(l),h=wu(e,c,n,r,a,!0===f?s:null,i,`${t}/${o}`,d);ne.push(...h.errors),u=u&&h.valid,h.valid&&re.push(d)}u?ne.length=c:ne.splice(c,0,{instanceLocation:i,keyword:"allOf",keywordLocation:t,error:"Instance does not match every subschema."})}if(void 0!==_){const t=`${o}/oneOf`,c=ne.length,u=_.filter((o,c)=>{const u=Object.create(l),d=wu(e,o,n,r,a,!0===f?s:null,i,`${t}/${c}`,u);return ne.push(...d.errors),d.valid&&re.push(u),d.valid}).length;1===u?ne.length=c:ne.splice(c,0,{instanceLocation:i,keyword:"oneOf",keywordLocation:t,error:`Instance does not match exactly one subschema (${u} matches).`})}if("object"!==u&&"array"!==u||Object.assign(l,...re),void 0!==S){const t=`${o}/if`;if(wu(e,S,n,r,a,s,i,t,l).valid){if(void 0!==k){const c=wu(e,k,n,r,a,s,i,`${o}/then`,l);c.valid||ne.push({instanceLocation:i,keyword:"if",keywordLocation:t,error:'Instance does not match "then" schema.'},...c.errors)}}else if(void 0!==E){const c=wu(e,E,n,r,a,s,i,`${o}/else`,l);c.valid||ne.push({instanceLocation:i,keyword:"if",keywordLocation:t,error:'Instance does not match "else" schema.'},...c.errors)}}if("object"===u){if(void 0!==y)for(const n of y)n in e||ne.push({instanceLocation:i,keyword:"required",keywordLocation:`${o}/required`,error:`Instance does not have required property "${n}".`});const t=Object.keys(e);if(void 0!==T&&t.length<T&&ne.push({instanceLocation:i,keyword:"minProperties",keywordLocation:`${o}/minProperties`,error:`Instance does not have at least ${T} properties.`}),void 0!==P&&t.length>P&&ne.push({instanceLocation:i,keyword:"maxProperties",keywordLocation:`${o}/maxProperties`,error:`Instance does not have at least ${P} properties.`}),void 0!==R){const t=`${o}/propertyNames`;for(const o in e){const e=`${i}/${nu(o)}`,l=wu(o,R,n,r,a,s,e,t);l.valid||ne.push({instanceLocation:i,keyword:"propertyNames",keywordLocation:t,error:`Property name "${o}" does not match schema.`},...l.errors)}}if(void 0!==C){const t=`${o}/dependantRequired`;for(const n in C)if(n in e){const r=C[n];for(const a of r)a in e||ne.push({instanceLocation:i,keyword:"dependentRequired",keywordLocation:t,error:`Instance has "${n}" but does not have "${a}".`})}}if(void 0!==N)for(const d in N){const t=`${o}/dependentSchemas`;if(d in e){const o=wu(e,N[d],n,r,a,s,i,`${t}/${nu(d)}`,l);o.valid||ne.push({instanceLocation:i,keyword:"dependentSchemas",keywordLocation:t,error:`Instance has "${d}" but does not match dependant schema.`},...o.errors)}}if(void 0!==j){const t=`${o}/dependencies`;for(const o in j)if(o in e){const l=j[o];if(Array.isArray(l))for(const n of l)n in e||ne.push({instanceLocation:i,keyword:"dependencies",keywordLocation:t,error:`Instance has "${o}" but does not have "${n}".`});else{const c=wu(e,l,n,r,a,s,i,`${t}/${nu(o)}`);c.valid||ne.push({instanceLocation:i,keyword:"dependencies",keywordLocation:t,error:`Instance has "${o}" but does not match dependant schema.`},...c.errors)}}}const c=Object.create(null);let u=!1;if(void 0!==O){const t=`${o}/properties`;for(const o in O){if(!(o in e))continue;const d=`${i}/${nu(o)}`,h=wu(e[o],O[o],n,r,a,s,d,`${t}/${nu(o)}`);if(h.valid)l[o]=c[o]=!0;else if(u=a,ne.push({instanceLocation:i,keyword:"properties",keywordLocation:t,error:`Property "${o}" does not match schema.`},...h.errors),u)break}}if(!u&&void 0!==A){const t=`${o}/patternProperties`;for(const o in A){const d=new RegExp(o,"u"),h=A[o];for(const f in e){if(!d.test(f))continue;const p=`${i}/${nu(f)}`,m=wu(e[f],h,n,r,a,s,p,`${t}/${nu(o)}`);m.valid?l[f]=c[f]=!0:(u=a,ne.push({instanceLocation:i,keyword:"patternProperties",keywordLocation:t,error:`Property "${f}" matches pattern "${o}" but does not match associated schema.`},...m.errors))}}}if(u||void 0===I){if(!u&&void 0!==$){const t=`${o}/unevaluatedProperties`;for(const o in e)if(!l[o]){const c=`${i}/${nu(o)}`,u=wu(e[o],$,n,r,a,s,c,t);u.valid?l[o]=!0:ne.push({instanceLocation:i,keyword:"unevaluatedProperties",keywordLocation:t,error:`Property "${o}" does not match unevaluated properties schema.`},...u.errors)}}}else{const t=`${o}/additionalProperties`;for(const o in e){if(c[o])continue;const d=`${i}/${nu(o)}`,h=wu(e[o],I,n,r,a,s,d,t);h.valid?l[o]=!0:(u=a,ne.push({instanceLocation:i,keyword:"additionalProperties",keywordLocation:t,error:`Property "${o}" does not match additional properties schema.`},...h.errors))}}}else if("array"===u){void 0!==H&&e.length>H&&ne.push({instanceLocation:i,keyword:"maxItems",keywordLocation:`${o}/maxItems`,error:`Array has too many items (${e.length} > ${H}).`}),void 0!==q&&e.length<q&&ne.push({instanceLocation:i,keyword:"minItems",keywordLocation:`${o}/minItems`,error:`Array has too few items (${e.length} < ${q}).`});const t=e.length;let c=0,u=!1;if(void 0!==L){const d=`${o}/prefixItems`,h=Math.min(L.length,t);for(;c<h;c++){const t=wu(e[c],L[c],n,r,a,s,`${i}/${c}`,`${d}/${c}`);if(l[c]=!0,!t.valid&&(u=a,ne.push({instanceLocation:i,keyword:"prefixItems",keywordLocation:d,error:"Items did not match schema."},...t.errors),u))break}}if(void 0!==M){const d=`${o}/items`;if(Array.isArray(M)){const o=Math.min(M.length,t);for(;c<o;c++){const t=wu(e[c],M[c],n,r,a,s,`${i}/${c}`,`${d}/${c}`);if(l[c]=!0,!t.valid&&(u=a,ne.push({instanceLocation:i,keyword:"items",keywordLocation:d,error:"Items did not match schema."},...t.errors),u))break}}else for(;c<t;c++){const t=wu(e[c],M,n,r,a,s,`${i}/${c}`,d);if(l[c]=!0,!t.valid&&(u=a,ne.push({instanceLocation:i,keyword:"items",keywordLocation:d,error:"Items did not match schema."},...t.errors),u))break}if(!u&&void 0!==D){const d=`${o}/additionalItems`;for(;c<t;c++){const t=wu(e[c],D,n,r,a,s,`${i}/${c}`,d);l[c]=!0,t.valid||(u=a,ne.push({instanceLocation:i,keyword:"additionalItems",keywordLocation:d,error:"Items did not match additional items schema."},...t.errors))}}}if(void 0!==U)if(0===t&&void 0===F)ne.push({instanceLocation:i,keyword:"contains",keywordLocation:`${o}/contains`,error:"Array is empty. It must contain at least one item matching the schema."});else if(void 0!==F&&t<F)ne.push({instanceLocation:i,keyword:"minContains",keywordLocation:`${o}/minContains`,error:`Array has less items (${t}) than minContains (${F}).`});else{const c=`${o}/contains`,u=ne.length;let d=0;for(let o=0;o<t;o++){const t=wu(e[o],U,n,r,a,s,`${i}/${o}`,c);t.valid?(l[o]=!0,d++):ne.push(...t.errors)}d>=(F||0)&&(ne.length=u),void 0===F&&void 0===B&&0===d?ne.splice(u,0,{instanceLocation:i,keyword:"contains",keywordLocation:c,error:"Array does not contain item matching schema."}):void 0!==F&&d<F?ne.push({instanceLocation:i,keyword:"minContains",keywordLocation:`${o}/minContains`,error:`Array must contain at least ${F} items matching schema. Only ${d} items were found.`}):void 0!==B&&d>B&&ne.push({instanceLocation:i,keyword:"maxContains",keywordLocation:`${o}/maxContains`,error:`Array may contain at most ${B} items matching schema. ${d} items were found.`})}if(!u&&void 0!==z){const u=`${o}/unevaluatedItems`;for(;c<t;c++){if(l[c])continue;const t=wu(e[c],z,n,r,a,s,`${i}/${c}`,u);l[c]=!0,t.valid||ne.push({instanceLocation:i,keyword:"unevaluatedItems",keywordLocation:u,error:"Items did not match unevaluated items schema."},...t.errors)}}if(W)for(let n=0;n<t;n++){const r=e[n],a="object"===typeof r&&null!==r;for(let s=0;s<t;s++){if(n===s)continue;const t=e[s];(r===t||a&&("object"===typeof t&&null!==t)&&tu(r,t))&&(ne.push({instanceLocation:i,keyword:"uniqueItems",keywordLocation:`${o}/uniqueItems`,error:`Duplicate items at indexes ${n} and ${s}.`}),n=Number.MAX_SAFE_INTEGER,s=Number.MAX_SAFE_INTEGER)}}}else if("number"===u){if("4"===n?(void 0!==V&&(!0===G&&e<=V||e<V)&&ne.push({instanceLocation:i,keyword:"minimum",keywordLocation:`${o}/minimum`,error:`${e} is less than ${G?"or equal to ":""} ${V}.`}),void 0!==Z&&(!0===J&&e>=Z||e>Z)&&ne.push({instanceLocation:i,keyword:"maximum",keywordLocation:`${o}/maximum`,error:`${e} is greater than ${J?"or equal to ":""} ${Z}.`})):(void 0!==V&&e<V&&ne.push({instanceLocation:i,keyword:"minimum",keywordLocation:`${o}/minimum`,error:`${e} is less than ${V}.`}),void 0!==Z&&e>Z&&ne.push({instanceLocation:i,keyword:"maximum",keywordLocation:`${o}/maximum`,error:`${e} is greater than ${Z}.`}),void 0!==G&&e<=G&&ne.push({instanceLocation:i,keyword:"exclusiveMinimum",keywordLocation:`${o}/exclusiveMinimum`,error:`${e} is less than ${G}.`}),void 0!==J&&e>=J&&ne.push({instanceLocation:i,keyword:"exclusiveMaximum",keywordLocation:`${o}/exclusiveMaximum`,error:`${e} is greater than or equal to ${J}.`})),void 0!==K){const t=e%K;Math.abs(0-t)>=1.1920929e-7&&Math.abs(K-t)>=1.1920929e-7&&ne.push({instanceLocation:i,keyword:"multipleOf",keywordLocation:`${o}/multipleOf`,error:`${e} is not a multiple of ${K}.`})}}else if("string"===u){const t=void 0===X&&void 0===Q?0:function(e){let t,n=0,r=e.length,a=0;for(;a<r;)n++,t=e.charCodeAt(a++),t>=55296&&t<=56319&&a<r&&(t=e.charCodeAt(a),56320==(64512&t)&&a++);return n}(e);void 0!==X&&t<X&&ne.push({instanceLocation:i,keyword:"minLength",keywordLocation:`${o}/minLength`,error:`String is too short (${t} < ${X}).`}),void 0!==Q&&t>Q&&ne.push({instanceLocation:i,keyword:"maxLength",keywordLocation:`${o}/maxLength`,error:`String is too long (${t} > ${Q}).`}),void 0===Y||new RegExp(Y,"u").test(e)||ne.push({instanceLocation:i,keyword:"pattern",keywordLocation:`${o}/pattern`,error:"String does not match pattern."}),void 0!==x&&hu[x]&&!hu[x](e)&&ne.push({instanceLocation:i,keyword:"format",keywordLocation:`${o}/format`,error:`String does not match format "${x}".`})}return{valid:0===ne.length,errors:ne}}!function(e){e[e.Flag=1]="Flag",e[e.Basic=2]="Basic",e[e.Detailed=4]="Detailed"}(vu||(vu={}));Object.freeze({status:"aborted"});function _u(e,t,n){function r(n,r){var a;Object.defineProperty(n,"_zod",{value:n._zod??{},enumerable:!1}),(a=n._zod).traits??(a.traits=new Set),n._zod.traits.add(e),t(n,r);for(const e in i.prototype)e in n||Object.defineProperty(n,e,{value:i.prototype[e].bind(n)});n._zod.constr=i,n._zod.def=r}const a=n?.Parent??Object;class s extends a{}function i(e){var t;const a=n?.Parent?new s:this;r(a,e),(t=a._zod).deferred??(t.deferred=[]);for(const n of a._zod.deferred)n();return a}return Object.defineProperty(s,"name",{value:e}),Object.defineProperty(i,"init",{value:r}),Object.defineProperty(i,Symbol.hasInstance,{value:t=>!!(n?.Parent&&t instanceof n.Parent)||t?._zod?.traits?.has(e)}),Object.defineProperty(i,"name",{value:e}),i}Symbol("zod_brand");class Su extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}const ku={};function Eu(e){return e&&Object.assign(ku,e),ku}const xu=(e,t)=>{e.name="$ZodError",Object.defineProperty(e,"_zod",{value:e._zod,enumerable:!1}),Object.defineProperty(e,"issues",{value:t,enumerable:!1}),Object.defineProperty(e,"message",{get:()=>JSON.stringify(t,oc,2),enumerable:!0}),Object.defineProperty(e,"toString",{value:()=>e.message,enumerable:!1})},Ou=_u("$ZodError",xu),Au=_u("$ZodError",xu,{Parent:Error});const Iu=e=>(t,n,r,a)=>{const s=r?Object.assign(r,{async:!1}):{async:!1},i=t._zod.run({value:n,issues:[]},s);if(i instanceof Promise)throw new Su;if(i.issues.length){const t=new(a?.Err??e)(i.issues.map(e=>pc(e,s,Eu())));throw lc(t,a?.callee),t}return i.value},$u=Iu(Au),Tu=e=>(t,n,r)=>{const a=r?{...r,async:!1}:{async:!1},s=t._zod.run({value:n,issues:[]},a);if(s instanceof Promise)throw new Su;return s.issues.length?{success:!1,error:new(e??Ou)(s.issues.map(e=>pc(e,a,Eu())))}:{success:!0,data:s.value}},Pu=Tu(Au),Ru=e=>async(t,n,r)=>{const a=r?Object.assign(r,{async:!0}):{async:!0};let s=t._zod.run({value:n,issues:[]},a);return s instanceof Promise&&(s=await s),s.issues.length?{success:!1,error:new e(s.issues.map(e=>pc(e,a,Eu())))}:{success:!0,data:s.value}},Cu=Ru(Au);function Nu(e,t){return new e({type:"never",...dc(t)})}const ju={major:4,minor:0,patch:0},Lu=_u("$ZodType",(e,t)=>{var n;e??(e={}),e._zod.def=t,e._zod.bag=e._zod.bag||{},e._zod.version=ju;const r=[...e._zod.def.checks??[]];e._zod.traits.has("$ZodCheck")&&r.unshift(e);for(const a of r)for(const t of a._zod.onattach)t(e);if(0===r.length)(n=e._zod).deferred??(n.deferred=[]),e._zod.deferred?.push(()=>{e._zod.run=e._zod.parse});else{const t=(e,t,n)=>{let r,a=hc(e);for(const s of t){if(s._zod.def.when){if(!s._zod.def.when(e))continue}else if(a)continue;const t=e.issues.length,i=s._zod.check(e);if(i instanceof Promise&&!1===n?.async)throw new Su;if(r||i instanceof Promise)r=(r??Promise.resolve()).then(async()=>{await i;e.issues.length!==t&&(a||(a=hc(e,t)))});else{if(e.issues.length===t)continue;a||(a=hc(e,t))}}return r?r.then(()=>e):e};e._zod.run=(n,a)=>{const s=e._zod.parse(n,a);if(s instanceof Promise){if(!1===a.async)throw new Su;return s.then(e=>t(e,r,a))}return t(s,r,a)}}e["~standard"]={validate:t=>{try{const n=Pu(e,t);return n.success?{value:n.data}:{issues:n.error?.issues}}catch(n){return Cu(e,t).then(e=>e.success?{value:e.data}:{issues:e.error?.issues})}},vendor:"zod",version:1}});const Mu=_u("$ZodNever",(e,t)=>{Lu.init(e,t),e._zod.parse=(t,n)=>(t.issues.push({expected:"never",code:"invalid_type",input:t.value,inst:e}),t)});function Du(e){if("object"!==typeof e||null===e)return!1;if(!("_zod"in e))return!1;const t=e._zod;return"object"===typeof t&&null!==t&&"def"in t}function zu(e){if("object"!==typeof e||null===e)return!1;if(!("_def"in e)||"_zod"in e)return!1;const t=e._def;return"object"===typeof t&&null!=t&&"typeName"in t}function Uu(e){return!!e&&("object"===typeof e&&(!Array.isArray(e)&&!(!Du(e)&&!zu(e))))}async function Fu(e,t){if(Du(e))return $u(e,t);if(zu(e))return e.parse(t);throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function Bu(e){return Du(e)?ic.get(e)?.description:zu(e)||"description"in e&&"string"===typeof e.description?e.description:void 0}function qu(e){return!!Du(e)&&("object"===typeof e&&null!==e&&"_zod"in e&&"object"===typeof e._zod&&null!==e._zod&&"def"in e._zod&&"object"===typeof e._zod.def&&null!==e._zod.def&&"type"in e._zod.def&&"object"===e._zod.def.type)}function Hu(e){return!!Du(e)&&("object"===typeof e&&null!==e&&"_zod"in e&&"object"===typeof e._zod&&null!==e._zod&&"def"in e._zod&&"object"===typeof e._zod.def&&null!==e._zod.def&&"type"in e._zod.def&&"array"===e._zod.def.type)}function Wu(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(zu(e))return e.strict();if(qu(e)){const n=e._zod.def.shape;if(t)for(const[s,i]of Object.entries(e._zod.def.shape)){if(qu(i)){const e=Wu(i,t);n[s]=e}else if(Hu(i)){let e=i._zod.def.element;qu(e)&&(e=Wu(e,t)),n[s]=uc(i,{...i._zod.def,element:e})}else n[s]=i;const e=ic.get(i);e&&ic.add(n[s],e)}const r=uc(e,{...e._zod.def,shape:n,catchall:Nu(Mu)}),a=ic.get(e);return a&&ic.add(r,a),r}throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function Vu(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(zu(e))return function(e){return zu(e)&&"typeName"in e._def&&"ZodEffects"===e._def.typeName}(e)?Vu(e._def.schema,t):e;if(Du(e)){let n=e;if(function(e){return Du(e)&&"pipe"===e._zod.def.type}(e)&&(n=Vu(e._zod.def.in,t)),t)if(qu(n)){const e=n._zod.def.shape;for(const[r,a]of Object.entries(n._zod.def.shape))e[r]=Vu(a,t);n=uc(n,{...n._zod.def,shape:e})}else if(Hu(n)){const e=Vu(n._zod.def.element,t);n=uc(n,{...n._zod.def,element:e})}const r=ic.get(e);return r&&ic.add(n,r),n}throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function Zu(e){if(Du(e)){const t=Vu(e,!0);if(qu(t)){return gc(Wu(t,!0))}return gc(e)}return zu(e)?((e,t)=>{const n=wc(t);let r="object"===typeof t&&t.definitions?Object.entries(t.definitions).reduce((e,t)=>{let[r,a]=t;return{...e,[r]:Qc(a._def,{...n,currentPath:[...n.basePath,n.definitionPath,r]},!0)??Sc(n)}},{}):void 0;const a="string"===typeof t?t:"title"===t?.nameStrategy?void 0:t?.name,s=Qc(e._def,void 0===a?n:{...n,currentPath:[...n.basePath,n.definitionPath,a]},!1)??Sc(n),i="object"===typeof t&&void 0!==t.name&&"title"===t.nameStrategy?t.name:void 0;void 0!==i&&(s.title=i),n.flags.hasReferencedOpenAiAnyType&&(r||(r={}),r[n.openAiAnyTypeName]||(r[n.openAiAnyTypeName]={type:["string","number","integer","boolean","array","null"],items:{$ref:"relative"===n.$refStrategy?"1":[...n.basePath,n.definitionPath,n.openAiAnyTypeName].join("/")}}));const o=void 0===a?r?{...s,[n.definitionPath]:r}:s:{$ref:[..."relative"===n.$refStrategy?[]:n.basePath,n.definitionPath,a].join("/"),[n.definitionPath]:{...r,[a]:s}};return"jsonSchema7"===n.target?o.$schema="http://json-schema.org/draft-07/schema#":"jsonSchema2019-09"!==n.target&&"openAi"!==n.target||(o.$schema="https://json-schema.org/draft/2019-09/schema#"),"openAi"===n.target&&("anyOf"in o||"oneOf"in o||"allOf"in o||"type"in o&&Array.isArray(o.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),o})(e):e}function Gu(e,t){if(void 0!==e&&!ti(e))return e;if(!Yl(t))return t.name??"UnknownSchema";try{let e=t.getName();return e=e.startsWith("Runnable")?e.slice(8):e,e}catch(n){return t.getName()}}function Ju(e){return Yl(e.data)?{type:"runnable",data:{id:e.data.lc_id,name:e.data.getName()}}:{type:"schema",data:{...Zu(e.data.schema),title:e.data.name}}}class Ku{constructor(e){Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"edges",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.nodes=e?.nodes??this.nodes,this.edges=e?.edges??this.edges}toJSON(){const e={};return Object.values(this.nodes).forEach((t,n)=>{e[t.id]=ti(t.id)?n:t.id}),{nodes:Object.values(this.nodes).map(t=>({id:e[t.id],...Ju(t)})),edges:this.edges.map(t=>{const n={source:e[t.source],target:e[t.target]};return"undefined"!==typeof t.data&&(n.data=t.data),"undefined"!==typeof t.conditional&&(n.conditional=t.conditional),n})}}addNode(e,t,n){if(void 0!==t&&void 0!==this.nodes[t])throw new Error(`Node with id ${t} already exists`);const r=t??Is(),a={id:r,data:e,name:Gu(t,e),metadata:n};return this.nodes[r]=a,a}removeNode(e){delete this.nodes[e.id],this.edges=this.edges.filter(t=>t.source!==e.id&&t.target!==e.id)}addEdge(e,t,n,r){if(void 0===this.nodes[e.id])throw new Error(`Source node ${e.id} not in graph`);if(void 0===this.nodes[t.id])throw new Error(`Target node ${t.id} not in graph`);const a={source:e.id,target:t.id,data:n,conditional:r};return this.edges.push(a),a}firstNode(){return Xu(this)}lastNode(){return Qu(this)}extend(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";Object.values(e.nodes).map(e=>e.id).every(ti)&&(t="");const n=e=>t?`${t}:${e}`:e;Object.entries(e.nodes).forEach(e=>{let[t,r]=e;this.nodes[n(t)]={...r,id:n(t)}});const r=e.edges.map(e=>({...e,source:n(e.source),target:n(e.target)}));this.edges=[...this.edges,...r];const a=e.firstNode(),s=e.lastNode();return[a?{id:n(a.id),data:a.data}:void 0,s?{id:n(s.id),data:s.data}:void 0]}trimFirstNode(){const e=this.firstNode();e&&Xu(this,[e.id])&&this.removeNode(e)}trimLastNode(){const e=this.lastNode();e&&Qu(this,[e.id])&&this.removeNode(e)}reid(){const e=Object.fromEntries(Object.values(this.nodes).map(e=>[e.id,e.name])),t=new Map;Object.values(e).forEach(e=>{t.set(e,(t.get(e)||0)+1)});const n=n=>{const r=e[n];return ti(n)&&1===t.get(r)?r:n};return new Ku({nodes:Object.fromEntries(Object.entries(this.nodes).map(e=>{let[t,r]=e;return[n(t),{...r,id:n(t)}]})),edges:this.edges.map(e=>({...e,source:n(e.source),target:n(e.target)}))})}drawMermaid(e){const{withStyles:t,curveStyle:n,nodeColors:r={default:"fill:#f2f0ff,line-height:1.2",first:"fill-opacity:0",last:"fill:#bfb6fc"},wrapLabelNWords:a}=e??{},s=this.reid(),i=s.firstNode(),o=s.lastNode();return rc(s.nodes,s.edges,{firstNode:i?.id,lastNode:o?.id,withStyles:t,curveStyle:n,nodeColors:r,wrapLabelNWords:a})}async drawMermaidPng(e){return async function(e,t){let{backgroundColor:n="white"}=t??{};const r=btoa(e);void 0!==n&&(/^#(?:[0-9a-fA-F]{3}){1,2}$/.test(n)||(n=`!${n}`));const a=`https://mermaid.ink/img/${r}?bgColor=${n}`,s=await fetch(a);if(!s.ok)throw new Error(["Failed to render the graph using the Mermaid.INK API.",`Status code: ${s.status}`,`Status text: ${s.statusText}`].join("\n"));return await s.blob()}(this.drawMermaid(e),{backgroundColor:e?.backgroundColor})}}function Xu(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const n=new Set(e.edges.filter(e=>!t.includes(e.source)).map(e=>e.target)),r=[];for(const a of Object.values(e.nodes))t.includes(a.id)||n.has(a.id)||r.push(a);return 1===r.length?r[0]:void 0}function Qu(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const n=new Set(e.edges.filter(e=>!t.includes(e.target)).map(e=>e.source)),r=[];for(const a of Object.values(e.nodes))t.includes(a.id)||n.has(a.id)||r.push(a);return 1===r.length?r[0]:void 0}function Yu(e){return"object"===typeof e&&null!==e&&"function"===typeof e[Symbol.iterator]&&"function"===typeof e.next}function ed(e){return"object"===typeof e&&null!==e&&"function"===typeof e[Symbol.asyncIterator]}function*td(e,t){for(;;){const{value:n,done:r}=Al.runWithConfig(Cl(e),t.next.bind(t),!0);if(r)break;yield n}}async function*nd(e,t){const n=t[Symbol.asyncIterator]();for(;;){const{value:r,done:a}=await Al.runWithConfig(Cl(e),n.next.bind(t),!0);if(a)break;yield r}}function rd(e,t){return!e||Array.isArray(e)||e instanceof Date||"object"!==typeof e?{[t]:e}:e}class ad extends Ao{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}getName(e){const t=this.name??this.constructor.lc_name()??this.constructor.name;return e?`${t}${e}`:t}bind(e){return new sd({bound:this,kwargs:e,config:{}})}map(){return new id({bound:this})}withRetry(e){return new od({bound:this,kwargs:{},config:{},maxAttemptNumber:e?.stopAfterAttempt,...e})}withConfig(e){return new sd({bound:this,config:e,kwargs:{}})}withFallbacks(e){const t=Array.isArray(e)?e:e.fallbacks;return new hd({runnable:this,fallbacks:t})}_getOptionsList(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(Array.isArray(e)&&e.length!==t)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);if(Array.isArray(e))return e.map(Pl);if(t>1&&!Array.isArray(e)&&e.runId){console.warn("Provided runId will be used only for the first element of the batch.");const n=Object.fromEntries(Object.entries(e).filter(e=>{let[t]=e;return"runId"!==t}));return Array.from({length:t},(t,r)=>Pl(0===r?e:n))}return Array.from({length:t},()=>Pl(e))}async batch(e,t,n){const r=this._getOptionsList(t??{},e.length),a=r[0]?.maxConcurrency??n?.maxConcurrency,s=new Xl({maxConcurrency:a,onFailedAttempt:e=>{throw e}}),i=e.map((e,t)=>s.call(async()=>{try{return await this.invoke(e,r[t])}catch(a){if(n?.returnExceptions)return a;throw a}}));return Promise.all(i)}async*_streamIterator(e,t){yield this.invoke(e,t)}async stream(e,t){const n=Pl(t),r=new Dl({generator:this._streamIterator(e,n),config:n});return await r.setup,jl.fromAsyncGenerator(r)}_separateRunnableConfigFromCallOptions(e){let t;t=Pl(void 0===e?e:{callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable,recursionLimit:e.recursionLimit,maxConcurrency:e.maxConcurrency,runId:e.runId,timeout:e.timeout,signal:e.signal});const n={...e};return delete n.callbacks,delete n.tags,delete n.metadata,delete n.runName,delete n.configurable,delete n.recursionLimit,delete n.maxConcurrency,delete n.runId,delete n.timeout,delete n.signal,[t,n]}async _callWithConfig(e,t,n){const r=Pl(n),a=await Il(r),s=await(a?.handleChainStart(this.toJSON(),rd(t,"input"),r.runId,r?.runType,void 0,void 0,r?.runName??this.getName()));let i;delete r.runId;try{const a=e.call(this,t,r,s);i=await Nl(a,n?.signal)}catch(o){throw await(s?.handleChainError(o)),o}return await(s?.handleChainEnd(rd(i,"output"))),i}async _batchWithConfig(e,t,n,r){const a=this._getOptionsList(n??{},t.length),s=await Promise.all(a.map(Il)),i=await Promise.all(s.map(async(e,n)=>{const r=await(e?.handleChainStart(this.toJSON(),rd(t[n],"input"),a[n].runId,a[n].runType,void 0,void 0,a[n].runName??this.getName()));return delete a[n].runId,r}));let o;try{const n=e.call(this,t,a,i,r);o=await Nl(n,a?.[0]?.signal)}catch(l){throw await Promise.all(i.map(e=>e?.handleChainError(l))),l}return await Promise.all(i.map(e=>e?.handleChainEnd(rd(o,"output")))),o}async*_transformStreamWithConfig(e,t,n){let r,a,s=!0,i=!0;const o=Pl(n),l=await Il(o);let c;try{const u=await async function(e,t,n,r){const a=new Dl({generator:t,startSetup:n,signal:r}),s=await a.setup;for(var i=arguments.length,o=new Array(i>4?i-4:0),l=4;l<i;l++)o[l-4]=arguments[l];return{output:e(a,s,...o),setup:s}}(t.bind(this),async function*(){for await(const t of e){if(s)if(void 0===r)r=t;else try{r=Ml(r,t)}catch{r=void 0,s=!1}yield t}}(),async()=>l?.handleChainStart(this.toJSON(),{input:""},o.runId,o.runType,void 0,void 0,o.runName??this.getName()),n?.signal,o);delete o.runId,c=u.setup;const d=c?.handlers.find(Zl);let h=u.output;void 0!==d&&void 0!==c&&(h=d.tapOutputIterable(c.runId,h));const f=c?.handlers.find(Fl);void 0!==f&&void 0!==c&&(h=f.tapOutputIterable(c.runId,h));for await(const e of h)if(yield e,i)if(void 0===a)a=e;else try{a=Ml(a,e)}catch{a=void 0,i=!1}}catch(u){throw await(c?.handleChainError(u,void 0,void 0,void 0,{inputs:rd(r,"input")})),u}await(c?.handleChainEnd(a??{},void 0,void 0,void 0,{inputs:rd(r,"input")}))}getGraph(e){const t=new Ku,n=t.addNode({name:`${this.getName()}Input`,schema:bs()}),r=t.addNode(this),a=t.addNode({name:`${this.getName()}Output`,schema:bs()});return t.addEdge(n,r),t.addEdge(r,a),t}pipe(e){return new ld({first:this,last:fd(e)})}pick(e){return this.pipe(new md(e))}assign(e){return this.pipe(new pd(new cd({steps:e})))}async*transform(e,t){let n;for await(const r of e)n=void 0===n?r:Ml(n,r);yield*this._streamIterator(n,Pl(t))}async*streamLog(e,t,n){const r=new Hl({...n,autoClose:!1,_schemaFormat:"original"}),a=Pl(t);yield*this._streamLog(e,r,a)}async*_streamLog(e,t,n){const{callbacks:r}=n;if(void 0===r)n.callbacks=[t];else if(Array.isArray(r))n.callbacks=r.concat([t]);else{const e=r.copy();e.addHandler(t,!0),n.callbacks=e}const a=this.stream(e,n);const s=async function(){try{const e=await a;for await(const n of e){const e=new zl({ops:[{op:"add",path:"/streamed_output/-",value:n}]});await t.writer.write(e)}}finally{await t.writer.close()}}();try{for await(const e of t)yield e}finally{await s}}streamEvents(e,t,n){let r;if("v1"===t.version)r=this._streamEventsV1(e,t,n);else{if("v2"!==t.version)throw new Error('Only versions "v1" and "v2" of the schema are currently supported.');r=this._streamEventsV2(e,t,n)}return"text/event-stream"===t.encoding?function(e){const t=new TextEncoder,n=new ReadableStream({async start(n){for await(const r of e)n.enqueue(t.encode(`event: data\ndata: ${JSON.stringify(r)}\n\n`));n.enqueue(t.encode("event: end\n\n")),n.close()}});return jl.fromReadableStream(n)}(r):jl.fromAsyncGenerator(r)}async*_streamEventsV2(e,t,n){const r=new Gl({...n,autoClose:!1}),a=Pl(t),s=a.runId??Is();a.runId=s;const i=a.callbacks;if(void 0===i)a.callbacks=[r];else if(Array.isArray(i))a.callbacks=i.concat(r);else{const e=i.copy();e.addHandler(r,!0),a.callbacks=e}const o=new AbortController,l=this;const c=async function(){let n,i=null;try{t?.signal?"any"in AbortSignal?n=AbortSignal.any([o.signal,t.signal]):(n=t.signal,i=()=>{o.abort()},t.signal.addEventListener("abort",i,{once:!0})):n=o.signal;const c=await l.stream(e,{...a,signal:n}),u=r.tapOutputIterable(s,c);for await(const e of u)if(o.signal.aborted)break}finally{await r.finish(),n&&i&&n.removeEventListener("abort",i)}}();let u,d=!1;try{for await(const t of r)d?(t.run_id===u&&t.event.endsWith("_end")&&t.data?.input&&delete t.data.input,yield t):(t.data.input=e,d=!0,u=t.run_id,yield t)}finally{o.abort(),await c}}async*_streamEventsV1(e,t,n){let r,a=!1;const s=Pl(t),i=s.tags??[],o=s.metadata??{},l=s.runName??this.getName(),c=new Hl({...n,autoClose:!1,_schemaFormat:"streaming_events"}),u=new ec({...n}),d=this._streamLog(e,c,s);for await(const f of d){if(r=r?r.concat(f):Ul.fromRunLogPatch(f),void 0===r.state)throw new Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!a){a=!0;const t={...r.state},n={run_id:t.id,event:`on_${t.type}_start`,name:l,tags:i,metadata:o,data:{input:e}};u.includeEvent(n,t.type)&&(yield n)}const t=f.ops.filter(e=>e.path.startsWith("/logs/")).map(e=>e.path.split("/")[2]),n=[...new Set(t)];for(const e of n){let t,n={};const a=r.state.logs[e];if(t=void 0===a.end_time?a.streamed_output.length>0?"stream":"start":"end","start"===t)void 0!==a.inputs&&(n.input=a.inputs);else if("end"===t)void 0!==a.inputs&&(n.input=a.inputs),n.output=a.final_output;else if("stream"===t){const e=a.streamed_output.length;if(1!==e)throw new Error(`Expected exactly one chunk of streamed output, got ${e} instead. Encountered in: "${a.name}"`);n={chunk:a.streamed_output[0]},a.streamed_output=[]}yield{event:`on_${a.type}_${t}`,name:a.name,run_id:a.id,tags:a.tags,metadata:a.metadata,data:n}}const{state:s}=r;if(s.streamed_output.length>0){const e=s.streamed_output.length;if(1!==e)throw new Error(`Expected exactly one chunk of streamed output, got ${e} instead. Encountered in: "${s.name}"`);const t={chunk:s.streamed_output[0]};s.streamed_output=[];const n={event:`on_${s.type}_stream`,run_id:s.id,tags:i,metadata:o,name:l,data:t};u.includeEvent(n,s.type)&&(yield n)}}const h=r?.state;if(void 0!==h){const e={event:`on_${h.type}_end`,name:l,run_id:h.id,tags:i,metadata:o,data:{output:h.final_output}};u.includeEvent(e,h.type)&&(yield e)}}static isRunnable(e){return Yl(e)}withListeners(e){let{onStart:t,onEnd:n,onError:r}=e;return new sd({bound:this,config:{},configFactories:[e=>({callbacks:[new Ql({config:e,onStart:t,onEnd:n,onError:r})]})]})}asTool(e){return function(e,t){const n=t.name??e.getName(),r=t.description??Bu(t.schema);if(function(e){if(!Uu(e))return!1;if(zu(e))return"ZodString"===e._def.typeName;if(Du(e))return"string"===e._zod.def.type;return!1}(t.schema))return new gd({name:n,description:r,schema:vs({input:ys()}).transform(e=>e.input),bound:e});return new gd({name:n,description:r,schema:t.schema,bound:e})}(this,e)}}class sd extends ad{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}getName(e){return this.bound.getName(e)}async _mergeConfig(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=$l(this.config,...t);return $l(r,...this.configFactories?await Promise.all(this.configFactories.map(async e=>await e(r))):[])}bind(e){return new this.constructor({bound:this.bound,kwargs:{...this.kwargs,...e},config:this.config})}withConfig(e){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return new od({bound:this.bound,kwargs:this.kwargs,config:this.config,maxAttemptNumber:e?.stopAfterAttempt,...e})}async invoke(e,t){return this.bound.invoke(e,await this._mergeConfig(Pl(t),this.kwargs))}async batch(e,t,n){const r=Array.isArray(t)?await Promise.all(t.map(async e=>this._mergeConfig(Pl(e),this.kwargs))):await this._mergeConfig(Pl(t),this.kwargs);return this.bound.batch(e,r,n)}async*_streamIterator(e,t){yield*this.bound._streamIterator(e,await this._mergeConfig(Pl(t),this.kwargs))}async stream(e,t){return this.bound.stream(e,await this._mergeConfig(Pl(t),this.kwargs))}async*transform(e,t){yield*this.bound.transform(e,await this._mergeConfig(Pl(t),this.kwargs))}streamEvents(e,t,n){const r=this;return jl.fromAsyncGenerator(async function*(){yield*r.bound.streamEvents(e,{...await r._mergeConfig(Pl(t),r.kwargs),version:t.version},n)}())}static isRunnableBinding(e){return e.bound&&ad.isRunnable(e.bound)}withListeners(e){let{onStart:t,onEnd:n,onError:r}=e;return new sd({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[e=>({callbacks:[new Ql({config:e,onStart:t,onEnd:n,onError:r})]})]})}}class id extends ad{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new id({bound:this.bound.bind(e)})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async _invoke(e,t,n){return this.bound.batch(e,Rl(t,{callbacks:n?.getChild()}))}withListeners(e){let{onStart:t,onEnd:n,onError:r}=e;return new id({bound:this.bound.withListeners({onStart:t,onEnd:n,onError:r})})}}class od extends sd{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,t,n){const r=e>1?`retry:attempt:${e}`:void 0;return Rl(t,{callbacks:n?.getChild(r)})}async _invoke(e,t,n){return ws(r=>super.invoke(e,this._patchConfigForRetry(r,t,n)),{onFailedAttempt:t=>this.onFailedAttempt(t,e),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async _batch(e,t,n,r){const a={};try{await ws(async s=>{const i=e.map((e,t)=>t).filter(e=>void 0===a[e.toString()]||a[e.toString()]instanceof Error),o=i.map(t=>e[t]),l=i.map(e=>this._patchConfigForRetry(s,t?.[e],n?.[e])),c=await super.batch(o,l,{...r,returnExceptions:!0});let u;for(let e=0;e<c.length;e+=1){const t=c[e],n=i[e];t instanceof Error&&void 0===u&&(u=t,u.input=o[e]),a[n.toString()]=t}if(u)throw u;return c},{onFailedAttempt:e=>this.onFailedAttempt(e,e.input),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(s){if(!0!==r?.returnExceptions)throw s}return Object.keys(a).sort((e,t)=>parseInt(e,10)-parseInt(t,10)).map(e=>a[parseInt(e,10)])}async batch(e,t,n){return this._batchWithConfig(this._batch.bind(this),e,t,n)}}class ld extends ad{static lc_name(){return"RunnableSequence"}constructor(e){super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"omitSequenceTags",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last,this.name=e.name,this.omitSequenceTags=e.omitSequenceTags??this.omitSequenceTags}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,t){const n=Pl(t),r=await Il(n),a=await(r?.handleChainStart(this.toJSON(),rd(e,"input"),n.runId,void 0,void 0,void 0,n?.runName));delete n.runId;let s,i=e;try{const e=[this.first,...this.middle];for(let r=0;r<e.length;r+=1){const s=e[r].invoke(i,Rl(n,{callbacks:a?.getChild(this.omitSequenceTags?void 0:`seq:step:${r+1}`)}));i=await Nl(s,t?.signal)}if(t?.signal?.aborted)throw new Error("Aborted");s=await this.last.invoke(i,Rl(n,{callbacks:a?.getChild(this.omitSequenceTags?void 0:`seq:step:${this.steps.length}`)}))}catch(o){throw await(a?.handleChainError(o)),o}return await(a?.handleChainEnd(rd(s,"output"))),s}async batch(e,t,n){const r=this._getOptionsList(t??{},e.length),a=await Promise.all(r.map(Il)),s=await Promise.all(a.map(async(t,n)=>{const a=await(t?.handleChainStart(this.toJSON(),rd(e[n],"input"),r[n].runId,void 0,void 0,void 0,r[n].runName));return delete r[n].runId,a}));let i=e;try{for(let e=0;e<this.steps.length;e+=1){const t=this.steps[e].batch(i,s.map((t,n)=>{const a=t?.getChild(this.omitSequenceTags?void 0:`seq:step:${e+1}`);return Rl(r[n],{callbacks:a})}),n);i=await Nl(t,r[0]?.signal)}}catch(o){throw await Promise.all(s.map(e=>e?.handleChainError(o))),o}return await Promise.all(s.map(e=>e?.handleChainEnd(rd(i,"output")))),i}async*_streamIterator(e,t){const n=await Il(t),{runId:r,...a}=t??{},s=await(n?.handleChainStart(this.toJSON(),rd(e,"input"),r,void 0,void 0,void 0,a?.runName)),i=[this.first,...this.middle,this.last];let o,l=!0;try{let n=i[0].transform(async function*(){yield e}(),Rl(a,{callbacks:s?.getChild(this.omitSequenceTags?void 0:"seq:step:1")}));for(let e=1;e<i.length;e+=1){const t=i[e];n=await t.transform(n,Rl(a,{callbacks:s?.getChild(this.omitSequenceTags?void 0:`seq:step:${e+1}`)}))}for await(const e of n)if(t?.signal?.throwIfAborted(),yield e,l)if(void 0===o)o=e;else try{o=Ml(o,e)}catch(c){o=void 0,l=!1}}catch(c){throw await(s?.handleChainError(c)),c}await(s?.handleChainEnd(rd(o,"output")))}getGraph(e){const t=new Ku;let n=null;return this.steps.forEach((r,a)=>{const s=r.getGraph(e);0!==a&&s.trimFirstNode(),a!==this.steps.length-1&&s.trimLastNode(),t.extend(s);const i=s.firstNode();if(!i)throw new Error(`Runnable ${r} has no first node`);n&&t.addEdge(n,i),n=s.lastNode()}),t}pipe(e){return ld.isRunnableSequence(e)?new ld({first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last,name:this.name??e.name}):new ld({first:this.first,middle:[...this.middle,this.last],last:fd(e),name:this.name})}static isRunnableSequence(e){return Array.isArray(e.middle)&&ad.isRunnable(e)}static from(e,t){let[n,...r]=e,a={};return"string"===typeof t?a.name=t:void 0!==t&&(a=t),new ld({...a,first:fd(n),middle:r.slice(0,-1).map(fd),last:fd(r[r.length-1])})}}class cd extends ad{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={};for(const[t,n]of Object.entries(e.steps))this.steps[t]=fd(n)}static from(e){return new cd({steps:e})}async invoke(e,t){const n=Pl(t),r=await Il(n),a=await(r?.handleChainStart(this.toJSON(),{input:e},n.runId,void 0,void 0,void 0,n?.runName));delete n.runId;const s={};try{const r=Object.entries(this.steps).map(async t=>{let[r,i]=t;s[r]=await i.invoke(e,Rl(n,{callbacks:a?.getChild(`map:key:${r}`)}))});await Nl(Promise.all(r),t?.signal)}catch(i){throw await(a?.handleChainError(i)),i}return await(a?.handleChainEnd(s)),s}async*_transform(e,t,n){const r={...this.steps},a=Ll(e,Object.keys(r).length),s=new Map(Object.entries(r).map((e,r)=>{let[s,i]=e;const o=i.transform(a[r],Rl(n,{callbacks:t?.getChild(`map:key:${s}`)}));return[s,o.next().then(e=>({key:s,gen:o,result:e}))]}));for(;s.size;){const e=Promise.race(s.values()),{key:t,result:r,gen:a}=await Nl(e,n?.signal);s.delete(t),r.done||(yield{[t]:r.value},s.set(t,a.next().then(e=>({key:t,gen:a,result:e}))))}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){const n=Pl(t),r=new Dl({generator:this.transform(async function*(){yield e}(),n),config:n});return await r.setup,jl.fromAsyncGenerator(r)}}class ud extends ad{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),!Rs(e.func))throw new Error("RunnableTraceable requires a function that is wrapped in traceable higher-order function");this.func=e.func}async invoke(e,t){const[n]=this._getOptionsList(t??{},1),r=await Il(n);return Nl(this.func(Rl(n,{callbacks:r}),e),n?.signal)}async*_streamIterator(e,t){const[n]=this._getOptionsList(t??{},1),r=await this.invoke(e,t);var a;if(ed(r))for await(const s of r)n?.signal?.throwIfAborted(),yield s;else if(null!=(a=r)&&"object"===typeof a&&"next"in a&&"function"===typeof a.next)for(;;){n?.signal?.throwIfAborted();const e=r.next();if(e.done)break;yield e.value}else yield r}static from(e){return new ud({func:e})}}class dd extends ad{static lc_name(){return"RunnableLambda"}constructor(e){if(Rs(e.func))return ud.from(e.func);super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),function(e){if(Rs(e))throw new Error("RunnableLambda requires a function that is not wrapped in traceable higher-order function. This shouldn't happen.")}(e.func),this.func=e.func}static from(e){return new dd({func:e})}async _invoke(e,t,n){return new Promise((r,a)=>{const s=Rl(t,{callbacks:n?.getChild(),recursionLimit:(t?.recursionLimit??25)-1});Al.runWithConfig(Cl(s),async()=>{try{let a=await this.func(e,{...s});if(a&&ad.isRunnable(a)){if(0===t?.recursionLimit)throw new Error("Recursion limit reached.");a=await a.invoke(e,{...s,recursionLimit:(s.recursionLimit??25)-1})}else if(ed(a)){let e;for await(const r of nd(s,a))if(t?.signal?.throwIfAborted(),void 0===e)e=r;else try{e=Ml(e,r)}catch(n){e=r}a=e}else if(Yu(a)){let e;for(const r of td(s,a))if(t?.signal?.throwIfAborted(),void 0===e)e=r;else try{e=Ml(e,r)}catch(n){e=r}a=e}r(a)}catch(n){a(n)}})})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async*_transform(e,t,n){let r;for await(const o of e)if(void 0===r)r=o;else try{r=Ml(r,o)}catch(i){r=o}const a=Rl(n,{callbacks:t?.getChild(),recursionLimit:(n?.recursionLimit??25)-1}),s=await new Promise((e,t)=>{Al.runWithConfig(Cl(a),async()=>{try{const t=await this.func(r,{...a,config:a});e(t)}catch(i){t(i)}})});if(s&&ad.isRunnable(s)){if(0===n?.recursionLimit)throw new Error("Recursion limit reached.");const e=await s.stream(r,a);for await(const t of e)yield t}else if(ed(s))for await(const o of nd(a,s))n?.signal?.throwIfAborted(),yield o;else if(Yu(s))for(const o of td(a,s))n?.signal?.throwIfAborted(),yield o;else yield s}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){const n=Pl(t),r=new Dl({generator:this.transform(async function*(){yield e}(),n),config:n});return await r.setup,jl.fromAsyncGenerator(r)}}class hd extends ad{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){yield this.runnable;for(const e of this.fallbacks)yield e}async invoke(e,t){const n=Pl(t),r=await Il(n),{runId:a,...s}=n,i=await(r?.handleChainStart(this.toJSON(),rd(e,"input"),a,void 0,void 0,void 0,s?.runName)),o=Rl(s,{callbacks:i?.getChild()});return await Al.runWithConfig(o,async()=>{let t;for(const a of this.runnables()){n?.signal?.throwIfAborted();try{const t=await a.invoke(e,o);return await(i?.handleChainEnd(rd(t,"output"))),t}catch(r){void 0===t&&(t=r)}}if(void 0===t)throw new Error("No error stored at end of fallback.");throw await(i?.handleChainError(t)),t})}async*_streamIterator(e,t){const n=Pl(t),r=await Il(n),{runId:a,...s}=n,i=await(r?.handleChainStart(this.toJSON(),rd(e,"input"),a,void 0,void 0,void 0,s?.runName));let o,l,c;for(const d of this.runnables()){n?.signal?.throwIfAborted();const t=Rl(s,{callbacks:i?.getChild()});try{l=nd(t,await d.stream(e,t));break}catch(u){void 0===o&&(o=u)}}if(void 0===l){const e=o??new Error("No error stored at end of fallback.");throw await(i?.handleChainError(e)),e}try{for await(const e of l){yield e;try{c=void 0===c?c:Ml(c,e)}catch(u){c=void 0}}}catch(u){throw await(i?.handleChainError(u)),u}await(i?.handleChainEnd(rd(c,"output")))}async batch(e,t,n){if(n?.returnExceptions)throw new Error("Not implemented.");const r=this._getOptionsList(t??{},e.length),a=await Promise.all(r.map(e=>Il(e))),s=await Promise.all(a.map(async(t,n)=>{const a=await(t?.handleChainStart(this.toJSON(),rd(e[n],"input"),r[n].runId,void 0,void 0,void 0,r[n].runName));return delete r[n].runId,a}));let i;for(const l of this.runnables()){r[0].signal?.throwIfAborted();try{const t=await l.batch(e,s.map((e,t)=>Rl(r[t],{callbacks:e?.getChild()})),n);return await Promise.all(s.map((e,n)=>e?.handleChainEnd(rd(t[n],"output")))),t}catch(o){void 0===i&&(i=o)}}if(!i)throw new Error("No error stored at end of fallbacks.");throw await Promise.all(s.map(e=>e?.handleChainError(i))),i}}function fd(e){if("function"===typeof e)return new dd({func:e});if(ad.isRunnable(e))return e;if(Array.isArray(e)||"object"!==typeof e)throw new Error("Expected a Runnable, function or object.\nInstead got an unsupported type.");{const t={};for(const[n,r]of Object.entries(e))t[n]=fd(r);return new cd({steps:t})}}class pd extends ad{static lc_name(){return"RunnableAssign"}constructor(e){e instanceof cd&&(e={mapper:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.mapper=e.mapper}async invoke(e,t){const n=await this.mapper.invoke(e,t);return{...e,...n}}async*_transform(e,t,n){const r=this.mapper.getStepsKeys(),[a,s]=Ll(e),i=this.mapper.transform(s,Rl(n,{callbacks:t?.getChild()})),o=i.next();for await(const l of a){if("object"!==typeof l||Array.isArray(l))throw new Error("RunnableAssign can only be used with objects as input, got "+typeof l);const e=Object.fromEntries(Object.entries(l).filter(e=>{let[t]=e;return!r.includes(t)}));Object.keys(e).length>0&&(yield e)}yield(await o).value;for await(const l of i)yield l}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){const n=Pl(t),r=new Dl({generator:this.transform(async function*(){yield e}(),n),config:n});return await r.setup,jl.fromAsyncGenerator(r)}}class md extends ad{static lc_name(){return"RunnablePick"}constructor(e){("string"===typeof e||Array.isArray(e))&&(e={keys:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keys=e.keys}async _pick(e){if("string"===typeof this.keys)return e[this.keys];{const t=this.keys.map(t=>[t,e[t]]).filter(e=>void 0!==e[1]);return 0===t.length?void 0:Object.fromEntries(t)}}async invoke(e,t){return this._callWithConfig(this._pick.bind(this),e,t)}async*_transform(e){for await(const t of e){const e=await this._pick(t);void 0!==e&&(yield e)}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){const n=Pl(t),r=new Dl({generator:this.transform(async function*(){yield e}(),n),config:n});return await r.setup,jl.fromAsyncGenerator(r)}}class gd extends sd{constructor(e){super({bound:ld.from([dd.from(async e=>{let t;if(Zo(e))try{t=await Fu(this.schema,e.args)}catch(n){throw new Go("Received tool input did not match expected schema",JSON.stringify(e.args))}else t=e;return t}).withConfig({runName:`${e.name}:parse_input`}),e.bound]).withConfig({runName:e.name}),config:e.config??{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.description=e.description,this.schema=e.schema}static lc_name(){return"RunnableToolLike"}}class yd extends ad{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","documents","transformers"]})}invoke(e,t){return this.transformDocuments(e)}}function bd(e,t,n,r,a){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?a.call(e,n):a?a.value=n:t.set(e,n),n}function vd(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)}let wd=function(){const{crypto:e}=globalThis;if(e?.randomUUID)return wd=e.randomUUID.bind(e),e.randomUUID();const t=new Uint8Array(1),n=e?()=>e.getRandomValues(t)[0]:()=>255*Math.random()&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>(+e^n()&15>>+e/4).toString(16))};function _d(e){return"object"===typeof e&&null!==e&&("name"in e&&"AbortError"===e.name||"message"in e&&String(e.message).includes("FetchRequestCanceledException"))}const Sd=e=>{if(e instanceof Error)return e;if("object"===typeof e&&null!==e){try{if("[object Error]"===Object.prototype.toString.call(e)){const t=new Error(e.message,e.cause?{cause:e.cause}:{});return e.stack&&(t.stack=e.stack),e.cause&&!t.cause&&(t.cause=e.cause),e.name&&(t.name=e.name),t}}catch{}try{return new Error(JSON.stringify(e))}catch{}}return new Error(e)};class kd extends Error{}class Ed extends kd{constructor(e,t,n,r){super(`${Ed.makeMessage(e,t,n)}`),this.status=e,this.headers=r,this.requestID=r?.get("x-request-id"),this.error=t;const a=t;this.code=a?.code,this.param=a?.param,this.type=a?.type}static makeMessage(e,t,n){const r=t?.message?"string"===typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&r?`${e} ${r}`:e?`${e} status code (no body)`:r||"(no status code or body)"}static generate(e,t,n,r){if(!e||!r)return new Od({message:n,cause:Sd(t)});const a=t?.error;return 400===e?new Id(e,a,n,r):401===e?new $d(e,a,n,r):403===e?new Td(e,a,n,r):404===e?new Pd(e,a,n,r):409===e?new Rd(e,a,n,r):422===e?new Cd(e,a,n,r):429===e?new Nd(e,a,n,r):e>=500?new jd(e,a,n,r):new Ed(e,a,n,r)}}class xd extends Ed{constructor(){let{message:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(void 0,void 0,e||"Request was aborted.",void 0)}}class Od extends Ed{constructor(e){let{message:t,cause:n}=e;super(void 0,void 0,t||"Connection error.",void 0),n&&(this.cause=n)}}class Ad extends Od{constructor(){let{message:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({message:e??"Request timed out."})}}class Id extends Ed{}class $d extends Ed{}class Td extends Ed{}class Pd extends Ed{}class Rd extends Ed{}class Cd extends Ed{}class Nd extends Ed{}class jd extends Ed{}class Ld extends kd{constructor(){super("Could not parse response content as the length limit was reached")}}class Md extends kd{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}class Dd extends Error{constructor(e){super(e)}}const zd=/^[a-z][a-z0-9+.-]*:/i;let Ud=e=>(Ud=Array.isArray,Ud(e)),Fd=Ud;function Bd(e){return null!=e&&"object"===typeof e&&!Array.isArray(e)}const qd=e=>new Promise(t=>setTimeout(t,e)),Hd="5.8.3";const Wd=()=>{const e="undefined"!==typeof Deno&&null!=Deno.build?"deno":"undefined"!==typeof EdgeRuntime?"edge":"[object process]"===Object.prototype.toString.call("undefined"!==typeof globalThis.process?globalThis.process:0)?"node":"unknown";if("deno"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Hd,"X-Stainless-OS":Zd(Deno.build.os),"X-Stainless-Arch":Vd(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"===typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"};if("undefined"!==typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Hd,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if("node"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Hd,"X-Stainless-OS":Zd(globalThis.process.platform??"unknown"),"X-Stainless-Arch":Vd(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};const t=function(){if("undefined"===typeof navigator||!navigator)return null;const e=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:t,pattern:n}of e){const e=n.exec(navigator.userAgent);if(e){return{browser:t,version:`${e[1]||0}.${e[2]||0}.${e[3]||0}`}}}return null}();return t?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Hd,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Hd,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};const Vd=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",Zd=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown";let Gd;function Jd(){const e=globalThis.ReadableStream;if("undefined"===typeof e)throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return new e(...n)}function Kd(e){let t=Symbol.asyncIterator in e?e[Symbol.asyncIterator]():e[Symbol.iterator]();return Jd({start(){},async pull(e){const{done:n,value:r}=await t.next();n?e.close():e.enqueue(r)},async cancel(){await(t.return?.())}})}function Xd(e){if(e[Symbol.asyncIterator])return e;const t=e.getReader();return{async next(){try{const e=await t.read();return e?.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){const e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}const Qd=e=>{let{headers:t,body:n}=e;return{bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(n)}},Yd="RFC3986",eh=e=>String(e),th={RFC1738:e=>String(e).replace(/%20/g,"+"),RFC3986:eh},nh="RFC1738";let rh=(e,t)=>(rh=Object.hasOwn??Function.prototype.call.bind(Object.prototype.hasOwnProperty),rh(e,t));const ah=(()=>{const e=[];for(let t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e})();const sh=1024;function ih(e,t){if(Ud(e)){const n=[];for(let r=0;r<e.length;r+=1)n.push(t(e[r]));return n}return t(e)}const oh={brackets:e=>String(e)+"[]",comma:"comma",indices:(e,t)=>String(e)+"["+t+"]",repeat:e=>String(e)},lh=function(e,t){Array.prototype.push.apply(e,Ud(t)?t:[t])};let ch;const uh={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:(e,t,n,r,a)=>{if(0===e.length)return e;let s=e;if("symbol"===typeof e?s=Symbol.prototype.toString.call(e):"string"!==typeof e&&(s=String(e)),"iso-8859-1"===n)return escape(s).replace(/%u[0-9a-f]{4}/gi,function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"});let i="";for(let o=0;o<s.length;o+=sh){const e=s.length>=sh?s.slice(o,o+sh):s,t=[];for(let n=0;n<e.length;++n){let r=e.charCodeAt(n);45===r||46===r||95===r||126===r||r>=48&&r<=57||r>=65&&r<=90||r>=97&&r<=122||a===nh&&(40===r||41===r)?t[t.length]=e.charAt(n):r<128?t[t.length]=ah[r]:r<2048?t[t.length]=ah[192|r>>6]+ah[128|63&r]:r<55296||r>=57344?t[t.length]=ah[224|r>>12]+ah[128|r>>6&63]+ah[128|63&r]:(n+=1,r=65536+((1023&r)<<10|1023&e.charCodeAt(n)),t[t.length]=ah[240|r>>18]+ah[128|r>>12&63]+ah[128|r>>6&63]+ah[128|63&r])}i+=t.join("")}return i},encodeValuesOnly:!1,format:Yd,formatter:eh,indices:!1,serializeDate:e=>(ch??(ch=Function.prototype.call.bind(Date.prototype.toISOString)))(e),skipNulls:!1,strictNullHandling:!1};const dh={};function hh(e,t,n,r,a,s,i,o,l,c,u,d,h,f,p,m,g,y){let b=e,v=y,w=0,_=!1;for(;void 0!==(v=v.get(dh))&&!_;){const t=v.get(e);if(w+=1,"undefined"!==typeof t){if(t===w)throw new RangeError("Cyclic object value");_=!0}"undefined"===typeof v.get(dh)&&(w=0)}if("function"===typeof c?b=c(t,b):b instanceof Date?b=h?.(b):"comma"===n&&Ud(b)&&(b=ih(b,function(e){return e instanceof Date?h?.(e):e})),null===b){if(s)return l&&!m?l(t,uh.encoder,g,"key",f):t;b=""}if("string"===typeof(S=b)||"number"===typeof S||"boolean"===typeof S||"symbol"===typeof S||"bigint"===typeof S||function(e){return!(!e||"object"!==typeof e)&&!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))}(b)){if(l){const e=m?t:l(t,uh.encoder,g,"key",f);return[p?.(e)+"="+p?.(l(b,uh.encoder,g,"value",f))]}return[p?.(t)+"="+p?.(String(b))]}var S;const k=[];if("undefined"===typeof b)return k;let E;if("comma"===n&&Ud(b))m&&l&&(b=ih(b,l)),E=[{value:b.length>0?b.join(",")||null:void 0}];else if(Ud(c))E=c;else{const e=Object.keys(b);E=u?e.sort(u):e}const x=o?String(t).replace(/\./g,"%2E"):String(t),O=r&&Ud(b)&&1===b.length?x+"[]":x;if(a&&Ud(b)&&0===b.length)return O+"[]";for(let A=0;A<E.length;++A){const t=E[A],v="object"===typeof t&&"undefined"!==typeof t.value?t.value:b[t];if(i&&null===v)continue;const _=d&&o?t.replace(/\./g,"%2E"):t,S=Ud(b)?"function"===typeof n?n(O,_):O:O+(d?"."+_:"["+_+"]");y.set(e,w);const x=new WeakMap;x.set(dh,y),lh(k,hh(v,S,n,r,a,s,i,o,"comma"===n&&m&&Ud(b)?null:l,c,u,d,h,f,p,m,g,x))}return k}function fh(e){let t=e;const n=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:uh;if("undefined"!==typeof e.allowEmptyArrays&&"boolean"!==typeof e.allowEmptyArrays)throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if("undefined"!==typeof e.encodeDotInKeys&&"boolean"!==typeof e.encodeDotInKeys)throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.encoder&&"undefined"!==typeof e.encoder&&"function"!==typeof e.encoder)throw new TypeError("Encoder has to be a function.");const t=e.charset||uh.charset;if("undefined"!==typeof e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let n=Yd;if("undefined"!==typeof e.format){if(!rh(th,e.format))throw new TypeError("Unknown format option provided.");n=e.format}const r=th[n];let a,s=uh.filter;if(("function"===typeof e.filter||Ud(e.filter))&&(s=e.filter),a=e.arrayFormat&&e.arrayFormat in oh?e.arrayFormat:"indices"in e?e.indices?"indices":"repeat":uh.arrayFormat,"commaRoundTrip"in e&&"boolean"!==typeof e.commaRoundTrip)throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const i="undefined"===typeof e.allowDots?!0===!!e.encodeDotInKeys||uh.allowDots:!!e.allowDots;return{addQueryPrefix:"boolean"===typeof e.addQueryPrefix?e.addQueryPrefix:uh.addQueryPrefix,allowDots:i,allowEmptyArrays:"boolean"===typeof e.allowEmptyArrays?!!e.allowEmptyArrays:uh.allowEmptyArrays,arrayFormat:a,charset:t,charsetSentinel:"boolean"===typeof e.charsetSentinel?e.charsetSentinel:uh.charsetSentinel,commaRoundTrip:!!e.commaRoundTrip,delimiter:"undefined"===typeof e.delimiter?uh.delimiter:e.delimiter,encode:"boolean"===typeof e.encode?e.encode:uh.encode,encodeDotInKeys:"boolean"===typeof e.encodeDotInKeys?e.encodeDotInKeys:uh.encodeDotInKeys,encoder:"function"===typeof e.encoder?e.encoder:uh.encoder,encodeValuesOnly:"boolean"===typeof e.encodeValuesOnly?e.encodeValuesOnly:uh.encodeValuesOnly,filter:s,format:n,formatter:r,serializeDate:"function"===typeof e.serializeDate?e.serializeDate:uh.serializeDate,skipNulls:"boolean"===typeof e.skipNulls?e.skipNulls:uh.skipNulls,sort:"function"===typeof e.sort?e.sort:null,strictNullHandling:"boolean"===typeof e.strictNullHandling?e.strictNullHandling:uh.strictNullHandling}}(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{});let r,a;"function"===typeof n.filter?(a=n.filter,t=a("",t)):Ud(n.filter)&&(a=n.filter,r=a);const s=[];if("object"!==typeof t||null===t)return"";const i=oh[n.arrayFormat],o="comma"===i&&n.commaRoundTrip;r||(r=Object.keys(t)),n.sort&&r.sort(n.sort);const l=new WeakMap;for(let d=0;d<r.length;++d){const e=r[d];n.skipNulls&&null===t[e]||lh(s,hh(t[e],e,i,o,n.allowEmptyArrays,n.strictNullHandling,n.skipNulls,n.encodeDotInKeys,n.encode?n.encoder:null,n.filter,n.sort,n.allowDots,n.serializeDate,n.format,n.formatter,n.encodeValuesOnly,n.charset,l))}const c=s.join(n.delimiter);let u=!0===n.addQueryPrefix?"?":"";return n.charsetSentinel&&("iso-8859-1"===n.charset?u+="utf8=%26%2310003%3B&":u+="utf8=%E2%9C%93&"),c.length>0?u+c:""}let ph,mh;function gh(e){let t;return(ph??(t=new globalThis.TextEncoder,ph=t.encode.bind(t)))(e)}function yh(e){let t;return(mh??(t=new globalThis.TextDecoder,mh=t.decode.bind(t)))(e)}var bh,vh;class wh{constructor(){bh.set(this,void 0),vh.set(this,void 0),bd(this,bh,new Uint8Array,"f"),bd(this,vh,null,"f")}decode(e){if(null==e)return[];const t=e instanceof ArrayBuffer?new Uint8Array(e):"string"===typeof e?gh(e):e;bd(this,bh,function(e){let t=0;for(const a of e)t+=a.length;const n=new Uint8Array(t);let r=0;for(const a of e)n.set(a,r),r+=a.length;return n}([vd(this,bh,"f"),t]),"f");const n=[];let r;for(;null!=(r=_h(vd(this,bh,"f"),vd(this,vh,"f")));){if(r.carriage&&null==vd(this,vh,"f")){bd(this,vh,r.index,"f");continue}if(null!=vd(this,vh,"f")&&(r.index!==vd(this,vh,"f")+1||r.carriage)){n.push(yh(vd(this,bh,"f").subarray(0,vd(this,vh,"f")-1))),bd(this,bh,vd(this,bh,"f").subarray(vd(this,vh,"f")),"f"),bd(this,vh,null,"f");continue}const e=null!==vd(this,vh,"f")?r.preceding-1:r.preceding,t=yh(vd(this,bh,"f").subarray(0,e));n.push(t),bd(this,bh,vd(this,bh,"f").subarray(r.index),"f"),bd(this,vh,null,"f")}return n}flush(){return vd(this,bh,"f").length?this.decode("\n"):[]}}function _h(e,t){for(let n=t??0;n<e.length;n++){if(10===e[n])return{preceding:n,index:n+1,carriage:!1};if(13===e[n])return{preceding:n,index:n+1,carriage:!0}}return null}function Sh(e){for(let t=0;t<e.length-1;t++){if(10===e[t]&&10===e[t+1])return t+2;if(13===e[t]&&13===e[t+1])return t+2;if(13===e[t]&&10===e[t+1]&&t+3<e.length&&13===e[t+2]&&10===e[t+3])return t+4}return-1}bh=new WeakMap,vh=new WeakMap,wh.NEWLINE_CHARS=new Set(["\n","\r"]),wh.NEWLINE_REGEXP=/\r\n|[\n\r]/g;const kh={off:0,error:200,warn:300,info:400,debug:500},Eh=(e,t,n)=>{var r,a;if(e)return r=kh,a=e,Object.prototype.hasOwnProperty.call(r,a)?e:void $h(n).warn(`${t} was set to ${JSON.stringify(e)}, expected one of ${JSON.stringify(Object.keys(kh))}`)};function xh(){}function Oh(e,t,n){return!t||kh[e]>kh[n]?xh:t[e].bind(t)}const Ah={error:xh,warn:xh,info:xh,debug:xh};let Ih=new WeakMap;function $h(e){const t=e.logger,n=e.logLevel??"off";if(!t)return Ah;const r=Ih.get(t);if(r&&r[0]===n)return r[1];const a={error:Oh("error",t,n),warn:Oh("warn",t,n),info:Oh("info",t,n),debug:Oh("debug",t,n)};return Ih.set(t,[n,a]),a}const Th=e=>(e.options&&(e.options={...e.options},delete e.options.headers),e.headers&&(e.headers=Object.fromEntries((e.headers instanceof Headers?[...e.headers]:Object.entries(e.headers)).map(e=>{let[t,n]=e;return[t,"authorization"===t.toLowerCase()||"cookie"===t.toLowerCase()||"set-cookie"===t.toLowerCase()?"***":n]}))),"retryOfRequestLogID"in e&&(e.retryOfRequestLogID&&(e.retryOf=e.retryOfRequestLogID),delete e.retryOfRequestLogID),e);var Ph,Rh,Ch;class Nh{constructor(e,t,n){this.iterator=e,Ph.set(this,void 0),this.controller=t,bd(this,Ph,n,"f")}static fromSSEResponse(e,t,n){let r=!1;const a=n?$h(n):console;return new Nh(async function*(){if(r)throw new kd("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let n=!1;try{for await(const r of async function*(e,t){if(!e.body){if(t.abort(),"undefined"!==typeof globalThis.navigator&&"ReactNative"===globalThis.navigator.product)throw new kd("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api");throw new kd("Attempted to iterate over a response with no body")}const n=new jh,r=new wh,a=Xd(e.body);for await(const s of async function*(e){let t=new Uint8Array;for await(const n of e){if(null==n)continue;const e=n instanceof ArrayBuffer?new Uint8Array(n):"string"===typeof n?gh(n):n;let r,a=new Uint8Array(t.length+e.length);for(a.set(t),a.set(e,t.length),t=a;-1!==(r=Sh(t));)yield t.slice(0,r),t=t.slice(r)}t.length>0&&(yield t)}(a))for(const e of r.decode(s)){const t=n.decode(e);t&&(yield t)}for(const s of r.flush()){const e=n.decode(s);e&&(yield e)}}(e,t))if(!n)if(r.data.startsWith("[DONE]"))n=!0;else if(null===r.event||r.event.startsWith("response.")||r.event.startsWith("transcript.")){let t;try{t=JSON.parse(r.data)}catch(s){throw a.error("Could not parse message into JSON:",r.data),a.error("From chunk:",r.raw),s}if(t&&t.error)throw new Ed(void 0,t.error,void 0,e.headers);yield t}else{let e;try{e=JSON.parse(r.data)}catch(s){throw console.error("Could not parse message into JSON:",r.data),console.error("From chunk:",r.raw),s}if("error"==r.event)throw new Ed(void 0,e.error,e.message,void 0);yield{event:r.event,data:e}}n=!0}catch(s){if(_d(s))return;throw s}finally{n||t.abort()}},t,n)}static fromReadableStream(e,t,n){let r=!1;return new Nh(async function*(){if(r)throw new kd("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let n=!1;try{for await(const t of async function*(){const t=new wh,n=Xd(e);for await(const e of n)for(const n of t.decode(e))yield n;for(const e of t.flush())yield e}())n||t&&(yield JSON.parse(t));n=!0}catch(a){if(_d(a))return;throw a}finally{n||t.abort()}},t,n)}[(Ph=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){const e=[],t=[],n=this.iterator(),r=r=>({next:()=>{if(0===r.length){const r=n.next();e.push(r),t.push(r)}return r.shift()}});return[new Nh(()=>r(e),this.controller,vd(this,Ph,"f")),new Nh(()=>r(t),this.controller,vd(this,Ph,"f"))]}toReadableStream(){const e=this;let t;return Jd({async start(){t=e[Symbol.asyncIterator]()},async pull(e){try{const{value:n,done:r}=await t.next();if(r)return e.close();const a=gh(JSON.stringify(n)+"\n");e.enqueue(a)}catch(n){e.error(n)}},async cancel(){await(t.return?.())}})}}class jh{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,r]=function(e,t){const n=e.indexOf(t);if(-1!==n)return[e.substring(0,n),t,e.substring(n+t.length)];return[e,"",""]}(e,":");return r.startsWith(" ")&&(r=r.substring(1)),"event"===t?this.event=r:"data"===t&&this.data.push(r),null}}async function Lh(e,t){const{response:n,requestLogID:r,retryOfRequestLogID:a,startTime:s}=t,i=await(async()=>{if(t.options.stream)return $h(e).debug("response",n.status,n.url,n.headers,n.body),t.options.__streamClass?t.options.__streamClass.fromSSEResponse(n,t.controller,e):Nh.fromSSEResponse(n,t.controller,e);if(204===n.status)return null;if(t.options.__binaryResponse)return n;const r=n.headers.get("content-type"),a=r?.split(";")[0]?.trim();if(a?.includes("application/json")||a?.endsWith("+json")){return Mh(await n.json(),n)}return await n.text()})();return $h(e).debug(`[${r}] response parsed`,Th({retryOfRequestLogID:a,url:n.url,status:n.status,body:i,durationMs:Date.now()-s})),i}function Mh(e,t){return!e||"object"!==typeof e||Array.isArray(e)?e:Object.defineProperty(e,"_request_id",{value:t.headers.get("x-request-id"),enumerable:!1})}class Dh extends Promise{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Lh;super(e=>{e(null)}),this.responsePromise=t,this.parseResponse=n,Rh.set(this,void 0),bd(this,Rh,e,"f")}_thenUnwrap(e){return new Dh(vd(this,Rh,"f"),this.responsePromise,async(t,n)=>Mh(e(await this.parseResponse(t,n),n),n.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(vd(this,Rh,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}Rh=new WeakMap;class zh{constructor(e,t,n,r){Ch.set(this,void 0),bd(this,Ch,e,"f"),this.options=r,this.response=t,this.body=n}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageRequestOptions()}async getNextPage(){const e=this.nextPageRequestOptions();if(!e)throw new kd("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await vd(this,Ch,"f").requestAPIList(this.constructor,e)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(Ch=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class Uh extends Dh{constructor(e,t,n){super(e,t,async(e,t)=>new n(e,t.response,await Lh(e,t),t.options))}async*[Symbol.asyncIterator](){const e=await(this);for await(const t of e)yield t}}class Fh extends zh{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[],this.object=n.object}getPaginatedItems(){return this.data??[]}nextPageRequestOptions(){return null}}class Bh extends zh{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[],this.has_more=n.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){const e=this.getPaginatedItems(),t=e[e.length-1]?.id;return t?{...this.options,query:{...(n=this.options.query,"object"!==typeof n?{}:n??{}),after:t}}:null;var n}}const qh=()=>{if("undefined"===typeof File){const{process:e}=globalThis,t="string"===typeof e?.versions?.node&&parseInt(e.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(t?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function Hh(e,t,n){return qh(),new File(e,t??"unknown_file",n)}function Wh(e){return("object"===typeof e&&null!==e&&("name"in e&&e.name&&String(e.name)||"url"in e&&e.url&&String(e.url)||"filename"in e&&e.filename&&String(e.filename)||"path"in e&&e.path&&String(e.path))||"").split(/[\\/]/).pop()||void 0}const Vh=e=>null!=e&&"object"===typeof e&&"function"===typeof e[Symbol.asyncIterator],Zh=async(e,t)=>({...e,body:await Jh(e.body,t)}),Gh=new WeakMap;const Jh=async(e,t)=>{if(!await function(e){const t="function"===typeof e?e:e.fetch,n=Gh.get(t);if(n)return n;const r=(async()=>{try{const e="Response"in t?t.Response:(await t("data:,")).constructor,n=new FormData;return n.toString()!==await new e(n).text()}catch{return!0}})();return Gh.set(t,r),r}(t))throw new TypeError("The provided fetch function does not support file uploads with the current global FormData class.");const n=new FormData;return await Promise.all(Object.entries(e||{}).map(e=>{let[t,r]=e;return Xh(n,t,r)})),n},Kh=e=>e instanceof Blob&&"name"in e,Xh=async(e,t,n)=>{if(void 0!==n){if(null==n)throw new TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if("string"===typeof n||"number"===typeof n||"boolean"===typeof n)e.append(t,String(n));else if(n instanceof Response)e.append(t,Hh([await n.blob()],Wh(n)));else if(Vh(n))e.append(t,Hh([await new Response(Kd(n)).blob()],Wh(n)));else if(Kh(n))e.append(t,n,Wh(n));else if(Array.isArray(n))await Promise.all(n.map(n=>Xh(e,t+"[]",n)));else{if("object"!==typeof n)throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${n} instead`);await Promise.all(Object.entries(n).map(n=>{let[r,a]=n;return Xh(e,`${t}[${r}]`,a)}))}}},Qh=e=>null!=e&&"object"===typeof e&&"number"===typeof e.size&&"string"===typeof e.type&&"function"===typeof e.text&&"function"===typeof e.slice&&"function"===typeof e.arrayBuffer;async function Yh(e){let t=[];if("string"===typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(Qh(e))t.push(e instanceof Blob?e:await e.arrayBuffer());else{if(!Vh(e)){const t=e?.constructor?.name;throw new Error(`Unexpected data type: ${typeof e}${t?`; constructor: ${t}`:""}${function(e){if("object"!==typeof e||null===e)return"";const t=Object.getOwnPropertyNames(e);return`; props: [${t.map(e=>`"${e}"`).join(", ")}]`}(e)}`)}for await(const n of e)t.push(...await Yh(n))}return t}class ef{constructor(e){this._client=e}}function tf(e){return e.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}const nf=Object.freeze(Object.create(null)),rf=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:tf;return function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];if(1===t.length)return t[0];let s=!1;const i=[],o=t.reduce((t,n,a)=>{/[?#]/.test(n)&&(s=!0);const o=r[a];let l=(s?encodeURIComponent:e)(""+o);return a!==r.length&&(null==o||"object"===typeof o&&o.toString===Object.getPrototypeOf(Object.getPrototypeOf(o.hasOwnProperty??nf)??nf)?.toString)&&(l=o+"",i.push({start:t.length+n.length,length:l.length,error:`Value of type ${Object.prototype.toString.call(o).slice(8,-1)} is not a valid path parameter`})),t+n+(a===r.length?"":l)},""),l=o.split(/[?#]/,1)[0],c=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi;let u;for(;null!==(u=c.exec(l));)i.push({start:u.index,length:u[0].length,error:`Value "${u[0]}" can't be safely passed as a path parameter`});if(i.sort((e,t)=>e.start-t.start),i.length>0){let e=0;const t=i.reduce((t,n)=>{const r=" ".repeat(n.start-e),a="^".repeat(n.length);return e=n.start+n.length,t+r+a},"");throw new kd(`Path parameters result in path with invalid segments:\n${i.map(e=>e.error).join("\n")}\n${o}\n${t}`)}return o}},af=rf(tf);class sf extends ef{list(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return this._client.getAPIList(af`/chat/completions/${e}/messages`,Bh,{query:t,...n})}}function of(e){return"function"===typeof e.parse}const lf=e=>"assistant"===e?.role,cf=e=>"tool"===e?.role;var uf,df,hf,ff,pf,mf,gf,yf,bf,vf,wf,_f,Sf,kf,Ef,xf,Of,Af,If,$f,Tf;class Pf{constructor(){uf.add(this),this.controller=new AbortController,df.set(this,void 0),hf.set(this,()=>{}),ff.set(this,()=>{}),pf.set(this,void 0),mf.set(this,()=>{}),gf.set(this,()=>{}),yf.set(this,{}),bf.set(this,!1),vf.set(this,!1),wf.set(this,!1),_f.set(this,!1),bd(this,df,new Promise((e,t)=>{bd(this,hf,e,"f"),bd(this,ff,t,"f")}),"f"),bd(this,pf,new Promise((e,t)=>{bd(this,mf,e,"f"),bd(this,gf,t,"f")}),"f"),vd(this,df,"f").catch(()=>{}),vd(this,pf,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},vd(this,uf,"m",Sf).bind(this))},0)}_connected(){this.ended||(vd(this,hf,"f").call(this),this._emit("connect"))}get ended(){return vd(this,bf,"f")}get errored(){return vd(this,vf,"f")}get aborted(){return vd(this,wf,"f")}abort(){this.controller.abort()}on(e,t){return(vd(this,yf,"f")[e]||(vd(this,yf,"f")[e]=[])).push({listener:t}),this}off(e,t){const n=vd(this,yf,"f")[e];if(!n)return this;const r=n.findIndex(e=>e.listener===t);return r>=0&&n.splice(r,1),this}once(e,t){return(vd(this,yf,"f")[e]||(vd(this,yf,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,n)=>{bd(this,_f,!0,"f"),"error"!==e&&this.once("error",n),this.once(e,t)})}async done(){bd(this,_f,!0,"f"),await vd(this,pf,"f")}_emit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if(vd(this,bf,"f"))return;"end"===e&&(bd(this,bf,!0,"f"),vd(this,mf,"f").call(this));const a=vd(this,yf,"f")[e];if(a&&(vd(this,yf,"f")[e]=a.filter(e=>!e.once),a.forEach(e=>{let{listener:t}=e;return t(...n)})),"abort"===e){const e=n[0];return vd(this,_f,"f")||a?.length||Promise.reject(e),vd(this,ff,"f").call(this,e),vd(this,gf,"f").call(this,e),void this._emit("end")}if("error"===e){const e=n[0];vd(this,_f,"f")||a?.length||Promise.reject(e),vd(this,ff,"f").call(this,e),vd(this,gf,"f").call(this,e),this._emit("end")}}_emitFinal(){}}function Rf(e){return"auto-parseable-response-format"===e?.$brand}function Cf(e){return"auto-parseable-tool"===e?.$brand}function Nf(e,t){const n=e.choices.map(e=>{if("length"===e.finish_reason)throw new Ld;if("content_filter"===e.finish_reason)throw new Md;return{...e,message:{...e.message,...e.message.tool_calls?{tool_calls:e.message.tool_calls?.map(e=>function(e,t){const n=e.tools?.find(e=>e.function?.name===t.function.name);return{...t,function:{...t.function,parsed_arguments:Cf(n)?n.$parseRaw(t.function.arguments):n?.function.strict?JSON.parse(t.function.arguments):null}}}(t,e))??void 0}:void 0,parsed:e.message.content&&!e.message.refusal?jf(t,e.message.content):null}}});return{...e,choices:n}}function jf(e,t){if("json_schema"!==e.response_format?.type)return null;if("json_schema"===e.response_format?.type){if("$parseRaw"in e.response_format){return e.response_format.$parseRaw(t)}return JSON.parse(t)}return null}function Lf(e,t){if(!e)return!1;const n=e.tools?.find(e=>e.function?.name===t.function.name);return Cf(n)||n?.function.strict||!1}function Mf(e){return!!Rf(e.response_format)||(e.tools?.some(e=>Cf(e)||"function"===e.type&&!0===e.function.strict)??!1)}df=new WeakMap,hf=new WeakMap,ff=new WeakMap,pf=new WeakMap,mf=new WeakMap,gf=new WeakMap,yf=new WeakMap,bf=new WeakMap,vf=new WeakMap,wf=new WeakMap,_f=new WeakMap,uf=new WeakSet,Sf=function(e){if(bd(this,vf,!0,"f"),e instanceof Error&&"AbortError"===e.name&&(e=new xd),e instanceof xd)return bd(this,wf,!0,"f"),this._emit("abort",e);if(e instanceof kd)return this._emit("error",e);if(e instanceof Error){const t=new kd(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new kd(String(e)))};const Df=10;class zf extends Pf{constructor(){super(...arguments),kf.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if("content"in e||(e.content=null),this.messages.push(e),t)if(this._emit("message",e),cf(e)&&e.content)this._emit("functionToolCallResult",e.content);else if(lf(e)&&e.tool_calls)for(const n of e.tool_calls)"function"===n.type&&this._emit("functionToolCall",n.function)}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new kd("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),vd(this,kf,"m",Ef).call(this)}async finalMessage(){return await this.done(),vd(this,kf,"m",xf).call(this)}async finalFunctionToolCall(){return await this.done(),vd(this,kf,"m",Of).call(this)}async finalFunctionToolCallResult(){return await this.done(),vd(this,kf,"m",Af).call(this)}async totalUsage(){return await this.done(),vd(this,kf,"m",If).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=vd(this,kf,"m",xf).call(this);t&&this._emit("finalMessage",t);const n=vd(this,kf,"m",Ef).call(this);n&&this._emit("finalContent",n);const r=vd(this,kf,"m",Of).call(this);r&&this._emit("finalFunctionToolCall",r);const a=vd(this,kf,"m",Af).call(this);null!=a&&this._emit("finalFunctionToolCallResult",a),this._chatCompletions.some(e=>e.usage)&&this._emit("totalUsage",vd(this,kf,"m",If).call(this))}async _createChatCompletion(e,t,n){const r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),vd(this,kf,"m",$f).call(this,t);const a=await e.chat.completions.create({...t,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addChatCompletion(Nf(a,t))}async _runChatCompletion(e,t,n){for(const r of t.messages)this._addMessage(r,!1);return await this._createChatCompletion(e,t,n)}async _runTools(e,t,n){const r="tool",{tool_choice:a="auto",stream:s,...i}=t,o="string"!==typeof a&&a?.function?.name,{maxChatCompletions:l=Df}=n||{},c=t.tools.map(e=>{if(Cf(e)){if(!e.$callback)throw new kd("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:e.$callback,name:e.function.name,description:e.function.description||"",parameters:e.function.parameters,parse:e.$parseRaw,strict:!0}}}return e}),u={};for(const f of c)"function"===f.type&&(u[f.function.name||f.function.function.name]=f.function);const d="tools"in t?c.map(e=>"function"===e.type?{type:"function",function:{name:e.function.name||e.function.function.name,parameters:e.function.parameters,description:e.function.description,strict:e.function.strict}}:e):void 0;for(const f of t.messages)this._addMessage(f,!1);for(let f=0;f<l;++f){const t=await this._createChatCompletion(e,{...i,tool_choice:a,tools:d,messages:[...this.messages]},n),s=t.choices[0]?.message;if(!s)throw new kd("missing message in ChatCompletion response");if(!s.tool_calls?.length)return;for(const e of s.tool_calls){if("function"!==e.type)continue;const t=e.id,{name:n,arguments:a}=e.function,s=u[n];if(!s){const e=`Invalid tool_call: ${JSON.stringify(n)}. Available options are: ${Object.keys(u).map(e=>JSON.stringify(e)).join(", ")}. Please try again`;this._addMessage({role:r,tool_call_id:t,content:e});continue}if(o&&o!==n){const e=`Invalid tool_call: ${JSON.stringify(n)}. ${JSON.stringify(o)} requested. Please try again`;this._addMessage({role:r,tool_call_id:t,content:e});continue}let i;try{i=of(s)?await s.parse(a):a}catch(h){const e=h instanceof Error?h.message:String(h);this._addMessage({role:r,tool_call_id:t,content:e});continue}const l=await s.function(i,this),c=vd(this,kf,"m",Tf).call(this,l);if(this._addMessage({role:r,tool_call_id:t,content:c}),o)return}}}}kf=new WeakSet,Ef=function(){return vd(this,kf,"m",xf).call(this).content??null},xf=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(lf(t)){return{...t,content:t.content??null,refusal:t.refusal??null}}}throw new kd("stream ended without producing a ChatCompletionMessage with role=assistant")},Of=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(lf(t)&&t?.tool_calls?.length)return t.tool_calls.at(-1)?.function}},Af=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(cf(t)&&null!=t.content&&"string"===typeof t.content&&this.messages.some(e=>"assistant"===e.role&&e.tool_calls?.some(e=>"function"===e.type&&e.id===t.tool_call_id)))return t.content}},If=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},$f=function(e){if(null!=e.n&&e.n>1)throw new kd("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},Tf=function(e){return"string"===typeof e?e:void 0===e?"undefined":JSON.stringify(e)};class Uf extends zf{static runTools(e,t,n){const r=new Uf,a={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run(()=>r._runTools(e,t,a)),r}_addMessage(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super._addMessage(e,t),lf(e)&&e.content&&this._emit("content",e.content)}}const Ff={STR:1,NUM:2,ARR:4,OBJ:8,NULL:16,BOOL:32,NAN:64,INFINITY:128,MINUS_INFINITY:256,INF:384,SPECIAL:496,ATOM:499,COLLECTION:12,ALL:511};class Bf extends Error{}class qf extends Error{}const Hf=(e,t)=>{const n=e.length;let r=0;const a=e=>{throw new Bf(`${e} at position ${r}`)},s=e=>{throw new qf(`${e} at position ${r}`)},i=()=>(d(),r>=n&&a("Unexpected end of input"),'"'===e[r]?o():"{"===e[r]?l():"["===e[r]?c():"null"===e.substring(r,r+4)||Ff.NULL&t&&n-r<4&&"null".startsWith(e.substring(r))?(r+=4,null):"true"===e.substring(r,r+4)||Ff.BOOL&t&&n-r<4&&"true".startsWith(e.substring(r))?(r+=4,!0):"false"===e.substring(r,r+5)||Ff.BOOL&t&&n-r<5&&"false".startsWith(e.substring(r))?(r+=5,!1):"Infinity"===e.substring(r,r+8)||Ff.INFINITY&t&&n-r<8&&"Infinity".startsWith(e.substring(r))?(r+=8,1/0):"-Infinity"===e.substring(r,r+9)||Ff.MINUS_INFINITY&t&&1<n-r&&n-r<9&&"-Infinity".startsWith(e.substring(r))?(r+=9,-1/0):"NaN"===e.substring(r,r+3)||Ff.NAN&t&&n-r<3&&"NaN".startsWith(e.substring(r))?(r+=3,NaN):u()),o=()=>{const i=r;let o=!1;for(r++;r<n&&('"'!==e[r]||o&&"\\"===e[r-1]);)o="\\"===e[r]&&!o,r++;if('"'==e.charAt(r))try{return JSON.parse(e.substring(i,++r-Number(o)))}catch(l){s(String(l))}else if(Ff.STR&t)try{return JSON.parse(e.substring(i,r-Number(o))+'"')}catch(l){return JSON.parse(e.substring(i,e.lastIndexOf("\\"))+'"')}a("Unterminated string literal")},l=()=>{r++,d();const s={};try{for(;"}"!==e[r];){if(d(),r>=n&&Ff.OBJ&t)return s;const a=o();d(),r++;try{const e=i();Object.defineProperty(s,a,{value:e,writable:!0,enumerable:!0,configurable:!0})}catch(l){if(Ff.OBJ&t)return s;throw l}d(),","===e[r]&&r++}}catch(l){if(Ff.OBJ&t)return s;a("Expected '}' at end of object")}return r++,s},c=()=>{r++;const n=[];try{for(;"]"!==e[r];)n.push(i()),d(),","===e[r]&&r++}catch(s){if(Ff.ARR&t)return n;a("Expected ']' at end of array")}return r++,n},u=()=>{if(0===r){"-"===e&&Ff.NUM&t&&a("Not sure what '-' is");try{return JSON.parse(e)}catch(o){if(Ff.NUM&t)try{return"."===e[e.length-1]?JSON.parse(e.substring(0,e.lastIndexOf("."))):JSON.parse(e.substring(0,e.lastIndexOf("e")))}catch(o){}s(String(o))}}const i=r;for("-"===e[r]&&r++;e[r]&&!",]}".includes(e[r]);)r++;r!=n||Ff.NUM&t||a("Unterminated number literal");try{return JSON.parse(e.substring(i,r))}catch(o){"-"===e.substring(i,r)&&Ff.NUM&t&&a("Not sure what '-' is");try{return JSON.parse(e.substring(i,e.lastIndexOf("e")))}catch(o){s(String(o))}}},d=()=>{for(;r<n&&" \n\r\t".includes(e[r]);)r++};return i()},Wf=e=>function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ff.ALL;if("string"!==typeof e)throw new TypeError("expecting str, got "+typeof e);if(!e.trim())throw new Error(`${e} is empty`);return Hf(e.trim(),t)}(e,Ff.ALL^Ff.NUM);var Vf,Zf,Gf,Jf,Kf,Xf,Qf,Yf,ep,tp,np,rp;class ap extends zf{constructor(e){super(),Vf.add(this),Zf.set(this,void 0),Gf.set(this,void 0),Jf.set(this,void 0),bd(this,Zf,e,"f"),bd(this,Gf,[],"f")}get currentChatCompletionSnapshot(){return vd(this,Jf,"f")}static fromReadableStream(e){const t=new ap(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,n){const r=new ap(t);return r._run(()=>r._runChatCompletion(e,{...t,stream:!0},{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),r}async _createChatCompletion(e,t,n){super._createChatCompletion;const r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),vd(this,Vf,"m",Kf).call(this);const a=await e.chat.completions.create({...t,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(const s of a)vd(this,Vf,"m",Qf).call(this,s);if(a.controller.signal?.aborted)throw new xd;return this._addChatCompletion(vd(this,Vf,"m",tp).call(this))}async _fromReadableStream(e,t){const n=t?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),vd(this,Vf,"m",Kf).call(this),this._connected();const r=Nh.fromReadableStream(e,this.controller);let a;for await(const s of r)a&&a!==s.id&&this._addChatCompletion(vd(this,Vf,"m",tp).call(this)),vd(this,Vf,"m",Qf).call(this,s),a=s.id;if(r.controller.signal?.aborted)throw new xd;return this._addChatCompletion(vd(this,Vf,"m",tp).call(this))}[(Zf=new WeakMap,Gf=new WeakMap,Jf=new WeakMap,Vf=new WeakSet,Kf=function(){this.ended||bd(this,Jf,void 0,"f")},Xf=function(e){let t=vd(this,Gf,"f")[e.index];return t||(t={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},vd(this,Gf,"f")[e.index]=t,t)},Qf=function(e){if(this.ended)return;const t=vd(this,Vf,"m",rp).call(this,e);this._emit("chunk",e,t);for(const n of e.choices){const e=t.choices[n.index];null!=n.delta.content&&"assistant"===e.message?.role&&e.message?.content&&(this._emit("content",n.delta.content,e.message.content),this._emit("content.delta",{delta:n.delta.content,snapshot:e.message.content,parsed:e.message.parsed})),null!=n.delta.refusal&&"assistant"===e.message?.role&&e.message?.refusal&&this._emit("refusal.delta",{delta:n.delta.refusal,snapshot:e.message.refusal}),null!=n.logprobs?.content&&"assistant"===e.message?.role&&this._emit("logprobs.content.delta",{content:n.logprobs?.content,snapshot:e.logprobs?.content??[]}),null!=n.logprobs?.refusal&&"assistant"===e.message?.role&&this._emit("logprobs.refusal.delta",{refusal:n.logprobs?.refusal,snapshot:e.logprobs?.refusal??[]});const r=vd(this,Vf,"m",Xf).call(this,e);e.finish_reason&&(vd(this,Vf,"m",ep).call(this,e),null!=r.current_tool_call_index&&vd(this,Vf,"m",Yf).call(this,e,r.current_tool_call_index));for(const t of n.delta.tool_calls??[])r.current_tool_call_index!==t.index&&(vd(this,Vf,"m",ep).call(this,e),null!=r.current_tool_call_index&&vd(this,Vf,"m",Yf).call(this,e,r.current_tool_call_index)),r.current_tool_call_index=t.index;for(const t of n.delta.tool_calls??[]){const n=e.message.tool_calls?.[t.index];n?.type&&("function"===n?.type?this._emit("tool_calls.function.arguments.delta",{name:n.function?.name,index:t.index,arguments:n.function.arguments,parsed_arguments:n.function.parsed_arguments,arguments_delta:t.function?.arguments??""}):op(n?.type))}}},Yf=function(e,t){if(vd(this,Vf,"m",Xf).call(this,e).done_tool_calls.has(t))return;const n=e.message.tool_calls?.[t];if(!n)throw new Error("no tool call snapshot");if(!n.type)throw new Error("tool call snapshot missing `type`");if("function"===n.type){const e=vd(this,Zf,"f")?.tools?.find(e=>"function"===e.type&&e.function.name===n.function.name);this._emit("tool_calls.function.arguments.done",{name:n.function.name,index:t,arguments:n.function.arguments,parsed_arguments:Cf(e)?e.$parseRaw(n.function.arguments):e?.function.strict?JSON.parse(n.function.arguments):null})}else n.type},ep=function(e){const t=vd(this,Vf,"m",Xf).call(this,e);if(e.message.content&&!t.content_done){t.content_done=!0;const n=vd(this,Vf,"m",np).call(this);this._emit("content.done",{content:e.message.content,parsed:n?n.$parseRaw(e.message.content):null})}e.message.refusal&&!t.refusal_done&&(t.refusal_done=!0,this._emit("refusal.done",{refusal:e.message.refusal})),e.logprobs?.content&&!t.logprobs_content_done&&(t.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:e.logprobs.content})),e.logprobs?.refusal&&!t.logprobs_refusal_done&&(t.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:e.logprobs.refusal}))},tp=function(){if(this.ended)throw new kd("stream has ended, this shouldn't happen");const e=vd(this,Jf,"f");if(!e)throw new kd("request ended without sending any chunks");return bd(this,Jf,void 0,"f"),bd(this,Gf,[],"f"),function(e,t){const{id:n,choices:r,created:a,model:s,system_fingerprint:i,...o}=e,l={...o,id:n,choices:r.map(t=>{let{message:n,finish_reason:r,index:a,logprobs:s,...i}=t;if(!r)throw new kd(`missing finish_reason for choice ${a}`);const{content:o=null,function_call:l,tool_calls:c,...u}=n,d=n.role;if(!d)throw new kd(`missing role for choice ${a}`);if(l){const{arguments:e,name:t}=l;if(null==e)throw new kd(`missing function_call.arguments for choice ${a}`);if(!t)throw new kd(`missing function_call.name for choice ${a}`);return{...i,message:{content:o,function_call:{arguments:e,name:t},role:d,refusal:n.refusal??null},finish_reason:r,index:a,logprobs:s}}return c?{...i,index:a,finish_reason:r,logprobs:s,message:{...u,role:d,content:o,refusal:n.refusal??null,tool_calls:c.map((t,n)=>{const{function:r,type:s,id:i,...o}=t,{arguments:l,name:c,...u}=r||{};if(null==i)throw new kd(`missing choices[${a}].tool_calls[${n}].id\n${sp(e)}`);if(null==s)throw new kd(`missing choices[${a}].tool_calls[${n}].type\n${sp(e)}`);if(null==c)throw new kd(`missing choices[${a}].tool_calls[${n}].function.name\n${sp(e)}`);if(null==l)throw new kd(`missing choices[${a}].tool_calls[${n}].function.arguments\n${sp(e)}`);return{...o,id:i,type:s,function:{...u,name:c,arguments:l}}})}}:{...i,message:{...u,content:o,role:d,refusal:n.refusal??null},finish_reason:r,index:a,logprobs:s}}),created:a,model:s,object:"chat.completion",...i?{system_fingerprint:i}:{}};return function(e,t){return t&&Mf(t)?Nf(e,t):{...e,choices:e.choices.map(e=>({...e,message:{...e.message,parsed:null,...e.message.tool_calls?{tool_calls:e.message.tool_calls}:void 0}}))}}(l,t)}(e,vd(this,Zf,"f"))},np=function(){const e=vd(this,Zf,"f")?.response_format;return Rf(e)?e:null},rp=function(e){var t,n,r,a;let s=vd(this,Jf,"f");const{choices:i,...o}=e;s?Object.assign(s,o):s=bd(this,Jf,{...o,choices:[]},"f");for(const{delta:l,finish_reason:c,index:u,logprobs:d=null,...h}of e.choices){let e=s.choices[u];if(e||(e=s.choices[u]={finish_reason:c,index:u,message:{},logprobs:d,...h}),d)if(e.logprobs){const{content:r,refusal:a,...s}=d;ip(s),Object.assign(e.logprobs,s),r&&((t=e.logprobs).content??(t.content=[]),e.logprobs.content.push(...r)),a&&((n=e.logprobs).refusal??(n.refusal=[]),e.logprobs.refusal.push(...a))}else e.logprobs=Object.assign({},d);if(c&&(e.finish_reason=c,vd(this,Zf,"f")&&Mf(vd(this,Zf,"f")))){if("length"===c)throw new Ld;if("content_filter"===c)throw new Md}if(Object.assign(e,h),!l)continue;const{content:i,refusal:o,function_call:f,role:p,tool_calls:m,...g}=l;if(ip(g),Object.assign(e.message,g),o&&(e.message.refusal=(e.message.refusal||"")+o),p&&(e.message.role=p),f&&(e.message.function_call?(f.name&&(e.message.function_call.name=f.name),f.arguments&&((r=e.message.function_call).arguments??(r.arguments=""),e.message.function_call.arguments+=f.arguments)):e.message.function_call=f),i&&(e.message.content=(e.message.content||"")+i,!e.message.refusal&&vd(this,Vf,"m",np).call(this)&&(e.message.parsed=Wf(e.message.content))),m){e.message.tool_calls||(e.message.tool_calls=[]);for(const{index:t,id:n,type:r,function:s,...i}of m){const o=(a=e.message.tool_calls)[t]??(a[t]={});Object.assign(o,i),n&&(o.id=n),r&&(o.type=r),s&&(o.function??(o.function={name:s.name??"",arguments:""})),s?.name&&(o.function.name=s.name),s?.arguments&&(o.function.arguments+=s.arguments,Lf(vd(this,Zf,"f"),o)&&(o.function.parsed_arguments=Wf(o.function.arguments)))}}}return s},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("chunk",n=>{const r=t.shift();r?r.resolve(n):e.push(n)}),this.on("end",()=>{n=!0;for(const e of t)e.resolve(void 0);t.length=0}),this.on("abort",e=>{n=!0;for(const n of t)n.reject(e);t.length=0}),this.on("error",e=>{n=!0;for(const n of t)n.reject(e);t.length=0}),{next:async()=>{if(!e.length)return n?{value:void 0,done:!0}:new Promise((e,n)=>t.push({resolve:e,reject:n})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0});return{value:e.shift(),done:!1}},return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Nh(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function sp(e){return JSON.stringify(e)}function ip(e){}function op(e){}class lp extends ap{static fromReadableStream(e){const t=new lp(null);return t._run(()=>t._fromReadableStream(e)),t}static runTools(e,t,n){const r=new lp(t),a={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run(()=>r._runTools(e,t,a)),r}}class cp extends ef{constructor(){super(...arguments),this.messages=new sf(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(af`/chat/completions/${e}`,t)}update(e,t,n){return this._client.post(af`/chat/completions/${e}`,{body:t,...n})}list(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return this._client.getAPIList("/chat/completions",Bh,{query:e,...t})}delete(e,t){return this._client.delete(af`/chat/completions/${e}`,t)}parse(e,t){return function(e){for(const t of e??[]){if("function"!==t.type)throw new kd(`Currently only \`function\` tool types support auto-parsing; Received \`${t.type}\``);if(!0!==t.function.strict)throw new kd(`The \`${t.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"chat.completions.parse"}})._thenUnwrap(t=>Nf(t,e))}runTools(e,t){return e.stream?lp.runTools(this._client,e,t):Uf.runTools(this._client,e,t)}stream(e,t){return ap.createChatCompletion(this._client,e,t)}}cp.Messages=sf;class up extends ef{constructor(){super(...arguments),this.completions=new cp(this._client)}}up.Completions=cp;const dp=Symbol("brand.privateNullableHeaders");function*hp(e){if(!e)return;if(dp in e){const{values:t,nulls:n}=e;yield*t.entries();for(const e of n)yield[e,null];return}let t,n=!1;e instanceof Headers?t=e.entries():Fd(e)?t=e:(n=!0,t=Object.entries(e??{}));for(let r of t){const e=r[0];if("string"!==typeof e)throw new TypeError("expected header name to be a string");const t=Fd(r[1])?r[1]:[r[1]];let a=!1;for(const r of t)void 0!==r&&(n&&!a&&(a=!0,yield[e,null]),yield[e,r])}}const fp=e=>{const t=new Headers,n=new Set;for(const r of e){const e=new Set;for(const[a,s]of hp(r)){const r=a.toLowerCase();e.has(r)||(t.delete(a),e.add(r)),null===s?(t.delete(a),n.add(r)):(t.append(a,s),n.delete(r))}}return{[dp]:!0,values:t,nulls:n}};class pp extends ef{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:fp([{Accept:"application/octet-stream"},t?.headers]),__binaryResponse:!0})}}class mp extends ef{create(e,t){return this._client.post("/audio/transcriptions",Zh({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}},this._client))}}class gp extends ef{create(e,t){return this._client.post("/audio/translations",Zh({body:e,...t,__metadata:{model:e.model}},this._client))}}class yp extends ef{constructor(){super(...arguments),this.transcriptions=new mp(this._client),this.translations=new gp(this._client),this.speech=new pp(this._client)}}yp.Transcriptions=mp,yp.Translations=gp,yp.Speech=pp;class bp extends ef{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(af`/batches/${e}`,t)}list(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return this._client.getAPIList("/batches",Bh,{query:e,...t})}cancel(e,t){return this._client.post(af`/batches/${e}/cancel`,t)}}class vp extends ef{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:fp([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(af`/assistants/${e}`,{...t,headers:fp([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,n){return this._client.post(af`/assistants/${e}`,{body:t,...n,headers:fp([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return this._client.getAPIList("/assistants",Bh,{query:e,...t,headers:fp([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete(af`/assistants/${e}`,{...t,headers:fp([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class wp extends ef{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:fp([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class _p extends ef{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:fp([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class Sp extends ef{constructor(){super(...arguments),this.sessions=new wp(this._client),this.transcriptionSessions=new _p(this._client)}}Sp.Sessions=wp,Sp.TranscriptionSessions=_p;class kp extends ef{create(e,t,n){return this._client.post(af`/threads/${e}/messages`,{body:t,...n,headers:fp([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}retrieve(e,t,n){const{thread_id:r}=t;return this._client.get(af`/threads/${r}/messages/${e}`,{...n,headers:fp([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}update(e,t,n){const{thread_id:r,...a}=t;return this._client.post(af`/threads/${r}/messages/${e}`,{body:a,...n,headers:fp([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return this._client.getAPIList(af`/threads/${e}/messages`,Bh,{query:t,...n,headers:fp([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}delete(e,t,n){const{thread_id:r}=t;return this._client.delete(af`/threads/${r}/messages/${e}`,{...n,headers:fp([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}}class Ep extends ef{retrieve(e,t,n){const{thread_id:r,run_id:a,...s}=t;return this._client.get(af`/threads/${r}/runs/${a}/steps/${e}`,{query:s,...n,headers:fp([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e,t,n){const{thread_id:r,...a}=t;return this._client.getAPIList(af`/threads/${r}/runs/${e}/steps`,Bh,{query:a,...n,headers:fp([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}}const xp=e=>"undefined"!==typeof globalThis.process?globalThis.process.env?.[e]?.trim()??void 0:"undefined"!==typeof globalThis.Deno?globalThis.Deno.env?.get?.(e)?.trim():void 0;var Op,Ap,Ip,$p,Tp,Pp,Rp,Cp,Np,jp,Lp,Mp,Dp,zp,Up,Fp,Bp,qp,Hp,Wp,Vp,Zp,Gp,Jp,Kp,Xp,Qp,Yp,em,tm,nm;class rm extends Pf{constructor(){super(...arguments),Op.add(this),Ip.set(this,[]),$p.set(this,{}),Tp.set(this,{}),Pp.set(this,void 0),Rp.set(this,void 0),Cp.set(this,void 0),Np.set(this,void 0),jp.set(this,void 0),Lp.set(this,void 0),Mp.set(this,void 0),Dp.set(this,void 0),zp.set(this,void 0)}[(Ip=new WeakMap,$p=new WeakMap,Tp=new WeakMap,Pp=new WeakMap,Rp=new WeakMap,Cp=new WeakMap,Np=new WeakMap,jp=new WeakMap,Lp=new WeakMap,Mp=new WeakMap,Dp=new WeakMap,zp=new WeakMap,Op=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("event",n=>{const r=t.shift();r?r.resolve(n):e.push(n)}),this.on("end",()=>{n=!0;for(const e of t)e.resolve(void 0);t.length=0}),this.on("abort",e=>{n=!0;for(const n of t)n.reject(e);t.length=0}),this.on("error",e=>{n=!0;for(const n of t)n.reject(e);t.length=0}),{next:async()=>{if(!e.length)return n?{value:void 0,done:!0}:new Promise((e,n)=>t.push({resolve:e,reject:n})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0});return{value:e.shift(),done:!1}},return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new Ap;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){const n=t?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),this._connected();const r=Nh.fromReadableStream(e,this.controller);for await(const a of r)vd(this,Op,"m",Up).call(this,a);if(r.controller.signal?.aborted)throw new xd;return this._addRun(vd(this,Op,"m",Fp).call(this))}toReadableStream(){return new Nh(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,n,r){const a=new Ap;return a._run(()=>a._runToolAssistantStream(e,t,n,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createToolAssistantStream(e,t,n,r){const a=r?.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const s={...n,stream:!0},i=await e.submitToolOutputs(t,s,{...r,signal:this.controller.signal});this._connected();for await(const o of i)vd(this,Op,"m",Up).call(this,o);if(i.controller.signal?.aborted)throw new xd;return this._addRun(vd(this,Op,"m",Fp).call(this))}static createThreadAssistantStream(e,t,n){const r=new Ap;return r._run(()=>r._threadAssistantStream(e,t,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),r}static createAssistantStream(e,t,n,r){const a=new Ap;return a._run(()=>a._runAssistantStream(e,t,n,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),a}currentEvent(){return vd(this,Mp,"f")}currentRun(){return vd(this,Dp,"f")}currentMessageSnapshot(){return vd(this,Pp,"f")}currentRunStepSnapshot(){return vd(this,zp,"f")}async finalRunSteps(){return await this.done(),Object.values(vd(this,$p,"f"))}async finalMessages(){return await this.done(),Object.values(vd(this,Tp,"f"))}async finalRun(){if(await this.done(),!vd(this,Rp,"f"))throw Error("Final run was not received.");return vd(this,Rp,"f")}async _createThreadAssistantStream(e,t,n){const r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort()));const a={...t,stream:!0},s=await e.createAndRun(a,{...n,signal:this.controller.signal});this._connected();for await(const i of s)vd(this,Op,"m",Up).call(this,i);if(s.controller.signal?.aborted)throw new xd;return this._addRun(vd(this,Op,"m",Fp).call(this))}async _createAssistantStream(e,t,n,r){const a=r?.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const s={...n,stream:!0},i=await e.create(t,s,{...r,signal:this.controller.signal});this._connected();for await(const o of i)vd(this,Op,"m",Up).call(this,o);if(i.controller.signal?.aborted)throw new xd;return this._addRun(vd(this,Op,"m",Fp).call(this))}static accumulateDelta(e,t){for(const[n,r]of Object.entries(t)){if(!e.hasOwnProperty(n)){e[n]=r;continue}let t=e[n];if(null!==t&&void 0!==t)if("index"!==n&&"type"!==n){if("string"===typeof t&&"string"===typeof r)t+=r;else if("number"===typeof t&&"number"===typeof r)t+=r;else{if(!Bd(t)||!Bd(r)){if(Array.isArray(t)&&Array.isArray(r)){if(t.every(e=>"string"===typeof e||"number"===typeof e)){t.push(...r);continue}for(const e of r){if(!Bd(e))throw new Error(`Expected array delta entry to be an object but got: ${e}`);const n=e.index;if(null==n)throw console.error(e),new Error("Expected array delta entry to have an `index` property");if("number"!==typeof n)throw new Error(`Expected array delta entry \`index\` property to be a number but got ${n}`);const r=t[n];null==r?t.push(e):t[n]=this.accumulateDelta(r,e)}continue}throw Error(`Unhandled record type: ${n}, deltaValue: ${r}, accValue: ${t}`)}t=this.accumulateDelta(t,r)}e[n]=t}else e[n]=r;else e[n]=r}return e}_addRun(e){return e}async _threadAssistantStream(e,t,n){return await this._createThreadAssistantStream(t,e,n)}async _runAssistantStream(e,t,n,r){return await this._createAssistantStream(t,e,n,r)}async _runToolAssistantStream(e,t,n,r){return await this._createToolAssistantStream(t,e,n,r)}}Ap=rm,Up=function(e){if(!this.ended)switch(bd(this,Mp,e,"f"),vd(this,Op,"m",Hp).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":vd(this,Op,"m",Gp).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":vd(this,Op,"m",qp).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":vd(this,Op,"m",Bp).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},Fp=function(){if(this.ended)throw new kd("stream has ended, this shouldn't happen");if(!vd(this,Rp,"f"))throw Error("Final run has not been received");return vd(this,Rp,"f")},Bp=function(e){const[t,n]=vd(this,Op,"m",Vp).call(this,e,vd(this,Pp,"f"));bd(this,Pp,t,"f"),vd(this,Tp,"f")[t.id]=t;for(const r of n){const e=t.content[r.index];"text"==e?.type&&this._emit("textCreated",e.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const n of e.data.delta.content){if("text"==n.type&&n.text){let e=n.text,r=t.content[n.index];if(!r||"text"!=r.type)throw Error("The snapshot associated with this text delta is not text or missing");this._emit("textDelta",e,r.text)}if(n.index!=vd(this,Cp,"f")){if(vd(this,Np,"f"))switch(vd(this,Np,"f").type){case"text":this._emit("textDone",vd(this,Np,"f").text,vd(this,Pp,"f"));break;case"image_file":this._emit("imageFileDone",vd(this,Np,"f").image_file,vd(this,Pp,"f"))}bd(this,Cp,n.index,"f")}bd(this,Np,t.content[n.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(void 0!==vd(this,Cp,"f")){const t=e.data.content[vd(this,Cp,"f")];if(t)switch(t.type){case"image_file":this._emit("imageFileDone",t.image_file,vd(this,Pp,"f"));break;case"text":this._emit("textDone",t.text,vd(this,Pp,"f"))}}vd(this,Pp,"f")&&this._emit("messageDone",e.data),bd(this,Pp,void 0,"f")}},qp=function(e){const t=vd(this,Op,"m",Wp).call(this,e);switch(bd(this,zp,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const n=e.data.delta;if(n.step_details&&"tool_calls"==n.step_details.type&&n.step_details.tool_calls&&"tool_calls"==t.step_details.type)for(const e of n.step_details.tool_calls)e.index==vd(this,jp,"f")?this._emit("toolCallDelta",e,t.step_details.tool_calls[e.index]):(vd(this,Lp,"f")&&this._emit("toolCallDone",vd(this,Lp,"f")),bd(this,jp,e.index,"f"),bd(this,Lp,t.step_details.tool_calls[e.index],"f"),vd(this,Lp,"f")&&this._emit("toolCallCreated",vd(this,Lp,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":bd(this,zp,void 0,"f");"tool_calls"==e.data.step_details.type&&vd(this,Lp,"f")&&(this._emit("toolCallDone",vd(this,Lp,"f")),bd(this,Lp,void 0,"f")),this._emit("runStepDone",e.data,t)}},Hp=function(e){vd(this,Ip,"f").push(e),this._emit("event",e)},Wp=function(e){switch(e.event){case"thread.run.step.created":return vd(this,$p,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=vd(this,$p,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let n=e.data;if(n.delta){const r=Ap.accumulateDelta(t,n.delta);vd(this,$p,"f")[e.data.id]=r}return vd(this,$p,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":vd(this,$p,"f")[e.data.id]=e.data}if(vd(this,$p,"f")[e.data.id])return vd(this,$p,"f")[e.data.id];throw new Error("No snapshot available")},Vp=function(e,t){let n=[];switch(e.event){case"thread.message.created":return[e.data,n];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let r=e.data;if(r.delta.content)for(const e of r.delta.content)if(e.index in t.content){let n=t.content[e.index];t.content[e.index]=vd(this,Op,"m",Zp).call(this,e,n)}else t.content[e.index]=e,n.push(e);return[t,n];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,n];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},Zp=function(e,t){return Ap.accumulateDelta(t,e)},Gp=function(e){switch(bd(this,Dp,e.data,"f"),e.event){case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.cancelling":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":case"thread.run.incomplete":bd(this,Rp,e.data,"f"),vd(this,Lp,"f")&&(this._emit("toolCallDone",vd(this,Lp,"f")),bd(this,Lp,void 0,"f"))}};class am extends ef{constructor(){super(...arguments),this.steps=new Ep(this._client)}create(e,t,n){const{include:r,...a}=t;return this._client.post(af`/threads/${e}/runs`,{query:{include:r},body:a,...n,headers:fp([{"OpenAI-Beta":"assistants=v2"},n?.headers]),stream:t.stream??!1})}retrieve(e,t,n){const{thread_id:r}=t;return this._client.get(af`/threads/${r}/runs/${e}`,{...n,headers:fp([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}update(e,t,n){const{thread_id:r,...a}=t;return this._client.post(af`/threads/${r}/runs/${e}`,{body:a,...n,headers:fp([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return this._client.getAPIList(af`/threads/${e}/runs`,Bh,{query:t,...n,headers:fp([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}cancel(e,t,n){const{thread_id:r}=t;return this._client.post(af`/threads/${r}/runs/${e}/cancel`,{...n,headers:fp([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async createAndPoll(e,t,n){const r=await this.create(e,t,n);return await this.poll(r.id,{thread_id:e},n)}createAndStream(e,t,n){return rm.createAssistantStream(e,this._client.beta.threads.runs,t,n)}async poll(e,t,n){const r=fp([n?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){const{data:a,response:s}=await this.retrieve(e,t,{...n,headers:{...n?.headers,...r}}).withResponse();switch(a.status){case"queued":case"in_progress":case"cancelling":let e=5e3;if(n?.pollIntervalMs)e=n.pollIntervalMs;else{const t=s.headers.get("openai-poll-after-ms");if(t){const n=parseInt(t);isNaN(n)||(e=n)}}await qd(e);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return a}}}stream(e,t,n){return rm.createAssistantStream(e,this._client.beta.threads.runs,t,n)}submitToolOutputs(e,t,n){const{thread_id:r,...a}=t;return this._client.post(af`/threads/${r}/runs/${e}/submit_tool_outputs`,{body:a,...n,headers:fp([{"OpenAI-Beta":"assistants=v2"},n?.headers]),stream:t.stream??!1})}async submitToolOutputsAndPoll(e,t,n){const r=await this.submitToolOutputs(e,t,n);return await this.poll(r.id,t,n)}submitToolOutputsStream(e,t,n){return rm.createToolAssistantStream(e,this._client.beta.threads.runs,t,n)}}am.Steps=Ep;class sm extends ef{constructor(){super(...arguments),this.runs=new am(this._client),this.messages=new kp(this._client)}create(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return this._client.post("/threads",{body:e,...t,headers:fp([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(af`/threads/${e}`,{...t,headers:fp([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,n){return this._client.post(af`/threads/${e}`,{body:t,...n,headers:fp([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}delete(e,t){return this._client.delete(af`/threads/${e}`,{...t,headers:fp([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:fp([{"OpenAI-Beta":"assistants=v2"},t?.headers]),stream:e.stream??!1})}async createAndRunPoll(e,t){const n=await this.createAndRun(e,t);return await this.runs.poll(n.id,{thread_id:n.thread_id},t)}createAndRunStream(e,t){return rm.createThreadAssistantStream(e,this._client.beta.threads,t)}}sm.Runs=am,sm.Messages=kp;class im extends ef{constructor(){super(...arguments),this.realtime=new Sp(this._client),this.assistants=new vp(this._client),this.threads=new sm(this._client)}}im.Realtime=Sp,im.Assistants=vp,im.Threads=sm;class om extends ef{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}class lm extends ef{retrieve(e,t,n){const{container_id:r}=t;return this._client.get(af`/containers/${r}/files/${e}/content`,{...n,headers:fp([{Accept:"application/binary"},n?.headers]),__binaryResponse:!0})}}class cm extends ef{constructor(){super(...arguments),this.content=new lm(this._client)}create(e,t,n){return this._client.post(af`/containers/${e}/files`,Zh({body:t,...n},this._client))}retrieve(e,t,n){const{container_id:r}=t;return this._client.get(af`/containers/${r}/files/${e}`,n)}list(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return this._client.getAPIList(af`/containers/${e}/files`,Bh,{query:t,...n})}delete(e,t,n){const{container_id:r}=t;return this._client.delete(af`/containers/${r}/files/${e}`,{...n,headers:fp([{Accept:"*/*"},n?.headers])})}}cm.Content=lm;class um extends ef{constructor(){super(...arguments),this.files=new cm(this._client)}create(e,t){return this._client.post("/containers",{body:e,...t})}retrieve(e,t){return this._client.get(af`/containers/${e}`,t)}list(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return this._client.getAPIList("/containers",Bh,{query:e,...t})}delete(e,t){return this._client.delete(af`/containers/${e}`,{...t,headers:fp([{Accept:"*/*"},t?.headers])})}}um.Files=cm;class dm extends ef{create(e,t){const n=!!e.encoding_format;let r=n?e.encoding_format:"base64";n&&$h(this._client).debug("embeddings/user defined encoding_format:",e.encoding_format);const a=this._client.post("/embeddings",{body:{...e,encoding_format:r},...t});return n?a:($h(this._client).debug("embeddings/decoding base64 embeddings from base64"),a._thenUnwrap(e=>(e&&e.data&&e.data.forEach(e=>{const t=e.embedding;e.embedding=(e=>{if("undefined"!==typeof Buffer){const t=Buffer.from(e,"base64");return Array.from(new Float32Array(t.buffer,t.byteOffset,t.length/Float32Array.BYTES_PER_ELEMENT))}{const t=atob(e),n=t.length,r=new Uint8Array(n);for(let e=0;e<n;e++)r[e]=t.charCodeAt(e);return Array.from(new Float32Array(r.buffer))}})(t)}),e)))}}class hm extends ef{retrieve(e,t,n){const{eval_id:r,run_id:a}=t;return this._client.get(af`/evals/${r}/runs/${a}/output_items/${e}`,n)}list(e,t,n){const{eval_id:r,...a}=t;return this._client.getAPIList(af`/evals/${r}/runs/${e}/output_items`,Bh,{query:a,...n})}}class fm extends ef{constructor(){super(...arguments),this.outputItems=new hm(this._client)}create(e,t,n){return this._client.post(af`/evals/${e}/runs`,{body:t,...n})}retrieve(e,t,n){const{eval_id:r}=t;return this._client.get(af`/evals/${r}/runs/${e}`,n)}list(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return this._client.getAPIList(af`/evals/${e}/runs`,Bh,{query:t,...n})}delete(e,t,n){const{eval_id:r}=t;return this._client.delete(af`/evals/${r}/runs/${e}`,n)}cancel(e,t,n){const{eval_id:r}=t;return this._client.post(af`/evals/${r}/runs/${e}`,n)}}fm.OutputItems=hm;class pm extends ef{constructor(){super(...arguments),this.runs=new fm(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(af`/evals/${e}`,t)}update(e,t,n){return this._client.post(af`/evals/${e}`,{body:t,...n})}list(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return this._client.getAPIList("/evals",Bh,{query:e,...t})}delete(e,t){return this._client.delete(af`/evals/${e}`,t)}}pm.Runs=fm;class mm extends ef{create(e,t){return this._client.post("/files",Zh({body:e,...t},this._client))}retrieve(e,t){return this._client.get(af`/files/${e}`,t)}list(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return this._client.getAPIList("/files",Bh,{query:e,...t})}delete(e,t){return this._client.delete(af`/files/${e}`,t)}content(e,t){return this._client.get(af`/files/${e}/content`,{...t,headers:fp([{Accept:"application/binary"},t?.headers]),__binaryResponse:!0})}async waitForProcessing(e){let{pollInterval:t=5e3,maxWait:n=18e5}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=new Set(["processed","error","deleted"]),a=Date.now();let s=await this.retrieve(e);for(;!s.status||!r.has(s.status);)if(await qd(t),s=await this.retrieve(e),Date.now()-a>n)throw new Ad({message:`Giving up on waiting for file ${e} to finish processing after ${n} milliseconds.`});return s}}class gm extends ef{}class ym extends ef{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}}class bm extends ef{constructor(){super(...arguments),this.graders=new ym(this._client)}}bm.Graders=ym;class vm extends ef{create(e,t,n){return this._client.getAPIList(af`/fine_tuning/checkpoints/${e}/permissions`,Fh,{body:t,method:"post",...n})}retrieve(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return this._client.get(af`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...n})}delete(e,t,n){const{fine_tuned_model_checkpoint:r}=t;return this._client.delete(af`/fine_tuning/checkpoints/${r}/permissions/${e}`,n)}}class wm extends ef{constructor(){super(...arguments),this.permissions=new vm(this._client)}}wm.Permissions=vm;class _m extends ef{list(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return this._client.getAPIList(af`/fine_tuning/jobs/${e}/checkpoints`,Bh,{query:t,...n})}}class Sm extends ef{constructor(){super(...arguments),this.checkpoints=new _m(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(af`/fine_tuning/jobs/${e}`,t)}list(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return this._client.getAPIList("/fine_tuning/jobs",Bh,{query:e,...t})}cancel(e,t){return this._client.post(af`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return this._client.getAPIList(af`/fine_tuning/jobs/${e}/events`,Bh,{query:t,...n})}pause(e,t){return this._client.post(af`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post(af`/fine_tuning/jobs/${e}/resume`,t)}}Sm.Checkpoints=_m;class km extends ef{constructor(){super(...arguments),this.methods=new gm(this._client),this.jobs=new Sm(this._client),this.checkpoints=new wm(this._client),this.alpha=new bm(this._client)}}km.Methods=gm,km.Jobs=Sm,km.Checkpoints=wm,km.Alpha=bm;class Em extends ef{}class xm extends ef{constructor(){super(...arguments),this.graderModels=new Em(this._client)}}xm.GraderModels=Em;class Om extends ef{createVariation(e,t){return this._client.post("/images/variations",Zh({body:e,...t},this._client))}edit(e,t){return this._client.post("/images/edits",Zh({body:e,...t},this._client))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}class Am extends ef{retrieve(e,t){return this._client.get(af`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",Fh,e)}delete(e,t){return this._client.delete(af`/models/${e}`,t)}}class Im extends ef{create(e,t){return this._client.post("/moderations",{body:e,...t})}}function $m(e,t){return t&&function(e){if(Rf(e.text?.format))return!0;return!1}(t)?Tm(e,t):{...e,output_parsed:null,output:e.output.map(e=>"function_call"===e.type?{...e,parsed_arguments:null}:"message"===e.type?{...e,content:e.content.map(e=>({...e,parsed:null}))}:e)}}function Tm(e,t){const n=e.output.map(e=>{if("function_call"===e.type)return{...e,parsed_arguments:Nm(t,e)};if("message"===e.type){const n=e.content.map(e=>"output_text"===e.type?{...e,parsed:Pm(t,e.text)}:e);return{...e,content:n}}return e}),r=Object.assign({},e,{output:n});return Object.getOwnPropertyDescriptor(e,"output_text")||jm(r),Object.defineProperty(r,"output_parsed",{enumerable:!0,get(){for(const e of r.output)if("message"===e.type)for(const t of e.content)if("output_text"===t.type&&null!==t.parsed)return t.parsed;return null}}),r}function Pm(e,t){if("json_schema"!==e.text?.format?.type)return null;if("$parseRaw"in e.text?.format){const n=e.text?.format;return n.$parseRaw(t)}return JSON.parse(t)}function Rm(e){return"auto-parseable-tool"===e?.$brand}function Cm(e,t){return e.find(e=>"function"===e.type&&e.name===t)}function Nm(e,t){const n=Cm(e.tools??[],t.name);return{...t,...t,parsed_arguments:Rm(n)?n.$parseRaw(t.arguments):n?.strict?JSON.parse(t.arguments):null}}function jm(e){const t=[];for(const n of e.output)if("message"===n.type)for(const e of n.content)"output_text"===e.type&&t.push(e.text);e.output_text=t.join("")}class Lm extends Pf{constructor(e){super(),Jp.add(this),Kp.set(this,void 0),Xp.set(this,void 0),Qp.set(this,void 0),bd(this,Kp,e,"f")}static createResponse(e,t,n){const r=new Lm(t);return r._run(()=>r._createOrRetrieveResponse(e,t,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),r}async _createOrRetrieveResponse(e,t,n){const r=n?.signal;let a;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),vd(this,Jp,"m",Yp).call(this);let s=null;"response_id"in t?(a=await e.responses.retrieve(t.response_id,{stream:!0},{...n,signal:this.controller.signal,stream:!0}),s=t.starting_after??null):a=await e.responses.create({...t,stream:!0},{...n,signal:this.controller.signal}),this._connected();for await(const i of a)vd(this,Jp,"m",em).call(this,i,s);if(a.controller.signal?.aborted)throw new xd;return vd(this,Jp,"m",tm).call(this)}[(Kp=new WeakMap,Xp=new WeakMap,Qp=new WeakMap,Jp=new WeakSet,Yp=function(){this.ended||bd(this,Xp,void 0,"f")},em=function(e,t){if(this.ended)return;const n=(e,n)=>{(null==t||n.sequence_number>t)&&this._emit(e,n)},r=vd(this,Jp,"m",nm).call(this,e);switch(n("event",e),e.type){case"response.output_text.delta":{const t=r.output[e.output_index];if(!t)throw new kd(`missing output at index ${e.output_index}`);if("message"===t.type){const r=t.content[e.content_index];if(!r)throw new kd(`missing content at index ${e.content_index}`);if("output_text"!==r.type)throw new kd(`expected content to be 'output_text', got ${r.type}`);n("response.output_text.delta",{...e,snapshot:r.text})}break}case"response.function_call_arguments.delta":{const t=r.output[e.output_index];if(!t)throw new kd(`missing output at index ${e.output_index}`);"function_call"===t.type&&n("response.function_call_arguments.delta",{...e,snapshot:t.arguments});break}default:n(e.type,e)}},tm=function(){if(this.ended)throw new kd("stream has ended, this shouldn't happen");const e=vd(this,Xp,"f");if(!e)throw new kd("request ended without sending any events");bd(this,Xp,void 0,"f");const t=function(e,t){return $m(e,t)}(e,vd(this,Kp,"f"));return bd(this,Qp,t,"f"),t},nm=function(e){let t=vd(this,Xp,"f");if(!t){if("response.created"!==e.type)throw new kd(`When snapshot hasn't been set yet, expected 'response.created' event, got ${e.type}`);return t=bd(this,Xp,e.response,"f"),t}switch(e.type){case"response.output_item.added":t.output.push(e.item);break;case"response.content_part.added":{const n=t.output[e.output_index];if(!n)throw new kd(`missing output at index ${e.output_index}`);"message"===n.type&&n.content.push(e.part);break}case"response.output_text.delta":{const n=t.output[e.output_index];if(!n)throw new kd(`missing output at index ${e.output_index}`);if("message"===n.type){const t=n.content[e.content_index];if(!t)throw new kd(`missing content at index ${e.content_index}`);if("output_text"!==t.type)throw new kd(`expected content to be 'output_text', got ${t.type}`);t.text+=e.delta}break}case"response.function_call_arguments.delta":{const n=t.output[e.output_index];if(!n)throw new kd(`missing output at index ${e.output_index}`);"function_call"===n.type&&(n.arguments+=e.delta);break}case"response.completed":bd(this,Xp,e.response,"f")}return t},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("event",n=>{const r=t.shift();r?r.resolve(n):e.push(n)}),this.on("end",()=>{n=!0;for(const e of t)e.resolve(void 0);t.length=0}),this.on("abort",e=>{n=!0;for(const n of t)n.reject(e);t.length=0}),this.on("error",e=>{n=!0;for(const n of t)n.reject(e);t.length=0}),{next:async()=>{if(!e.length)return n?{value:void 0,done:!0}:new Promise((e,n)=>t.push({resolve:e,reject:n})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0});return{value:e.shift(),done:!1}},return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();const e=vd(this,Qp,"f");if(!e)throw new kd("stream ended without producing a ChatCompletion");return e}}class Mm extends ef{list(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return this._client.getAPIList(af`/responses/${e}/input_items`,Bh,{query:t,...n})}}class Dm extends ef{constructor(){super(...arguments),this.inputItems=new Mm(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap(e=>("object"in e&&"response"===e.object&&jm(e),e))}retrieve(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return this._client.get(af`/responses/${e}`,{query:t,...n,stream:t?.stream??!1})._thenUnwrap(e=>("object"in e&&"response"===e.object&&jm(e),e))}delete(e,t){return this._client.delete(af`/responses/${e}`,{...t,headers:fp([{Accept:"*/*"},t?.headers])})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(t=>Tm(t,e))}stream(e,t){return Lm.createResponse(this._client,e,t)}cancel(e,t){return this._client.post(af`/responses/${e}/cancel`,t)}}Dm.InputItems=Mm;class zm extends ef{create(e,t,n){return this._client.post(af`/uploads/${e}/parts`,Zh({body:t,...n},this._client))}}class Um extends ef{constructor(){super(...arguments),this.parts=new zm(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(af`/uploads/${e}/cancel`,t)}complete(e,t,n){return this._client.post(af`/uploads/${e}/complete`,{body:t,...n})}}Um.Parts=zm;class Fm extends ef{create(e,t,n){return this._client.post(af`/vector_stores/${e}/file_batches`,{body:t,...n,headers:fp([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}retrieve(e,t,n){const{vector_store_id:r}=t;return this._client.get(af`/vector_stores/${r}/file_batches/${e}`,{...n,headers:fp([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}cancel(e,t,n){const{vector_store_id:r}=t;return this._client.post(af`/vector_stores/${r}/file_batches/${e}/cancel`,{...n,headers:fp([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async createAndPoll(e,t,n){const r=await this.create(e,t);return await this.poll(e,r.id,n)}listFiles(e,t,n){const{vector_store_id:r,...a}=t;return this._client.getAPIList(af`/vector_stores/${r}/file_batches/${e}/files`,Bh,{query:a,...n,headers:fp([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async poll(e,t,n){const r=fp([n?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){const{data:a,response:s}=await this.retrieve(t,{vector_store_id:e},{...n,headers:r}).withResponse();switch(a.status){case"in_progress":let e=5e3;if(n?.pollIntervalMs)e=n.pollIntervalMs;else{const t=s.headers.get("openai-poll-after-ms");if(t){const n=parseInt(t);isNaN(n)||(e=n)}}await qd(e);break;case"failed":case"cancelled":case"completed":return a}}}async uploadAndPoll(e,t,n){let{files:r,fileIds:a=[]}=t;if(null==r||0==r.length)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const s=n?.maxConcurrency??5,i=Math.min(s,r.length),o=this._client,l=r.values(),c=[...a];const u=Array(i).fill(l).map(async function(e){for(let t of e){const e=await o.files.create({file:t,purpose:"assistants"},n);c.push(e.id)}});return await(async e=>{const t=await Promise.allSettled(e),n=t.filter(e=>"rejected"===e.status);if(n.length){for(const e of n)console.error(e.reason);throw new Error(`${n.length} promise(s) failed - see the above errors`)}const r=[];for(const a of t)"fulfilled"===a.status&&r.push(a.value);return r})(u),await this.createAndPoll(e,{file_ids:c})}}class Bm extends ef{create(e,t,n){return this._client.post(af`/vector_stores/${e}/files`,{body:t,...n,headers:fp([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}retrieve(e,t,n){const{vector_store_id:r}=t;return this._client.get(af`/vector_stores/${r}/files/${e}`,{...n,headers:fp([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}update(e,t,n){const{vector_store_id:r,...a}=t;return this._client.post(af`/vector_stores/${r}/files/${e}`,{body:a,...n,headers:fp([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return this._client.getAPIList(af`/vector_stores/${e}/files`,Bh,{query:t,...n,headers:fp([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}delete(e,t,n){const{vector_store_id:r}=t;return this._client.delete(af`/vector_stores/${r}/files/${e}`,{...n,headers:fp([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async createAndPoll(e,t,n){const r=await this.create(e,t,n);return await this.poll(e,r.id,n)}async poll(e,t,n){const r=fp([n?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){const a=await this.retrieve(t,{vector_store_id:e},{...n,headers:r}).withResponse(),s=a.data;switch(s.status){case"in_progress":let e=5e3;if(n?.pollIntervalMs)e=n.pollIntervalMs;else{const t=a.response.headers.get("openai-poll-after-ms");if(t){const n=parseInt(t);isNaN(n)||(e=n)}}await qd(e);break;case"failed":case"completed":return s}}}async upload(e,t,n){const r=await this._client.files.create({file:t,purpose:"assistants"},n);return this.create(e,{file_id:r.id},n)}async uploadAndPoll(e,t,n){const r=await this.upload(e,t,n);return await this.poll(e,r.id,n)}content(e,t,n){const{vector_store_id:r}=t;return this._client.getAPIList(af`/vector_stores/${r}/files/${e}/content`,Fh,{...n,headers:fp([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}}class qm extends ef{constructor(){super(...arguments),this.files=new Bm(this._client),this.fileBatches=new Fm(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:fp([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(af`/vector_stores/${e}`,{...t,headers:fp([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,n){return this._client.post(af`/vector_stores/${e}`,{body:t,...n,headers:fp([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return this._client.getAPIList("/vector_stores",Bh,{query:e,...t,headers:fp([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete(af`/vector_stores/${e}`,{...t,headers:fp([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}search(e,t,n){return this._client.getAPIList(af`/vector_stores/${e}/search`,Fh,{body:t,method:"post",...n,headers:fp([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}}var Hm,Wm,Vm,Zm,Gm,Jm,Km;qm.Files=Bm,qm.FileBatches=Fm;class Xm extends ef{constructor(){super(...arguments),Hm.add(this)}async unwrap(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._client.webhookSecret,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:300;return await this.verifySignature(e,t,n,r),JSON.parse(e)}async verifySignature(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._client.webhookSecret,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:300;if("undefined"===typeof crypto||"function"!==typeof crypto.subtle.importKey||"function"!==typeof crypto.subtle.verify)throw new Error("Webhook signature verification is only supported when the `crypto` global is defined");vd(this,Hm,"m",Wm).call(this,n);const a=fp([t]).values,s=vd(this,Hm,"m",Vm).call(this,a,"webhook-signature"),i=vd(this,Hm,"m",Vm).call(this,a,"webhook-timestamp"),o=vd(this,Hm,"m",Vm).call(this,a,"webhook-id"),l=parseInt(i,10);if(isNaN(l))throw new Dd("Invalid webhook timestamp format");const c=Math.floor(Date.now()/1e3);if(c-l>r)throw new Dd("Webhook timestamp is too old");if(l>c+r)throw new Dd("Webhook timestamp is too new");const u=s.split(" ").map(e=>e.startsWith("v1,")?e.substring(3):e),d=n.startsWith("whsec_")?Buffer.from(n.replace("whsec_",""),"base64"):Buffer.from(n,"utf-8"),h=o?`${o}.${i}.${e}`:`${i}.${e}`,f=await crypto.subtle.importKey("raw",d,{name:"HMAC",hash:"SHA-256"},!1,["verify"]);for(const p of u)try{const e=Buffer.from(p,"base64");if(await crypto.subtle.verify("HMAC",f,e,(new TextEncoder).encode(h)))return}catch{continue}throw new Dd("The given webhook signature does not match the expected signature")}}Hm=new WeakSet,Wm=function(e){if("string"!==typeof e||0===e.length)throw new Error("The webhook secret must either be set using the env var, OPENAI_WEBHOOK_SECRET, on the client class, OpenAI({ webhookSecret: '123' }), or passed to this function")},Vm=function(e,t){if(!e)throw new Error("Headers are required");const n=e.get(t);if(null===n||void 0===n)throw new Error(`Missing required header: ${t}`);return n};class Qm{constructor(){let{baseURL:e=xp("OPENAI_BASE_URL"),apiKey:t=xp("OPENAI_API_KEY"),organization:n=xp("OPENAI_ORG_ID")??null,project:r=xp("OPENAI_PROJECT_ID")??null,webhookSecret:a=xp("OPENAI_WEBHOOK_SECRET")??null,...s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(Zm.add(this),Jm.set(this,void 0),this.completions=new om(this),this.chat=new up(this),this.embeddings=new dm(this),this.files=new mm(this),this.images=new Om(this),this.audio=new yp(this),this.moderations=new Im(this),this.models=new Am(this),this.fineTuning=new km(this),this.graders=new xm(this),this.vectorStores=new qm(this),this.webhooks=new Xm(this),this.beta=new im(this),this.batches=new bp(this),this.uploads=new Um(this),this.responses=new Dm(this),this.evals=new pm(this),this.containers=new um(this),void 0===t)throw new kd("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const i={apiKey:t,organization:n,project:r,webhookSecret:a,...s,baseURL:e||"https://api.openai.com/v1"};if(!i.dangerouslyAllowBrowser&&"undefined"!==typeof window&&"undefined"!==typeof window.document&&"undefined"!==typeof navigator)throw new kd("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew OpenAI({ apiKey, dangerouslyAllowBrowser: true });\n\nhttps://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety\n");this.baseURL=i.baseURL,this.timeout=i.timeout??Gm.DEFAULT_TIMEOUT,this.logger=i.logger??console;const o="warn";this.logLevel=o,this.logLevel=Eh(i.logLevel,"ClientOptions.logLevel",this)??Eh(xp("OPENAI_LOG"),"process.env['OPENAI_LOG']",this)??o,this.fetchOptions=i.fetchOptions,this.maxRetries=i.maxRetries??2,this.fetch=i.fetch??function(){if("undefined"!==typeof fetch)return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}(),bd(this,Jm,Qd,"f"),this._options=i,this.apiKey=t,this.organization=n,this.project=r,this.webhookSecret=a}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,organization:this.organization,project:this.project,webhookSecret:this.webhookSecret,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders(e){let{values:t,nulls:n}=e}authHeaders(e){return fp([{Authorization:`Bearer ${this.apiKey}`}])}stringifyQuery(e){return fh(e,{arrayFormat:"brackets"})}getUserAgent(){return`${this.constructor.name}/JS ${Hd}`}defaultIdempotencyKey(){return`stainless-node-retry-${wd()}`}makeStatusError(e,t,n,r){return Ed.generate(e,t,n,r)}buildURL(e,t,n){const r=!vd(this,Zm,"m",Km).call(this)&&n||this.baseURL,a=(e=>zd.test(e))(e)?new URL(e):new URL(r+(r.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return function(e){if(!e)return!0;for(const t in e)return!1;return!0}(s)||(t={...s,...t}),"object"===typeof t&&t&&!Array.isArray(t)&&(a.search=this.stringifyQuery(t)),a.toString()}async prepareOptions(e){}async prepareRequest(e,t){let{url:n,options:r}=t}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then(n=>({method:e,path:t,...n})))}request(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new Dh(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,n){const r=await e,a=r.maxRetries??this.maxRetries;null==t&&(t=a),await this.prepareOptions(r);const{req:s,url:i,timeout:o}=this.buildRequest(r,{retryCount:a-t});await this.prepareRequest(s,{url:i,options:r});const l="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),c=void 0===n?"":`, retryOf: ${n}`,u=Date.now();if($h(this).debug(`[${l}] sending request`,Th({retryOfRequestLogID:n,method:r.method,url:i,options:r,headers:s.headers})),r.signal?.aborted)throw new xd;const d=new AbortController,h=await this.fetchWithTimeout(i,s,o,d).catch(Sd),f=Date.now();if(h instanceof Error){const e=`retrying, ${t} attempts remaining`;if(r.signal?.aborted)throw new xd;const a=_d(h)||/timed? ?out/i.test(String(h)+("cause"in h?String(h.cause):""));if(t)return $h(this).info(`[${l}] connection ${a?"timed out":"failed"} - ${e}`),$h(this).debug(`[${l}] connection ${a?"timed out":"failed"} (${e})`,Th({retryOfRequestLogID:n,url:i,durationMs:f-u,message:h.message})),this.retryRequest(r,t,n??l);if($h(this).info(`[${l}] connection ${a?"timed out":"failed"} - error; no more retries left`),$h(this).debug(`[${l}] connection ${a?"timed out":"failed"} (error; no more retries left)`,Th({retryOfRequestLogID:n,url:i,durationMs:f-u,message:h.message})),a)throw new Ad;throw new Od({cause:h})}const p=`[${l}${c}${[...h.headers.entries()].filter(e=>{let[t]=e;return"x-request-id"===t}).map(e=>{let[t,n]=e;return", "+t+": "+JSON.stringify(n)}).join("")}] ${s.method} ${i} ${h.ok?"succeeded":"failed"} with status ${h.status} in ${f-u}ms`;if(!h.ok){const e=this.shouldRetry(h);if(t&&e){const e=`retrying, ${t} attempts remaining`;return await async function(e){if(null===e||"object"!==typeof e)return;if(e[Symbol.asyncIterator])return void await(e[Symbol.asyncIterator]().return?.());const t=e.getReader(),n=t.cancel();t.releaseLock(),await n}(h.body),$h(this).info(`${p} - ${e}`),$h(this).debug(`[${l}] response error (${e})`,Th({retryOfRequestLogID:n,url:h.url,status:h.status,headers:h.headers,durationMs:f-u})),this.retryRequest(r,t,n??l,h.headers)}const a=e?"error; no more retries left":"error; not retryable";$h(this).info(`${p} - ${a}`);const s=await h.text().catch(e=>Sd(e).message),i=(e=>{try{return JSON.parse(e)}catch(t){return}})(s),o=i?void 0:s;$h(this).debug(`[${l}] response error (${a})`,Th({retryOfRequestLogID:n,url:h.url,status:h.status,headers:h.headers,message:o,durationMs:Date.now()-u}));throw this.makeStatusError(h.status,i,o,h.headers)}return $h(this).info(p),$h(this).debug(`[${l}] response start`,Th({retryOfRequestLogID:n,url:h.url,status:h.status,headers:h.headers,durationMs:f-u})),{response:h,options:r,controller:d,requestLogID:l,retryOfRequestLogID:n,startTime:u}}getAPIList(e,t,n){return this.requestAPIList(t,{method:"get",path:e,...n})}requestAPIList(e,t){const n=this.makeRequest(t,null,void 0);return new Uh(this,n,e)}async fetchWithTimeout(e,t,n,r){const{signal:a,method:s,...i}=t||{};a&&a.addEventListener("abort",()=>r.abort());const o=setTimeout(()=>r.abort(),n),l=globalThis.ReadableStream&&i.body instanceof globalThis.ReadableStream||"object"===typeof i.body&&null!==i.body&&Symbol.asyncIterator in i.body,c={signal:r.signal,...l?{duplex:"half"}:{},method:"GET",...i};s&&(c.method=s.toUpperCase());try{return await this.fetch.call(void 0,e,c)}finally{clearTimeout(o)}}shouldRetry(e){const t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||(409===e.status||(429===e.status||e.status>=500)))}async retryRequest(e,t,n,r){let a;const s=r?.get("retry-after-ms");if(s){const e=parseFloat(s);Number.isNaN(e)||(a=e)}const i=r?.get("retry-after");if(i&&!a){const e=parseFloat(i);a=Number.isNaN(e)?Date.parse(i)-Date.now():1e3*e}if(!(a&&0<=a&&a<6e4)){const n=e.maxRetries??this.maxRetries;a=this.calculateDefaultRetryTimeoutMillis(t,n)}return await qd(a),this.makeRequest(e,t-1,n)}calculateDefaultRetryTimeoutMillis(e,t){const n=t-e;return Math.min(.5*Math.pow(2,n),8)*(1-.25*Math.random())*1e3}buildRequest(e){let{retryCount:t=0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n={...e},{method:r,path:a,query:s,defaultBaseURL:i}=n,o=this.buildURL(a,s,i);"timeout"in n&&((e,t)=>{if("number"!==typeof t||!Number.isInteger(t))throw new kd(`${e} must be an integer`);if(t<0)throw new kd(`${e} must be a positive integer`)})("timeout",n.timeout),n.timeout=n.timeout??this.timeout;const{bodyHeaders:l,body:c}=this.buildBody({options:n});return{req:{method:r,headers:this.buildHeaders({options:e,method:r,bodyHeaders:l,retryCount:t}),...n.signal&&{signal:n.signal},...globalThis.ReadableStream&&c instanceof globalThis.ReadableStream&&{duplex:"half"},...c&&{body:c},...this.fetchOptions??{},...n.fetchOptions??{}},url:o,timeout:n.timeout}}buildHeaders(e){let{options:t,method:n,bodyHeaders:r,retryCount:a}=e,s={};this.idempotencyHeader&&"get"!==n&&(t.idempotencyKey||(t.idempotencyKey=this.defaultIdempotencyKey()),s[this.idempotencyHeader]=t.idempotencyKey);const i=fp([s,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(a),...t.timeout?{"X-Stainless-Timeout":String(Math.trunc(t.timeout/1e3))}:{},...Gd??(Gd=Wd()),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project},this.authHeaders(t),this._options.defaultHeaders,r,t.headers]);return this.validateHeaders(i),i.values}buildBody(e){let{options:{body:t,headers:n}}=e;if(!t)return{bodyHeaders:void 0,body:void 0};const r=fp([n]);return ArrayBuffer.isView(t)||t instanceof ArrayBuffer||t instanceof DataView||"string"===typeof t&&r.values.has("content-type")||t instanceof Blob||t instanceof FormData||t instanceof URLSearchParams||globalThis.ReadableStream&&t instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:t}:"object"===typeof t&&(Symbol.asyncIterator in t||Symbol.iterator in t&&"next"in t&&"function"===typeof t.next)?{bodyHeaders:void 0,body:Kd(t)}:vd(this,Jm,"f").call(this,{body:t,headers:r})}}Gm=Qm,Jm=new WeakMap,Zm=new WeakSet,Km=function(){return"https://api.openai.com/v1"!==this.baseURL},Qm.OpenAI=Gm,Qm.DEFAULT_TIMEOUT=6e5,Qm.OpenAIError=kd,Qm.APIError=Ed,Qm.APIConnectionError=Od,Qm.APIConnectionTimeoutError=Ad,Qm.APIUserAbortError=xd,Qm.NotFoundError=Pd,Qm.ConflictError=Rd,Qm.RateLimitError=Nd,Qm.BadRequestError=Id,Qm.AuthenticationError=$d,Qm.InternalServerError=jd,Qm.PermissionDeniedError=Td,Qm.UnprocessableEntityError=Cd,Qm.InvalidWebhookSignatureError=Dd,Qm.toFile=async function(e,t,n){if(qh(),(e=>null!=e&&"object"===typeof e&&"string"===typeof e.name&&"number"===typeof e.lastModified&&Qh(e))(e=await e))return e instanceof File?e:Hh([await e.arrayBuffer()],e.name);if((e=>null!=e&&"object"===typeof e&&"string"===typeof e.url&&"function"===typeof e.blob)(e)){const r=await e.blob();return t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()),Hh(await Yh(r),t,n)}const r=await Yh(e);if(t||(t=Wh(e)),!n?.type){const e=r.find(e=>"object"===typeof e&&"type"in e&&e.type);"string"===typeof e&&(n={...n,type:e})}return Hh(r,t,n)},Qm.Completions=om,Qm.Chat=up,Qm.Embeddings=dm,Qm.Files=mm,Qm.Images=Om,Qm.Audio=yp,Qm.Moderations=Im,Qm.Models=Am,Qm.FineTuning=km,Qm.Graders=xm,Qm.VectorStores=qm,Qm.Webhooks=Xm,Qm.Beta=im,Qm.Batches=bp,Qm.Uploads=Um,Qm.Responses=Dm,Qm.Evals=pm,Qm.Containers=um;new Set(["/completions","/chat/completions","/embeddings","/audio/transcriptions","/audio/translations","/audio/speech","/images/generations","/batches","/images/edits"]);var Ym="object"===typeof window?window:{},eg="0123456789abcdef".split(""),tg=[-2147483648,8388608,32768,128],ng=[24,16,8,0],rg=[];function ag(e){e?(rg[0]=rg[16]=rg[1]=rg[2]=rg[3]=rg[4]=rg[5]=rg[6]=rg[7]=rg[8]=rg[9]=rg[10]=rg[11]=rg[12]=rg[13]=rg[14]=rg[15]=0,this.blocks=rg):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=1732584193,this.h1=4023233417,this.h2=2562383102,this.h3=271733878,this.h4=3285377520,this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}ag.prototype.update=function(e){if(!this.finalized){var t="string"!==typeof e;t&&e.constructor===Ym.ArrayBuffer&&(e=new Uint8Array(e));for(var n,r,a=0,s=e.length||0,i=this.blocks;a<s;){if(this.hashed&&(this.hashed=!1,i[0]=this.block,i[16]=i[1]=i[2]=i[3]=i[4]=i[5]=i[6]=i[7]=i[8]=i[9]=i[10]=i[11]=i[12]=i[13]=i[14]=i[15]=0),t)for(r=this.start;a<s&&r<64;++a)i[r>>2]|=e[a]<<ng[3&r++];else for(r=this.start;a<s&&r<64;++a)(n=e.charCodeAt(a))<128?i[r>>2]|=n<<ng[3&r++]:n<2048?(i[r>>2]|=(192|n>>6)<<ng[3&r++],i[r>>2]|=(128|63&n)<<ng[3&r++]):n<55296||n>=57344?(i[r>>2]|=(224|n>>12)<<ng[3&r++],i[r>>2]|=(128|n>>6&63)<<ng[3&r++],i[r>>2]|=(128|63&n)<<ng[3&r++]):(n=65536+((1023&n)<<10|1023&e.charCodeAt(++a)),i[r>>2]|=(240|n>>18)<<ng[3&r++],i[r>>2]|=(128|n>>12&63)<<ng[3&r++],i[r>>2]|=(128|n>>6&63)<<ng[3&r++],i[r>>2]|=(128|63&n)<<ng[3&r++]);this.lastByteIndex=r,this.bytes+=r-this.start,r>=64?(this.block=i[16],this.start=r-64,this.hash(),this.hashed=!0):this.start=r}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296|0,this.bytes=this.bytes%4294967296),this}},ag.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var e=this.blocks,t=this.lastByteIndex;e[16]=this.block,e[t>>2]|=tg[3&t],this.block=e[16],t>=56&&(this.hashed||this.hash(),e[0]=this.block,e[16]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=e[9]=e[10]=e[11]=e[12]=e[13]=e[14]=e[15]=0),e[14]=this.hBytes<<3|this.bytes>>>29,e[15]=this.bytes<<3,this.hash()}},ag.prototype.hash=function(){var e,t,n=this.h0,r=this.h1,a=this.h2,s=this.h3,i=this.h4,o=this.blocks;for(e=16;e<80;++e)t=o[e-3]^o[e-8]^o[e-14]^o[e-16],o[e]=t<<1|t>>>31;for(e=0;e<20;e+=5)n=(t=(r=(t=(a=(t=(s=(t=(i=(t=n<<5|n>>>27)+(r&a|~r&s)+i+1518500249+o[e]|0)<<5|i>>>27)+(n&(r=r<<30|r>>>2)|~n&a)+s+1518500249+o[e+1]|0)<<5|s>>>27)+(i&(n=n<<30|n>>>2)|~i&r)+a+1518500249+o[e+2]|0)<<5|a>>>27)+(s&(i=i<<30|i>>>2)|~s&n)+r+1518500249+o[e+3]|0)<<5|r>>>27)+(a&(s=s<<30|s>>>2)|~a&i)+n+1518500249+o[e+4]|0,a=a<<30|a>>>2;for(;e<40;e+=5)n=(t=(r=(t=(a=(t=(s=(t=(i=(t=n<<5|n>>>27)+(r^a^s)+i+1859775393+o[e]|0)<<5|i>>>27)+(n^(r=r<<30|r>>>2)^a)+s+1859775393+o[e+1]|0)<<5|s>>>27)+(i^(n=n<<30|n>>>2)^r)+a+1859775393+o[e+2]|0)<<5|a>>>27)+(s^(i=i<<30|i>>>2)^n)+r+1859775393+o[e+3]|0)<<5|r>>>27)+(a^(s=s<<30|s>>>2)^i)+n+1859775393+o[e+4]|0,a=a<<30|a>>>2;for(;e<60;e+=5)n=(t=(r=(t=(a=(t=(s=(t=(i=(t=n<<5|n>>>27)+(r&a|r&s|a&s)+i-1894007588+o[e]|0)<<5|i>>>27)+(n&(r=r<<30|r>>>2)|n&a|r&a)+s-1894007588+o[e+1]|0)<<5|s>>>27)+(i&(n=n<<30|n>>>2)|i&r|n&r)+a-1894007588+o[e+2]|0)<<5|a>>>27)+(s&(i=i<<30|i>>>2)|s&n|i&n)+r-1894007588+o[e+3]|0)<<5|r>>>27)+(a&(s=s<<30|s>>>2)|a&i|s&i)+n-1894007588+o[e+4]|0,a=a<<30|a>>>2;for(;e<80;e+=5)n=(t=(r=(t=(a=(t=(s=(t=(i=(t=n<<5|n>>>27)+(r^a^s)+i-899497514+o[e]|0)<<5|i>>>27)+(n^(r=r<<30|r>>>2)^a)+s-899497514+o[e+1]|0)<<5|s>>>27)+(i^(n=n<<30|n>>>2)^r)+a-899497514+o[e+2]|0)<<5|a>>>27)+(s^(i=i<<30|i>>>2)^n)+r-899497514+o[e+3]|0)<<5|r>>>27)+(a^(s=s<<30|s>>>2)^i)+n-899497514+o[e+4]|0,a=a<<30|a>>>2;this.h0=this.h0+n|0,this.h1=this.h1+r|0,this.h2=this.h2+a|0,this.h3=this.h3+s|0,this.h4=this.h4+i|0},ag.prototype.hex=function(){this.finalize();var e=this.h0,t=this.h1,n=this.h2,r=this.h3,a=this.h4;return eg[e>>28&15]+eg[e>>24&15]+eg[e>>20&15]+eg[e>>16&15]+eg[e>>12&15]+eg[e>>8&15]+eg[e>>4&15]+eg[15&e]+eg[t>>28&15]+eg[t>>24&15]+eg[t>>20&15]+eg[t>>16&15]+eg[t>>12&15]+eg[t>>8&15]+eg[t>>4&15]+eg[15&t]+eg[n>>28&15]+eg[n>>24&15]+eg[n>>20&15]+eg[n>>16&15]+eg[n>>12&15]+eg[n>>8&15]+eg[n>>4&15]+eg[15&n]+eg[r>>28&15]+eg[r>>24&15]+eg[r>>20&15]+eg[r>>16&15]+eg[r>>12&15]+eg[r>>8&15]+eg[r>>4&15]+eg[15&r]+eg[a>>28&15]+eg[a>>24&15]+eg[a>>20&15]+eg[a>>16&15]+eg[a>>12&15]+eg[a>>8&15]+eg[a>>4&15]+eg[15&a]},ag.prototype.toString=ag.prototype.hex,ag.prototype.digest=function(){this.finalize();var e=this.h0,t=this.h1,n=this.h2,r=this.h3,a=this.h4;return[e>>24&255,e>>16&255,e>>8&255,255&e,t>>24&255,t>>16&255,t>>8&255,255&t,n>>24&255,n>>16&255,n>>8&255,255&n,r>>24&255,r>>16&255,r>>8&255,255&r,a>>24&255,a>>16&255,a>>8&255,255&a]},ag.prototype.array=ag.prototype.digest,ag.prototype.arrayBuffer=function(){this.finalize();var e=new ArrayBuffer(20),t=new DataView(e);return t.setUint32(0,this.h0),t.setUint32(4,this.h1),t.setUint32(8,this.h2),t.setUint32(12,this.h3),t.setUint32(16,this.h4),e};var sg="0123456789abcdef".split(""),ig=[-2147483648,8388608,32768,128],og=[24,16,8,0],lg=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],cg=[];function ug(e,t){t?(cg[0]=cg[16]=cg[1]=cg[2]=cg[3]=cg[4]=cg[5]=cg[6]=cg[7]=cg[8]=cg[9]=cg[10]=cg[11]=cg[12]=cg[13]=cg[14]=cg[15]=0,this.blocks=cg):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e?(this.h0=3238371032,this.h1=914150663,this.h2=812702999,this.h3=4144912697,this.h4=4290775857,this.h5=1750603025,this.h6=1694076839,this.h7=3204075428):(this.h0=1779033703,this.h1=3144134277,this.h2=1013904242,this.h3=2773480762,this.h4=1359893119,this.h5=2600822924,this.h6=528734635,this.h7=1541459225),this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0,this.is224=e}ug.prototype.update=function(e){if(!this.finalized){var t,n=typeof e;if("string"!==n){if("object"!==n)throw new Error(ERROR);if(null===e)throw new Error(ERROR);if(ARRAY_BUFFER&&e.constructor===ArrayBuffer)e=new Uint8Array(e);else if(!Array.isArray(e)&&(!ARRAY_BUFFER||!ArrayBuffer.isView(e)))throw new Error(ERROR);t=!0}for(var r,a,s=0,i=e.length,o=this.blocks;s<i;){if(this.hashed&&(this.hashed=!1,o[0]=this.block,this.block=o[16]=o[1]=o[2]=o[3]=o[4]=o[5]=o[6]=o[7]=o[8]=o[9]=o[10]=o[11]=o[12]=o[13]=o[14]=o[15]=0),t)for(a=this.start;s<i&&a<64;++s)o[a>>>2]|=e[s]<<og[3&a++];else for(a=this.start;s<i&&a<64;++s)(r=e.charCodeAt(s))<128?o[a>>>2]|=r<<og[3&a++]:r<2048?(o[a>>>2]|=(192|r>>>6)<<og[3&a++],o[a>>>2]|=(128|63&r)<<og[3&a++]):r<55296||r>=57344?(o[a>>>2]|=(224|r>>>12)<<og[3&a++],o[a>>>2]|=(128|r>>>6&63)<<og[3&a++],o[a>>>2]|=(128|63&r)<<og[3&a++]):(r=65536+((1023&r)<<10|1023&e.charCodeAt(++s)),o[a>>>2]|=(240|r>>>18)<<og[3&a++],o[a>>>2]|=(128|r>>>12&63)<<og[3&a++],o[a>>>2]|=(128|r>>>6&63)<<og[3&a++],o[a>>>2]|=(128|63&r)<<og[3&a++]);this.lastByteIndex=a,this.bytes+=a-this.start,a>=64?(this.block=o[16],this.start=a-64,this.hash(),this.hashed=!0):this.start=a}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296|0,this.bytes=this.bytes%4294967296),this}},ug.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var e=this.blocks,t=this.lastByteIndex;e[16]=this.block,e[t>>>2]|=ig[3&t],this.block=e[16],t>=56&&(this.hashed||this.hash(),e[0]=this.block,e[16]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=e[9]=e[10]=e[11]=e[12]=e[13]=e[14]=e[15]=0),e[14]=this.hBytes<<3|this.bytes>>>29,e[15]=this.bytes<<3,this.hash()}},ug.prototype.hash=function(){var e,t,n,r,a,s,i,o,l,c=this.h0,u=this.h1,d=this.h2,h=this.h3,f=this.h4,p=this.h5,m=this.h6,g=this.h7,y=this.blocks;for(e=16;e<64;++e)t=((a=y[e-15])>>>7|a<<25)^(a>>>18|a<<14)^a>>>3,n=((a=y[e-2])>>>17|a<<15)^(a>>>19|a<<13)^a>>>10,y[e]=y[e-16]+t+y[e-7]+n|0;for(l=u&d,e=0;e<64;e+=4)this.first?(this.is224?(s=300032,g=(a=y[0]-1413257819)-150054599|0,h=a+24177077|0):(s=704751109,g=(a=y[0]-210244248)-1521486534|0,h=a+143694565|0),this.first=!1):(t=(c>>>2|c<<30)^(c>>>13|c<<19)^(c>>>22|c<<10),r=(s=c&u)^c&d^l,g=h+(a=g+(n=(f>>>6|f<<26)^(f>>>11|f<<21)^(f>>>25|f<<7))+(f&p^~f&m)+lg[e]+y[e])|0,h=a+(t+r)|0),t=(h>>>2|h<<30)^(h>>>13|h<<19)^(h>>>22|h<<10),r=(i=h&c)^h&u^s,m=d+(a=p+(n=(g>>>6|g<<26)^(g>>>11|g<<21)^(g>>>25|g<<7))+(m&g^~m&f)+lg[e+1]+y[e+1])|0,t=((d=a+(t+r)|0)>>>2|d<<30)^(d>>>13|d<<19)^(d>>>22|d<<10),r=(o=d&h)^d&c^i,p=u+(a=f+(n=(m>>>6|m<<26)^(m>>>11|m<<21)^(m>>>25|m<<7))+(p&m^~p&g)+lg[e+2]+y[e+2])|0,t=((u=a+(t+r)|0)>>>2|u<<30)^(u>>>13|u<<19)^(u>>>22|u<<10),r=(l=u&d)^u&h^o,f=c+(a=f+(n=(p>>>6|p<<26)^(p>>>11|p<<21)^(p>>>25|p<<7))+(p&m^~p&g)+lg[e+3]+y[e+3])|0,c=a+(t+r)|0,this.chromeBugWorkAround=!0;this.h0=this.h0+c|0,this.h1=this.h1+u|0,this.h2=this.h2+d|0,this.h3=this.h3+h|0,this.h4=this.h4+f|0,this.h5=this.h5+p|0,this.h6=this.h6+m|0,this.h7=this.h7+g|0},ug.prototype.hex=function(){this.finalize();var e=this.h0,t=this.h1,n=this.h2,r=this.h3,a=this.h4,s=this.h5,i=this.h6,o=this.h7,l=sg[e>>>28&15]+sg[e>>>24&15]+sg[e>>>20&15]+sg[e>>>16&15]+sg[e>>>12&15]+sg[e>>>8&15]+sg[e>>>4&15]+sg[15&e]+sg[t>>>28&15]+sg[t>>>24&15]+sg[t>>>20&15]+sg[t>>>16&15]+sg[t>>>12&15]+sg[t>>>8&15]+sg[t>>>4&15]+sg[15&t]+sg[n>>>28&15]+sg[n>>>24&15]+sg[n>>>20&15]+sg[n>>>16&15]+sg[n>>>12&15]+sg[n>>>8&15]+sg[n>>>4&15]+sg[15&n]+sg[r>>>28&15]+sg[r>>>24&15]+sg[r>>>20&15]+sg[r>>>16&15]+sg[r>>>12&15]+sg[r>>>8&15]+sg[r>>>4&15]+sg[15&r]+sg[a>>>28&15]+sg[a>>>24&15]+sg[a>>>20&15]+sg[a>>>16&15]+sg[a>>>12&15]+sg[a>>>8&15]+sg[a>>>4&15]+sg[15&a]+sg[s>>>28&15]+sg[s>>>24&15]+sg[s>>>20&15]+sg[s>>>16&15]+sg[s>>>12&15]+sg[s>>>8&15]+sg[s>>>4&15]+sg[15&s]+sg[i>>>28&15]+sg[i>>>24&15]+sg[i>>>20&15]+sg[i>>>16&15]+sg[i>>>12&15]+sg[i>>>8&15]+sg[i>>>4&15]+sg[15&i];return this.is224||(l+=sg[o>>>28&15]+sg[o>>>24&15]+sg[o>>>20&15]+sg[o>>>16&15]+sg[o>>>12&15]+sg[o>>>8&15]+sg[o>>>4&15]+sg[15&o]),l},ug.prototype.toString=ug.prototype.hex,ug.prototype.digest=function(){this.finalize();var e=this.h0,t=this.h1,n=this.h2,r=this.h3,a=this.h4,s=this.h5,i=this.h6,o=this.h7,l=[e>>>24&255,e>>>16&255,e>>>8&255,255&e,t>>>24&255,t>>>16&255,t>>>8&255,255&t,n>>>24&255,n>>>16&255,n>>>8&255,255&n,r>>>24&255,r>>>16&255,r>>>8&255,255&r,a>>>24&255,a>>>16&255,a>>>8&255,255&a,s>>>24&255,s>>>16&255,s>>>8&255,255&s,i>>>24&255,i>>>16&255,i>>>8&255,255&i];return this.is224||l.push(o>>>24&255,o>>>16&255,o>>>8&255,255&o),l},ug.prototype.array=ug.prototype.digest,ug.prototype.arrayBuffer=function(){this.finalize();var e=new ArrayBuffer(this.is224?28:32),t=new DataView(e);return t.setUint32(0,this.h0),t.setUint32(4,this.h1),t.setUint32(8,this.h2),t.setUint32(12,this.h3),t.setUint32(16,this.h4),t.setUint32(20,this.h5),t.setUint32(24,this.h6),this.is224||t.setUint32(28,this.h7),e};new Map;var dg=n(4375),hg=Object.defineProperty;function fg(e,t){return 1===e.length?[t.get(e.join(","))]:function(e,t){let n=Array.from({length:e.length},(e,t)=>({start:t,end:t+1}));for(;n.length>1;){let r=null;for(let a=0;a<n.length-1;a++){const s=e.slice(n[a].start,n[a+1].end),i=t.get(s.join(","));null!=i&&(null==r||i<r[0])&&(r=[i,a])}if(null==r)break;{const e=r[1];n[e]={start:n[e].start,end:n[e+1].end},n.splice(e+1,1)}}return n}(e,t).map(n=>t.get(e.slice(n.start,n.end).join(","))).filter(e=>null!=e)}var pg,mg,gg=class{specialTokens;inverseSpecialTokens;patStr;textEncoder=(()=>new TextEncoder)();textDecoder=(()=>new TextDecoder("utf-8"))();rankMap=(()=>new Map)();textMap=(()=>new Map)();constructor(e,t){this.patStr=e.pat_str;const n=e.bpe_ranks.split("\n").filter(Boolean).reduce((e,t)=>{const[n,r,...a]=t.split(" "),s=Number.parseInt(r,10);return a.forEach((t,n)=>e[t]=s+n),e},{});for(const[r,a]of Object.entries(n)){const e=dg.toByteArray(r);this.rankMap.set(e.join(","),a),this.textMap.set(a,e)}this.specialTokens={...e.special_tokens,...t},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((e,t)=>{let[n,r]=t;return e[r]=this.textEncoder.encode(n),e},{})}encode(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"all";const r=new RegExp(this.patStr,"ug"),a=gg.specialTokenRegex(Object.keys(this.specialTokens)),s=[],i=new Set("all"===t?Object.keys(this.specialTokens):t),o=new Set("all"===n?Object.keys(this.specialTokens).filter(e=>!i.has(e)):n);if(o.size>0){const t=gg.specialTokenRegex([...o]),n=e.match(t);if(null!=n)throw new Error(`The text contains a special token that is not allowed: ${n[0]}`)}let l=0;for(;;){let t=null,n=l;for(;a.lastIndex=n,t=a.exec(e),null!=t&&!i.has(t[0]);)n=t.index+1;const o=t?.index??e.length;for(const a of e.substring(l,o).matchAll(r)){const e=this.textEncoder.encode(a[0]),t=this.rankMap.get(e.join(","));null==t?s.push(...fg(e,this.rankMap)):s.push(t)}if(null==t)break;let c=this.specialTokens[t[0]];s.push(c),l=t.index+t[0].length}return s}decode(e){const t=[];let n=0;for(let s=0;s<e.length;++s){const r=e[s],a=this.textMap.get(r)??this.inverseSpecialTokens[r];null!=a&&(t.push(a),n+=a.length)}const r=new Uint8Array(n);let a=0;for(const s of t)r.set(s,a),a+=s.length;return this.textDecoder.decode(r)}},yg=gg;mg=e=>new RegExp(e.map(e=>function(e){return e.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}(e)).join("|"),"g"),((e,t,n)=>{t in e?hg(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(yg,"symbol"!==typeof(pg="specialTokenRegex")?pg+"":pg,mg);class bg extends ad{get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(e){super(e),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verbose=e.verbose??!1,this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}}Error;Symbol("Let zodToJsonSchema decide on which parser to use");function vg(e){const{azureOpenAIApiDeploymentName:t,azureOpenAIApiInstanceName:n,azureOpenAIApiKey:r,azureOpenAIBasePath:a,baseURL:s,azureADTokenProvider:i,azureOpenAIEndpoint:o}=e;if((r||i)&&a&&t)return`${a}/${t}`;if((r||i)&&o&&t)return`${o}/openai/deployments/${t}`;if(r||i){if(!n)throw new Error("azureOpenAIApiInstanceName is required when using azureOpenAIApiKey");if(!t)throw new Error("azureOpenAIApiDeploymentName is a required parameter when using azureOpenAIApiKey");return`https://${n}.openai.azure.com/openai/deployments/${t}`}return s}function wg(e,t){return e.lc_error_code=t,e.message=`${e.message}\n\nTroubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${t}/\n`,e}function _g(e){let t;return e.constructor.name===Ad.name?(t=new Error(e.message),t.name="TimeoutError"):e.constructor.name===xd.name?(t=new Error(e.message),t.name="AbortError"):t=400===e.status&&e.message.includes("tool_calls")?wg(e,"INVALID_TOOL_RESULTS"):401===e.status?wg(e,"MODEL_AUTHENTICATION"):429===e.status?wg(e,"MODEL_RATE_LIMIT"):404===e.status?wg(e,"MODEL_NOT_FOUND"):e,t}const Sg=(e,t)=>e.reduce((e,n,r)=>{const a=Math.floor(r/t),s=e[a]||[];return e[a]=s.concat([n]),e},[]);class kg{constructor(e){Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.caller=new Xl(e??{})}}class Eg extends kg{constructor(e){const t={maxConcurrency:2,...e};super(t),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"text-embedding-ada-002"}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchSize",{enumerable:!0,configurable:!0,writable:!0,value:512}),Object.defineProperty(this,"stripNewLines",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"dimensions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const n=t?.apiKey??t?.openAIApiKey??Ro("OPENAI_API_KEY");this.organization=t?.configuration?.organization??Ro("OPENAI_ORGANIZATION"),this.model=t?.model??t?.modelName??this.model,this.modelName=this.model,this.batchSize=t?.batchSize??this.batchSize,this.stripNewLines=t?.stripNewLines??this.stripNewLines,this.timeout=t?.timeout,this.dimensions=t?.dimensions,this.clientConfig={apiKey:n,organization:this.organization,dangerouslyAllowBrowser:!0,...e?.configuration}}async embedDocuments(e){const t=Sg(this.stripNewLines?e.map(e=>e.replace(/\n/g," ")):e,this.batchSize),n=t.map(e=>{const t={model:this.model,input:e};return this.dimensions&&(t.dimensions=this.dimensions),this.embeddingWithRetry(t)}),r=await Promise.all(n),a=[];for(let s=0;s<r.length;s+=1){const e=t[s],{data:n}=r[s];for(let t=0;t<e.length;t+=1)a.push(n[t].embedding)}return a}async embedQuery(e){const t={model:this.model,input:this.stripNewLines?e.replace(/\n/g," "):e};this.dimensions&&(t.dimensions=this.dimensions);const{data:n}=await this.embeddingWithRetry(t);return n[0].embedding}async embeddingWithRetry(e){if(!this.client){const e=vg({baseURL:this.clientConfig.baseURL}),t={...this.clientConfig,baseURL:e,timeout:this.timeout,maxRetries:0};t.baseURL||delete t.baseURL,this.client=new Qm(t)}const t={};return this.caller.call(async()=>{try{return await this.client.embeddings.create(e,t)}catch(n){throw _g(n)}})}}class xg extends bg{get lc_namespace(){return["langchain","tools"]}constructor(e){super(e??{}),Object.defineProperty(this,"returnDirect",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"verboseParsingErrors",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"responseFormat",{enumerable:!0,configurable:!0,writable:!0,value:"content"}),this.verboseParsingErrors=e?.verboseParsingErrors??this.verboseParsingErrors,this.responseFormat=e?.responseFormat??this.responseFormat}async invoke(e,t){let n,r=Pl(t);return Zo(e)?(n=e.args,r={...r,toolCall:e}):n=e,this.call(n,r)}async call(e,t,n){const r=Zo(e)?e.args:e;let a;if(Uu(this.schema))try{a=await Fu(this.schema,r)}catch(f){let t="Received tool input did not match expected schema";throw this.verboseParsingErrors&&(t=`${t}\nDetails: ${f.message}`),new Go(t,JSON.stringify(e))}else{const t=wu(r,this.schema);if(!t.valid){let n="Received tool input did not match expected schema";throw this.verboseParsingErrors&&(n=`${n}\nDetails: ${t.errors.map(e=>`${e.keywordLocation}: ${e.error}`).join("\n")}`),new Go(n,JSON.stringify(e))}a=r}const s=gl(t),i=kl.configure(s.callbacks,this.callbacks,s.tags||n,this.tags,s.metadata,this.metadata,{verbose:this.verbose}),o=await(i?.handleToolStart(this.toJSON(),"string"===typeof e?e:JSON.stringify(e),s.runId,void 0,void 0,void 0,s.runName));let l,c,u,d;delete s.runId;try{l=await this._call(a,o,s)}catch(f){throw await(o?.handleToolError(f)),f}if("content_and_artifact"===this.responseFormat){if(!Array.isArray(l)||2!==l.length)throw new Error(`Tool response format is "content_and_artifact" but the output was not a two-tuple.\nResult: ${JSON.stringify(l)}`);[c,u]=l}else c=l;Zo(e)&&(d=e.id),!d&&function(e){return!!(e&&"object"===typeof e&&"toolCall"in e&&null!=e.toolCall&&"object"===typeof e.toolCall&&"id"in e.toolCall&&"string"===typeof e.toolCall.id)}(s)&&(d=s.toolCall.id);const h=function(e){const{content:t,artifact:n,toolCallId:r}=e;return r&&(a=t,null==a||"object"!==typeof a||!("lc_direct_tool_output"in a)||!0!==a.lc_direct_tool_output)?"string"===typeof t||Array.isArray(t)&&t.every(e=>"object"===typeof e)?new nl({content:t,artifact:n,tool_call_id:r,name:e.name}):new nl({content:Ag(t),artifact:n,tool_call_id:r,name:e.name}):t;var a}({content:c,artifact:u,toolCallId:d,name:this.name});return await(o?.handleToolEnd(h)),h}}class Og extends xg{constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:vs({input:ys().optional()}).transform(e=>e.input)})}call(e,t){const n="string"===typeof e||null==e?{input:e}:e;return super.call(n,t)}}function Ag(e){try{return JSON.stringify(e,null,2)??""}catch(t){return`${e}`}}Object.defineProperty(class extends Og{static lc_name(){return"DallEAPIWrapper"}constructor(e){void 0!==e?.responseFormat&&["url","b64_json"].includes(e.responseFormat)&&(e.dallEResponseFormat=e.responseFormat,e.responseFormat="content"),super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"dalle_api_wrapper"}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:"A wrapper around OpenAI DALL-E API. Useful for when you need to generate images from a text description. Input should be an image description."}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"dall-e-3"}),Object.defineProperty(this,"style",{enumerable:!0,configurable:!0,writable:!0,value:"vivid"}),Object.defineProperty(this,"quality",{enumerable:!0,configurable:!0,writable:!0,value:"standard"}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"size",{enumerable:!0,configurable:!0,writable:!0,value:"1024x1024"}),Object.defineProperty(this,"dallEResponseFormat",{enumerable:!0,configurable:!0,writable:!0,value:"url"}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const t={apiKey:e?.apiKey??e?.openAIApiKey??Ro("OPENAI_API_KEY"),organization:e?.organization??Ro("OPENAI_ORGANIZATION"),dangerouslyAllowBrowser:!0,baseURL:e?.baseUrl};this.client=new Qm(t),this.model=e?.model??e?.modelName??this.model,this.style=e?.style??this.style,this.quality=e?.quality??this.quality,this.n=e?.n??this.n,this.size=e?.size??this.size,this.dallEResponseFormat=e?.dallEResponseFormat??this.dallEResponseFormat,this.user=e?.user}processMultipleGeneratedUrls(e){return"url"===this.dallEResponseFormat?e.flatMap(e=>e.data?.flatMap(e=>e.url?{type:"image_url",image_url:e.url}:[]).filter(e=>void 0!==e&&"image_url"===e.type&&"string"===typeof e.image_url&&void 0!==e.image_url)??[]):e.flatMap(e=>e.data?.flatMap(e=>e.b64_json?{type:"image_url",image_url:{url:e.b64_json}}:[]).filter(e=>void 0!==e&&"image_url"===e.type&&"object"===typeof e.image_url&&"url"in e.image_url&&"string"===typeof e.image_url.url&&void 0!==e.image_url.url)??[])}async _call(e){const t={model:this.model,prompt:e,n:1,size:this.size,response_format:this.dallEResponseFormat,style:this.style,quality:this.quality,user:this.user};if(this.n>1){const e=await Promise.all(Array.from({length:this.n}).map(()=>this.client.images.generate(t)));return this.processMultipleGeneratedUrls(e)}const n=await this.client.images.generate(t);let r="";return"url"===this.dallEResponseFormat?[r]=n.data?.map(e=>e.url).filter(e=>"undefined"!==e)??[]:[r]=n.data?.map(e=>e.b64_json).filter(e=>"undefined"!==e)??[],r}},"toolName",{enumerable:!0,configurable:!0,writable:!0,value:"dalle_api_wrapper"});class Ig extends ad{constructor(e){super(e),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.callbacks=e?.callbacks,this.tags=e?.tags??[],this.metadata=e?.metadata??{},this.verbose=e?.verbose??!1}_getRelevantDocuments(e,t){throw new Error("Not implemented!")}async invoke(e,t){return this.getRelevantDocuments(e,Pl(t))}async getRelevantDocuments(e,t){const n=Pl(gl(t)),r=await kl.configure(n.callbacks,this.callbacks,n.tags,this.tags,n.metadata,this.metadata,{verbose:this.verbose}),a=await(r?.handleRetrieverStart(this.toJSON(),e,n.runId,void 0,void 0,void 0,n.runName));try{const t=await this._getRelevantDocuments(e,a);return await(a?.handleRetrieverEnd(t)),t}catch(s){throw await(a?.handleRetrieverError(s)),s}}}class $g extends Ig{static lc_name(){return"VectorStoreRetriever"}get lc_namespace(){return["langchain_core","vectorstores"]}_vectorstoreType(){return this.vectorStore._vectorstoreType()}constructor(e){super(e),Object.defineProperty(this,"vectorStore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"k",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(this,"searchType",{enumerable:!0,configurable:!0,writable:!0,value:"similarity"}),Object.defineProperty(this,"searchKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.vectorStore=e.vectorStore,this.k=e.k??this.k,this.searchType=e.searchType??this.searchType,this.filter=e.filter,"mmr"===e.searchType&&(this.searchKwargs=e.searchKwargs)}async _getRelevantDocuments(e,t){if("mmr"===this.searchType){if("function"!==typeof this.vectorStore.maxMarginalRelevanceSearch)throw new Error(`The vector store backing this retriever, ${this._vectorstoreType()} does not support max marginal relevance search.`);return this.vectorStore.maxMarginalRelevanceSearch(e,{k:this.k,filter:this.filter,...this.searchKwargs},t?.getChild("vectorstore"))}return this.vectorStore.similaritySearch(e,this.k,this.filter,t?.getChild("vectorstore"))}async addDocuments(e,t){return this.vectorStore.addDocuments(e,t)}}class Tg extends Ao{constructor(e,t){super(t),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","vectorstores",this._vectorstoreType()]}),Object.defineProperty(this,"embeddings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.embeddings=e}async delete(e){throw new Error("Not implemented.")}async similaritySearch(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;return(await this.similaritySearchVectorWithScore(await this.embeddings.embedQuery(e),t,n)).map(e=>e[0])}async similaritySearchWithScore(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;return this.similaritySearchVectorWithScore(await this.embeddings.embedQuery(e),t,n)}static fromTexts(e,t,n,r){throw new Error("the Langchain vectorstore implementation you are using forgot to override this, please report a bug")}static fromDocuments(e,t,n){throw new Error("the Langchain vectorstore implementation you are using forgot to override this, please report a bug")}asRetriever(e,t,n,r,a,s){if("number"===typeof e)return new $g({vectorStore:this,k:e,filter:t,tags:[...r??[],this._vectorstoreType()],metadata:a,verbose:s,callbacks:n});{const t={vectorStore:this,k:e?.k,filter:e?.filter,tags:[...e?.tags??[],this._vectorstoreType()],metadata:e?.metadata,verbose:e?.verbose,callbacks:e?.callbacks,searchType:e?.searchType};return new $g("mmr"===e?.searchType?{...t,searchKwargs:e.searchKwargs}:{...t})}}}function Pg(e,t){let n=0,r=0,a=0;for(let s=0;s<e.length;s++)n+=e[s]*t[s],r+=e[s]*e[s],a+=t[s]*t[s];return n/(Math.sqrt(r)*Math.sqrt(a))}function Rg(e,t){let n=0,r=0,a=0;for(let s=0;s<e.length;s++)n+=e[s]*t[s],r+=e[s]*e[s],a+=t[s]*t[s];return n/(Math.sqrt(r)*Math.sqrt(a))}function Cg(e,t,n){if(0===e.length||0===e[0].length||0===t.length||0===t[0].length)return[[]];if(e[0].length!==t[0].length)throw new Error(`Number of columns in X and Y must be the same. X has shape ${[e.length,e[0].length]} and Y has shape ${[t.length,t[0].length]}.`);return e.map(e=>t.map(t=>n(e,t)).map(e=>Number.isNaN(e)?0:e))}function Ng(e,t){return Cg(e,t,Rg)}function jg(e){if(0===e.length)return{maxIndex:-1,maxValue:NaN};let t=e[0],n=0;for(let r=1;r<e.length;r+=1)e[r]>t&&(n=r,t=e[r]);return{maxIndex:n,maxValue:t}}class Lg extends Tg{_vectorstoreType(){return"memory"}constructor(e){let{similarity:t,...n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(e,n),Object.defineProperty(this,"memoryVectors",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"similarity",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.similarity=t??Pg}async addDocuments(e){const t=e.map(e=>{let{pageContent:t}=e;return t});return this.addVectors(await this.embeddings.embedDocuments(t),e)}async addVectors(e,t){const n=e.map((e,n)=>({content:t[n].pageContent,embedding:e,metadata:t[n].metadata,id:t[n].id}));this.memoryVectors=this.memoryVectors.concat(n)}async _queryVectors(e,t,n){return this.memoryVectors.filter(e=>{if(!n)return!0;const t=new zr({metadata:e.metadata,pageContent:e.content,id:e.id});return n(t)}).map((t,n)=>({similarity:this.similarity(e,t.embedding),index:n,metadata:t.metadata,content:t.content,embedding:t.embedding,id:t.id})).sort((e,t)=>e.similarity>t.similarity?-1:0).slice(0,t)}async similaritySearchVectorWithScore(e,t,n){return(await this._queryVectors(e,t,n)).map(e=>[new zr({metadata:e.metadata,pageContent:e.content,id:e.id}),e.similarity])}async maxMarginalRelevanceSearch(e,t){const n=await this.embeddings.embedQuery(e),r=await this._queryVectors(n,t.fetchK??20,t.filter),a=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;if(Math.min(r,t.length)<=0)return[];const a=Ng(Array.isArray(e[0])?e:[e],t)[0],s=jg(a).maxIndex,i=[t[s]],o=[s];for(;o.length<Math.min(r,t.length);){let e=-1/0,r=-1;const s=Ng(t,i);a.forEach((t,a)=>{if(o.includes(a))return;const i=Math.max(...s[a]),l=n*t-(1-n)*i;l>e&&(e=l,r=a)}),i.push(t[r]),o.push(r)}return o}(n,r.map(e=>e.embedding),t.lambda,t.k);return a.map(e=>new zr({metadata:r[e].metadata,pageContent:r[e].content,id:r[e].id}))}static async fromTexts(e,t,n,r){const a=[];for(let s=0;s<e.length;s+=1){const n=Array.isArray(t)?t[s]:t,r=new zr({pageContent:e[s],metadata:n});a.push(r)}return Lg.fromDocuments(a,n,r)}static async fromDocuments(e,t,n){const r=new this(t,n);return await r.addDocuments(e),r}static async fromExistingIndex(e,t){return new this(e,t)}}class Mg extends yd{constructor(e){if(super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","document_transformers","text_splitters"]}),Object.defineProperty(this,"chunkSize",{enumerable:!0,configurable:!0,writable:!0,value:1e3}),Object.defineProperty(this,"chunkOverlap",{enumerable:!0,configurable:!0,writable:!0,value:200}),Object.defineProperty(this,"keepSeparator",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lengthFunction",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.chunkSize=e?.chunkSize??this.chunkSize,this.chunkOverlap=e?.chunkOverlap??this.chunkOverlap,this.keepSeparator=e?.keepSeparator??this.keepSeparator,this.lengthFunction=e?.lengthFunction??(e=>e.length),this.chunkOverlap>=this.chunkSize)throw new Error("Cannot have chunkOverlap >= chunkSize")}async transformDocuments(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.splitDocuments(e,t)}splitOnSeparator(e,t){let n;if(t)if(this.keepSeparator){const r=t.replace(/[/\-\\^$*+?.()|[\]{}]/g,"\\$&");n=e.split(new RegExp(`(?=${r})`))}else n=e.split(t);else n=e.split("");return n.filter(e=>""!==e)}async createDocuments(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=t.length>0?t:[...Array(e.length)].map(()=>({})),{chunkHeader:a="",chunkOverlapHeader:s="(cont'd) ",appendChunkOverlapHeader:i=!1}=n,o=new Array;for(let l=0;l<e.length;l+=1){const t=e[l];let n=1,c=null,u=-1;for(const e of await this.splitText(t)){let d=a;const h=t.indexOf(e,u+1);if(null===c){n+=this.numberOfNewLines(t,0,h)}else{const e=u+await this.lengthFunction(c);if(e<h){n+=this.numberOfNewLines(t,e,h)}else if(e>h){n-=this.numberOfNewLines(t,h,e)}i&&(d+=s)}const f=this.numberOfNewLines(e),p=r[l].loc&&"object"===typeof r[l].loc?{...r[l].loc}:{};p.lines={from:n,to:n+f};const m={...r[l],loc:p};d+=e,o.push(new zr({pageContent:d,metadata:m})),n+=f,c=e,u=h}}return o}numberOfNewLines(e,t,n){return(e.slice(t,n).match(/\n/g)||[]).length}async splitDocuments(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=e.filter(e=>void 0!==e.pageContent),r=n.map(e=>e.pageContent),a=n.map(e=>e.metadata);return this.createDocuments(r,a,t)}joinDocs(e,t){const n=e.join(t).trim();return""===n?null:n}async mergeSplits(e,t){const n=[],r=[];let a=0;for(const i of e){const e=await this.lengthFunction(i);if(a+e+r.length*t.length>this.chunkSize&&(a>this.chunkSize&&console.warn(`Created a chunk of size ${a}, +\nwhich is longer than the specified ${this.chunkSize}`),r.length>0)){const s=this.joinDocs(r,t);for(null!==s&&n.push(s);a>this.chunkOverlap||a+e+r.length*t.length>this.chunkSize&&a>0;)a-=await this.lengthFunction(r[0]),r.shift()}r.push(i),a+=e}const s=this.joinDocs(r,t);return null!==s&&n.push(s),n}}class Dg extends Mg{static lc_name(){return"RecursiveCharacterTextSplitter"}constructor(e){super(e),Object.defineProperty(this,"separators",{enumerable:!0,configurable:!0,writable:!0,value:["\n\n","\n"," ",""]}),this.separators=e?.separators??this.separators,this.keepSeparator=e?.keepSeparator??!0}async _splitText(e,t){const n=[];let r,a=t[t.length-1];for(let l=0;l<t.length;l+=1){const n=t[l];if(""===n){a=n;break}if(e.includes(n)){a=n,r=t.slice(l+1);break}}const s=this.splitOnSeparator(e,a);let i=[];const o=this.keepSeparator?"":a;for(const l of s)if(await this.lengthFunction(l)<this.chunkSize)i.push(l);else{if(i.length){const e=await this.mergeSplits(i,o);n.push(...e),i=[]}if(r){const e=await this._splitText(l,r);n.push(...e)}else n.push(l)}if(i.length){const e=await this.mergeSplits(i,o);n.push(...e)}return n}async splitText(e){return this._splitText(e,this.separators)}static fromLanguage(e,t){return new Dg({...t,separators:Dg.getSeparatorsForLanguage(e)})}static getSeparatorsForLanguage(e){if("cpp"===e)return["\nclass ","\nvoid ","\nint ","\nfloat ","\ndouble ","\nif ","\nfor ","\nwhile ","\nswitch ","\ncase ","\n\n","\n"," ",""];if("go"===e)return["\nfunc ","\nvar ","\nconst ","\ntype ","\nif ","\nfor ","\nswitch ","\ncase ","\n\n","\n"," ",""];if("java"===e)return["\nclass ","\npublic ","\nprotected ","\nprivate ","\nstatic ","\nif ","\nfor ","\nwhile ","\nswitch ","\ncase ","\n\n","\n"," ",""];if("js"===e)return["\nfunction ","\nconst ","\nlet ","\nvar ","\nclass ","\nif ","\nfor ","\nwhile ","\nswitch ","\ncase ","\ndefault ","\n\n","\n"," ",""];if("php"===e)return["\nfunction ","\nclass ","\nif ","\nforeach ","\nwhile ","\ndo ","\nswitch ","\ncase ","\n\n","\n"," ",""];if("proto"===e)return["\nmessage ","\nservice ","\nenum ","\noption ","\nimport ","\nsyntax ","\n\n","\n"," ",""];if("python"===e)return["\nclass ","\ndef ","\n\tdef ","\n\n","\n"," ",""];if("rst"===e)return["\n===\n","\n---\n","\n***\n","\n.. ","\n\n","\n"," ",""];if("ruby"===e)return["\ndef ","\nclass ","\nif ","\nunless ","\nwhile ","\nfor ","\ndo ","\nbegin ","\nrescue ","\n\n","\n"," ",""];if("rust"===e)return["\nfn ","\nconst ","\nlet ","\nif ","\nwhile ","\nfor ","\nloop ","\nmatch ","\nconst ","\n\n","\n"," ",""];if("scala"===e)return["\nclass ","\nobject ","\ndef ","\nval ","\nvar ","\nif ","\nfor ","\nwhile ","\nmatch ","\ncase ","\n\n","\n"," ",""];if("swift"===e)return["\nfunc ","\nclass ","\nstruct ","\nenum ","\nif ","\nfor ","\nwhile ","\ndo ","\nswitch ","\ncase ","\n\n","\n"," ",""];if("markdown"===e)return["\n## ","\n### ","\n#### ","\n##### ","\n###### ","```\n\n","\n\n***\n\n","\n\n---\n\n","\n\n___\n\n","\n\n","\n"," ",""];if("latex"===e)return["\n\\chapter{","\n\\section{","\n\\subsection{","\n\\subsubsection{","\n\\begin{enumerate}","\n\\begin{itemize}","\n\\begin{description}","\n\\begin{list}","\n\\begin{quote}","\n\\begin{quotation}","\n\\begin{verse}","\n\\begin{verbatim}","\n\\begin{align}","$$","$","\n\n","\n"," ",""];if("html"===e)return["<body>","<div>","<p>","<br>","<li>","<h1>","<h2>","<h3>","<h4>","<h5>","<h6>","<span>","<table>","<tr>","<td>","<th>","<ul>","<ol>","<header>","<footer>","<nav>","<head>","<style>","<script>","<meta>","<title>"," ",""];if("sol"===e)return["\npragma ","\nusing ","\ncontract ","\ninterface ","\nlibrary ","\nconstructor ","\ntype ","\nfunction ","\nevent ","\nmodifier ","\nerror ","\nstruct ","\nenum ","\nif ","\nfor ","\nwhile ","\ndo while ","\nassembly ","\n\n","\n"," ",""];throw new Error(`Language ${e} is not supported.`)}}var zg=n(579);const Ug=function(){const[e,n]=(0,t.useState)(()=>localStorage.getItem("openai-api-key")||""),[r,a]=(0,t.useState)("gpt-4o"),[s,i]=(0,t.useState)([]),[o,l]=(0,t.useState)(null),[c,u]=(0,t.useState)(""),[d,h]=(0,t.useState)(!1),[f,p]=(0,t.useState)(!1),[m,g]=(0,t.useState)(!1),[y,b]=(0,t.useState)(!1),[v,w]=(0,t.useState)(null),[_,S]=(0,t.useState)(null),[k,E]=(0,t.useState)("No documents loaded."),[x,O]=(0,t.useState)([]),A=(0,t.useRef)(null),I=(0,t.useRef)(null),$=(0,t.useRef)(null),T=(0,t.useRef)(0),[P,R]=(0,t.useState)(!1);(0,t.useEffect)(()=>{const e=localStorage.getItem("chatbot-chats");if(e){const t=JSON.parse(e);if(t.length>0){i(t);const e=localStorage.getItem("chatbot-active-chat-id"),n=t.some(t=>t.id===e);return void l(n?e:t[0].id)}}j()},[]);const C=s.find(e=>e.id===o);(0,t.useEffect)(()=>{var e;!d&&C&&(null===(e=I.current)||void 0===e||e.focus())},[d,C]),(0,t.useEffect)(()=>{localStorage.setItem("openai-api-key",e)},[e]),(0,t.useEffect)(()=>{localStorage.setItem("chatbot-chats",JSON.stringify(s)),o&&localStorage.setItem("chatbot-active-chat-id",o)},[s,o]),(0,t.useEffect)(()=>{A.current&&(A.current.scrollTop=A.current.scrollHeight)},[s,o]),(0,t.useEffect)(()=>{const e=window.SpeechRecognition||window.webkitSpeechRecognition;if(e){R(!0);const t=new e;t.continuous=!0,t.interimResults=!0,t.lang="en-US",t.onstart=()=>p(!0),t.onend=()=>p(!1),t.onerror=e=>{console.error("Speech recognition error:",e.error),p(!1)},t.onresult=e=>{let t="";for(let n=T.current;n<e.results.length;n++)t+=e.results[n][0].transcript;u(t);if(e.results[e.results.length-1].isFinal){const n=/\s(send|sent)$/i;if(n.test(t)){const r=t.replace(n,"").trim();r&&(w(r),T.current=e.results.length)}}},$.current=t}else console.warn("Speech Recognition API is not supported in this browser."),R(!1)},[]);const N=(0,t.useCallback)(e=>{if(m||!window.speechSynthesis)return;window.speechSynthesis.cancel();const t=new SpeechSynthesisUtterance(e);window.speechSynthesis.speak(t)},[m]),j=()=>{const e={id:Date.now().toString(),title:"New Chat",messages:[]};i([e,...s]),l(e.id)},L=(0,t.useCallback)(async()=>{if(0===x.length)return S(null),void E("No documents loaded.");E(`Processing ${x.length} document(s)...`);try{const t=x.map(e=>{let{content:t}=e;const n=(new DOMParser).parseFromString(t,"text/html");return new zr({pageContent:n.body.textContent||""})}),n=new Dg({chunkSize:1e3,chunkOverlap:200}),r=await n.splitDocuments(t),a=new Eg({openAIApiKey:e}),s=await Lg.fromDocuments(r,a);S(s.asRetriever()),E(`Ready. ${x.length} document(s) loaded.`)}catch(t){console.error("Error building RAG system:",t),E("Error processing documents.")}},[e,x]);(0,t.useEffect)(()=>{L()},[L]);const M={role:"system",content:"You are a helpful digital consciousness named Olly that has been created by Zachary Kulik as a demo for the company Olivia."},D=(0,t.useCallback)(async t=>{if(""===t.trim()||d)return;if(!e)return void alert("Please enter your OpenAI API key.");u(""),h(!0);let n="";if(_){n=(await _.getRelevantDocuments(t)).map(e=>e.pageContent).join("\n\n---\n\n")}const a=[];let c;n?a.push({role:"system",content:`Based on the following context, answer the user's question.\n\nContext:\n${n}`}):a.push(M);const f={role:"user",content:t};if(o){const e=s.find(e=>e.id===o),t=[...e.messages,f];i(s.map(e=>e.id===o?{...e,messages:t}:e)),c={...e,messages:t}}else c={id:Date.now().toString(),title:"New Chat",messages:[f]},l(c.id),i(e=>[c,...e]);a.push(...c.messages);try{const n=new Dr({apiKey:e,dangerouslyAllowBrowser:!0});if(1===c.messages.length){var p;const e=`Generate a short, concise title (3-5 words) for the following user query: "${t}"`,r=(null===(p=(await n.chat.completions.create({model:"gpt-4o",messages:[{role:"user",content:e}]})).choices[0].message.content)||void 0===p?void 0:p.replace(/["']/g,""))||"Chat";i(e=>e.map(e=>e.id===c.id?{...e,title:r}:e))}const s=(await n.chat.completions.create({model:r,messages:a})).choices[0].message;if(s.content){N(s.content);const e={role:"assistant",content:s.content};i(t=>t.map(t=>t.id===c.id?{...t,messages:[...t.messages,e]}:t))}}catch(m){console.error("Error calling OpenAI API:",m);const e="Sorry, something went wrong.";N(e);const t={role:"assistant",content:e};i(e=>e.map(e=>e.id===c.id?{...e,messages:[...e.messages,t]}:e))}finally{h(!1)}},[e,o,s,d,r,N,M,_]);(0,t.useEffect)(()=>{v&&(D(v),w(null))},[v,D]);const z=()=>{D(c)};return(0,zg.jsxs)("div",{className:"App",children:[(0,zg.jsxs)("div",{className:"sidebar "+(y?"collapsed":""),children:[(0,zg.jsx)("button",{className:"new-chat-button",onClick:j,children:"+ New Chat"}),(0,zg.jsx)("ul",{className:"chat-history-list",children:s.map(e=>(0,zg.jsxs)("li",{className:"chat-history-item "+(e.id===o?"active":""),onClick:()=>l(e.id),children:[e.title,(0,zg.jsx)("button",{className:"delete-chat-button",onClick:t=>((e,t)=>{if(e.stopPropagation(),i(s.filter(e=>e.id!==t)),o===t){const e=s.filter(e=>e.id!==t);l(e.length>0?e[0].id:null)}})(t,e.id),children:"\u2715"})]},e.id))}),(0,zg.jsxs)("div",{className:"rag-controls",children:[(0,zg.jsx)("input",{type:"file",id:"file-upload-input",multiple:!0,accept:".txt,text/plain",onChange:t=>(async t=>{if(!e)return void alert("Please enter your OpenAI API key before loading documents.");if(!t||0===t.length)return;const n=await Promise.all(Array.from(t).map(async e=>({name:e.name,content:await e.text()})));O(e=>{const t=new Set(e.map(e=>e.name)),r=n.filter(e=>!t.has(e.name));return[...e,...r]})})(t.target.files)}),(0,zg.jsx)("label",{htmlFor:"file-upload-input",className:"load-docs-button",children:"Load Documents"}),(0,zg.jsx)("div",{className:"rag-status",children:k}),x.length>0&&(0,zg.jsx)("ul",{className:"document-list",children:x.map((e,t)=>(0,zg.jsxs)("li",{className:"document-list-item",title:e.name,children:[e.name,(0,zg.jsx)("button",{className:"remove-doc-button",onClick:()=>{return t=e.name,void O(e=>e.filter(e=>e.name!==t));var t},children:"\u2715"})]},t))})]})]}),(0,zg.jsxs)("div",{className:"main-chat-area",children:[(0,zg.jsxs)("header",{className:"App-header",children:[(0,zg.jsxs)("div",{className:"header-left",children:[(0,zg.jsx)("button",{className:"sidebar-toggle-button",onClick:()=>b(!y),children:y?"\u203a":"\u2039"}),(0,zg.jsx)("h1",{children:"Chatbot Example"})]}),(0,zg.jsxs)("div",{className:"controls-container",children:[(0,zg.jsx)("input",{type:"password",value:e,onChange:e=>n(e.target.value),placeholder:"Enter your OpenAI API Key"}),(0,zg.jsxs)("select",{value:r,onChange:e=>a(e.target.value),children:[(0,zg.jsx)("option",{value:"gpt-4o",children:"GPT-4o"}),(0,zg.jsx)("option",{value:"gpt-4o-mini",children:"GPT-4o-mini"}),(0,zg.jsx)("option",{value:"o1",children:"o1"}),(0,zg.jsx)("option",{value:"o4-mini",children:"o4-mini"})]}),(0,zg.jsx)("button",{className:"mute-button",onClick:()=>g(!m),children:m?"\ud83d\udd07":"\ud83d\udd0a"})]})]}),(0,zg.jsxs)("div",{className:"chat-window",ref:A,children:[C?C.messages.map((e,t)=>(0,zg.jsx)("div",{className:`message ${e.role}`,children:(0,zg.jsx)("p",{children:e.content})},t)):null,d&&(0,zg.jsx)("div",{className:"message assistant",children:(0,zg.jsx)("p",{children:"Thinking..."})})]}),f&&(0,zg.jsx)("div",{className:"listening-popup",children:'Listening... Say "send" to send your message.'}),(0,zg.jsxs)("div",{className:"input-container",children:[P&&(0,zg.jsx)("button",{className:"mic-button "+(f?"listening":""),onClick:()=>{var e,t;f?null===(e=$.current)||void 0===e||e.stop():(T.current=0,null===(t=$.current)||void 0===t||t.start())},children:f?"...":"\ud83c\udfa4"}),(0,zg.jsx)("input",{ref:I,type:"text",value:c,onChange:e=>u(e.target.value),onKeyPress:e=>{"Enter"===e.key&&z()},placeholder:P?"Type your message or use the microphone...":"Type your message...",disabled:d}),(0,zg.jsx)("button",{onClick:z,disabled:d,children:"Send"})]})]})]})},Fg=e=>{e&&e instanceof Function&&n.e(453).then(n.bind(n,6453)).then(t=>{let{getCLS:n,getFID:r,getFCP:a,getLCP:s,getTTFB:i}=t;n(e),r(e),a(e),s(e),i(e)})};r.createRoot(document.getElementById("root")).render((0,zg.jsx)(t.StrictMode,{children:(0,zg.jsx)(Ug,{})})),Fg()})()})();
//# sourceMappingURL=main.4b176e3d.js.map